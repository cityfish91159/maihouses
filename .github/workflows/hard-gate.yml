# ============================================================================
# Hard Gate (ä¸å¯ç¹é) - Server-Side Enforcement
# ============================================================================
# é€™æ˜¯çœŸæ­£çš„ç‰©ç†é˜»æ–·ï¼Œå³ä½¿æœ¬åœ°ç¹é git hooksï¼ŒGitHub ä¹Ÿæœƒæ“‹ä½
# ============================================================================

name: Hard Gate (ä¸å¯ç¹é)

on: [push, pull_request]

jobs:
  gate:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: TypeScript æª¢æŸ¥
        run: npm run typecheck

      - name: ESLint æª¢æŸ¥
        run: npm run lint

      - name: G6 å·æ‡¶ä»£ç¢¼æª¢æŸ¥
        run: |
          echo "ğŸ” æª¢æŸ¥å·æ‡¶ä»£ç¢¼..."

          # æª¢æŸ¥ any é¡å‹
          if grep -r ": any" --include="*.ts" --include="*.tsx" src/; then
            echo "âŒ ç™¼ç¾ 'any' é¡å‹ï¼"
            exit 1
          fi

          # æª¢æŸ¥ @ts-ignore
          if grep -r "@ts-ignore\|@ts-nocheck" --include="*.ts" --include="*.tsx" src/; then
            echo "âŒ ç™¼ç¾ @ts-ignoreï¼"
            exit 1
          fi

          # æª¢æŸ¥ eslint-disable
          if grep -r "eslint-disable" --include="*.ts" --include="*.tsx" src/; then
            echo "âŒ ç™¼ç¾ eslint-disableï¼"
            exit 1
          fi

          echo "âœ… ç„¡å·æ‡¶ä»£ç¢¼"

      - name: Build æª¢æŸ¥
        run: npm run build
