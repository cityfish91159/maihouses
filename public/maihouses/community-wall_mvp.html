<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5, viewport-fit=cover"/>
<title>ç¤¾å€ç‰†ï½œæƒ å®‡ä¸Šæ™´</title>
<meta name="description" content="ç¤¾å€ç†±å¸–ã€çœŸå¯¦è©•åƒ¹ã€æº–ä½æˆ¶å•ç­” - é‚æˆ¿å­ç¤¾å€ç‰†"/>
<style>
/* === å‹•ç•« === */
@keyframes fadeInUp { from { opacity: 0; transform: translateY(8px);} to { opacity: 1; transform: translateY(0);} }

/* === åŸºç¤è®Šæ•¸ === */
:root{
  --primary:#00385a;--primary-dark:#002a44;--primary-light:#33607b;
  --secondary:#34c759;--secondary-light:#50d167;
  --accent:#ff9b4a;--warning:#ef4444;--heart:#ff3b30;
  --bg-base:#f8fafb;--bg-alt:#f0f4fa;--bg-elevated:#ffffff;
  --text-primary:#0a1f3f;--text-secondary:#5a6b7f;
  --border:#d8e4f0;--border-light:#e8f0f8;
  --brand:#003366;--line:#e6edf7;
}

/* === Reset === */
*{box-sizing:border-box;margin:0;padding:0}
html,body{min-height:100%;background:linear-gradient(180deg,var(--bg-base)0%,var(--bg-alt)100%);
  color:var(--text-primary);font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Noto Sans TC",sans-serif;
  -webkit-font-smoothing:antialiased}

/* === é é¢å®¹å™¨ === */
.page{max-width:520px;margin:0 auto;padding:8px 8px 100px;display:flex;flex-direction:column;gap:12px;animation:fadeInUp .6s ease-out}

/* === é ‚éƒ¨å°èˆª === */
.topbar{position:sticky;top:0;z-index:100;background:rgba(246,249,255,.95);backdrop-filter:blur(12px);
  border-bottom:1px solid rgba(230,237,247,0.8);display:flex;align-items:center;gap:10px;padding:8px 16px;margin:-8px -8px 0}
.brand{display:flex;align-items:center;gap:10px;text-decoration:none}
.brand .logo-icon{width:42px;height:42px;background:linear-gradient(135deg,var(--brand),#005282);border-radius:12px;
  display:flex;align-items:center;justify-content:center;box-shadow:0 4px 12px rgba(0,51,102,.2)}
.brand .logo-icon svg{width:22px;height:22px;color:#fff}
.brand .logo-text{font-size:24px;font-weight:700;font-family:serif;color:var(--brand)}
.tools{margin-left:auto;display:flex;gap:8px}
.icon-btn{border:1px solid var(--line);border-radius:12px;background:#fff;padding:8px 12px;font-size:13px;color:#173a7c;
  display:inline-flex;align-items:center;gap:6px;cursor:pointer;transition:all .15s}
.icon-btn:hover{background:#f6f9ff}
.icon-btn:active{transform:scale(0.95)}

/* === å€å¡Šå¡ç‰‡ === */
.section{background:rgba(255,255,255,.95);border:1px solid var(--border-light);
  border-radius:18px;padding:12px;display:flex;flex-direction:column;gap:10px;
  box-shadow:0 2px 8px rgba(0,0,0,.03)}
.section-header{display:flex;justify-content:space-between;align-items:center}
.section-title{font-size:16px;font-weight:800;color:var(--primary-dark)}
.section-sub{font-size:11px;color:var(--text-secondary)}
.badge{display:inline-flex;align-items:center;gap:4px;background:rgba(0,56,90,.08);border:1px solid var(--primary-light);
  color:var(--primary);border-radius:999px;padding:4px 10px;font-size:10px;font-weight:700}

/* === Tabs === */
.tabs{display:flex;gap:6px;flex-wrap:wrap}
.tab{padding:6px 14px;border-radius:999px;border:1px solid transparent;font-size:11px;font-weight:600;
  background:rgba(240,244,250,.8);color:var(--text-secondary);cursor:pointer;transition:all .2s}
.tab:hover{background:rgba(0,56,90,.08);color:var(--primary)}
.tab.active{background:rgba(0,56,90,.1);border-color:var(--primary-light);color:var(--primary);font-weight:700}
.tab.locked{opacity:.6}
.tab .lock-icon{margin-left:4px}

/* === è²¼æ–‡å¡ç‰‡ === */
.post-card{display:flex;gap:10px;padding:12px;border:1px solid var(--border-light);border-radius:14px;
  background:#fff;transition:all .2s}
.post-card:hover{border-color:var(--primary-light);box-shadow:0 2px 8px rgba(0,56,90,.06)}
.post-avatar{width:40px;height:40px;border-radius:50%;background:linear-gradient(135deg,#eef3ff,#fff);
  border:2px solid var(--primary);display:flex;align-items:center;justify-content:center;
  font-weight:800;color:var(--primary);font-size:16px;flex-shrink:0}
.post-avatar.agent{border-color:var(--secondary);color:var(--secondary)}
.post-body{flex:1;display:flex;flex-direction:column;gap:6px}
.post-header{display:flex;align-items:center;gap:8px;flex-wrap:wrap}
.post-author{font-weight:700;font-size:13px;color:var(--text-primary)}
.post-badge{font-size:9px;padding:2px 6px;border-radius:4px;font-weight:700}
.post-badge.resident{background:#e8faef;color:#0e8d52}
.post-badge.agent{background:#fff3e0;color:#e65100}
.post-badge.verified{background:#e3f2fd;color:#1565c0}
.post-time{font-size:11px;color:var(--text-secondary)}
.post-content{font-size:13px;line-height:1.55;color:var(--text-primary)}
.post-stats{display:flex;gap:12px;font-size:11px;color:var(--text-secondary)}
.post-stat{display:flex;align-items:center;gap:4px}
.post-actions{display:flex;gap:8px;margin-top:4px}
.action-btn{display:flex;align-items:center;gap:4px;padding:5px 10px;border-radius:8px;
  background:rgba(0,56,90,.06);border:1px solid rgba(0,56,90,.1);color:var(--primary);
  font-size:11px;font-weight:600;cursor:pointer;transition:all .15s}
.action-btn:hover{background:rgba(0,56,90,.12)}

/* === è©•åƒ¹å¡ç‰‡ === */
.review-card{padding:12px;border:1px solid var(--border-light);border-radius:14px;background:#fff}
.review-header{display:flex;align-items:center;gap:10px;margin-bottom:8px}
.review-avatar{width:36px;height:36px;border-radius:50%;background:rgba(0,56,90,.08);
  display:flex;align-items:center;justify-content:center;font-weight:800;color:var(--primary);font-size:14px}
.review-meta{flex:1}
.review-author{font-weight:700;font-size:12px}
.review-sub{font-size:10px;color:var(--text-secondary)}
.review-content{display:flex;flex-direction:column;gap:6px}
.review-item{display:flex;align-items:flex-start;gap:8px;font-size:12px;line-height:1.5}
.review-icon{font-size:14px;flex-shrink:0}
.review-text{color:var(--text-primary)}

/* === å•ç­”å¡ç‰‡ === */
.qa-card{padding:12px;border:1px solid var(--border-light);border-radius:14px;background:#fff}
.qa-question{font-weight:700;font-size:13px;color:var(--primary-dark);margin-bottom:8px}
.qa-meta{display:flex;align-items:center;gap:8px;font-size:11px;color:var(--text-secondary);margin-bottom:10px}
.qa-answers{display:flex;flex-direction:column;gap:8px;padding-left:12px;border-left:2px solid var(--border)}
.qa-answer{font-size:12px;line-height:1.5}
.qa-answer-header{display:flex;align-items:center;gap:6px;margin-bottom:4px}
.qa-answer-badge{font-size:9px;padding:2px 6px;border-radius:4px;font-weight:700}

/* === æ¨¡ç³Šé®ç½©ï¼ˆç”¨ body class æ§åˆ¶ï¼Œé¿å…åˆ‡æ›èº«ä»½å¾Œå£æ‰ï¼‰=== */
.blur-overlay{position:relative}
.blur-overlay .blur-target{filter:blur(4px);pointer-events:none;user-select:none}
/* æœƒå“¡ä»¥ä¸Šï¼šè§£é™¤æ¨¡ç³Š */
body.role-member .blur-overlay .blur-target,
body.role-resident .blur-overlay .blur-target,
body.role-agent .blur-overlay .blur-target{filter:none;pointer-events:auto;user-select:auto}
/* æœƒå“¡ä»¥ä¸Šï¼šéš±è— blur CTA */
body.role-member .blur-cta,
body.role-resident .blur-cta,
body.role-agent .blur-cta{display:none !important}
.blur-overlay .blur-cta{position:absolute;inset:0;display:flex;flex-direction:column;
  align-items:center;justify-content:center;background:rgba(255,255,255,.85);border-radius:14px;
  text-align:center;padding:20px}
.blur-cta h4{font-size:14px;font-weight:800;color:var(--primary-dark);margin-bottom:8px}
.blur-cta p{font-size:12px;color:var(--text-secondary);margin-bottom:12px}
.blur-cta button{background:linear-gradient(135deg,var(--primary),#005282);color:#fff;
  border:none;border-radius:999px;padding:10px 24px;font-size:13px;font-weight:700;cursor:pointer}
.blur-cta button:hover{transform:scale(1.02)}

/* === ç§å¯†ç‰†é–å®š === */
.private-lock{display:flex;flex-direction:column;align-items:center;justify-content:center;
  padding:40px 20px;text-align:center;background:rgba(0,56,90,.03);border-radius:14px}
.private-lock .lock-icon-big{font-size:48px;margin-bottom:12px;opacity:.5}
.private-lock h4{font-size:14px;font-weight:700;color:var(--primary-dark);margin-bottom:6px}
.private-lock p{font-size:12px;color:var(--text-secondary);margin-bottom:16px}
.private-lock button{background:var(--primary);color:#fff;border:none;border-radius:999px;
  padding:10px 20px;font-size:12px;font-weight:700;cursor:pointer}

/* === èº«ä»½åˆ‡æ›å™¨ï¼ˆMock ç”¨ï¼‰=== */
.role-switcher{position:fixed;bottom:20px;right:20px;z-index:1000}
.role-switcher-btn{background:linear-gradient(135deg,#1a1a2e,#16213e);color:#fff;
  border:none;border-radius:12px;padding:10px 16px;font-size:12px;font-weight:700;
  cursor:pointer;box-shadow:0 4px 20px rgba(0,0,0,.3);display:flex;align-items:center;gap:6px}
.role-switcher-menu{position:absolute;bottom:50px;right:0;background:#fff;border:1px solid var(--border);
  border-radius:12px;box-shadow:0 8px 30px rgba(0,0,0,.15);padding:8px;min-width:180px;display:none}
.role-switcher-menu.open{display:block}
.role-switcher-menu button{display:block;width:100%;text-align:left;padding:10px 12px;
  border:none;background:none;border-radius:8px;font-size:12px;cursor:pointer;color:var(--text-primary)}
.role-switcher-menu button:hover{background:#f6f9ff}
.role-switcher-menu button.active{background:rgba(0,56,90,.1);color:var(--primary);font-weight:700}

/* === å›ºå®šåº•éƒ¨ CTA === */
.fixed-bottom-cta{position:fixed;bottom:0;left:0;right:0;background:rgba(255,255,255,.95);
  backdrop-filter:blur(12px);border-top:1px solid var(--border);padding:12px 16px;
  display:flex;align-items:center;justify-content:center;gap:12px;z-index:90}
.fixed-bottom-cta.hidden{display:none}
.fixed-bottom-cta p{font-size:12px;color:var(--text-secondary)}
.fixed-bottom-cta button{background:linear-gradient(135deg,var(--primary),#005282);color:#fff;

/* === Loading Skeleton === */
.skeleton{animation:shimmer 1.5s infinite}
.skeleton-avatar{width:40px;height:40px;border-radius:50%;background:linear-gradient(90deg,#f0f0f0 25%,#e8e8e8 50%,#f0f0f0 75%);background-size:200% 100%}
.skeleton-line{height:12px;background:linear-gradient(90deg,#f0f0f0 25%,#e8e8e8 50%,#f0f0f0 75%);background-size:200% 100%;border-radius:6px;margin-bottom:8px}
.skeleton-line.short{width:60%}
.skeleton-line.medium{width:80%}
@keyframes shimmer{0%{background-position:200% 0}100%{background-position:-200% 0}}
  border:none;border-radius:999px;padding:10px 20px;font-size:13px;font-weight:700;cursor:pointer}
</style>
</head>
<body>
<main class="page">

  <!-- é ‚éƒ¨å°èˆª -->
  <header class="topbar">
    <a href="/maihouses/" class="brand">
      <div class="logo-icon">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
          <polyline points="9 22 9 12 15 12 15 22"/>
        </svg>
      </div>
      <span class="logo-text">é‚æˆ¿å­</span>
    </a>
    <div class="tools">
      <button class="icon-btn" onclick="history.back()">â† è¿”å›</button>
      <button class="icon-btn">ğŸ“¤</button>
    </div>
  </header>

  <!-- ç¤¾å€è³‡è¨Šå¡ -->
  <section class="section">
    <div class="section-header">
      <div>
        <h1 class="section-title">æƒ å®‡ä¸Šæ™´ï½œç¤¾å€ç‰†</h1>
        <p class="section-sub">çœŸå¯¦ä½æˆ¶äº’å‹• Ã— ç¤¾å€å£ç¢‘</p>
      </div>
      <span class="badge">ğŸ‘¥ å·²åŠ å…¥ 88 ä½</span>
    </div>
  </section>

  <!-- å€å¡Šä¸€ï¼šç¤¾å€è©•åƒ¹ï¼ˆæ”¾æœ€ä¸Šé¢ä½œç‚º Hookï¼‰-->
  <section class="section" id="reviews-section">
    <div class="section-header">
      <h2 class="section-title">â­ ç¤¾å€è©•åƒ¹</h2>
      <span class="section-sub">ä¾†è‡ªçœŸå¯¦æˆ¿ä»²çš„ã€Œå…©å¥½ä¸€å…¬é“ã€</span>
    </div>
    <div id="reviews-list"></div>
  </section>

  <!-- å€å¡ŠäºŒï¼šç¤¾å€ç†±å¸– -->
  <section class="section" id="hot-posts-section">
    <div class="section-header">
      <h2 class="section-title">ğŸ”¥ ç¤¾å€ç†±å¸–</h2>
    </div>
    <div class="tabs" id="wall-tabs">
      <div class="tab active" data-wall="public" onclick="switchWall('public')">å…¬é–‹ç‰†</div>
      <div class="tab" data-wall="private" onclick="switchWall('private')">
        ç§å¯†ç‰† <span class="lock-icon">ğŸ”’</span>
      </div>
    </div>
    
    <!-- å…¬é–‹ç‰†å…§å®¹ -->
    <div id="public-wall"></div>

    <!-- ç§å¯†ç‰†å…§å®¹ -->
    <div id="private-wall" style="display:none"></div>
  </section>

  <!-- å€å¡Šä¸‰ï¼šæº–ä½æˆ¶å•ç­” -->
  <section class="section" id="qa-section">
    <div class="section-header">
      <h2 class="section-title">ğŸ™‹ æº–ä½æˆ¶å•ç­”</h2>
      <span class="section-sub">è²·æˆ¿å‰ï¼Œå…ˆå•å•é„°å±…æ€éº¼èªª</span>
    </div>
    <div id="qa-list"></div>
  </section>

</main>

<!-- èº«ä»½åˆ‡æ›å™¨ï¼ˆMock ç”¨ï¼‰-->
<div class="role-switcher">
  <button class="role-switcher-btn" onclick="toggleRoleSwitcher()">
    ğŸ•¶ï¸ <span id="current-role">è¨ªå®¢æ¨¡å¼</span> â–¾
  </button>
  <div class="role-switcher-menu" id="role-menu">
    <button class="active" data-role="guest" onclick="switchRole('guest')">ğŸ‘¤ è¨ªå®¢ï¼ˆæœªç™»å…¥ï¼‰</button>
    <button data-role="member" onclick="switchRole('member')">ğŸ‘¥ ä¸€èˆ¬æœƒå“¡</button>
    <button data-role="resident" onclick="switchRole('resident')">ğŸ  å·²é©—è­‰ä½æˆ¶</button>
    <button data-role="agent" onclick="switchRole('agent')">ğŸ¢ èªè­‰æˆ¿ä»²</button>
  </div>
</div>

<!-- å›ºå®šåº•éƒ¨ CTA -->
<div class="fixed-bottom-cta" id="bottom-cta"></div>

<script>
// ============================
// ç‹€æ…‹ç®¡ç†
// ============================
let currentRole = 'guest'; // guest | member | resident | agent
let currentWall = 'public'; // public | private

// æ¬Šé™å¸¸æ•¸
const GUEST_VISIBLE_COUNT = 2; // è¨ªå®¢å¯è¦‹æ•¸é‡

// ============================
// Mock è³‡æ–™
// ============================
const MOCK_DATA = {
  posts: {
    public: [
      { id: 1, author: 'é™³å°å§', floor: '12F', type: 'resident', time: '2å°æ™‚å‰', title: 'æœ‰äººè¦åœ˜è³¼æƒåœ°æ©Ÿå—ï¼ŸğŸ¤–', content: 'é€™æ¬¾ iRobot æ‰“æŠ˜ï¼Œæ»¿ 5 å°æœ‰åœ˜è³¼åƒ¹ï½', likes: 31, comments: 14 },
      { id: 2, author: 'æ¸¸æ°å€«', type: 'agent', time: 'æ˜¨å¤©', title: 'ğŸ¡ æƒ å®‡ä¸Šæ™´ 12Fï½œé›™é™½å°è¦–é‡æˆ¶', content: 'å®¢å»³å…‰ç·šå¾ˆå¥½ï¼Œä¸Šé€±å±‹ä¸»å‰›é™åƒ¹ 50 è¬ï¼Œæœ‰èˆˆè¶£å¯ç§è¨Šã€‚', views: 89, comments: 5 },
      { id: 3, author: 'æå…ˆç”Ÿ', floor: '8F', type: 'resident', time: '3å¤©å‰', title: 'åœè»Šä½äº¤æµ ğŸš—', content: 'æˆ‘æœ‰ B2-128 æƒ³èˆ‡ B1 äº¤æ›ï¼Œæ–¹ä¾¿æ¥é€å°å­©', likes: 12, comments: 8 },
      { id: 4, author: 'ç‹å¤ªå¤ª', floor: '5F', type: 'resident', time: '1é€±å‰', title: 'æ¨è–¦æ°´é›»å¸«å‚…', content: 'ä¸Šæ¬¡æ‰¾çš„å¸«å‚…å¾ˆå°ˆæ¥­ï¼Œåƒ¹æ ¼å…¬é“ï¼Œéœ€è¦çš„é„°å±…ç§è¨Šæˆ‘', likes: 25, comments: 6 },
      { id: 5, author: 'æ—ç¶“ç†', type: 'agent', time: '1é€±å‰', title: 'ğŸ¡ æƒ å®‡ä¸Šæ™´ 8Fï½œä¸‰æˆ¿è»Šä½', content: 'å±‹æ³æ¥µæ–°ï¼Œå‰å±‹ä¸»è‡ªä½ä¿é¤Šå¥½', views: 156, comments: 12 }
    ],
    private: [
      { id: 101, author: 'ç®¡å§”æœƒ', type: 'official', time: '3å¤©å‰', title: 'ğŸ“¢ å¹´åº¦æ¶ˆé˜²æ¼”ç·´é€šçŸ¥', content: '12/15ï¼ˆæ—¥ï¼‰ä¸Šåˆ 10:00 å°‡é€²è¡Œå…¨ç¤¾å€æ¶ˆé˜²æ¼”ç·´ï¼Œå±Šæ™‚è­¦å ±å™¨æœƒéŸ¿ï¼Œè«‹å‹¿é©šæ…Œã€‚', pinned: true },
      { id: 102, author: '15F ä½æˆ¶', type: 'resident', time: '1é€±å‰', title: 'ç®¡ç†è²»èª¿æ¼²è¨è«–', content: 'æƒ³å•å¤§å®¶è¦ºå¾—ç®¡ç†è²»èª¿æ¼²åˆç†å—ï¼Ÿå¾ 2,800 èª¿åˆ° 3,200ï¼Œæ¼²å¹…æœ‰é»å¤§...', comments: 28, private: true },
      { id: 103, author: '3F ä½æˆ¶', type: 'resident', time: '2é€±å‰', title: 'é ‚æ¨“æ¼æ°´å•é¡Œ', content: 'æœ€è¿‘ä¸‹é›¨é ‚æ¨“å¥½åƒæœ‰æ¼æ°´ï¼Œç®¡å§”æœƒæœ‰è¦è™•ç†å—ï¼Ÿ', comments: 15, private: true }
    ]
  },
  reviews: [
    { id: 1, author: 'æ¸¸æ°å€«', company: '21ä¸–ç´€', visits: 12, deals: 3, pros: ['å…¬è¨­ç¶­è­·å¾—ä¹¾æ·¨ï¼Œå‡æ—¥è‰çš®æœ‰äººæ•´ç†', 'åæ˜ åœè»Šå‹•ç·šï¼Œç®¡å§”æœƒä¸€é€±å…§å°±å…¬å‘Šæ”¹å–„'], cons: 'é¢å‘å¤§é¦¬è·¯ä½æ¨“å±¤è»Šè²æ˜é¡¯ï¼Œå–œéœè€…é¸ä¸­é«˜æ¨“å±¤' },
    { id: 2, author: 'æ—ç¾ç²', company: 'ä¿¡ç¾©æˆ¿å±‹', visits: 8, deals: 2, pros: ['é ‚æ¨“æ’æ°´è¨­è¨ˆä¸éŒ¯ï¼Œé¢±é¢¨å¤©ä¹Ÿæ²’æœ‰ç©æ°´å•é¡Œ', 'ä¸­åº­èŠ±åœ’ç¶­è­·ç”¨å¿ƒï¼Œä½æˆ¶åæ‡‰éƒ½å¾ˆæ­£é¢'], cons: 'åƒåœ¾è»Šæ™‚é–“ç¨æ™šï¼Œå®¶è£¡å¶çˆ¾æœƒæœ‰ä¸‹æ°´é“å‘³' },
    { id: 3, author: 'é™³å¿—æ˜', company: 'æ°¸æ…¶æˆ¿å±‹', visits: 6, deals: 1, pros: ['ç®¡ç†å“¡æœå‹™æ…‹åº¦å¾ˆå¥½ï¼Œä»£æ”¶åŒ…è£¹å¾ˆæ–¹ä¾¿', 'ç¤¾å€æœ‰å¥èº«æˆ¿ï¼Œè¨­å‚™ç¶­è­·ä¸éŒ¯'], cons: 'é›»æ¢¯å°–å³°æ™‚æ®µè¦ç­‰æ¯”è¼ƒä¹…' },
    { id: 4, author: 'é»ƒå°è¯', company: 'ä½å•†ä¸å‹•ç”¢', visits: 10, deals: 2, pros: ['å­¸å€ä¸éŒ¯ï¼Œèµ°è·¯åˆ°åœ‹å°åªè¦5åˆ†é˜', 'é™„è¿‘ç”Ÿæ´»æ©Ÿèƒ½å®Œå–„'], cons: 'éƒ¨åˆ†æˆ¶å‹æ¡å…‰ç¨å¼±' },
    { id: 5, author: 'å¼µå¤§æ˜', company: 'å°ç£æˆ¿å±‹', visits: 5, deals: 1, pros: ['å»ºå•†å£ç¢‘å¥½ï¼Œç”¨æ–™å¯¦åœ¨', 'å…¬è¨­æ¯”åˆç†ï¼Œå¯¦åªæ•¸åˆ’ç®—'], cons: 'è»Šé“å¡åº¦è¼ƒé™¡ï¼Œæ–°æ‰‹è¦å°å¿ƒ' }
  ],
  questions: [
    { id: 1, question: 'è«‹å•ç¤¾å€åœè»Šä½å¥½åœå—ï¼Ÿæœƒä¸æœƒå¸¸å®¢æ»¿ï¼Ÿ', time: '2å¤©å‰', answersCount: 3, answers: [
      { author: '8F ä½æˆ¶', type: 'resident', content: 'å¹³æ—¥ç™½å¤©éƒ½æœ‰ä½ï¼Œå‡æ—¥å¶çˆ¾è¦ç­‰ä¸€ä¸‹ï¼Œä½†ä¸æœƒå¤ªä¹…ã€‚' },
      { author: '12F ä½æˆ¶', type: 'resident', content: 'B2 æ¯”è¼ƒå®¹æ˜“æœ‰ä½ï¼ŒB1 è¦ç¢°é‹æ°£ã€‚' },
      { author: 'æ¸¸æ°å€«', type: 'agent', content: 'é€™ç¤¾å€è»Šä½é…æ¯”æ˜¯ 1:1.2ï¼Œç®—å……è£•çš„ã€‚', expert: true }
    ]},
    { id: 2, question: 'æ™šä¸Šæœƒä¸æœƒå¾ˆåµï¼Ÿæˆ‘çœ‹ç‰©ä»¶æ™‚æ˜¯ç™½å¤©', time: '5å¤©å‰', answersCount: 2, answers: [
      { author: '3F ä½æˆ¶', type: 'resident', content: 'é¢å¤§é¦¬è·¯é‚£å´ç¢ºå¯¦æœ‰è»Šè²ï¼Œä½†ç¿’æ…£å°±å¥½ã€‚å…§å´å®‰éœå¾ˆå¤šã€‚' },
      { author: '10F ä½æˆ¶', type: 'resident', content: 'æˆ‘ä½å…§å´ï¼Œæ™šä¸Šå¾ˆå®‰éœï¼Œç¡çœ å“è³ªä¸éŒ¯ã€‚' }
    ]},
    { id: 3, question: 'ç®¡ç†è²»å¤šå°‘ï¼Ÿæœ‰åŒ…å«å“ªäº›æœå‹™ï¼Ÿ', time: '1é€±å‰', answersCount: 1, answers: [
      { author: 'ç®¡å§”æœƒ', type: 'official', content: 'ç›®å‰æ¯åª 85 å…ƒï¼Œå« 24 å°æ™‚ä¿å…¨ã€å…¬è¨­ç¶­è­·ã€åƒåœ¾ä»£æ”¶ã€‚' }
    ]}
  ]
};

// ============================
// èº«ä»½åˆ‡æ›
// ============================
function toggleRoleSwitcher() {
  document.getElementById('role-menu').classList.toggle('open');
}

function switchRole(role) {
  currentRole = role;
  
  // æ›´æ–° body classï¼ˆç”¨æ–¼ CSS æ§åˆ¶ blurï¼‰
  document.body.classList.remove('role-guest', 'role-member', 'role-resident', 'role-agent');
  document.body.classList.add('role-' + role);
  
  // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
  document.querySelectorAll('.role-switcher-menu button').forEach(btn => {
    btn.classList.toggle('active', btn.dataset.role === role);
  });
  
  // æ›´æ–°é¡¯ç¤ºæ–‡å­—
  const roleNames = {
    guest: 'è¨ªå®¢æ¨¡å¼',
    member: 'æœƒå“¡æ¨¡å¼',
    resident: 'ä½æˆ¶æ¨¡å¼',
    agent: 'æˆ¿ä»²æ¨¡å¼'
  };
  document.getElementById('current-role').textContent = roleNames[role];
  
  // é—œé–‰é¸å–®
  document.getElementById('role-menu').classList.remove('open');
  
  // å®Œæ•´é‡æ–°æ¸²æŸ“
  renderAll();
}

// ============================
// æ¬Šé™åˆ¤æ–·
// ============================
function getPermissions() {
  const isGuest = currentRole === 'guest';
  const isMember = currentRole === 'member';
  const isResident = currentRole === 'resident';
  const isAgent = currentRole === 'agent';
  
  return {
    isGuest,
    isMember,
    isResident,
    isAgent,
    isLoggedIn: !isGuest,                        // æœƒå“¡ä»¥ä¸Š
    canSeeAllReviews: !isGuest,                  // æœƒå“¡ä»¥ä¸Šå¯çœ‹å…¨éƒ¨è©•åƒ¹
    canSeeAllPosts: !isGuest,                    // æœƒå“¡ä»¥ä¸Šå¯çœ‹å…¨éƒ¨å…¬é–‹ç‰†
    canAccessPrivate: isResident || isAgent,     // åªæœ‰ä½æˆ¶/æˆ¿ä»²å¯çœ‹ç§å¯†ç‰†
    canPostPublic: isResident || isAgent,        // ä½æˆ¶/æˆ¿ä»²å¯ç™¼å…¬é–‹ç‰†
    canPostPrivate: isResident,                  // åªæœ‰ä½æˆ¶å¯ç™¼ç§å¯†ç‰†
    canAskQuestion: !isGuest,                    // æœƒå“¡ä»¥ä¸Šå¯ç™¼å•
    canAnswer: isResident || isAgent,            // ä½æˆ¶/æˆ¿ä»²å¯å›ç­”
    showExpertBadge: isAgent                     // æˆ¿ä»²é¡¯ç¤ºå°ˆå®¶æ¨™ç« 
  };
}

// ============================
// æ¸²æŸ“ï¼šè©•åƒ¹å€
// ============================
function renderReviews() {
  const perm = getPermissions();
  const reviews = MOCK_DATA.reviews;
  const container = document.getElementById('reviews-list');
  
  // æŠŠæ‰€æœ‰è©•åƒ¹æ‹†æˆå–®é …ï¼šæ¯å€‹ âœ… æ˜¯ä¸€å‰‡ï¼Œæ¯å€‹ âš–ï¸ ä¹Ÿæ˜¯ä¸€å‰‡
  const allItems = [];
  reviews.forEach(review => {
    review.pros.forEach(pro => {
      allItems.push({ type: 'pro', text: pro, author: review.author, company: review.company, visits: review.visits, deals: review.deals });
    });
    allItems.push({ type: 'con', text: review.cons, author: review.author, company: review.company, visits: review.visits, deals: review.deals });
  });
  
  const totalCount = allItems.length;
  const visibleCount = perm.canSeeAllReviews ? totalCount : GUEST_VISIBLE_COUNT;
  const hiddenCount = totalCount - visibleCount;
  
  let html = '';
  
  // é¡¯ç¤ºå¯è¦‹çš„è©•åƒ¹é …ç›®
  allItems.slice(0, visibleCount).forEach(item => {
    const icon = item.type === 'pro' ? 'âœ…' : 'âš–ï¸';
    html += `
      <div class="review-card">
        <div class="review-header">
          <div class="review-avatar">${item.author.charAt(0)}</div>
          <div class="review-meta">
            <div class="review-author">${item.author}ï½œ${item.company}</div>
            <div class="review-sub">å¸¶çœ‹ ${item.visits} æ¬¡ Â· æˆäº¤ ${item.deals} æˆ¶</div>
          </div>
        </div>
        <div class="review-content">
          <div class="review-item"><span class="review-icon">${icon}</span><span class="review-text">${item.text}</span></div>
        </div>
      </div>
    `;
  });
  
  // blur é®ç½©ï¼ˆä½¿ç”¨ blur-targetï¼Œç”± body class æ§åˆ¶ï¼‰
  if (hiddenCount > 0) {
    const nextItem = allItems[visibleCount];
    html += `
      <div class="blur-overlay">
        <div class="review-card blur-target">
          <div class="review-header">
            <div class="review-avatar">${nextItem?.author?.charAt(0) || '?'}</div>
            <div class="review-meta">
              <div class="review-author">${nextItem?.author || ''}ï½œ***</div>
            </div>
          </div>
          <div class="review-content">
            <div class="review-item"><span class="review-icon">âœ…</span><span class="review-text">${nextItem?.text?.substring(0, 10) || '...'}...</span></div>
          </div>
        </div>
        <div class="blur-cta">
          <h4>ğŸ”’ é‚„æœ‰ ${hiddenCount} å‰‡è©•åƒ¹</h4>
          <p>è¨»å†Šæœƒå“¡çœ‹å…¨éƒ¨æˆ¿ä»²çœŸå¯¦è©•åƒ¹</p>
          <button onclick="showLoginModal()">å…è²»è¨»å†Š / ç™»å…¥</button>
        </div>
      </div>
    `;
  }
  
  container.innerHTML = html;
}

// ============================
// æ¸²æŸ“ï¼šå…¬é–‹ç‰†
// ============================
function renderPublicWall() {
  const perm = getPermissions();
  const posts = MOCK_DATA.posts.public;
  const container = document.getElementById('public-wall');
  
  const visibleCount = perm.canSeeAllPosts ? posts.length : GUEST_VISIBLE_COUNT;
  const hiddenCount = posts.length - visibleCount;
  
  let html = '';
  
  // é¡¯ç¤ºå¯è¦‹çš„è²¼æ–‡
  posts.slice(0, visibleCount).forEach(post => {
    html += renderPostCard(post, perm);
  });
  
  // å¦‚æœæœ‰éš±è—çš„ï¼Œé¡¯ç¤º blur é®ç½©ï¼ˆä½¿ç”¨ blur-targetï¼‰
  if (hiddenCount > 0) {
    html += `
      <div class="blur-overlay">
        <div class="post-card blur-target">
          <div class="post-avatar">${posts[visibleCount]?.author?.charAt(0) || '?'}</div>
          <div class="post-body">
            <div class="post-header">
              <span class="post-author">${posts[visibleCount]?.author || ''}</span>
            </div>
            <div class="post-content">${posts[visibleCount]?.title || ''}</div>
          </div>
        </div>
        <div class="blur-cta">
          <h4>ğŸ”’ é‚„æœ‰ ${hiddenCount} å‰‡ç†±å¸–</h4>
          <p>ç™»å…¥å¾ŒæŸ¥çœ‹å®Œæ•´ç¤¾å€å‹•æ…‹</p>
          <button onclick="showLoginModal()">å…è²»è¨»å†Š / ç™»å…¥</button>
        </div>
      </div>
    `;
  }
  
  // ç™¼æ–‡æŒ‰éˆ•ï¼ˆä½æˆ¶/æˆ¿ä»²ï¼‰
  if (perm.canPostPublic) {
    html += `
      <div class="post-card" style="background:rgba(0,56,90,.03);border-style:dashed;justify-content:center;padding:20px">
        <button class="action-btn" style="width:100%;justify-content:center" onclick="showCreatePostModal('public')">
          âœï¸ ç™¼å¸ƒè²¼æ–‡
        </button>
      </div>
    `;
  }
  
  container.innerHTML = html;
}

function renderPostCard(post, perm) {
  const isAgent = post.type === 'agent';
  const isOfficial = post.type === 'official';
  const avatarClass = isAgent ? 'agent' : '';
  const badgeHtml = isAgent 
    ? '<span class="post-badge agent">èªè­‰æˆ¿ä»²</span>'
    : isOfficial 
      ? '<span class="post-badge verified">å®˜æ–¹å…¬å‘Š</span>'
      : post.floor ? `<span class="post-badge resident">${post.floor} ä½æˆ¶</span>` : '';
  
  const statsHtml = post.likes 
    ? `<span class="post-stat">â¤ï¸ ${post.likes}</span>` 
    : post.views 
      ? `<span class="post-stat">ğŸ‘ï¸ ${post.views}</span>` 
      : '';
  
  const actionsHtml = isAgent
    ? '<button class="action-btn">ğŸ“© ç§è¨Šæˆ¿ä»²</button>'
    : `<button class="action-btn">â¤ï¸ è®š</button><button class="action-btn">ğŸ’¬ å›è¦†</button>`;
  
  return `
    <div class="post-card">
      <div class="post-avatar ${avatarClass}">${post.author.charAt(0)}</div>
      <div class="post-body">
        <div class="post-header">
          <span class="post-author">${post.author}</span>
          ${badgeHtml}
          <span class="post-time">${post.time}</span>
        </div>
        <div class="post-content">
          <b>${post.title}</b><br>
          ${post.content}
        </div>
        <div class="post-stats">
          ${statsHtml}
          <span class="post-stat">ğŸ’¬ ${post.comments || 0}</span>
          ${post.private ? '<span class="post-stat">ğŸ”’ åƒ…ç¤¾å€å¯è¦‹</span>' : ''}
        </div>
        <div class="post-actions">
          ${actionsHtml}
        </div>
      </div>
    </div>
  `;
}

// ============================
// æ¸²æŸ“ï¼šç§å¯†ç‰†
// ============================
function renderPrivateWall() {
  const perm = getPermissions();
  const container = document.getElementById('private-wall');
  
  if (!perm.canAccessPrivate) {
    // è¨ªå®¢/æœƒå“¡çœ‹åˆ°é–å®šç•«é¢
    const ctaText = perm.isGuest 
      ? '<button onclick="showLoginModal()">å…è²»è¨»å†Š / ç™»å…¥</button>'
      : '<button onclick="showVerifyModal()">æˆ‘æ˜¯ä½æˆ¶ï¼Œé©—è­‰èº«ä»½</button>';
    
    container.innerHTML = `
      <div class="private-lock">
        <div class="lock-icon-big">ğŸ”</div>
        <h4>ç§å¯†ç‰†åƒ…é™æœ¬ç¤¾å€ä½æˆ¶æŸ¥çœ‹</h4>
        <p>${perm.isGuest ? 'è«‹å…ˆç™»å…¥æˆ–è¨»å†Š' : 'é©—è­‰ä½æˆ¶èº«ä»½å¾Œå³å¯åŠ å…¥è¨è«–'}</p>
        ${ctaText}
      </div>
    `;
    return;
  }
  
  // ä½æˆ¶/æˆ¿ä»²å¯çœ‹ç§å¯†ç‰†
  const posts = MOCK_DATA.posts.private;
  let html = '';
  
  posts.forEach(post => {
    html += renderPostCard(post, perm);
  });
  
  // ç™¼æ–‡æŒ‰éˆ•ï¼ˆåªæœ‰ä½æˆ¶å¯ç™¼ï¼‰
  if (perm.canPostPrivate) {
    html += `
      <div class="post-card" style="background:rgba(0,56,90,.03);border-style:dashed;justify-content:center;padding:20px">
        <button class="action-btn" style="width:100%;justify-content:center" onclick="showCreatePostModal('private')">
          âœï¸ ç™¼å¸ƒç§å¯†è²¼æ–‡
        </button>
      </div>
    `;
  } else if (perm.isAgent) {
    html += `
      <div style="text-align:center;padding:12px;font-size:11px;color:var(--text-secondary)">
        ğŸ’¡ æˆ¿ä»²å¯æŸ¥çœ‹ç§å¯†ç‰†ï¼Œä½†ç„¡æ³•ç™¼æ–‡
      </div>
    `;
  }
  
  container.innerHTML = html;
}

// ============================
// æ¸²æŸ“ï¼šå•ç­”å€
// ============================
function renderQuestions() {
  const perm = getPermissions();
  const questions = MOCK_DATA.questions;
  const container = document.getElementById('qa-list');
  
  let html = '';
  
  questions.forEach((q, idx) => {
    // è¨ªå®¢åªèƒ½çœ‹å•é¡Œå’Œéƒ¨åˆ†å›ç­”
    const showAllAnswers = perm.isLoggedIn;
    const visibleAnswers = showAllAnswers ? q.answers : q.answers.slice(0, 1);
    const hiddenAnswerCount = q.answers.length - visibleAnswers.length;
    
    html += `
      <div class="qa-card">
        <div class="qa-question">Q: ${q.question}</div>
        <div class="qa-meta">
          <span>ğŸ‘¤ æº–ä½æˆ¶</span>
          <span>Â· ${q.time}</span>
          <span>Â· ${q.answersCount} å‰‡å›è¦†</span>
        </div>
        <div class="qa-answers">
          ${visibleAnswers.map(a => `
            <div class="qa-answer">
              <div class="qa-answer-header">
                <span class="qa-answer-badge" style="background:${a.type === 'agent' ? '#fff3e0' : a.type === 'official' ? '#e3f2fd' : '#e8faef'};color:${a.type === 'agent' ? '#e65100' : a.type === 'official' ? '#1565c0' : '#0e8d52'}">
                  ${a.type === 'agent' ? 'ğŸ¢ èªè­‰æˆ¿ä»²' : a.type === 'official' ? 'ğŸ“‹ ' + a.author : 'ğŸ  ' + a.author}
                </span>
                ${a.expert ? '<span class="qa-answer-badge" style="background:#fce4ec;color:#c2185b">â­ å°ˆå®¶å›ç­”</span>' : ''}
              </div>
              ${a.content}
            </div>
          `).join('')}
        </div>
        ${hiddenAnswerCount > 0 ? `
          <div class="blur-overlay" style="margin-top:8px">
            <div class="qa-answer blur-target" style="padding:12px;background:#f8f8f8;border-radius:8px">
              <div class="qa-answer-header">
                <span class="qa-answer-badge" style="background:#e8faef;color:#0e8d52">ğŸ  ä½æˆ¶</span>
              </div>
              é‚„æœ‰æ›´å¤šä½æˆ¶å›è¦†...
            </div>
            <div class="blur-cta" style="padding:16px">
              <h4 style="margin-bottom:6px">ğŸ”’ é‚„æœ‰ ${hiddenAnswerCount} å‰‡å›è¦†</h4>
              <button onclick="showLoginModal()">ç™»å…¥æŸ¥çœ‹</button>
            </div>
          </div>
        ` : ''}
        ${perm.canAnswer ? `
          <div style="margin-top:10px">
            <button class="action-btn" style="width:100%;justify-content:center" onclick="showAnswerModal(${q.id})">
              ğŸ’¬ æˆ‘ä¾†å›ç­”${perm.isAgent ? 'ï¼ˆå°ˆå®¶ï¼‰' : ''}
            </button>
          </div>
        ` : ''}
      </div>
    `;
  });
  
  // ç™¼å•å€å¡Š
  html += `
    <div class="qa-card" style="background:rgba(0,56,90,.03);border-style:dashed">
      <div class="qa-question" style="color:var(--text-secondary)">ğŸ’¬ ä½ ä¹Ÿæœ‰å•é¡Œæƒ³å•ï¼Ÿ</div>
      <p style="font-size:12px;color:var(--text-secondary);margin:8px 0">å•é¡Œæœƒé€šçŸ¥è©²ç¤¾å€ä½æˆ¶ï¼Œé€šå¸¸ 24 å°æ™‚å…§æœƒæœ‰å›è¦†</p>
      ${perm.canAskQuestion 
        ? '<button class="action-btn" style="width:100%;justify-content:center" onclick="showAskModal()">æˆ‘æƒ³å•å•é¡Œ</button>'
        : '<button class="action-btn" style="width:100%;justify-content:center" onclick="showLoginModal()">ç™»å…¥å¾Œç™¼å•</button>'
      }
    </div>
  `;
  
  container.innerHTML = html;
}

// ============================
// æ¸²æŸ“ï¼šåº•éƒ¨ CTA
// ============================
function renderBottomCTA() {
  const perm = getPermissions();
  const cta = document.getElementById('bottom-cta');
  
  if (perm.canAccessPrivate) {
    // ä½æˆ¶/æˆ¿ä»²ï¼šéš±è—
    cta.classList.add('hidden');
  } else if (perm.isMember) {
    // æœƒå“¡ï¼šé©—è­‰ä½æˆ¶
    cta.classList.remove('hidden');
    cta.innerHTML = `
      <p>ğŸ  é©—è­‰ä½æˆ¶èº«ä»½ï¼Œè§£é–ç§å¯†ç‰†</p>
      <button onclick="showVerifyModal()">é©—è­‰ä½æˆ¶</button>
    `;
  } else {
    // è¨ªå®¢ï¼šè¨»å†Š
    cta.classList.remove('hidden');
    cta.innerHTML = `
      <p>ğŸ”“ ç™»å…¥è§£é–å®Œæ•´è©•åƒ¹ + æ›´å¤šåŠŸèƒ½</p>
      <button onclick="showLoginModal()">å…è²»è¨»å†Š</button>
    `;
  }
}

// ============================
// æ¸²æŸ“ï¼šç§å¯†ç‰† Tab ç‹€æ…‹
// ============================
function renderPrivateTab() {
  const perm = getPermissions();
  const privateTab = document.querySelector('.tab[data-wall="private"]');
  
  if (privateTab) {
    privateTab.classList.toggle('locked', !perm.canAccessPrivate);
    privateTab.innerHTML = perm.canAccessPrivate 
      ? 'ç§å¯†ç‰†'
      : 'ç§å¯†ç‰† <span class="lock-icon">ğŸ”’</span>';
  }
}

// ============================
// å…¨éƒ¨æ¸²æŸ“
// ============================
function renderAll() {
  renderReviews();
  renderPublicWall();
  renderPrivateWall();
  renderQuestions();
  renderBottomCTA();
  renderPrivateTab();
  
  // å¦‚æœç›®å‰åœ¨ç§å¯†ç‰†ä½†æ²’æ¬Šé™ï¼Œåˆ‡å›å…¬é–‹ç‰†
  if (currentWall === 'private') {
    const perm = getPermissions();
    if (!perm.canAccessPrivate) {
      switchWall('public');
    }
  }
}

// ============================
// ç‰†åˆ‡æ›
// ============================
function switchWall(wall) {
  const perm = getPermissions();
  
  // å¦‚æœè¦åˆ‡åˆ°ç§å¯†ç‰†ä½†æ²’æ¬Šé™
  if (wall === 'private' && !perm.canAccessPrivate) {
    if (perm.isGuest) {
      showLoginModal();
    } else {
      showVerifyModal();
    }
    return;
  }
  
  currentWall = wall;
  
  // æ›´æ–° Tab ç‹€æ…‹
  document.querySelectorAll('#wall-tabs .tab').forEach(tab => {
    tab.classList.toggle('active', tab.dataset.wall === wall);
  });
  
  // åˆ‡æ›å…§å®¹
  document.getElementById('public-wall').style.display = wall === 'public' ? 'block' : 'none';
  document.getElementById('private-wall').style.display = wall === 'private' ? 'block' : 'none';
}

// ============================
// Modalï¼ˆç°¡æ˜“ç‰ˆï¼‰
// ============================
function showLoginModal() {
  alert('ğŸ” ç™»å…¥/è¨»å†Š\n\né€™è£¡æœƒè·³å‡ºç™»å…¥è¦–çª—\nï¼ˆå¯¦éš›æ¥ Supabase Authï¼‰');
}

function showVerifyModal() {
  alert('ğŸ  ä½æˆ¶é©—è­‰\n\nè«‹ä¸Šå‚³æ°´é›»å¸³å–®æˆ–ç®¡ç†è²»æ”¶æ“š\næˆ–è¼¸å…¥ç¤¾å€å°ˆå±¬é©—è­‰ç¢¼');
}

function showCreatePostModal(visibility) {
  alert(`âœï¸ ç™¼å¸ƒ${visibility === 'private' ? 'ç§å¯†' : 'å…¬é–‹'}è²¼æ–‡\n\nï¼ˆé€™è£¡æœƒè·³å‡ºç™¼æ–‡è¡¨å–®ï¼‰`);
}

function showAskModal() {
  alert('ğŸ’¬ ç™¼å•\n\nï¼ˆé€™è£¡æœƒè·³å‡ºç™¼å•è¡¨å–®ï¼‰');
}

function showAnswerModal(questionId) {
  alert(`ğŸ’¬ å›ç­”å•é¡Œ #${questionId}\n\nï¼ˆé€™è£¡æœƒè·³å‡ºå›ç­”è¡¨å–®ï¼‰`);
}

// ============================
// åˆå§‹åŒ–
// ============================
document.addEventListener('DOMContentLoaded', () => {
  // åˆå§‹åŒ– body classï¼ˆè¨ªå®¢æ¨¡å¼ï¼‰
  document.body.classList.add('role-guest');
  
  renderAll();
  
  // é»æ“Šå¤–éƒ¨é—œé–‰é¸å–®
  document.addEventListener('click', (e) => {
    if (!e.target.closest('.role-switcher')) {
      document.getElementById('role-menu').classList.remove('open');
    }
  });
  
  console.log('âœ… ç¤¾å€ç‰†åˆå§‹åŒ–å®Œæˆ');
  console.log('ğŸ”§ åˆ‡æ›èº«ä»½: é»æ“Šå³ä¸‹è§’ [ğŸ•¶ï¸ è¨ªå®¢æ¨¡å¼]');
});
</script>
</body>
</html>
