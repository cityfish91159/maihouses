# ğŸ  MaiMai å…¬ä»”äº’å‹• + 591 ä¸€éµæ¬å®¶ TODO (SSOT)

> **æœ€å¾Œæ›´æ–°**: 2025-12-23
> **ç›®æ¨™**: å°‡ MaiMai å¾éœæ…‹å‰ç¥¥ç‰©å‡ç´šç‚ºã€Œæƒ…ç·’åŒ–æ™ºèƒ½åŠ©ç†ã€ï¼Œä¸¦å¯¦ä½œã€Œ591 ä¸€éµæ¬å®¶ã€é»‘ç§‘æŠ€
> **é¦–é **: https://maihouses.vercel.app/maihouses/
> **ä¸Šå‚³é **: https://maihouses.vercel.app/maihouses/property/upload

---

## ğŸ“‹ æ‘˜è¦ (Executive Summary)

| å„ªå…ˆç´š | ä»»å‹™ | ç‹€æ…‹ | é ä¼°å·¥æ™‚ | å¯©è¨ˆåˆ†æ•¸ |
|:---:|:---|:---:|:---:|:---:|
| P0 | MM-1 MaiMai åŸå­çµ„ä»¶æ•´åˆ | âš ï¸ | 2hr | 85/100 |
| P0 | MM-2 æ…¶ç¥å‹•ç•« (react-canvas-confetti) | â¬œ | 1hr | - |
| P0 | IM-1 æ™ºæ…§è²¼ä¸Šç›£è½å™¨ | â¬œ | 2hr | - |
| P0 | IM-2 591 ç”Ÿç”¢ç´šè§£æå™¨ | â¬œ | 3hr | - |
| P1 | MM-3 æƒ…ç·’ç‹€æ…‹æ©Ÿ (Mood FSM) | â¬œ | 2hr | - |
| P1 | IM-3 é‡è¤‡åŒ¯å…¥åµæ¸¬ | â¬œ | 1hr | - |
| P1 | IM-4 iOS æ·å¾‘æ”¯æ´ | â¬œ | 1hr | - |
| P2 | MM-4 å°è©±æ­·å²æ°£æ³¡ | â¬œ | 1hr | - |
| P2 | IM-5 è§£æå“è³ªè¿½è¹¤ API | â¬œ | 1hr | - |
| P3 | MM-5 MaiMai å…¨ç«™çµ±ä¸€å¯¦ä¾‹ | â¬œ | 2hr | - |

> **âš ï¸ ç‹€æ…‹èªªæ˜**: â¬œ æœªé–‹å§‹ | ğŸ”§ é€²è¡Œä¸­ | âš ï¸ éœ€ä¿®æ­£ | âœ… å®Œæˆ (100åˆ†)

---

## ğŸ­ MaiMai å…¬ä»”äº’å‹•æ¨¡çµ„

### MM-1: MaiMai åŸå­çµ„ä»¶æ•´åˆ âš ï¸ 85/100

**å®Œæˆæ™‚é–“**: 2025-12-23
**å¯©è¨ˆè©•åˆ†**: 85/100 (åŠŸèƒ½å®Œæˆï¼Œå­˜åœ¨æ¶æ§‹éš±æ‚£å¾…å„ªåŒ–)

**æˆæœ**:
- æ–°å¢ `src/components/MaiMai/` ç›®éŒ„
- `types.ts`: MaiMaiMood å‹åˆ¥ (10ç¨®å¿ƒæƒ…)
- `MaiMaiBase.tsx`: SVG éª¨æ¶ + æ‰€æœ‰å¿ƒæƒ…ç‹€æ…‹æ¸²æŸ“
- `useMaiMaiMood.ts`: å¿ƒæƒ…ç‹€æ…‹æ©Ÿ Hook (å„ªå…ˆç´šè¨ˆç®—)
- `MaiMaiSpeech.tsx`: å°è©±æ°£æ³¡çµ„ä»¶
- `index.ts`: çµ±ä¸€åŒ¯å‡º

**é‡æ§‹æˆæœ**:
| çµ„ä»¶ | åŸè¡Œæ•¸ | æ–°è¡Œæ•¸ | æ¸›å°‘ |
|:---|:---:|:---:|:---:|
| MascotMaiMai.tsx | 97 | 35 | -64% |
| MascotInteractive.tsx | 510 | 86 | -83% |
| MascotHouse.tsx | 215 | 132 | -39% |

**é©—è­‰**: 324/324 æ¸¬è©¦é€šéï¼ŒTypeScript ç·¨è­¯é€šé

---

### MM-1 ç¼ºå¤±æ¸…å–®

| # | å•é¡Œ | ç‹€æ…‹ | ä¿®æ­£/èªªæ˜ |
|:---:|:---|:---:|:---|
| A | å–®å…ƒæ¸¬è©¦ | âœ… | 25 tests passed |
| B | AC1~4 æœªé©— | âœ… | é»æ“Š 5 æ¬¡/SmartAsk æ…¶ç¥çš†æœ‰ confetti + mood å°é½Š |
| C | SIZE_CLASSES é‡è¤‡ | âœ… | MaiMaiBase + MascotInteractive æ”¹ç”¨ types.SIZE_CLASSES |
| D | MaiMaiSpeech æ²’äººç”¨ | âœ… | MascotInteractive ä¸² SmartAsk è¨Šæ¯ + æ°£æ³¡å¯¦é¡¯ |
| E | CelebrateEvent æœªæ•´åˆ | âœ… | celebrate/excited é‚Šç•Œè§¸ç™¼ confetti + mascot:celebrateï¼ˆå«å†·å»ï¼‰ |
| F | ç„¡ Storybook | âœ… | maimai-story.html + å¤šå…¥å£ build + smoke testï¼ˆnpm run dev:maimai-storyï¼‰ |
| G | CSS å‹•ç•«æœªå®šç¾© | âœ… | tailwind.config.cjs åŠ  9 å€‹ keyframes |
| H | Arms è¨­è¨ˆä¸ç´” | âš ï¸ | è¡¨é¢å®Œæˆï¼Œå­˜åœ¨ 5 é …æ¶æ§‹å•é¡Œï¼ˆè¦‹ä¸‹æ–¹ï¼‰ |

---

### MM-1.H æ·±åº¦å¯©è¨ˆ (Google é¦–å¸­å‰å¾Œç«¯è™•é•·è©•åƒ¹)

**è©•åˆ†**: 85/100 âš ï¸ åŠŸèƒ½å®Œæˆä½†ä¾¿å®œè¡Œäº‹

**ğŸ“Š è©³ç´°è©•åˆ†**:
| é …ç›® | å¾—åˆ† | æ‰£åˆ†åŸå›  |
|------|------|----------|
| åŠŸèƒ½å®Œæ•´åº¦ | 23/25 | å§¿æ…‹æ˜ å°„å®Œæˆï¼Œwave é›™å´å°ç¨±å®Œæˆ |
| ä»£ç¢¼å“è³ª | 20/25 | **æ¨¡çµ„å±¤ JSX é•å React åŸå‰‡**ï¼›types.ts èˆ‡ MaiMaiBase.tsx å§¿æ…‹è¡¨é‡è¤‡ |
| æ•ˆèƒ½å„ªåŒ– | 22/25 | ç§»é™¤ transition-all æ­£ç¢ºï¼Œä½† extra ä»åœ¨æ¨¡çµ„å±¤ç”Ÿæˆ ReactNode |
| æ¶æ§‹ä¸€è‡´æ€§ | 20/25 | **DEFAULT_ARM_POSES èˆ‡ ARM_POSES ä¸¦å­˜æœªçµ±ä¸€**ï¼›åº§æ¨™ç¡¬ç·¨ç¢¼ |

**âš ï¸ ç™¼ç¾çš„å·æ‡¶/ä¾¿å®œè¡Œäº‹ (5 é …)**:

| # | åš´é‡åº¦ | å•é¡Œ | å¾Œæœ | å„ªåŒ–æ–¹å‘ |
|:---:|:---:|:---|:---|:---|
| H.1 | **P1** | `ARM_POSES` åœ¨æ¨¡çµ„å±¤åŒ…å« JSX (`extra` å±¬æ€§) | æ¯æ¬¡ import éƒ½åŸ·è¡Œ React.createElementï¼›é•åã€Œæ¨¡çµ„å±¤åªæ”¾ dataã€åŸå‰‡ | å§¿æ…‹è¡¨åªå­˜åº§æ¨™/åƒæ•¸ï¼Œextra åœ¨ Arms çµ„ä»¶å…§æ ¹æ“š pose.extraType å‹•æ…‹ç”Ÿæˆ |
| H.2 | **P1** | `types.ts` æœ‰ `DEFAULT_ARM_POSES`ï¼Œ`MaiMaiBase.tsx` æœ‰ `ARM_POSES` | å…©å¥—å§¿æ…‹è¡¨ä¸¦å­˜ï¼Œé•å SSOTï¼›æœªä¾†ä¿®æ”¹éœ€æ”¹å…©è™• | åˆªé™¤ types.ts çš„ DEFAULT_ARM_POSESï¼Œæˆ–å°‡ ARM_POSES ç§»å…¥ types.ts çµ±ä¸€åŒ¯å‡º |
| H.3 | P2 | `createWaveExtra(26, 90, ...)` èˆ‡ `(180, 90, ...)` ç¡¬ç·¨ç¢¼ | åº§æ¨™èˆ‡æ‰‹è‡‚ç«¯é» (38,112) / (175,98) ä¸å°é½Šï¼Œmagic number é›£ç¶­è­· | ç”¨ `waveHandX - offset` å…¬å¼è¨ˆç®—ï¼Œæˆ–å®šç¾© `WAVE_ANCHOR = { left: {...}, right: {...} }` |
| H.4 | P2 | `peekBarXs = [76, 100, 124]` ç¡¬ç·¨ç¢¼ | èˆ‡ rect x=64 width=72 çš„é—œä¿‚ä¸æ˜é¡¯ (64+12=76, 64+36=100, 64+60=124)ï¼Œä¸‹æ¬¡æ”¹ rect å¿…å¿˜è¨˜æ”¹é€™è£¡ | ç”¨ `const cx = 64 + 72/2; const bars = [-24, 0, 24].map(d => cx + d)` æˆ–é¡ä¼¼å…¬å¼ |
| H.5 | P3 | ç§»é™¤ `transition-all` å¾Œç„¡æ›¿ä»£å‹•ç•« | å§¿æ…‹åˆ‡æ›è®Šæˆç¬é–“è·³è®Šï¼ŒUX ç•¥ç”Ÿç¡¬ | å¯è£œ CSS animation æˆ– SMIL `<animate>` è®“åˆ‡æ›æœ‰éæ¸¡æ„Ÿï¼ˆéå¿…è¦ï¼Œè¦–è¨­è¨ˆéœ€æ±‚ï¼‰ |

**ğŸ’¡ é¦–å¸­æ¶æ§‹å¸«æŒ‡å¼• (å¦‚ä½•åšåˆ° 100 åˆ†)**:

> **H.1 ä¿®æ­£æ–¹æ¡ˆ**: æ¨¡çµ„å±¤å§¿æ…‹è¡¨åªå­˜ç´” dataï¼ŒJSX åœ¨ render å…§ç”Ÿæˆ
> ```typescript
> // types.ts - ç´” data
> interface ArmPoseData {
>   left: string;
>   right: string;
>   extraType?: 'wave' | 'peek' | null;
>   extraParams?: { waveAnchors?: [number, number][]; peekRect?: { x: number; width: number; bars: number } };
> }
> 
> // MaiMaiBase.tsx - Arms çµ„ä»¶å…§
> function renderExtra(pose: ArmPoseData) {
>   if (pose.extraType === 'wave') return <WaveCircles anchors={pose.extraParams.waveAnchors} />;
>   if (pose.extraType === 'peek') return <PeekBars config={pose.extraParams.peekRect} />;
>   return null;
> }
> ```
>
> **H.2 ä¿®æ­£æ–¹æ¡ˆ**: åˆªé™¤ `types.ts` çš„ `DEFAULT_ARM_POSES`ï¼Œè®“ `ARM_POSES` æˆç‚ºå”¯ä¸€çœŸç†ä¾†æºã€‚æˆ–åéä¾†ï¼Œåœ¨ `types.ts` å®šç¾© `ARM_POSE_DATA`ï¼Œ`MaiMaiBase.tsx` å¼•ç”¨å®ƒã€‚
>
> **H.3/H.4 ä¿®æ­£æ–¹æ¡ˆ**: æ‰€æœ‰åº§æ¨™ç”¨å¸¸æ•¸æˆ–å…¬å¼ï¼Œä¸¦åŠ è¨»é‡‹èªªæ˜é—œä¿‚
> ```typescript
> const WAVE_CIRCLE_OFFSET = 12; // åœ“å¿ƒè·æ‰‹è‡‚ç«¯é»çš„åç§»
> const waveRight = { armEnd: [175, 98], circleCenter: [175 + WAVE_CIRCLE_OFFSET, 98 - 8] };
> 
> const PEEK_RECT = { x: 64, width: 72 };
> const peekCenter = PEEK_RECT.x + PEEK_RECT.width / 2; // 100
> const PEEK_BAR_SPACING = 24;
> const peekBarXs = [-1, 0, 1].map(i => peekCenter + i * PEEK_BAR_SPACING); // [76, 100, 124]
> ```

---

### MM-2: æ…¶ç¥å‹•ç•« (react-canvas-confetti) â¬œ

**ä¾è³´**: `npm install react-canvas-confetti`
**åƒè€ƒ**: https://github.com/ulitcos/react-canvas-confetti

| ID | å­ä»»å‹™ | ç‹€æ…‹ | é©—æ”¶æ¨™æº– |
|:---|:---|:---:|:---|
| MM-2.1 | å®‰è£ `react-canvas-confetti` | â¬œ | `package.json` æœ‰æ­¤ä¾è³´ |
| MM-2.2 | å»ºç«‹ `useConfetti.ts` Hook | â¬œ | å¯è§¸ç™¼æ’’èŠ±å‹•ç•« |
| MM-2.3 | æ•´åˆè‡³ MaiMai `celebrate` å¿ƒæƒ… | â¬œ | å¿ƒæƒ…è®Šç‚º celebrate æ™‚è‡ªå‹•æ’’èŠ± |
| MM-2.4 | ç›£è½ `mascot:celebrate` äº‹ä»¶ | â¬œ | `window.dispatchEvent(new CustomEvent('mascot:celebrate'))` å¯è§¸ç™¼ |

**ğŸ’¡ é¦–å¸­æ¶æ§‹å¸«æŒ‡å¼•**:
> ã€ŒConfetti çš„æ•ˆèƒ½é—œéµæ˜¯ **ä¸è¦åœ¨æ¯æ¬¡ render éƒ½åˆå§‹åŒ– Canvas**ã€‚ä½¿ç”¨ `useRef` æŒæœ‰ Canvas å¯¦ä¾‹ï¼Œä¸¦ç”¨ `useCallback` åŒ…è£ fire å‡½æ•¸ã€‚ã€
>
> **å¯¦ä½œæç¤º**:
> ```tsx
> // useConfetti.ts æ ¸å¿ƒé‚è¼¯
> const canvasRef = useRef<HTMLCanvasElement>(null);
> const confettiInstance = useRef<confetti.CreateTypes | null>(null);
>
> useEffect(() => {
>   if (canvasRef.current) {
>     confettiInstance.current = confetti.create(canvasRef.current, { resize: true });
>   }
>   return () => confettiInstance.current?.reset();
> }, []);
>
> const fire = useCallback(() => {
>   confettiInstance.current?.({ particleCount: 100, spread: 70, origin: { y: 0.6 } });
> }, []);
> ```

---

### MM-3: æƒ…ç·’ç‹€æ…‹æ©Ÿ (Mood FSM) â¬œ

**å¿ƒæƒ…å®šç¾©**:
```typescript
type MaiMaiMood = 
  | 'idle'      // å¾…æ©Ÿï¼Œè¼•å¾®å‘¼å¸
  | 'wave'      // æ®æ‰‹æ‰“æ‹›å‘¼
  | 'thinking'  // æ€è€ƒä¸­ï¼Œè½‰åœˆ
  | 'happy'     // é–‹å¿ƒï¼Œçœ¼ç›å½å½
  | 'excited'   // è¶…èˆˆå¥®ï¼Œè·³èº + æ„›å¿ƒ
  | 'confused'  // å›°æƒ‘ï¼Œå•è™Ÿ
  | 'celebrate' // æ…¶ç¥ï¼Œæ’’èŠ±
  | 'shy'       // å®³ç¾ï¼Œè‡‰ç´…
  | 'sleep';    // ç¡è‘—ï¼Œzzz
```

| ID | å­ä»»å‹™ | ç‹€æ…‹ | é©—æ”¶æ¨™æº– |
|:---|:---|:---:|:---|
| MM-3.1 | å®šç¾© `MaiMaiMood` å‹åˆ¥ | â¬œ | `src/components/MaiMai/types.ts` |
| MM-3.2 | å¯¦ä½œ `useMaiMaiMood` Hook | â¬œ | æ”¯æ´å¤–éƒ¨å‚³å…¥ mood æˆ–è‡ªå‹•è¨ˆç®— |
| MM-3.3 | åŠ å…¥å¿ƒæƒ…è½‰æ›å‹•ç•« | â¬œ | å¿ƒæƒ…è®ŠåŒ–æ™‚æœ‰éæ¸¡æ•ˆæœ |
| MM-3.4 | æ•´åˆ MascotInteractive ç¾æœ‰é‚è¼¯ | â¬œ | ç™»å…¥é äº’å‹•ä¸é€€åŒ– |

**ğŸ’¡ é¦–å¸­æ¶æ§‹å¸«æŒ‡å¼•**:
> ã€Œå¿ƒæƒ…ç‹€æ…‹æ©Ÿçš„é—œéµæ˜¯ **å„ªå…ˆç´š**ã€‚ç™»å…¥é çš„ `isTypingPassword` æ‡‰è©²å„ªå…ˆæ–¼ `isHovered`ã€‚ä½¿ç”¨ `useMemo` è¨ˆç®—æœ€çµ‚å¿ƒæƒ…ï¼Œè€Œé `useEffect` + `setState`ï¼ˆé¿å…é–ƒçˆï¼‰ã€‚ã€
>
> **å„ªå…ˆç´šç¯„ä¾‹**:
> ```tsx
> const mood = useMemo(() => {
>   if (externalMood) return externalMood; // å¤–éƒ¨å¼·åˆ¶æŒ‡å®š
>   if (isSuccess) return 'celebrate';
>   if (hasError) return 'shy';
>   if (isLoading) return 'thinking';
>   if (isTypingPassword) return 'peek';   // è¼¸å…¥å¯†ç¢¼æ™‚å·çœ‹
>   if (isTypingEmail) return 'happy';
>   if (isHovered) return 'wave';
>   return 'idle';
> }, [externalMood, isSuccess, hasError, isLoading, isTypingPassword, isTypingEmail, isHovered]);
> ```

---

### MM-4: å°è©±æ­·å²æ°£æ³¡ â¬œ

**è¨­è¨ˆ**: MaiMai çš„æ°£æ³¡é¡¯ç¤ºæœ€è¿‘ 3 å¥å°è©±ï¼Œå‰µé€ ã€ŒèŠå¤©æ„Ÿã€ã€‚

| ID | å­ä»»å‹™ | ç‹€æ…‹ | é©—æ”¶æ¨™æº– |
|:---|:---|:---:|:---|
| MM-4.1 | å»ºç«‹ `MaiMaiSpeech.tsx` çµ„ä»¶ | â¬œ | æ”¯æ´ `messages: string[]` prop |
| MM-4.2 | èˆŠè¨Šæ¯æ·¡å‡ºæ¨£å¼ | â¬œ | æœ€å¾Œä¸€å¥ç²—é«”ï¼Œå‰é¢å…©å¥ç°è‰²åˆªé™¤ç·š |
| MM-4.3 | è¨Šæ¯æ–°å¢æ™‚çš„æ»‘å…¥å‹•ç•« | â¬œ | æ–°è¨Šæ¯å¾ä¸‹æ–¹æ»‘å…¥ |

**ğŸ’¡ é¦–å¸­æ¶æ§‹å¸«æŒ‡å¼•**:
> ã€Œå°è©±æ­·å²ç”¨ `slice(-3)` å–æœ€å¾Œä¸‰å¥å³å¯ã€‚ä¸è¦ç”¨è¤‡é›œçš„ç‹€æ…‹ç®¡ç†ï¼Œä¸€å€‹ç°¡å–®çš„ `addMessage` å‡½æ•¸å°±å¤ äº†ã€‚ã€
>
> **æ¨£å¼æç¤º**:
> ```tsx
> <div className="space-y-1">
>   {messages.slice(-3, -1).map((m, i) => (
>     <p key={i} className="text-[10px] text-slate-400 line-through opacity-50">{m}</p>
>   ))}
>   <p className="text-sm font-bold text-slate-700">{messages.at(-1)}</p>
> </div>
> ```

---

### MM-5: MaiMai å…¨ç«™çµ±ä¸€å¯¦ä¾‹ â¬œ

**å•é¡Œ**: ç›®å‰å„é é¢å„è‡ªç¶­è­· MaiMai ç‹€æ…‹ï¼Œç„¡æ³•è·¨é é¢åŒæ­¥å¿ƒæƒ…ã€‚

| ID | å­ä»»å‹™ | ç‹€æ…‹ | é©—æ”¶æ¨™æº– |
|:---|:---|:---:|:---|
| MM-5.1 | å»ºç«‹ `MaiMaiContext.tsx` | â¬œ | æä¾›å…¨ç«™å…±äº«çš„å¿ƒæƒ…ç‹€æ…‹ |
| MM-5.2 | åœ¨ App.tsx åŠ å…¥ Provider | â¬œ | æ‰€æœ‰å­çµ„ä»¶å¯å­˜å– |
| MM-5.3 | æä¾› `setMood` / `addMessage` API | â¬œ | ä»»ä½•çµ„ä»¶å¯è§¸ç™¼å¿ƒæƒ…è®ŠåŒ– |

**ğŸ’¡ é¦–å¸­æ¶æ§‹å¸«æŒ‡å¼•**:
> ã€Œé€™æ˜¯ P3 ä»»å‹™ï¼Œä¸æ€¥ã€‚å…ˆç¢ºä¿å„é é¢çš„ MaiMai ç¨ç«‹é‹ä½œæ­£å¸¸ï¼Œå†è€ƒæ…®å…¨ç«™çµ±ä¸€ã€‚éæ—©çš„æŠ½è±¡æ˜¯è¬æƒ¡ä¹‹æºã€‚ã€

---

## ğŸšš 591 ä¸€éµæ¬å®¶æ¨¡çµ„

### IM-1: æ™ºæ…§è²¼ä¸Šç›£è½å™¨ â¬œ

**æ ¸å¿ƒç†å¿µ**: éä¾µå…¥å¼ç›£è½ `paste` äº‹ä»¶ã€‚è‹¥ç„¦é»åœ¨ `INPUT/TEXTAREA`ï¼Œå‰‡ä¸æ””æˆªã€‚

| ID | å­ä»»å‹™ | ç‹€æ…‹ | é©—æ”¶æ¨™æº– |
|:---|:---|:---:|:---|
| IM-1.1 | åœ¨ `PropertyUploadPage` åŠ å…¥ `paste` ç›£è½ | â¬œ | äº‹ä»¶è™•ç†å™¨å·²ç¶å®š |
| IM-1.2 | æ’é™¤ `INPUT/TEXTAREA` ç„¦é»è¡çª | â¬œ | åœ¨æ¨™é¡Œæ¡†å…§è²¼ä¸Šä¸è§¸ç™¼è‡ªå‹•å¡«è¡¨ |
| IM-1.3 | æ™ºæ…§åµæ¸¬ 591 å…§å®¹ | â¬œ | åŒ…å«ã€Œ591ã€æˆ–ã€Œè¬+åªã€æ‰è§¸ç™¼ |
| IM-1.4 | é¡¯ç¤ºè™•ç†ä¸­ Loading ç‹€æ…‹ | â¬œ | ç”¨æˆ¶çŸ¥é“ç³»çµ±æ­£åœ¨è™•ç† |

**ğŸ’¡ é¦–å¸­æ¶æ§‹å¸«æŒ‡å¼•**:
> ã€Œè²¼ä¸Šç›£è¯çš„é—œéµæ˜¯ **ä¸è¦å¹²æ“¾æ­£å¸¸è¼¸å…¥**ã€‚ç”¨ `document.activeElement?.tagName` åˆ¤æ–·ç„¦é»ä½ç½®ï¼Œè€Œéç¦ç”¨æ•´å€‹ paste äº‹ä»¶ã€‚ã€
>
> **å¯¦ä½œæç¤º**:
> ```tsx
> useEffect(() => {
>   const handlePaste = (e: ClipboardEvent) => {
>     const activeEl = document.activeElement;
>     if (activeEl?.tagName === 'INPUT' || activeEl?.tagName === 'TEXTAREA') return;
>
>     const text = e.clipboardData?.getData('text') || '';
>     if (text.includes('591') || (text.includes('è¬') && text.includes('åª'))) {
>       e.preventDefault();
>       handleImport(text);
>     }
>   };
>   document.addEventListener('paste', handlePaste);
>   return () => document.removeEventListener('paste', handlePaste);
> }, [handleImport]);
> ```

---

### IM-2: 591 ç”Ÿç”¢ç´šè§£æå™¨ â¬œ

**è¨­è¨ˆ**: å¸¶ã€Œä¿¡å¿ƒåˆ†æ•¸ã€çš„è§£æå™¨ï¼ŒMaiMai æ ¹æ“šåˆ†æ•¸å±•ç¾ä¸åŒæƒ…ç·’ã€‚

| ID | å­ä»»å‹™ | ç‹€æ…‹ | é©—æ”¶æ¨™æº– |
|:---|:---|:---:|:---|
| IM-2.1 | åƒ¹æ ¼è§£æ (å”®/ç§Ÿé€šç”¨) | â¬œ | åŒ¹é…ã€Œå”®åƒ¹ 1,288 è¬ã€ã€Œç§Ÿé‡‘ 25,000 å…ƒ/æœˆã€ |
| IM-2.2 | åªæ•¸è§£æ | â¬œ | åŒ¹é…ã€Œæ¬Šç‹€ 34.2 åªã€ã€Œå»ºåª 28 åªã€ |
| IM-2.3 | æ ¼å±€è§£æ | â¬œ | åŒ¹é…ã€Œ3æˆ¿2å»³2è¡›ã€ã€Œé›…æˆ¿ã€ã€Œå¥—æˆ¿ã€ |
| IM-2.4 | åœ°å€è§£æ (å°/è‡ºé€šç”¨) | â¬œ | åŒ¹é…ã€Œå°åŒ—å¸‚ä¿¡ç¾©å€ä¿¡ç¾©è·¯äº”æ®µ7è™Ÿã€ |
| IM-2.5 | æ¨™é¡Œæ“·å– | â¬œ | å– 5-50 å­—çš„éæ•¸å­—è¡Œ |
| IM-2.6 | 591 ç‰©ä»¶ ID æ“·å– | â¬œ | åŒ¹é… `detail/123456` æˆ– `id=123456` |
| IM-2.7 | ä¿¡å¿ƒåˆ†æ•¸è¨ˆç®— | â¬œ | åƒ¹æ ¼+åªæ•¸+æ ¼å±€+åœ°å€+æ¨™é¡Œ = 25+25+20+20+10 |

**ğŸ’¡ é¦–å¸­æ¶æ§‹å¸«æŒ‡å¼•**:
> ã€Œè§£æå™¨çš„æ ¸å¿ƒæ˜¯ **å®¹éŒ¯**ã€‚591 çš„æ ¼å¼æœƒè®Šï¼Œç”¨æˆ¶çš„è¤‡è£½ç¯„åœä¹Ÿä¸å›ºå®šã€‚æ¯å€‹æ¬„ä½éƒ½è¦æœ‰ fallbackã€‚ã€
>
> **ä¿¡å¿ƒåˆ†æ•¸å°æ‡‰**:
> ```tsx
> if (confidence >= 80) {
>   setMood('excited');
>   addMessage("å®Œç¾ï¼å…¨éƒ¨è³‡æ–™éƒ½æŠ“åˆ°äº† âœ¨");
>   window.dispatchEvent(new CustomEvent('mascot:celebrate'));
> } else if (confidence >= 40) {
>   setMood('happy');
>   addMessage(`æŠ“åˆ°äº†åƒ¹æ ¼èˆ‡åªæ•¸ï¼Œå‰©ä¸‹çš„æ¬„ä½å†è£œé½Šï½`);
> } else {
>   setMood('confused');
>   addMessage("å…§å®¹æœ‰é»çŸ­ï¼Œåªçœ‹æ‡‚äº†ä¸€é»é» ğŸ¤”");
> }
> ```

---

### IM-3: é‡è¤‡åŒ¯å…¥åµæ¸¬ â¬œ

**è¨­è¨ˆ**: ç•¶åµæ¸¬åˆ°ä¸åŒç‰©ä»¶ ID æ™‚ï¼ŒMaiMai ä¸»å‹•è©¢å•æ˜¯å¦è¦†è“‹ã€‚

| ID | å­ä»»å‹™ | ç‹€æ…‹ | é©—æ”¶æ¨™æº– |
|:---|:---|:---:|:---|
| IM-3.1 | è¨˜éŒ„ `lastListingId` ç‹€æ…‹ | â¬œ | æˆåŠŸåŒ¯å…¥å¾Œå„²å­˜ ID |
| IM-3.2 | åµæ¸¬æ–°èˆŠ ID ä¸åŒ | â¬œ | æ¯”å° `imported.listingId !== lastListingId` |
| IM-3.3 | å½ˆå‡ºç¢ºèªå°è©±æ¡† | â¬œ | ä½¿ç”¨ `notify.confirm` |
| IM-3.4 | æ”¯æ´å¼·åˆ¶è¦†è“‹ `forceOverwrite` | â¬œ | ç¢ºèªå¾Œæ¸…é™¤èˆŠè³‡æ–™å†å¡«å…¥ |

**ğŸ’¡ é¦–å¸­æ¶æ§‹å¸«æŒ‡å¼•**:
> ã€Œé‡è¤‡åŒ¯å…¥çš„ UX å¾ˆé‡è¦ã€‚ä¸è¦ç›´æ¥è¦†è“‹ï¼Œä¹Ÿä¸è¦æ¯æ¬¡éƒ½å•ã€‚åªæœ‰ç•¶ **ID ä¸åŒ** æ™‚æ‰è©¢å•ã€‚ã€

---

### IM-4: iOS æ·å¾‘æ”¯æ´ â¬œ

**è¨­è¨ˆ**: æ”¯æ´ iOS Shortcuts ç›´æ¥å‚³é 591 å…§å®¹è‡³ä¸Šå‚³é ã€‚

| ID | å­ä»»å‹™ | ç‹€æ…‹ | é©—æ”¶æ¨™æº– |
|:---|:---|:---:|:---|
| IM-4.1 | ç›£è½ URL `?importText=` åƒæ•¸ | â¬œ | é é¢è¼‰å…¥æ™‚è‡ªå‹•è§¸ç™¼åŒ¯å…¥ |
| IM-4.2 | è™•ç† URI decode | â¬œ | æ­£ç¢ºè§£æä¸­æ–‡å­—å…ƒ |
| IM-4.3 | è™•ç†å¾Œæ¸…é™¤ URL åƒæ•¸ | â¬œ | é¿å…é‡æ–°æ•´ç†æ™‚é‡è¤‡åŒ¯å…¥ |
| IM-4.4 | é˜²æ­¢é‡è¤‡è™•ç† | â¬œ | ä½¿ç”¨ `useRef` è¨˜éŒ„æ˜¯å¦å·²è™•ç† |

**ğŸ’¡ é¦–å¸­æ¶æ§‹å¸«æŒ‡å¼•**:
> ã€ŒiOS æ·å¾‘çš„ URL å¯èƒ½å¾ˆé•·ï¼Œè¨˜å¾—ç”¨ `decodeURIComponent` è§£ç¢¼ã€‚è™•ç†å¾Œç”¨ `setSearchParams` æ¸…é™¤åƒæ•¸ï¼Œä¸”è¨­å®š `replace: true` é¿å…æ±¡æŸ“æ­·å²ç´€éŒ„ã€‚ã€

---

### IM-5: è§£æå“è³ªè¿½è¹¤ API â¬œ

**è¨­è¨ˆ**: å¾Œç«¯è¿½è¹¤è§£æçµæœï¼Œç”¨æ–¼å„ªåŒ– Regexã€‚

| ID | å­ä»»å‹™ | ç‹€æ…‹ | é©—æ”¶æ¨™æº– |
|:---|:---|:---:|:---|
| IM-5.1 | å»ºç«‹ `api/analytics/import.ts` | â¬œ | Vercel Serverless å‡½æ•¸ |
| IM-5.2 | è¨˜éŒ„ `textLength`, `confidence`, `fieldsFound` | â¬œ | å¯æŸ¥è©¢å“ªå€‹æ¬„ä½æœ€å¸¸å¤±æ•— |
| IM-5.3 | å¯«å…¥ Supabase analytics è¡¨ | â¬œ | æ¯é€±å¯åˆ†æè§£æå“è³ª |

**ğŸ’¡ é¦–å¸­æ¶æ§‹å¸«æŒ‡å¼•**:
> ã€Œé€™æ˜¯ P2 ä»»å‹™ï¼Œå…ˆç¢ºä¿å‰ç«¯åŠŸèƒ½å®Œå–„ã€‚è¿½è¹¤ API çš„åƒ¹å€¼åœ¨æ–¼ **ç™¼ç¾ 591 æ”¹ç‰ˆ**ï¼šå¦‚æœæŸé€±çš„åƒ¹æ ¼è§£ææˆåŠŸç‡çªç„¶ä¸‹é™ï¼Œå°±çŸ¥é“è©²æ›´æ–° Regex äº†ã€‚ã€

---

## ğŸ¯ é©—æ”¶æ¨™æº– (Acceptance Criteria)

### å…¬ä»”äº’å‹•é©—æ”¶
1. **MM-AC1**: é»æ“Š MaiMai 5 æ¬¡æœƒè§¸ç™¼ `celebrate` å¿ƒæƒ… + æ’’èŠ±å‹•ç•«
2. **MM-AC2**: åœ¨ SmartAsk è¼¸å…¥å•é¡Œæ™‚ï¼ŒMaiMai é¡¯ç¤º `thinking` å¿ƒæƒ…
3. **MM-AC3**: å•ç­”æˆåŠŸå¾Œï¼ŒMaiMai é¡¯ç¤º `excited` å¿ƒæƒ…ä¸¦æ’’èŠ±
4. **MM-AC4**: å°è©±æ°£æ³¡é¡¯ç¤ºæœ€è¿‘ 3 å¥ï¼Œæœ€æ–°ä¸€å¥ç²—é«”

### ä¸€éµæ¬å®¶é©—æ”¶
1. **IM-AC1**: åœ¨ç©ºç™½è™•è²¼ä¸Š 591 å…§å®¹ï¼Œè‡ªå‹•å¡«å…¥åƒ¹æ ¼ã€åªæ•¸ã€åœ°å€
2. **IM-AC2**: åœ¨æ¨™é¡Œè¼¸å…¥æ¡†å…§è²¼ä¸Š 591ï¼Œ**ä¸æœƒ**è§¸ç™¼è‡ªå‹•å¡«è¡¨
3. **IM-AC3**: åŒ¯å…¥æˆåŠŸå¾Œ 3 ç§’ï¼Œè‡ªå‹•æ»¾å‹•è‡³ã€Œå…©å¥½ä¸€å…¬é“ã€å€å¡Š
4. **IM-AC4**: è²¼ä¸Šç‰©ä»¶ A å¾Œå†è²¼ä¸Šç‰©ä»¶ Bï¼Œå½ˆå‡ºç¢ºèªè¦–çª—
5. **IM-AC5**: iOS ç”¨æˆ¶å¯é€éæ·å¾‘ç›´æ¥åˆ†äº« 591 é€£çµè‡³ä¸Šå‚³é 

---

## ğŸ“ æª”æ¡ˆè®Šæ›´é è¦½

```
src/
â”œâ”€â”€ components/
â”‚   â””â”€â”€ MaiMai/                      # æ–°å»ºç›®éŒ„
â”‚       â”œâ”€â”€ index.ts
â”‚       â”œâ”€â”€ MaiMaiBase.tsx
â”‚       â”œâ”€â”€ MaiMaiMood.tsx
â”‚       â”œâ”€â”€ MaiMaiSpeech.tsx
â”‚       â”œâ”€â”€ useMaiMaiMood.ts
â”‚       â”œâ”€â”€ useConfetti.ts
â”‚       â””â”€â”€ types.ts
â”œâ”€â”€ pages/
â”‚   â””â”€â”€ PropertyUploadPage.tsx       # ä¿®æ”¹ï¼šåŠ å…¥è²¼ä¸Šç›£è½
â”œâ”€â”€ lib/
â”‚   â””â”€â”€ parse591.ts                  # æ–°å»ºï¼šè§£æå™¨
api/
â””â”€â”€ analytics/
    â””â”€â”€ import.ts                    # æ–°å»ºï¼šè¿½è¹¤ API
```

---

## ğŸ“Š æ¸¬è©¦è¨ˆç•«

| æ¸¬è©¦é¡å‹ | æª”æ¡ˆ | æ¶µè“‹ç¯„åœ |
|:---:|:---|:---|
| å–®å…ƒæ¸¬è©¦ | `parse591.test.ts` | å„ç¨® 591 æ ¼å¼è®Šé«” |
| å–®å…ƒæ¸¬è©¦ | `useMaiMaiMood.test.ts` | å¿ƒæƒ…ç‹€æ…‹æ©Ÿå„ªå…ˆç´š |
| E2E æ¸¬è©¦ | `import.spec.ts` | è²¼ä¸Šæµç¨‹ã€é‡è¤‡åµæ¸¬ |
| è¦–è¦ºæ¸¬è©¦ | Storybook | MaiMai å„å¿ƒæƒ…ç‹€æ…‹ |

---

## ğŸ’¡ é–‹ç™¼é †åºå»ºè­°

```
IM-2 (è§£æå™¨) â†’ IM-1 (ç›£è½å™¨) â†’ MM-2 (æ’’èŠ±) â†’ MM-3 (å¿ƒæƒ…) â†’ å…¶ä»–
```

**åŸå› **: è§£æå™¨æ˜¯æ ¸å¿ƒï¼Œæ²’æœ‰å®ƒå…¶ä»–åŠŸèƒ½éƒ½ç„¡æ³•é©—è­‰ã€‚ç›£è½å™¨æ˜¯å…¥å£ï¼Œæ’’èŠ±æ˜¯æœ€æœ‰æ„Ÿçš„ UX æå‡ã€‚

---

## ğŸ“œ èˆŠä»»å‹™å­˜æª” (å·²å®Œæˆ)

| ä»»å‹™ | ç‹€æ…‹ | åˆ†æ•¸ |
|:---|:---:|:---:|
| UP-1 è¡¨å–®è‡ªå‹•å¿«ç…§ | âœ… | 98/100 |
| UP-2 åœ–ç‰‡å‰ç«¯å£“ç¸® | âœ… | 100/100 |
| UP-3 åœ–ç‰‡ç®¡ç†é‡æ§‹ | âœ… | 95/100 |
| UP-4 äº®é»è† å›Šåˆ†æµ | âœ… | 100/100 |

> å®Œæ•´æ­·å²ï¼šè¦‹ `docs/COMMUNITY_WALL_DEV_LOG.md`
