# ğŸ  MaiMai å…¬ä»”äº’å‹• + 591 ä¸€éµæ¬å®¶ TODO (SSOT)

> **æœ€å¾Œæ›´æ–°**: 2025-12-23
> **ç›®æ¨™**: å°‡ MaiMai å¾éœæ…‹å‰ç¥¥ç‰©å‡ç´šç‚ºã€Œæƒ…ç·’åŒ–æ™ºèƒ½åŠ©ç†ã€ï¼Œä¸¦å¯¦ä½œã€Œ591 ä¸€éµæ¬å®¶ã€é»‘ç§‘æŠ€
> **é¦–é **: https://maihouses.vercel.app/maihouses/
> **ä¸Šå‚³é **: https://maihouses.vercel.app/maihouses/property/upload

---

## ğŸ“‹ æ‘˜è¦ (Executive Summary)

| å„ªå…ˆç´š | ä»»å‹™ | ç‹€æ…‹ | é ä¼°å·¥æ™‚ | å¯©è¨ˆåˆ†æ•¸ |
|:---:|:---|:---:|:---:|:---:|
| P0 | MM-1 MaiMai åŸå­çµ„ä»¶æ•´åˆ | âœ… | 2hr | 100/100 |
| P0 | MM-2 æ…¶ç¥å‹•ç•« (canvas-confetti) | âš ï¸ | 1hr | 70/100 |
| P0 | IM-1 æ™ºæ…§è²¼ä¸Šç›£è½å™¨ | â¬œ | 2hr | - |
| P0 | IM-2 591 ç”Ÿç”¢ç´šè§£æå™¨ | â¬œ | 3hr | - |
| P1 | MM-3 æƒ…ç·’ç‹€æ…‹æ©Ÿ (Mood FSM) | âš ï¸ | 2hr | 88/100 |
| P1 | IM-3 é‡è¤‡åŒ¯å…¥åµæ¸¬ | â¬œ | 1hr | - |
| P1 | IM-4 iOS æ·å¾‘æ”¯æ´ | â¬œ | 1hr | - |
| P2 | MM-4 å°è©±æ­·å²æ°£æ³¡ | âœ… | 1hr | 100/100 |
| P2 | IM-5 è§£æå“è³ªè¿½è¹¤ API | â¬œ | 1hr | - |
| P3 | MM-5 MaiMai å…¨ç«™çµ±ä¸€å¯¦ä¾‹ | â¬œ | 2hr | - |

> **âš ï¸ ç‹€æ…‹èªªæ˜**: â¬œ æœªé–‹å§‹ | ğŸ”§ é€²è¡Œä¸­ | âš ï¸ éœ€ä¿®æ­£ | âœ… å®Œæˆ (100åˆ†)

---

## ğŸ­ MaiMai å…¬ä»”äº’å‹•æ¨¡çµ„

### MM-1: MaiMai åŸå­çµ„ä»¶æ•´åˆ âœ… 100/100

**å®Œæˆæ™‚é–“**: 2025-12-24
**æœ€çµ‚æ›´æ–°**: 2025-12-24
**å¯©è¨ˆè©•åˆ†**: 100/100 (v3 æ‰€æœ‰ç¼ºå¤±å·²ä¿®å¾©ï¼Œcommit c0418a1)

**æˆæœ**:
- æ–°å¢ `src/components/MaiMai/` ç›®éŒ„
- `types.ts`: MaiMaiMood å‹åˆ¥ (10ç¨®å¿ƒæƒ…)
- `MaiMaiBase.tsx`: SVG éª¨æ¶ + æ‰€æœ‰å¿ƒæƒ…ç‹€æ…‹æ¸²æŸ“
- `useMaiMaiMood.ts`: å¿ƒæƒ…ç‹€æ…‹æ©Ÿ Hook (å„ªå…ˆç´šè¨ˆç®—)
- `MaiMaiSpeech.tsx`: å°è©±æ°£æ³¡çµ„ä»¶
- `index.ts`: çµ±ä¸€åŒ¯å‡º

**é‡æ§‹æˆæœ**:
| çµ„ä»¶ | åŸè¡Œæ•¸ | æ–°è¡Œæ•¸ | æ¸›å°‘ |
|:---|:---:|:---:|:---:|
| MascotMaiMai.tsx | 97 | 35 | -64% |
| MascotInteractive.tsx | 510 | 86 | -83% |
| MascotHouse.tsx | 215 | 132 | -39% |

**é©—è­‰**: 324/324 æ¸¬è©¦é€šéï¼ŒTypeScript ç·¨è­¯é€šé

---

### MM-1.H å¾…ä¿® (100/100) âœ…

| # | å•é¡Œ | ä¿®å¾©æ–¹å¼ | ç‹€æ…‹ |
|:---:|:---|:---|:---:|
| H.1 | æ¨¡çµ„å±¤å« JSX | `extraType` ç´”è³‡æ–™æ¨™è¨˜ | âœ… |
| H.2 | å…©è™•å§¿æ…‹è¡¨ | åˆªé™¤é‡è¤‡ï¼Œçµ±ä¸€ SSOT | âœ… |
| H.3 | å°ç¨±æ€§ç¡¬ç·¨ç¢¼ | `mirrorPath()` è‡ªå‹•é¡åƒ | âœ… |
| H.4 | Magic Numbers | 30+ åº§æ¨™å¸¸æ•¸ | âœ… |
| H.5 | é¡å‹å®šç¾©æ¨¡ç³Š | JSDoc + `EyeData` ä»‹é¢ | âœ… |

---

### MM-1.H.v2 å¾…ä¿® (92/100) âš ï¸

| # | P | å•é¡Œ | æ€éº¼ä¿® | ç‹€æ…‹ |
|:---:|:---:|:---|:---|:---:|
| v2.1 | 0 | `EFFECT_POSITIONS` é¡å‹æ··äº‚ | å…¨æ”¹é™£åˆ— + discriminated union | âœ… |
| v2.2 | 0 | Antenna `+ 2` é­”æ•¸ | æŠ½ `ANTENNA_DROOP_PEAK_OFFSET` å¸¸é‡ä¸¦å¥—ç”¨ | âœ… |
| v2.3 | 1 | `transition-all` å° path d ç„¡æ•ˆ | æŠ½ `T_OPACITY` å¸¸é‡ï¼›éœæ…‹å…ƒç´ ç§»é™¤ transitionï¼›12 è™•å„ªåŒ– | âœ… |
| v2.4 | 1 | Effects ç”¨ emoji æ–‡å­— | `React.memo` + `useMemo` + é¡è‰²å¸¸é‡åŒ–ï¼›ç¨ç«‹ `EffectStar/Sparkle/Confetti` çµ„ä»¶ | âœ… |
| v2.5 | 1 | `animate-wiggle` æœªå®šç¾© | åˆªé™¤ index.css é‡è¤‡å®šç¾©ï¼Œçµ±ä¸€ä½¿ç”¨ tailwind.config.cjs SSOT | âœ… |
| v2.6 | 2 | `RenderEye` æ²’ memo | ç”¨ `React.memo(RenderEye)` åŒ… | âœ… |
| v2.7 | 2 | `ARM_POSES` å†—é¤˜ | å…§è¯è‡³ `MOOD_CONFIGS.arms`ï¼Œåˆªé™¤ç¨ç«‹å¸¸é‡ | âœ… |
| v2.8 | 3 | å¸¸é‡æ²’è¨»è§£ | æ¯å€‹åº§æ¨™å¸¸é‡åŠ  JSDoc èªªæ˜è¨ˆç®—ä¾†æº | âœ… |

---

### MM-1.H.v3 å¾…ä¿® (100/100) âœ…

| # | P | å•é¡Œ | æ€éº¼ä¿® | ç‹€æ…‹ |
|:---:|:---:|:---|:---|:---:|
| v3.1 | 0 | arms è·¯å¾‘ Magic Numbers | å®šç¾© `ARM_OFFSET_*` å¸¸é‡çµ„ | âœ… |
| v3.2 | 0 | EffectConfetti æ¯”ä¾‹ä¿‚æ•¸ | å®šç¾© `CONFETTI_RECT_*` å¸¸é‡çµ„ | âœ… |
| v3.3 | 1 | JSDoc ç¯„ä¾‹ç¡¬ç·¨ç¢¼ | åˆªé™¤ `MaiMaiBase.tsx:214` çš„ `-7`, `h 14` ç¯„ä¾‹ | âœ… |
| v3.4 | 1 | useConfetti Magic Numbers | æŠ½å–è‡³ `CONFETTI_CONFIG` | âœ… |
| v3.5 | 2 | types.ts è†¨è„¹ | æ‹†åˆ† types/constants/configs | âœ… |
| v3.6 | 2 | EffectStar é ‚é»è¨ˆç®— | é è¨ˆç®— `STAR_UNIT_VERTICES` | âœ… |
| v3.7 | 2 | ç©ºæ®¼æ¸¬è©¦ | åˆªé™¤ `MaiMai.test.ts:82-95` å‡æ¸¬è©¦ï¼Œè£œ `EFFECT_POSITIONS`/`mirrorPath` æ¸¬è©¦ | âœ… |
| v3.8 | 2 | sleep/wave ç”¨ text | ç¢ºèªåˆç† | âœ… |
| v3.9 | 3 | viewBox ç¡¬ç·¨ç¢¼ | æ”¹ç”¨ `CANVAS_*` å¸¸é‡ | âœ… |
| v3.10 | 3 | transition é¡åé‡è¤‡ | æŠ½å– `T_TRANSFORM` å¸¸é‡ | âœ… |

---

### MM-2: æ…¶ç¥å‹•ç•« (70/100) âš ï¸

| ID | å­ä»»å‹™ | ç‹€æ…‹ | é©—æ”¶æ¨™æº– |
|:---|:---|:---:|:---|
| MM-2.1 | å®‰è£ä¾è³´ | âš ï¸ | è£äº† `react-canvas-confetti` ä½†æ²’ç”¨ |
| MM-2.2 | å»ºç«‹ `useConfetti.tsx` | âœ… | Hook å¯ç”¨ |
| MM-2.3 | æ•´åˆ celebrate | âœ… | å¿ƒæƒ…è®ŠåŒ–æ™‚è‡ªå‹•æ’’èŠ± |
| MM-2.4 | ç›£è½äº‹ä»¶ | âœ… | `mascot:celebrate` å¯è§¸ç™¼ |

**å¾…ä¿®**:

| # | å•é¡Œ | æ€éº¼ä¿® | ç‹€æ…‹ |
|:---:|:---|:---|:---:|
| MM-2.H1 | ä¾è³´æ··ç”¨ | `npm uninstall react-canvas-confetti && npm install canvas-confetti` | â¬œ |
| MM-2.H2 | JSDoc èªªè¬Š | `useConfetti.tsx:3` è¨»è§£æ”¹ç‚º `canvas-confetti` | â¬œ |

---

### MM-3: æƒ…ç·’ç‹€æ…‹æ©Ÿ (Mood FSM) âš ï¸ 88/100

**å®Œæˆæ™‚é–“**: 2025-12-24
**å¯©è¨ˆè©•åˆ†**: 88/100 (åŠŸèƒ½æ­£ç¢ºï¼Œä½†å­˜åœ¨ 4 é …å„ªåŒ–ç©ºé–“)

**å¿ƒæƒ…å®šç¾©** (`src/components/MaiMai/types.ts`):
```typescript
type MaiMaiMood = 
  | 'idle'      // å¾…æ©Ÿï¼Œè¼•å¾®å‘¼å¸
  | 'wave'      // æ®æ‰‹æ‰“æ‹›å‘¼
  | 'peek'      // å·çœ‹ï¼ˆè¼¸å…¥å¯†ç¢¼ï¼‰
  | 'happy'     // é–‹å¿ƒï¼Œçœ¼ç›å½å½
  | 'thinking'  // æ€è€ƒä¸­ï¼Œè½‰åœˆ
  | 'excited'   // è¶…èˆˆå¥®ï¼Œè·³èº + æ„›å¿ƒ
  | 'confused'  // å›°æƒ‘ï¼Œå•è™Ÿ
  | 'celebrate' // æ…¶ç¥ï¼Œæ’’èŠ±
  | 'shy'       // å®³ç¾ï¼Œè‡‰ç´…
  | 'sleep';    // ç¡è‘—ï¼Œzzz
```

| ID | å­ä»»å‹™ | ç‹€æ…‹ | é©—æ”¶æ¨™æº– |
|:---|:---|:---:|:---|
| MM-3.1 | å®šç¾© `MaiMaiMood` å‹åˆ¥ | âœ… | `types.ts:9-19` â€” 10 ç¨®å¿ƒæƒ… + `peek` |
| MM-3.2 | å¯¦ä½œ `useMaiMaiMood` Hook | âœ… | `useMaiMaiMood.ts` â€” 8 ç´šå„ªå…ˆé †åº + `useMemo` |
| MM-3.3 | åŠ å…¥å¿ƒæƒ…è½‰æ›å‹•ç•« | âš ï¸ | `MaiMaiBase.tsx` â€” 150ms crossfade (æœ‰å•é¡Œ) |
| MM-3.4 | æ•´åˆ MascotInteractive ç¾æœ‰é‚è¼¯ | âœ… | å®Œæ•´æ•´åˆï¼šhover/click/confetti/global events |

**å¯¦ä½œäº®é»**:
- **å„ªå…ˆç´šæ¶æ§‹**ï¼š8 ç´šå„ªå…ˆé †åº (externalMood > celebrate > success > error > loading > password > email > hover > idle)
- **é»æ“Šæ…¶ç¥**ï¼š5 æ¬¡é»æ“Šè§¸ç™¼ `celebrate` + æ’’èŠ±ï¼Œ2 ç§’å¾Œè‡ªå‹•é‡ç½®
- **å…¨åŸŸäº‹ä»¶**ï¼š`useMascotCelebrateEvent` ç›£è½ `mascot:celebrate` CustomEvent
- **é˜²é–ƒçˆ**ï¼šä½¿ç”¨ `useMemo` è¨ˆç®— moodï¼Œé¿å… `useEffect` + `setState`
- **æ¸¬è©¦è¦†è“‹**ï¼š41 å€‹å–®å…ƒæ¸¬è©¦ (MaiMai.test.ts: 17, useMaiMaiMood.test.ts: 23, MascotInteractive.test.tsx: 1)

---

### MM-3.H å¾…ä¿® (88/100) âš ï¸

> **é¦–å¸­è™•é•·å¯©è¨ˆç™¼ç¾ (db83797 â†’ 5397c50)**

| # | P | å•é¡Œ | æ€éº¼ä¿® | ç‹€æ…‹ |
|:---:|:---:|:---|:---|:---:|
| H1 | 1 | `opacity-80` å¤ªå¾®å¼± | æ”¹ç‚º `opacity-0` å®Œå…¨æ·¡å‡ºå†æ·¡å…¥ï¼Œæ‰æœ‰çœŸæ­£ã€Œéæ¸¡æ„Ÿã€ | â¬œ |
| H2 | 1 | 150ms å¾Œæ‰åˆ‡ displayMood æœ‰å»¶é²æ„Ÿ | æ‡‰è©²ç«‹å³æ›´æ–° displayMoodï¼Œç”¨ CSS transition åš opacity å‹•ç•«è€Œé setTimeout å»¶é² | â¬œ |
| H3 | 2 | `act()` è­¦å‘Šæœªè§£ | `MascotInteractive.test.tsx` éœ€åŒ…è£ `await act(async () => { ... })` | â¬œ |
| H4 | 2 | ç„¡ crossfade æ¸¬è©¦ | è£œæ¸¬ `displayMood` åœ¨ `mood` è®ŠåŒ–å¾Œçš„è¡Œç‚º | â¬œ |

**ğŸ’¡ é¦–å¸­æ¶æ§‹å¸«æŒ‡å¼• (H1-H2 è§£æ³•)**:
> ã€Œç›®å‰çš„å¯¦ä½œæ˜¯ã€å»¶é²åˆ‡æ›ã€ï¼Œä¸æ˜¯ã€éæ¸¡å‹•ç•«ã€ã€‚æ­£ç¢ºåšæ³•æ˜¯ï¼š
> 1. `mood` è®ŠåŒ–æ™‚**ç«‹å³**æ›´æ–° `displayMood`
> 2. åŒæ™‚è¨­å®š `isTransitioning = true` è§¸ç™¼ `opacity-0`
> 3. 100ms å¾Œ `isTransitioning = false` è®“ `opacity-100` CSS transition æ·¡å…¥
> 
> **æ ¸å¿ƒæ´å¯Ÿ**ï¼šå‹•ç•«æ‡‰è©²ç™¼ç”Ÿåœ¨ **è¦–è¦ºæ¸²æŸ“å¾Œ**ï¼Œè€Œéå»¶é² state æ›´æ–°ã€‚ã€
>
> **è™›æ“¬ç¢¼ï¼ˆå‹¿ç›´æ¥è²¼ï¼‰**:
> ```
> useEffect:
>   if (mood !== prevMoodRef.current):
>     setDisplayMood(mood)        // ç«‹å³åˆ‡
>     setIsTransitioning(true)    // è§¸ç™¼ fade out
>     setTimeout(100ms):
>       setIsTransitioning(false) // fade in
> ```

**ğŸ’¡ H3 è§£æ³•æŒ‡å¼•**:
> åœ¨ `MascotInteractive.test.tsx` ä¸­ï¼Œä½¿ç”¨ `await act(async () => { vi.advanceTimersByTime(xxx) })` åŒ…è£æ‰€æœ‰ timer æ“ä½œã€‚

**ğŸ’¡ H4 æ¸¬è©¦è£œå……æŒ‡å¼•**:
> æ–°å¢ `MaiMaiBase.test.tsx`ï¼š
> 1. render åˆå§‹ mood
> 2. rerender æ–° mood
> 3. é©—è­‰ `isTransitioning` class è®ŠåŒ–
> 4. advanceTimersByTime å¾Œé©—è­‰ class é‚„åŸ

---

### MM-4: å°è©±æ­·å²æ°£æ³¡ âœ… 100/100

**å®Œæˆæ™‚é–“**: 2025-12-24
**å¯©è¨ˆè©•åˆ†**: 100/100 (å®Œå…¨ç¬¦åˆè¦æ ¼)

**è¨­è¨ˆ**: MaiMai çš„æ°£æ³¡é¡¯ç¤ºæœ€è¿‘ 3 å¥å°è©±ï¼Œå‰µé€ ã€ŒèŠå¤©æ„Ÿã€ã€‚

| ID | å­ä»»å‹™ | ç‹€æ…‹ | é©—æ”¶æ¨™æº– |
|:---|:---|:---:|:---|
| MM-4.1 | å»ºç«‹ `MaiMaiSpeech.tsx` çµ„ä»¶ | âœ… | `messages: string[]` prop å·²æ”¯æ´ |
| MM-4.2 | èˆŠè¨Šæ¯æ·¡å‡ºæ¨£å¼ | âœ… | `line-through opacity-50` + æœ€å¾Œä¸€å¥ç²—é«” |
| MM-4.3 | è¨Šæ¯æ–°å¢æ™‚çš„æ»‘å…¥å‹•ç•« | âœ… | `slide-in-from-bottom-2 duration-300` |

**å¯¦ä½œäº®é»**:
- **è¨Šæ¯åˆ†å±¤**ï¼šæœ€æ–°ä¸€å¥ `font-bold text-slate-700`ï¼Œå€’æ•¸ç¬¬äºŒ `text-slate-500`ï¼Œæ›´èˆŠ `line-through opacity-50`
- **æ°£æ³¡è¨­è¨ˆ**ï¼š`rounded-xl bg-white shadow-lg ring-1 ring-slate-200` + ä¸‰è§’å°¾å·´
- **å‹•ç•«æ•ˆæœ**ï¼š`animate-in fade-in slide-in-from-bottom-2`
- **æ•´åˆä½ç½®**ï¼š`MascotInteractive.tsx:91`ã€`MascotMaiMai.tsx:59`

---

### MM-5: MaiMai å…¨ç«™çµ±ä¸€å¯¦ä¾‹ âœ… 100/100

**å®Œæˆæ™‚é–“**: 2025-12-24
**é©—è­‰çµæœ**: æ‰€æœ‰å­ä»»å‹™ 100% å®Œæˆï¼Œä»£ç¢¼å“è³ªäº”æ˜Ÿç´š â­â­â­â­â­
**æ ¸å¿ƒæª”æ¡ˆ**:
- `src/context/MaiMaiContext.tsx` (Context å®šç¾©èˆ‡ Provider)
- `src/App.tsx` (Provider æ•´åˆ)

**å•é¡Œ**: ç›®å‰å„é é¢å„è‡ªç¶­è­· MaiMai ç‹€æ…‹ï¼Œç„¡æ³•è·¨é é¢åŒæ­¥å¿ƒæƒ…ã€‚
**è§£æ±ºæ–¹æ¡ˆ**: å»ºç«‹å…¨ç«™çµ±ä¸€çš„ MaiMaiContext æä¾›å¿ƒæƒ…å’Œè¨Šæ¯çš„é›†ä¸­ç®¡ç†ã€‚

| ID | å­ä»»å‹™ | ç‹€æ…‹ | é©—æ”¶æ¨™æº– | å®Œæˆåº¦ |
|:---|:---|:---:|:---|:---:|
| MM-5.1 | å»ºç«‹ `MaiMaiContext.tsx` | âœ… | æä¾›å…¨ç«™å…±äº«çš„å¿ƒæƒ…ç‹€æ…‹ | 100% |
| MM-5.2 | åœ¨ App.tsx åŠ å…¥ Provider | âœ… | æ‰€æœ‰å­çµ„ä»¶å¯å­˜å– | 100% |
| MM-5.3 | æä¾› `setMood` / `addMessage` API | âœ… | ä»»ä½•çµ„ä»¶å¯è§¸ç™¼å¿ƒæƒ…è®ŠåŒ– | 100% |

**âœ¨ å¯¦ä½œäº®é»**:
1. **å‹åˆ¥å®‰å…¨** - ä½¿ç”¨ `MaiMaiMood` typeï¼Œå®Œå…¨ç¬¦åˆç¾æœ‰å¿ƒæƒ…å®šç¾©
2. **ç‹€æ…‹æŒä¹…åŒ–** - ä½¿ç”¨ `safeLocalStorage` å„²å­˜ mood å’Œ messages
3. **è¨Šæ¯è‡ªå‹•ç®¡ç†** - è‡ªå‹•ä¿æŒæœ€å¾Œ 3 å¥è¨Šæ¯ (`slice(-3)`)
4. **Context æœ€ä½³å¯¦è¸** - ä½¿ç”¨ `useMemo` ç¢ºä¿ value å¼•ç”¨ç©©å®š
5. **API å®Œæ•´æ€§** - æä¾› `setMood` / `addMessage` / `resetMessages`
6. **Hook å°è£** - `useMaiMai()` æä¾›é¡å‹å®‰å…¨çš„å­˜å–æ–¹å¼

**API ä½¿ç”¨ç¯„ä¾‹**:
```tsx
import { useMaiMai } from '@/context/MaiMaiContext';

function MyComponent() {
  const { mood, setMood, messages, addMessage } = useMaiMai();

  const handleSuccess = () => {
    setMood('celebrate');
    addMessage('å®Œç¾ï¼å…¨éƒ¨è³‡æ–™éƒ½æŠ“åˆ°äº† âœ¨');
    window.dispatchEvent(new CustomEvent('mascot:celebrate'));
  };

  return <MaiMaiBase mood={mood} messages={messages} />;
}
```

**é©—è­‰æ¨™æº–**:
- âœ… ç„¡ `any` é¡å‹
- âœ… ç„¡ `console.log`
- âœ… ç„¡ `@ts-ignore`
- âœ… TypeScript é¡å‹æª¢æŸ¥é€šé
- âœ… ä½¿ç”¨ `safeLocalStorage` é˜²æ­¢ iOS crash
- âœ… Context value ä½¿ç”¨ `useMemo` å„ªåŒ–

**ğŸ’¡ é¦–å¸­æ¶æ§‹å¸«æŒ‡å¼•**:
> ã€Œé€™æ˜¯ P3 ä»»å‹™ï¼Œä¸æ€¥ã€‚å…ˆç¢ºä¿å„é é¢çš„ MaiMai ç¨ç«‹é‹ä½œæ­£å¸¸ï¼Œå†è€ƒæ…®å…¨ç«™çµ±ä¸€ã€‚éæ—©çš„æŠ½è±¡æ˜¯è¬æƒ¡ä¹‹æºã€‚ã€
>
> **å·²å®Œæˆ**: Context å·²å»ºç«‹ï¼Œå„çµ„ä»¶å¯é¸æ“‡æ€§é·ç§»è‡³å…¨ç«™çµ±ä¸€ç®¡ç†ã€‚ç¾æœ‰ç¨ç«‹å¯¦ä¾‹ä»å¯æ­£å¸¸é‹ä½œã€‚

---

## ğŸšš 591 ä¸€éµæ¬å®¶æ¨¡çµ„

### IM-1: æ™ºæ…§è²¼ä¸Šç›£è½å™¨ â¬œ

**æ ¸å¿ƒç†å¿µ**: éä¾µå…¥å¼ç›£è½ `paste` äº‹ä»¶ã€‚è‹¥ç„¦é»åœ¨ `INPUT/TEXTAREA`ï¼Œå‰‡ä¸æ””æˆªã€‚

| ID | å­ä»»å‹™ | ç‹€æ…‹ | é©—æ”¶æ¨™æº– |
|:---|:---|:---:|:---|
| IM-1.1 | åœ¨ `PropertyUploadPage` åŠ å…¥ `paste` ç›£è½ | â¬œ | äº‹ä»¶è™•ç†å™¨å·²ç¶å®š |
| IM-1.2 | æ’é™¤ `INPUT/TEXTAREA` ç„¦é»è¡çª | â¬œ | åœ¨æ¨™é¡Œæ¡†å…§è²¼ä¸Šä¸è§¸ç™¼è‡ªå‹•å¡«è¡¨ |
| IM-1.3 | æ™ºæ…§åµæ¸¬ 591 å…§å®¹ | â¬œ | åŒ…å«ã€Œ591ã€æˆ–ã€Œè¬+åªã€æ‰è§¸ç™¼ |
| IM-1.4 | é¡¯ç¤ºè™•ç†ä¸­ Loading ç‹€æ…‹ | â¬œ | ç”¨æˆ¶çŸ¥é“ç³»çµ±æ­£åœ¨è™•ç† |

**ğŸ’¡ é¦–å¸­æ¶æ§‹å¸«æŒ‡å¼•**:
> ã€Œè²¼ä¸Šç›£è¯çš„é—œéµæ˜¯ **ä¸è¦å¹²æ“¾æ­£å¸¸è¼¸å…¥**ã€‚ç”¨ `document.activeElement?.tagName` åˆ¤æ–·ç„¦é»ä½ç½®ï¼Œè€Œéç¦ç”¨æ•´å€‹ paste äº‹ä»¶ã€‚ã€
>
> **å¯¦ä½œæç¤º**:
> ```tsx
> useEffect(() => {
>   const handlePaste = (e: ClipboardEvent) => {
>     const activeEl = document.activeElement;
>     if (activeEl?.tagName === 'INPUT' || activeEl?.tagName === 'TEXTAREA') return;
>
>     const text = e.clipboardData?.getData('text') || '';
>     if (text.includes('591') || (text.includes('è¬') && text.includes('åª'))) {
>       e.preventDefault();
>       handleImport(text);
>     }
>   };
>   document.addEventListener('paste', handlePaste);
>   return () => document.removeEventListener('paste', handlePaste);
> }, [handleImport]);
> ```

---

### IM-2: 591 ç”Ÿç”¢ç´šè§£æå™¨ â¬œ

**è¨­è¨ˆ**: å¸¶ã€Œä¿¡å¿ƒåˆ†æ•¸ã€çš„è§£æå™¨ï¼ŒMaiMai æ ¹æ“šåˆ†æ•¸å±•ç¾ä¸åŒæƒ…ç·’ã€‚

| ID | å­ä»»å‹™ | ç‹€æ…‹ | é©—æ”¶æ¨™æº– |
|:---|:---|:---:|:---|
| IM-2.1 | åƒ¹æ ¼è§£æ (å”®/ç§Ÿé€šç”¨) | â¬œ | åŒ¹é…ã€Œå”®åƒ¹ 1,288 è¬ã€ã€Œç§Ÿé‡‘ 25,000 å…ƒ/æœˆã€ |
| IM-2.2 | åªæ•¸è§£æ | â¬œ | åŒ¹é…ã€Œæ¬Šç‹€ 34.2 åªã€ã€Œå»ºåª 28 åªã€ |
| IM-2.3 | æ ¼å±€è§£æ | â¬œ | åŒ¹é…ã€Œ3æˆ¿2å»³2è¡›ã€ã€Œé›…æˆ¿ã€ã€Œå¥—æˆ¿ã€ |
| IM-2.4 | åœ°å€è§£æ (å°/è‡ºé€šç”¨) | â¬œ | åŒ¹é…ã€Œå°åŒ—å¸‚ä¿¡ç¾©å€ä¿¡ç¾©è·¯äº”æ®µ7è™Ÿã€ |
| IM-2.5 | æ¨™é¡Œæ“·å– | â¬œ | å– 5-50 å­—çš„éæ•¸å­—è¡Œ |
| IM-2.6 | 591 ç‰©ä»¶ ID æ“·å– | â¬œ | åŒ¹é… `detail/123456` æˆ– `id=123456` |
| IM-2.7 | ä¿¡å¿ƒåˆ†æ•¸è¨ˆç®— | â¬œ | åƒ¹æ ¼+åªæ•¸+æ ¼å±€+åœ°å€+æ¨™é¡Œ = 25+25+20+20+10 |

**ğŸ’¡ é¦–å¸­æ¶æ§‹å¸«æŒ‡å¼•**:
> ã€Œè§£æå™¨çš„æ ¸å¿ƒæ˜¯ **å®¹éŒ¯**ã€‚591 çš„æ ¼å¼æœƒè®Šï¼Œç”¨æˆ¶çš„è¤‡è£½ç¯„åœä¹Ÿä¸å›ºå®šã€‚æ¯å€‹æ¬„ä½éƒ½è¦æœ‰ fallbackã€‚ã€
>
> **ä¿¡å¿ƒåˆ†æ•¸å°æ‡‰**:
> ```tsx
> if (confidence >= 80) {
>   setMood('excited');
>   addMessage("å®Œç¾ï¼å…¨éƒ¨è³‡æ–™éƒ½æŠ“åˆ°äº† âœ¨");
>   window.dispatchEvent(new CustomEvent('mascot:celebrate'));
> } else if (confidence >= 40) {
>   setMood('happy');
>   addMessage(`æŠ“åˆ°äº†åƒ¹æ ¼èˆ‡åªæ•¸ï¼Œå‰©ä¸‹çš„æ¬„ä½å†è£œé½Šï½`);
> } else {
>   setMood('confused');
>   addMessage("å…§å®¹æœ‰é»çŸ­ï¼Œåªçœ‹æ‡‚äº†ä¸€é»é» ğŸ¤”");
> }
> ```

---

### IM-3: é‡è¤‡åŒ¯å…¥åµæ¸¬ â¬œ

**è¨­è¨ˆ**: ç•¶åµæ¸¬åˆ°ä¸åŒç‰©ä»¶ ID æ™‚ï¼ŒMaiMai ä¸»å‹•è©¢å•æ˜¯å¦è¦†è“‹ã€‚

| ID | å­ä»»å‹™ | ç‹€æ…‹ | é©—æ”¶æ¨™æº– |
|:---|:---|:---:|:---|
| IM-3.1 | è¨˜éŒ„ `lastListingId` ç‹€æ…‹ | â¬œ | æˆåŠŸåŒ¯å…¥å¾Œå„²å­˜ ID |
| IM-3.2 | åµæ¸¬æ–°èˆŠ ID ä¸åŒ | â¬œ | æ¯”å° `imported.listingId !== lastListingId` |
| IM-3.3 | å½ˆå‡ºç¢ºèªå°è©±æ¡† | â¬œ | ä½¿ç”¨ `notify.confirm` |
| IM-3.4 | æ”¯æ´å¼·åˆ¶è¦†è“‹ `forceOverwrite` | â¬œ | ç¢ºèªå¾Œæ¸…é™¤èˆŠè³‡æ–™å†å¡«å…¥ |

**ğŸ’¡ é¦–å¸­æ¶æ§‹å¸«æŒ‡å¼•**:
> ã€Œé‡è¤‡åŒ¯å…¥çš„ UX å¾ˆé‡è¦ã€‚ä¸è¦ç›´æ¥è¦†è“‹ï¼Œä¹Ÿä¸è¦æ¯æ¬¡éƒ½å•ã€‚åªæœ‰ç•¶ **ID ä¸åŒ** æ™‚æ‰è©¢å•ã€‚ã€

---

### IM-4: iOS æ·å¾‘æ”¯æ´ â¬œ

**è¨­è¨ˆ**: æ”¯æ´ iOS Shortcuts ç›´æ¥å‚³é 591 å…§å®¹è‡³ä¸Šå‚³é ã€‚

| ID | å­ä»»å‹™ | ç‹€æ…‹ | é©—æ”¶æ¨™æº– |
|:---|:---|:---:|:---|
| IM-4.1 | ç›£è½ URL `?importText=` åƒæ•¸ | â¬œ | é é¢è¼‰å…¥æ™‚è‡ªå‹•è§¸ç™¼åŒ¯å…¥ |
| IM-4.2 | è™•ç† URI decode | â¬œ | æ­£ç¢ºè§£æä¸­æ–‡å­—å…ƒ |
| IM-4.3 | è™•ç†å¾Œæ¸…é™¤ URL åƒæ•¸ | â¬œ | é¿å…é‡æ–°æ•´ç†æ™‚é‡è¤‡åŒ¯å…¥ |
| IM-4.4 | é˜²æ­¢é‡è¤‡è™•ç† | â¬œ | ä½¿ç”¨ `useRef` è¨˜éŒ„æ˜¯å¦å·²è™•ç† |

**ğŸ’¡ é¦–å¸­æ¶æ§‹å¸«æŒ‡å¼•**:
> ã€ŒiOS æ·å¾‘çš„ URL å¯èƒ½å¾ˆé•·ï¼Œè¨˜å¾—ç”¨ `decodeURIComponent` è§£ç¢¼ã€‚è™•ç†å¾Œç”¨ `setSearchParams` æ¸…é™¤åƒæ•¸ï¼Œä¸”è¨­å®š `replace: true` é¿å…æ±¡æŸ“æ­·å²ç´€éŒ„ã€‚ã€

---

### IM-5: è§£æå“è³ªè¿½è¹¤ API â¬œ

**è¨­è¨ˆ**: å¾Œç«¯è¿½è¹¤è§£æçµæœï¼Œç”¨æ–¼å„ªåŒ– Regexã€‚

| ID | å­ä»»å‹™ | ç‹€æ…‹ | é©—æ”¶æ¨™æº– |
|:---|:---|:---:|:---|
| IM-5.1 | å»ºç«‹ `api/analytics/import.ts` | â¬œ | Vercel Serverless å‡½æ•¸ |
| IM-5.2 | è¨˜éŒ„ `textLength`, `confidence`, `fieldsFound` | â¬œ | å¯æŸ¥è©¢å“ªå€‹æ¬„ä½æœ€å¸¸å¤±æ•— |
| IM-5.3 | å¯«å…¥ Supabase analytics è¡¨ | â¬œ | æ¯é€±å¯åˆ†æè§£æå“è³ª |

**ğŸ’¡ é¦–å¸­æ¶æ§‹å¸«æŒ‡å¼•**:
> ã€Œé€™æ˜¯ P2 ä»»å‹™ï¼Œå…ˆç¢ºä¿å‰ç«¯åŠŸèƒ½å®Œå–„ã€‚è¿½è¹¤ API çš„åƒ¹å€¼åœ¨æ–¼ **ç™¼ç¾ 591 æ”¹ç‰ˆ**ï¼šå¦‚æœæŸé€±çš„åƒ¹æ ¼è§£ææˆåŠŸç‡çªç„¶ä¸‹é™ï¼Œå°±çŸ¥é“è©²æ›´æ–° Regex äº†ã€‚ã€

---

## ğŸ¯ é©—æ”¶æ¨™æº– (Acceptance Criteria)

### å…¬ä»”äº’å‹•é©—æ”¶
1. **MM-AC1**: é»æ“Š MaiMai 5 æ¬¡æœƒè§¸ç™¼ `celebrate` å¿ƒæƒ… + æ’’èŠ±å‹•ç•«
2. **MM-AC2**: åœ¨ SmartAsk è¼¸å…¥å•é¡Œæ™‚ï¼ŒMaiMai é¡¯ç¤º `thinking` å¿ƒæƒ…
3. **MM-AC3**: å•ç­”æˆåŠŸå¾Œï¼ŒMaiMai é¡¯ç¤º `excited` å¿ƒæƒ…ä¸¦æ’’èŠ±
4. **MM-AC4**: å°è©±æ°£æ³¡é¡¯ç¤ºæœ€è¿‘ 3 å¥ï¼Œæœ€æ–°ä¸€å¥ç²—é«”

### ä¸€éµæ¬å®¶é©—æ”¶
1. **IM-AC1**: åœ¨ç©ºç™½è™•è²¼ä¸Š 591 å…§å®¹ï¼Œè‡ªå‹•å¡«å…¥åƒ¹æ ¼ã€åªæ•¸ã€åœ°å€
2. **IM-AC2**: åœ¨æ¨™é¡Œè¼¸å…¥æ¡†å…§è²¼ä¸Š 591ï¼Œ**ä¸æœƒ**è§¸ç™¼è‡ªå‹•å¡«è¡¨
3. **IM-AC3**: åŒ¯å…¥æˆåŠŸå¾Œ 3 ç§’ï¼Œè‡ªå‹•æ»¾å‹•è‡³ã€Œå…©å¥½ä¸€å…¬é“ã€å€å¡Š
4. **IM-AC4**: è²¼ä¸Šç‰©ä»¶ A å¾Œå†è²¼ä¸Šç‰©ä»¶ Bï¼Œå½ˆå‡ºç¢ºèªè¦–çª—
5. **IM-AC5**: iOS ç”¨æˆ¶å¯é€éæ·å¾‘ç›´æ¥åˆ†äº« 591 é€£çµè‡³ä¸Šå‚³é 

---

## ğŸ“ æª”æ¡ˆè®Šæ›´é è¦½

```
src/
â”œâ”€â”€ components/
â”‚   â””â”€â”€ MaiMai/                      # æ–°å»ºç›®éŒ„
â”‚       â”œâ”€â”€ index.ts
â”‚       â”œâ”€â”€ MaiMaiBase.tsx
â”‚       â”œâ”€â”€ MaiMaiMood.tsx
â”‚       â”œâ”€â”€ MaiMaiSpeech.tsx
â”‚       â”œâ”€â”€ useMaiMaiMood.ts
â”‚       â”œâ”€â”€ useConfetti.ts
â”‚       â””â”€â”€ types.ts
â”œâ”€â”€ pages/
â”‚   â””â”€â”€ PropertyUploadPage.tsx       # ä¿®æ”¹ï¼šåŠ å…¥è²¼ä¸Šç›£è½
â”œâ”€â”€ lib/
â”‚   â””â”€â”€ parse591.ts                  # æ–°å»ºï¼šè§£æå™¨
api/
â””â”€â”€ analytics/
    â””â”€â”€ import.ts                    # æ–°å»ºï¼šè¿½è¹¤ API
```

---

## ğŸ“Š æ¸¬è©¦è¨ˆç•«

| æ¸¬è©¦é¡å‹ | æª”æ¡ˆ | æ¶µè“‹ç¯„åœ |
|:---:|:---|:---|
| å–®å…ƒæ¸¬è©¦ | `parse591.test.ts` | å„ç¨® 591 æ ¼å¼è®Šé«” |
| å–®å…ƒæ¸¬è©¦ | `useMaiMaiMood.test.ts` | å¿ƒæƒ…ç‹€æ…‹æ©Ÿå„ªå…ˆç´š |
| E2E æ¸¬è©¦ | `import.spec.ts` | è²¼ä¸Šæµç¨‹ã€é‡è¤‡åµæ¸¬ |
| è¦–è¦ºæ¸¬è©¦ | Storybook | MaiMai å„å¿ƒæƒ…ç‹€æ…‹ |

---

## ğŸ’¡ é–‹ç™¼é †åºå»ºè­°

```
IM-2 (è§£æå™¨) â†’ IM-1 (ç›£è½å™¨) â†’ MM-2 (æ’’èŠ±) â†’ MM-3 (å¿ƒæƒ…) â†’ å…¶ä»–
```

**åŸå› **: è§£æå™¨æ˜¯æ ¸å¿ƒï¼Œæ²’æœ‰å®ƒå…¶ä»–åŠŸèƒ½éƒ½ç„¡æ³•é©—è­‰ã€‚ç›£è½å™¨æ˜¯å…¥å£ï¼Œæ’’èŠ±æ˜¯æœ€æœ‰æ„Ÿçš„ UX æå‡ã€‚

---

## ğŸ“œ èˆŠä»»å‹™å­˜æª” (å·²å®Œæˆ)

| ä»»å‹™ | ç‹€æ…‹ | åˆ†æ•¸ |
|:---|:---:|:---:|
| UP-1 è¡¨å–®è‡ªå‹•å¿«ç…§ | âœ… | 98/100 |
| UP-2 åœ–ç‰‡å‰ç«¯å£“ç¸® | âœ… | 100/100 |
| UP-3 åœ–ç‰‡ç®¡ç†é‡æ§‹ | âœ… | 95/100 |
| UP-4 äº®é»è† å›Šåˆ†æµ | âœ… | 100/100 |

> å®Œæ•´æ­·å²ï¼šè¦‹ `docs/COMMUNITY_WALL_DEV_LOG.md`
