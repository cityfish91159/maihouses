# ğŸ  P9: é¦–é ç¤¾å€è©•åƒ¹èšåˆ API å°å…¥

> **å°ˆæ¡ˆç‹€æ…‹**: ğŸŸ¡ **Phase 1 å®Œæˆ (68/100)**
> **æœ€å¾Œæ›´æ–°**: 2025-12-15
> **ç›®æ¨™**: å¤–è§€ä¸è®Šï¼Œè³‡æ–™æºå¾éœæ…‹åˆ‡æ›ç‚º API æ··åˆæ¨¡å¼
> **æ ¸å¿ƒç­–ç•¥**: å¾Œç«¯èšåˆ + è‡ªå‹•è£œä½ (Hybrid Reviews System)

---

## âš ï¸ P9-1 å¯©æŸ¥ç™¼ç¾çš„å•é¡Œ (å¿…é ˆåœ¨ P9-2/P9-3 ä¿®å¾©)

### ğŸ’€ P1: API å›å‚³æ ¼å¼èˆ‡ UI ä¸ç›¸å®¹ (-15 åˆ†)

**å•é¡Œ**ï¼šAPI å›å‚³ `displayId: "01"`ï¼Œä½† `ReviewCard` æœŸæœ› `id: "J"` (é¦–å­—æ¯)

**å½±éŸ¿**ï¼šç›´æ¥ä½¿ç”¨ API è³‡æ–™æœƒé¡¯ç¤ºéŒ¯èª¤çš„é ­åƒæ–‡å­—

**ä¿®å¾©æŒ‡å¼•**ï¼š
1. åœ¨ `CommunityTeaser.tsx` åšè³‡æ–™è½‰æ›
2. å°‡ `displayId` æ”¹ç‚ºå¾ `name` æå–é¦–å­—ï¼ˆå¦‚ "åŒ¿å" â†’ "åŒ¿"ï¼‰
3. æˆ–ä¿®æ”¹ `ReviewCard` æ¥å—æ–°æ ¼å¼ï¼ˆä½†é€™æœƒç ´å£å…¶ä»–åœ°æ–¹ï¼‰

```typescript
// P9-3 æ™‚çš„è½‰æ›é‚è¼¯ï¼ˆä¸æ˜¯å®Œæ•´ä»£ç¢¼ï¼Œåªæ˜¯æŒ‡å¼•ï¼‰
const uiData = apiData.map(r => ({
  ...r,
  id: r.name.charAt(0) // å–åå­—é¦–å­—ç•¶é ­åƒ
}))
```

---

### ğŸ”´ P2: displayId è¨ˆç®—é‚è¼¯å•é¡Œ (-5 åˆ†)

**å•é¡Œ**ï¼š`index + 1` è¨ˆç®—æœƒå°è‡´ Mock å’Œ Real è³‡æ–™ç·¨è™Ÿè¡çª

**ä¿®å¾©æŒ‡å¼•**ï¼š
1. Real è³‡æ–™ç”¨ `R01, R02...`
2. Seed è³‡æ–™ç”¨ `S01, S02...`
3. æˆ–ç›´æ¥ç”¨ name é¦–å­—ï¼Œä¸è¦ç”¨æ•¸å­—ç·¨è™Ÿ

---

### ğŸ”´ P3: rating ç¡¬ç·¨ç¢¼ 5 æ˜Ÿ (-4 åˆ†)

**å•é¡Œ**ï¼šæ‰€æœ‰çœŸå¯¦è©•åƒ¹éƒ½é¡¯ç¤º 5 æ˜Ÿï¼Œèˆ‡åŸæœ¬ 3-5 æ˜Ÿæ··åˆä¸åŒ

**ä¿®å¾©æŒ‡å¼•**ï¼š
1. Supabase æ²’æœ‰ rating æ¬„ä½ â†’ æ”¹ç”¨éš¨æ©Ÿ 4-5 æ˜Ÿ
2. æˆ–æ ¹æ“š disadvantage æœ‰ç„¡æ±ºå®šï¼šæœ‰ç¼ºé» â†’ 4 æ˜Ÿï¼Œç„¡ç¼ºé» â†’ 5 æ˜Ÿ

```typescript
// æŒ‡å¼•ï¼šåœ¨ adaptRealReviewForUI ä¸­
rating: review.disadvantage ? 4 : 5
```

---

### ğŸŸ¡ P4: TypeScript å®šç¾©æœªå°å‡º (-3 åˆ†)

**å•é¡Œ**ï¼š`ReviewForUI` åªåœ¨ API æª”æ¡ˆå…§ï¼Œå‰ç«¯ç„¡æ³•é‡ç”¨

**ä¿®å¾©æŒ‡å¼•**ï¼š
1. å»ºç«‹ `src/types/review.ts` å…±ç”¨å®šç¾©
2. API å’Œå‰ç«¯éƒ½ import åŒä¸€å€‹ interface

---

### ğŸŸ¡ P5: TODO.md æ¸¬è©¦ç‹€æ…‹æœªå‹¾é¸ (-2 åˆ†)

**å•é¡Œ**ï¼šæ¸¬è©¦å·²é€šéä½†æ²’æ›´æ–° checkbox

**ç‹€æ…‹**ï¼šå·²åœ¨æ­¤æ¬¡å¯©æŸ¥ä¸­ä¿®æ­£ âœ…

---

### ğŸŸ¡ P6: ç¼ºå°‘éŒ¯èª¤ç›£æ§ä¸Šå ± (-3 åˆ†)

**å•é¡Œ**ï¼š`console.error` åªåœ¨ server logï¼ŒProduction ç„¡æ³•è¿½è¹¤

**ä¿®å¾©æŒ‡å¼•**ï¼š
1. åŠ å…¥ `/api/log-error.ts` ä¸Šå ±
2. æˆ–æœªä¾†æ•´åˆ Sentry

---

## âœ… Phase 1: å¾Œç«¯ API - å·²å®Œæˆ (68/100)

### P9-1: `api/home/featured-reviews.ts` âœ…

**æª”æ¡ˆä½ç½®**: `/api/home/featured-reviews.ts`

**å·²å¯¦ä½œåŠŸèƒ½**:
1. âœ… å¾ Supabase `community_reviews` æ’ˆå–çœŸå¯¦è³‡æ–™
2. âœ… ä¸è¶³ 6 ç­†æ™‚ç”¨ `SERVER_SEEDS` è£œä½
3. âœ… çµ±ä¸€è¼¸å‡ºæ ¼å¼ (Adapter Pattern)
4. âœ… è¨­å®š Cache Header (`s-maxage=60, stale-while-revalidate=300`)
5. âœ… CORS è¨­å®š
6. âœ… éŒ¯èª¤é™ç´šæ©Ÿåˆ¶ (API ç•°å¸¸æ™‚ä»å›å‚³ Mock)

**å¾…ä¿®å¾©** (å¯åœ¨ P9-2/P9-3 ä¸€ä½µè™•ç†)ï¼š
- âš ï¸ P1: displayId æ ¼å¼éœ€é…åˆ UI
- âš ï¸ P3: rating ä¸æ‡‰ç¡¬ç·¨ç¢¼ 5 æ˜Ÿ

**API å›æ‡‰æ ¼å¼**:
```json
{
  "success": true,
  "data": [
    {
      "id": "uuid",
      "displayId": "01",
      "name": "åŒ¿åæˆ¿ä»²ï½œèªè­‰è©•åƒ¹",
      "rating": 5,
      "tags": ["#å„ªé»1", "#å„ªé»2"],
      "content": "æ¨è–¦å„ªé»ï¼š...",
      "communityId": "uuid",
      "source": "real",
      "region": "taiwan"
    }
  ],
  "meta": {
    "total": 6,
    "realCount": 2,
    "seedCount": 4,
    "timestamp": "2025-12-15T..."
  }
}
```

**é©—è­‰çµæœ**:
- TypeScript ç·¨è­¯: âœ… é€šé
- Vite Build: âœ… é€šé (19.42s)
- Live API: âœ… æ­£å¸¸é‹ä½œ

---

## ğŸ“Š æ¸¬è©¦è¨ˆç•«

### API ç«¯é»æ¸¬è©¦
- [x] éƒ¨ç½²å¾Œæ¸¬è©¦: `https://maihouses.vercel.app/api/home/featured-reviews`
- [x] é©—è­‰å›å‚³ 6 ç­†è³‡æ–™
- [x] é©—è­‰æ··åˆ `source: "real"` + `source: "seed"`

---

## ğŸ“ å¾…å¯¦ä½œæ¸…å–®

### Phase 2: å‰ç«¯æœå‹™å±¤

- [ ] **P9-2**: æ›´æ–° `src/services/communityService.ts`
  - æ–°å¢ `getFeaturedHomeReviews()` å‡½æ•¸
  - éŒ¯èª¤è™•ç† + fallback
  - **ä¿®å¾© P1**: è½‰æ› displayId â†’ é¦–å­—é ­åƒ
  - **ä¿®å¾© P4**: å»ºç«‹å…±ç”¨ TypeScript interface

### Phase 3: UI æ•´åˆ

- [ ] **P9-3**: æ›´æ–° `CommunityTeaser.tsx`
  - æ”¹ç”¨ `useEffect` + `useState` å–ä»£éœæ…‹ import
  - ä¿æŒ UI å¤–è§€å®Œå…¨ä¸è®Š
  - è™•ç†é»æ“Šå°å‘é‚è¼¯ (Mock vs Real)
  - **é©—è­‰**: é ­åƒé¡¯ç¤ºæ­£ç¢ºï¼ˆä¸æ˜¯ "01"ï¼‰

### Phase 4: ä¿åº•æ©Ÿåˆ¶

- [ ] **P9-4**: æ›´æ–° `src/constants/data.ts`
  - å°‡ `COMMUNITY_REVIEWS` æ”¹åç‚º `BACKUP_REVIEWS`

---

## ğŸ“ æª”æ¡ˆè®Šæ›´æ¸…å–®

| æª”æ¡ˆ | æ“ä½œ | ç‹€æ…‹ |
|------|------|------|
| `api/home/featured-reviews.ts` | æ–°å¢ | âœ… å®Œæˆ (éœ€å°ä¿®) |
| `src/types/review.ts` | æ–°å¢ | â¬œ å¾…åš (P4 ä¿®å¾©) |
| `src/services/communityService.ts` | ä¿®æ”¹ | â¬œ å¾…åš |
| `src/features/home/sections/CommunityTeaser.tsx` | ä¿®æ”¹ | â¬œ å¾…åš |
| `src/constants/data.ts` | ä¿®æ”¹ | â¬œ å¾…åš |
