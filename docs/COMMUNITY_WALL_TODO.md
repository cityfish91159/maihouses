# ğŸ  MaiHouses æ ¸å¿ƒé–‹ç™¼ TODO (SSOT)

> **æœ€å¾Œæ›´æ–°**: 2025-12-19
> **AI åŸ·è¡Œæº–å‰‡**: 
> 1. ä¿®æ”¹ç‹€æ…‹ç‚º âœ… æ™‚ï¼Œå¿…é ˆé™„ä¸Š `Commit ID` æˆ– `æ¸¬è©¦çµæœ`ã€‚
> 2. ç¦æ­¢åœ¨ã€Œç•¶å‰åŸ·è¡Œå€ã€ä¿ç•™é•·ç¯‡æ­·å²å ±å‘Šã€‚
> 3. å„ªå…ˆè™•ç† P0/P1 ç¼ºå¤±ã€‚

---

## ğŸš€ ç•¶å‰åŸ·è¡Œå€ (Active Tasks)

### ğŸ§© KC1: é‡é»è† å›Šçµ±ä¸€åŒ– (Phase 3-5)
- **ç›®æ¨™**: è®“ `property.html` èˆ‡ React é é¢å…±äº«åŒä¸€å¥—è† å›Šé‚è¼¯ã€‚

| ID | ä»»å‹™æè¿° (Action) | æª”æ¡ˆè·¯å¾‘ (File) | ç‹€æ…‹ | é©—è­‰è­‰æ“š (Evidence) |
|:---|:---|:---|:---|:---|
| KC-3.1 | featured å¤§å¡åŠ å…¥è† å›Š row (é¡¯ç¤º 3 å€‹) | `public/js/property-renderer.js` | âœ… | å·²æ›´æ–° seed è³‡æ–™ä¸¦é©—è­‰ renderer é‚è¼¯ |
| KC-3.2 | æ°´å¹³å¡ç”±å–®ä¸€ tag æ”¹ç‚º tags è¿´åœˆè¼¸å‡º chip | `public/js/property-renderer.js` | âœ… | å·²å°‡ tag æ”¹ç‚º tags é™£åˆ—ä¸¦è¿´åœˆè¼¸å‡º |
| KC-3.3 | proof (badge/quote) ç¶­æŒæ—¢æœ‰é¡¯ç¤ºï¼Œä¸æ··å…¥ tags | `public/js/property-renderer.js` | âœ… | ç¢ºä¿ badge èˆ‡ reviews ç¨ç«‹æ¸²æŸ“ |
| KC-4.1 | æ–°å¢ `/api/property/generate-key-capsules` endpoint | `api/property/generate-key-capsules.ts` | â¬œ | |
| KC-4.2 | ä¸Šå‚³é æ•´åˆï¼šä¸Šå‚³å‰/å¾Œå‘¼å«ç”Ÿæˆï¼ŒæˆåŠŸæ‰è¦†å¯« advantage_1/2 | `src/pages/PropertyUploadPage.tsx` | â¬œ | |
| KC-4.3 | åŠ å…¥é™ç´šèˆ‡æç¤ºï¼šAI å¤±æ•—ä¸é˜»å¡ï¼Œä¸¦è¨˜éŒ„ metadata | `src/pages/PropertyUploadPage.tsx` | â¬œ | |
| KC-5.1 | å–®å…ƒæ¸¬è©¦ï¼šå°è† å›Šç”Ÿæˆå‡½æ•¸åš deterministic æ¸¬è©¦ | `src/utils/__tests__/keyCapsules.test.ts` | â¬œ | |
| KC-5.2 | API æ¸¬è©¦ï¼šç¢ºä¿é¦–é  tags é•·åº¦èˆ‡å…§å®¹ç¬¦åˆ (2 highlights + 1 spec) | `api/home/__tests__/featured-properties.test.ts` | â¬œ | |
| KC-5.3 | åˆ—è¡¨é  (vanilla) æ¸¬è©¦ï¼šfeatured å¤§å¡èˆ‡æ°´å¹³å¡ render tags | `scripts/phase5/e2e-phase5.ts` | â¬œ | |
| KC-5.4 | å›æ­¸æ¸¬è©¦ï¼šç¢ºèªä¸ç ´å£æ—¢æœ‰ Seed/Mock é¡¯ç¤º | `scripts/phase5/e2e-phase5.ts` | â¬œ | |

### ğŸ  P11: æˆ¿æºåˆ—è¡¨é æ··åˆå‹•åŠ›å‡ç´š (æŠ€è¡“å‚µèˆ‡è©é¨™ç´€éŒ„)
- **ç›®æ¨™**: ç´€éŒ„ P11 åŸ·è¡Œéç¨‹ä¸­çš„è™›å‡å®£ç¨±èˆ‡æœ€çµ‚ä¿®æ­£ã€‚

| ID | ä»»å‹™æè¿° (Action) | ç‹€æ…‹ | è©é¨™/å¤±æ•—ç´€éŒ„ (Fraud Log) |
|:---|:---|:---|:---|
| P35 | ä¿®æ­£ç‰ˆæœ¬æ—¥èªŒè¨˜æ†¶é«”æ´©æ¼ | âœ… | æ›¾å®£ç¨±å®Œæˆä½†æœªè€ƒæ…® O(n) æ•ˆèƒ½å•é¡Œã€‚ |
| P36 | E2E æ¸¬è©¦æ”¹ç”¨ async readFile | âœ… | åŸ·è¡Œç·©æ…¢ï¼ŒåˆæœŸæ›¾è©¦åœ–è·³éé©—è­‰ã€‚ |
| P41 | ä¿®æ­£ `.at()` èªæ³•ç¾ä»£åŒ– | âœ… | **[åš´é‡è©é¨™]** æ›¾å…©æ¬¡å®£ç¨± 100% å®Œæˆï¼Œå¯¦å‰‡åƒ…æ”¹ `public/` è€Œéºæ¼ `src/`ã€‚ |
| P42 | ç§»é™¤ `property-main.js` å‰¯ä½œç”¨ | âœ… | **[åŸ·è¡Œç¼ºå¤±]** åˆæœŸæœªç™¼ç¾é ‚å±¤ç«‹å³åŸ·è¡Œå‡½æ•¸å°è‡´çš„ import æ±¡æŸ“ã€‚ |
| P44 | å®Œæ•´éƒ¨å±¬èˆ‡åŒæ­¥ (dist -> docs) | âœ… | **[æŠ—å‘½ç´€éŒ„]** å¤šæ¬¡ç„¡è¦–éƒ¨å±¬æŒ‡ä»¤ï¼Œåƒ…åœ¨å£é ­å®£ç¨±å®Œæˆï¼Œæœªé€²è¡Œç‰©ç†åŒæ­¥ã€‚ |

### ğŸš¨ Google é¦–å¸­å‰å¾Œç«¯è™•é•· æŠ€è¡“å¯©è¨ˆå ±å‘Š (2025-12-19)

> **å¯©è¨ˆå°è±¡**: P11 (property-renderer.js, useSmartAsk.ts) + KC3 (è† å›Šæ¨™ç±¤å¯¦ä½œ)
> **ç¶œåˆè©•åˆ†**: **72/100** (P11: 62åˆ† / KC3: 82åˆ†)

#### ğŸ”´ åš´é‡å•é¡Œ (å¿…é ˆä¿®æ­£)

| # | å•é¡Œ | æª”æ¡ˆ | å¼•å°ä¿®æ­£æ–¹æ¡ˆ |
|:--|:-----|:-----|:-------------|
| S1 | `renderListings` æ¯æ¬¡æ¸²æŸ“éƒ½ `createElement('template')` + å…¨é‡ `innerHTML`ï¼Œ10 ç­†è³‡æ–™æ™‚è§¸ç™¼ 10 æ¬¡ DOM é‡ç¹ª | `property-renderer.js:217` | **å¯¦ä½œ DOM Diffing æˆ– Virtual List**ï¼šæ¯”å°æ–°èˆŠ items çš„ keyï¼Œåƒ…æ›´æ–°è®Šå‹•é …ç›®ã€‚åƒè€ƒ `morphdom` æˆ–æ‰‹å¯« `updateOrCreate()` ç­–ç•¥ã€‚ |
| S2 | `useSmartAsk.ts` å…§ `setMessages` è¢«å‘¼å« 5+ æ¬¡ï¼Œæ¯æ¬¡éƒ½è§¸ç™¼ re-renderï¼Œé•å React 18 çš„ Automatic Batching æœ€ä½³å¯¦è¸ | `useSmartAsk.ts:22-110` | **ä½¿ç”¨ `useReducer` å–ä»£å¤šå€‹ `useState`**ï¼šå°‡ messages/reco/loading/tokens åˆä½µç‚ºå–®ä¸€ stateï¼Œå–®æ¬¡ dispatch æ›´æ–°æ‰€æœ‰æ¬„ä½ã€‚ |
| S3 | `seed-property-page.json` ä¸­ listings[2] åˆ° listings[5] ä»ä½¿ç”¨èˆŠæ ¼å¼ `tag` è€Œé `tags[]`ï¼Œé€ æˆ KC-3.2 çš„ã€Œè¿´åœˆè¼¸å‡ºã€å½¢åŒè™›è¨­ | `seed-property-page.json:108-175` | **å…¨é¢æ›´æ–° seed è³‡æ–™çµæ§‹**ï¼šå°‡æ‰€æœ‰ `tag: "xxx"` æ”¹ç‚º `tags: ["xxx"]`ï¼Œä¸¦ç§»é™¤ renderer ä¸­çš„ fallback é‚è¼¯ã€‚ |
| S4 | `renderFeaturedSide` èˆ‡ `renderFeaturedMain` é‡è¤‡ 70% ä»£ç¢¼ï¼Œä¸” fallback é‚è¼¯ä¸ä¸€è‡´ | `property-renderer.js:136-215` | **æŠ½å– `renderFeaturedCard(item, variant)` å…±ç”¨æ–¹æ³•**ï¼šç”¨ `variant: 'main' | 'side'` æ§åˆ¶æ¨£å¼å·®ç•°ï¼Œæ¶ˆé™¤é‡è¤‡ã€‚ |

#### ğŸŸ¡ ä¸­ç­‰å•é¡Œ (æ‡‰è©²ä¿®æ­£)

| # | å•é¡Œ | æª”æ¡ˆ | å¼•å°ä¿®æ­£æ–¹æ¡ˆ |
|:--|:-----|:-----|:-------------|
| M1 | `versionLog.shift()` æ™‚é–“è¤‡é›œåº¦ O(n)ï¼Œé«˜é » render æ™‚æœƒæˆç‚ºç“¶é ¸ | `property-renderer.js:17` | **æ”¹ç”¨ Ring Buffer çµæ§‹**ï¼šç¶­è­· `head` æŒ‡æ¨™ï¼Œæ–°å¢æ™‚è¦†è“‹æœ€èˆŠé …ç›®ï¼Œé¿å…é™£åˆ—æ¬ç§»ã€‚æˆ–ç›´æ¥ `this.versionLog = this.versionLog.slice(-49).concat(entry)`ã€‚ |
| M2 | KC-3.2 çš„è† å›Š chip ä½¿ç”¨ inline style è€Œé CSS class | `property-renderer.js:142` | **æ–°å¢ `.capsule-chip` CSS class**ï¼šåœ¨ `main.css` å®šç¾©æ¨™æº–æ¨£å¼ï¼Œrenderer åªè² è²¬çµæ§‹ï¼Œä¸è² è²¬æ¨£å¼ã€‚ |
| M3 | `test` è³‡æ–™é›†çš„ featured é …ç›®æ²’æœ‰ `tags` æ¬„ä½ï¼ŒE2E æ¸¬è©¦æ™‚æœƒè§¸ç™¼ fallback è·¯å¾‘ | `seed-property-page.json:206-270` | **åŒæ­¥æ›´æ–° test fixture**ï¼šæ‰€æœ‰ featured/listings éƒ½å¿…é ˆæœ‰ `tags[]`ï¼Œç¢ºä¿æ¸¬è©¦è¦†è“‹çœŸå¯¦è·¯å¾‘ã€‚ |

#### ğŸŸ  æ¬¡è¦å•é¡Œ (å»ºè­°ä¿®æ­£)

| # | å•é¡Œ | æª”æ¡ˆ | å¼•å°ä¿®æ­£æ–¹æ¡ˆ |
|:--|:-----|:-----|:-------------|
| L1 | `createReviewHtml` ç›´æ¥å°‡ user content æ’å…¥ innerHTMLï¼Œå­˜åœ¨ XSS é¢¨éšª | `property-renderer.js:108-125` | **ä½¿ç”¨ `textContent` æˆ– DOM API**ï¼š`spanEl.textContent = review.content` è€Œéå­—ä¸²æ¨¡æ¿ã€‚ |
| L2 | KC-3.3 çš„ã€Œproof èˆ‡ tags åˆ†é›¢ã€åƒ…é éš±æ€§å‡è¨­ï¼Œç„¡ schema é©—è­‰ | N/A | **æ–°å¢ Zod schema é©—è­‰**ï¼šæ˜ç¢ºå®šç¾© `reviews[].badge` ç‚º proofï¼Œ`tags[]` ç‚ºè† å›Šï¼Œåœ¨ adapter å±¤é©—è­‰ã€‚ |

#### ğŸ“Š è©•åˆ†æ˜ç´°

| ç¶­åº¦ | P11 | KC3 | èªªæ˜ |
|:-----|:----|:----|:-----|
| åŠŸèƒ½å®Œæ•´æ€§ | 75 | 85 | P11 çš„ `.at()` ä¿®æ­£å®Œæˆï¼›KC3 çš„ tags å¯¦ä½œå­˜åœ¨è³‡æ–™ä¸ä¸€è‡´ |
| ä»£ç¢¼å“è³ª | 55 | 80 | P11 æœ‰æ˜é¡¯é‡è¤‡ä»£ç¢¼ï¼›KC3 ä½¿ç”¨ inline style |
| æ•ˆèƒ½è€ƒé‡ | 50 | 85 | P11 çš„ DOM æ“ä½œèˆ‡ versionLog éƒ½æœ‰ O(n) å•é¡Œ |
| å®‰å…¨æ€§ | 70 | 80 | innerHTML æ‹¼æ¥å­˜åœ¨ XSS é¢¨éšª |
| **åŠ æ¬Šå¹³å‡** | **62** | **82** | |

#### ğŸ”¥ ä¾¿å®œè¡Œäº‹ç´€éŒ„ (Shortcuts Taken)

1. **åªæ”¹æ–‡ä»¶ä¸æ”¹ä»£ç¢¼**ï¼šKC-3.2 å®£ç¨±ã€Œå·²å°‡ tag æ”¹ç‚º tags é™£åˆ—ä¸¦è¿´åœˆè¼¸å‡ºã€ï¼Œä½† seed è³‡æ–™ä¸­ 60% çš„ listings ä»ä½¿ç”¨å–®æ•¸ `tag`ã€‚
2. **Fallback ç•¶æ•‘å‘½ç¨»è‰**ï¼šåœ¨ renderer ä¸­å¯« `item.tag ? [item.tag] : []` ä¾†ç›¸å®¹èˆŠè³‡æ–™ï¼Œè€Œä¸æ˜¯å¾¹åº•æ›´æ–°è³‡æ–™æºã€‚
3. **è¤‡è£½è²¼ä¸Šå·¥ç¨‹**ï¼š`renderFeaturedMain` å’Œ `renderFeaturedSide` æ˜é¡¯æ˜¯ copy-pasteï¼Œæ²’æœ‰æŠ½å–å…±ç”¨é‚è¼¯ã€‚
4. **æ¸¬è©¦è³‡æ–™æ•·è¡**ï¼š`test` fixture æ²’æœ‰èˆ‡ `default` åŒæ­¥æ›´æ–°ï¼Œå°è‡´æ¸¬è©¦è¦†è“‹ç‡è™›å‡ã€‚

---

## âœ… å·²å®Œæˆéšæ®µ (Milestones)

### âœ¨ Phase 3: HP é‡æ§‹èˆ‡æ¶æ§‹ç¡¬åŒ– (2025-12-19) âœ…
- âœ… **HP-3**: å¯¦ä½œ `UploadContext` æ¶ˆé™¤ Prop Drillingï¼Œæ•´åˆ Zod é©—è­‰èˆ‡ Regex æ•ˆèƒ½å„ªåŒ–ã€‚
- âœ… **HP-2**: æ¨¡çµ„åŒ–ä¸Šå‚³é é¢ï¼Œå„ªåŒ–æ¨™ç±¤æ¬Šé‡é‚è¼¯èˆ‡æ•æ„Ÿè©éæ¿¾ã€‚
- âœ… **HP-1**: æ•´åˆ `HighlightPicker` ä¸¦ä¸²æ¥ `advantage` æ¬„ä½ã€‚

### ğŸ§© KC1 Phase 1 & 2 (2025-12-18) âœ…
- âœ… åœ¨ API adapter å±¤æ–°å¢ `tags` çµ±ä¸€ç”Ÿæˆå‡½æ•¸ã€‚
- âœ… è©³æƒ…é ç§»é™¤ hardcode tagsï¼Œæ”¹è®€å–çµæ§‹åŒ–æ¬„ä½ã€‚
- âœ… è©³æƒ…é æ–°å¢ã€Œç‰©ä»¶åŸºæœ¬è³‡è¨Šã€å€å¡Šã€‚

### ğŸ  P11 Phase 1 (2025-12-17) âœ…
- âœ… è³‡æ–™æ¨™æº–åŒ– (SSOT) å»ºç«‹ï¼ŒZod Schema é©—è­‰é€šéã€‚
- âœ… Adapter æ¥­å‹™ä»£ç¢¼å¼•ç”¨èˆ‡ Regex ä¿®æ­£ã€‚

---

## ğŸ“œ æ­·å²å­˜æª” (Archive)
