<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>X-Ray Mike æ¸¬è©¦é é¢</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  min-height: 100vh;
  padding: 20px;
  color: #333;
}

.container {
  max-width: 800px;
  margin: 0 auto;
  background: white;
  border-radius: 20px;
  padding: 40px;
  box-shadow: 0 20px 60px rgba(0,0,0,0.3);
}

h1 {
  font-size: 32px;
  margin-bottom: 10px;
  background: linear-gradient(135deg, #667eea, #764ba2);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

.subtitle {
  color: #666;
  margin-bottom: 30px;
}

.section {
  margin-bottom: 30px;
}

.section-title {
  font-size: 18px;
  font-weight: 600;
  margin-bottom: 15px;
  color: #667eea;
}

.input-group {
  margin-bottom: 20px;
}

label {
  display: block;
  margin-bottom: 8px;
  font-weight: 500;
  color: #555;
}

input[type="text"], input[type="file"] {
  width: 100%;
  padding: 12px;
  border: 2px solid #e0e0e0;
  border-radius: 10px;
  font-size: 14px;
  transition: border-color 0.3s;
}

input[type="text"]:focus {
  outline: none;
  border-color: #667eea;
}

button {
  background: linear-gradient(135deg, #667eea, #764ba2);
  color: white;
  border: none;
  padding: 14px 28px;
  border-radius: 10px;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  transition: transform 0.2s, box-shadow 0.2s;
  width: 100%;
}

button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
}

button:active {
  transform: translateY(0);
}

button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.result {
  margin-top: 30px;
  padding: 20px;
  background: #f8f9fa;
  border-radius: 10px;
  display: none;
}

.result.show {
  display: block;
}

.result img {
  max-width: 100%;
  border-radius: 10px;
  margin-top: 15px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

.error {
  background: #fee;
  color: #c33;
  padding: 15px;
  border-radius: 10px;
  margin-top: 15px;
  display: none;
}

.error.show {
  display: block;
}

.progress {
  width: 100%;
  height: 8px;
  background: #e0e0e0;
  border-radius: 4px;
  overflow: hidden;
  margin-top: 15px;
  display: none;
}

.progress.show {
  display: block;
}

.progress-bar {
  height: 100%;
  background: linear-gradient(90deg, #667eea, #764ba2);
  width: 0%;
  transition: width 0.3s;
  animation: shimmer 2s infinite;
}

@keyframes shimmer {
  0% { opacity: 0.5; }
  50% { opacity: 1; }
  100% { opacity: 0.5; }
}

.info {
  background: #e3f2fd;
  padding: 15px;
  border-radius: 10px;
  margin-top: 15px;
  font-size: 14px;
  color: #1976d2;
}

.code {
  background: #263238;
  color: #aed581;
  padding: 15px;
  border-radius: 10px;
  font-family: 'Courier New', monospace;
  font-size: 13px;
  overflow-x: auto;
  margin-top: 10px;
}

.tabs {
  display: flex;
  gap: 10px;
  margin-bottom: 20px;
  border-bottom: 2px solid #e0e0e0;
}

.tab {
  padding: 10px 20px;
  background: none;
  color: #666;
  border: none;
  cursor: pointer;
  font-weight: 600;
  border-bottom: 3px solid transparent;
  transition: all 0.3s;
  width: auto;
}

.tab.active {
  color: #667eea;
  border-bottom-color: #667eea;
}

.tab-content {
  display: none;
}

.tab-content.active {
  display: block;
}
</style>
</head>
<body>

<div class="container">
  <h1>ğŸ”¬ X-Ray Mike æ¸¬è©¦</h1>
  <p class="subtitle">æ¸¬è©¦ Replicate X-Ray Mike æ¨¡å‹ API</p>

  <div class="tabs">
    <button class="tab active" onclick="switchTab('url')">URL è¼¸å…¥</button>
    <button class="tab" onclick="switchTab('upload')">ä¸Šå‚³åœ–ç‰‡</button>
    <button class="tab" onclick="switchTab('api')">API ç¤ºä¾‹</button>
  </div>

  <!-- Tab 1: URL è¼¸å…¥ -->
  <div class="tab-content active" id="urlTab">
    <div class="section">
      <div class="input-group">
        <label for="imageUrl">åœ–ç‰‡ URLï¼š</label>
        <input type="text" id="imageUrl" placeholder="https://example.com/image.jpg">
      </div>
      <button onclick="processFromUrl()">ğŸ” è™•ç†åœ–ç‰‡</button>
    </div>
  </div>

  <!-- Tab 2: ä¸Šå‚³åœ–ç‰‡ -->
  <div class="tab-content" id="uploadTab">
    <div class="section">
      <div class="input-group">
        <label for="fileInput">é¸æ“‡åœ–ç‰‡ï¼š</label>
        <input type="file" id="fileInput" accept="image/*">
      </div>
      <button onclick="processFromFile()">ğŸ” è™•ç†åœ–ç‰‡</button>
    </div>
  </div>

  <!-- Tab 3: API ç¤ºä¾‹ -->
  <div class="tab-content" id="apiTab">
    <div class="section">
      <div class="section-title">JavaScript èª¿ç”¨ç¤ºä¾‹</div>
      <div class="code">const response = await fetch('/api/x-raymike', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    image: 'https://example.com/image.jpg'
  })
});

const result = await response.json();
console.log('è¼¸å‡º:', result.output);</div>
    </div>

    <div class="section">
      <div class="section-title">cURL èª¿ç”¨ç¤ºä¾‹</div>
      <div class="code">curl -X POST https://maihouses.vercel.app/api/x-raymike \
  -H "Content-Type: application/json" \
  -d '{"image": "https://example.com/image.jpg"}'</div>
    </div>

    <div class="info">
      <strong>ğŸ“š å®Œæ•´æ–‡æª”ï¼š</strong> æŸ¥çœ‹ <code>X_RAY_MIKE_GUIDE.md</code> ç²å–æ›´å¤šä¿¡æ¯
    </div>
  </div>

  <!-- é€²åº¦æ¢ -->
  <div class="progress" id="progress">
    <div class="progress-bar" id="progressBar"></div>
  </div>

  <!-- éŒ¯èª¤æç¤º -->
  <div class="error" id="error"></div>

  <!-- çµæœé¡¯ç¤º -->
  <div class="result" id="result">
    <div class="section-title">âœ¨ è™•ç†çµæœ</div>
    <div id="resultInfo"></div>
    <img id="resultImage" alt="è™•ç†çµæœ">
  </div>
</div>

<script>
function switchTab(tab) {
  // åˆ‡æ›æ¨™ç±¤
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));

  event.target.classList.add('active');
  document.getElementById(tab + 'Tab').classList.add('active');
}

function showProgress(show) {
  document.getElementById('progress').classList.toggle('show', show);
  if (show) {
    document.getElementById('progressBar').style.width = '0%';
    setTimeout(() => {
      document.getElementById('progressBar').style.width = '90%';
    }, 100);
  }
}

function showError(message) {
  const errorEl = document.getElementById('error');
  errorEl.textContent = message;
  errorEl.classList.add('show');
  setTimeout(() => errorEl.classList.remove('show'), 5000);
}

function showResult(data) {
  const resultEl = document.getElementById('result');
  const imageEl = document.getElementById('resultImage');
  const infoEl = document.getElementById('resultInfo');

  if (data.ok && data.output) {
    imageEl.src = data.output;
    infoEl.innerHTML = `
      <strong>ID:</strong> ${data.id}<br>
      ${data.metrics ? `<strong>è™•ç†æ™‚é–“:</strong> ${data.metrics.predict_time.toFixed(2)}s` : ''}
    `;
    resultEl.classList.add('show');
  } else {
    showError('è™•ç†å¤±æ•—ï¼š' + (data.error || 'æœªçŸ¥éŒ¯èª¤'));
  }
}

async function processFromUrl() {
  const imageUrl = document.getElementById('imageUrl').value.trim();

  if (!imageUrl) {
    showError('è«‹è¼¸å…¥åœ–ç‰‡ URL');
    return;
  }

  await processImage(imageUrl);
}

async function processFromFile() {
  const fileInput = document.getElementById('fileInput');
  const file = fileInput.files[0];

  if (!file) {
    showError('è«‹é¸æ“‡åœ–ç‰‡');
    return;
  }

  // è½‰æ›ç‚º base64
  const reader = new FileReader();
  reader.onload = async (e) => {
    await processImage(e.target.result);
  };
  reader.readAsDataURL(file);
}

async function processImage(imageData) {
  // éš±è—ä¹‹å‰çš„çµæœå’ŒéŒ¯èª¤
  document.getElementById('result').classList.remove('show');
  document.getElementById('error').classList.remove('show');

  // é¡¯ç¤ºé€²åº¦
  showProgress(true);

  // ç¦ç”¨æŒ‰éˆ•
  document.querySelectorAll('button').forEach(btn => btn.disabled = true);

  try {
    const response = await fetch('/api/x-raymike', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        image: imageData
      })
    });

    const data = await response.json();

    if (response.ok) {
      showResult(data);
    } else {
      showError(`API éŒ¯èª¤ (${response.status}): ${data.error || data.message || 'æœªçŸ¥éŒ¯èª¤'}`);
    }
  } catch (error) {
    showError('ç¶²çµ¡éŒ¯èª¤: ' + error.message);
  } finally {
    showProgress(false);
    document.querySelectorAll('button').forEach(btn => btn.disabled = false);
  }
}

// é å¡«ç¤ºä¾‹ URL
document.getElementById('imageUrl').value = 'https://replicate.delivery/pbxt/Jv0iM5p0HZJZZvqG7SgZqMQhBYCdvnkm2TQkI7qHB3ycDGRA/out-0.webp';
</script>

</body>
</html>
