# ç¤¾å€ç‰†é–‹ç™¼ç´€éŒ„

> **æœ€å¾Œæ›´æ–°**: 2025/12/03 01:00 (å°åŒ—æ™‚é–“)  
> **ç‹€æ…‹**: MVP å®Œæˆ + React ç‰ˆå®Œæˆ + **é‡æ§‹å„ªåŒ–å®Œæˆ**

---

## ğŸ“ æª”æ¡ˆæ¸…å–®

| æª”æ¡ˆ | ç”¨é€” |
|------|------|
| `public/maihouses/community-wall_mvp.html` | MVP å‰ç«¯é é¢ (1047è¡Œ) |
| `src/pages/Community/Wall.tsx` | **React ç‰ˆç¤¾å€ç‰† (é‡æ§‹ç‰ˆ, ~120è¡Œ)** |
| `src/pages/Community/Wall.backup.tsx` | é‡æ§‹å‰å‚™ä»½ (748è¡Œ) |
| `src/pages/Community/types.ts` | **å…±ç”¨å‹åˆ¥å®šç¾© (æ–°å¢)** |
| `src/pages/Community/mockData.ts` | **Mock è³‡æ–™ (æ–°å¢)** |
| `src/pages/Community/components/` | **çµ„ä»¶ç›®éŒ„ (æ–°å¢)** |
| `src/pages/Community/components/index.ts` | çµ„ä»¶åŒ¯å‡º |
| `src/pages/Community/components/Topbar.tsx` | é ‚éƒ¨å°èˆªåˆ— |
| `src/pages/Community/components/ReviewsSection.tsx` | è©•åƒ¹å€å¡Š |
| `src/pages/Community/components/PostsSection.tsx` | è²¼æ–‡å€å¡Šï¼ˆå…¬é–‹ç‰†/ç§å¯†ç‰†ï¼‰ |
| `src/pages/Community/components/QASection.tsx` | å•ç­”å€å¡Š |
| `src/pages/Community/components/Sidebar.tsx` | å´é‚Šæ¬„ |
| `src/pages/Community/components/RoleSwitcher.tsx` | èº«ä»½åˆ‡æ›å™¨ |
| `src/pages/Community/components/MockToggle.tsx` | Mock åˆ‡æ›æŒ‰éˆ• |
| `src/pages/Community/components/BottomCTA.tsx` | åº•éƒ¨ CTA |
| `api/community/wall.ts` | API: è®€å–è³‡æ–™ |
| `api/community/question.ts` | API: å•ç­”åŠŸèƒ½ |
| `api/community/like.ts` | API: æŒ‰è®šåŠŸèƒ½ |
| `supabase/migrations/20241201_community_wall.sql` | è³‡æ–™åº« Schema |
| `src/hooks/usePropertyFormValidation.ts` | è¡¨å–®é©—è­‰ Hook |
| `src/hooks/useCommunityWall.ts` | ç¤¾å€ç‰†è³‡æ–™ Hook (åŸç‰ˆ) |
| `src/hooks/useCommunityWallQuery.ts` | **ç¤¾å€ç‰† Hook (React Query ç‰ˆ, æ–°å¢)** |
| `src/components/ui/Toast.tsx` | Toast é€šçŸ¥çµ„ä»¶ |
| `src/components/ui/CommunityPicker.tsx` | ç¤¾å€é¸æ“‡å™¨ |
| `src/utils/contentCheck.ts` | å…§å®¹å¯©æ ¸å·¥å…· |
| `src/services/communityService.ts` | ç¤¾å€ç‰† API å°è£ | |

---

## ğŸŒ ç¶²å€

| ç‰ˆæœ¬ | ç¶²å€ |
|------|------|
| **é¦–é ** | `https://maihouses.vercel.app/maihouses/` |
| MVP HTML | `https://maihouses.vercel.app/maihouses/community-wall_mvp.html` |
| **React ç‰ˆ** | `https://maihouses.vercel.app/maihouses/community/{uuid}/wall` |

---

## ğŸ” æ¬Šé™çŸ©é™£

| åŠŸèƒ½ | è¨ªå®¢ | æœƒå“¡ | ä½æˆ¶ | æˆ¿ä»² |
|------|------|------|------|------|
| è©•åƒ¹ | 2å‰‡+blur | å…¨éƒ¨ | å…¨éƒ¨ | å…¨éƒ¨ |
| å…¬é–‹ç‰† | 2å‰‡+blur | å…¨éƒ¨ | +ç™¼æ–‡ | +ç™¼ç‰©ä»¶ |
| ç§å¯†ç‰† | âŒé– | âŒé– | âœ…+ç™¼æ–‡ | âœ…å”¯è®€ |
| å•ç­” | çœ‹1ç­” | å¯å• | å¯ç­” | å°ˆå®¶ç­” |
| æŒ‰è®š | âŒ | âœ… | âœ… | âœ… |
| CTA | è¨»å†Š | é©—è­‰ | éš±è— | éš±è— |

---

## âœ… å·²å®ŒæˆåŠŸèƒ½

1. **å››è§’è‰²æ¬Šé™ç³»çµ±**ï¼šè¨ªå®¢/æœƒå“¡/ä½æˆ¶/æˆ¿ä»²ï¼Œå®Œæ•´æ¬Šé™æ§åˆ¶
2. **blur é®ç½©**ï¼šç”¨ body.role-xxx class æ§åˆ¶ï¼Œåˆ‡æ›èº«ä»½ä¸æœƒå£
3. **è©•åƒ¹å€**ï¼šæ¯å€‹âœ…/âš–ï¸=1å‰‡ï¼Œè¨ªå®¢åªçœ‹2å‰‡
4. **å…¬é–‹ç‰†/ç§å¯†ç‰†**ï¼šTab åˆ‡æ›ï¼Œæœƒå“¡é»ç§å¯†ç‰†å½ˆé©—è­‰æç¤º
5. **å•ç­”å€**ï¼šè¨ªå®¢çœ‹1å‰‡å›ç­”ï¼Œæˆ¿ä»²å›ç­”é¡¯ç¤ºå°ˆå®¶æ¨™ç« 
6. **æŒ‰è®šåŠŸèƒ½**ï¼šliked_by[] + /api/community/like
7. **Mock èº«ä»½åˆ‡æ›å™¨**ï¼šå³ä¸‹è§’å³æ™‚åˆ‡æ›æ¸¬è©¦
8. **React ç‰ˆç¤¾å€ç‰†**ï¼šå®Œæ•´æ‹†è§£ MVP HTML ç‚º React çµ„ä»¶
9. **ğŸ†• çµ„ä»¶åŒ–é‡æ§‹**ï¼šå°‡ 748 è¡Œå–®æª”æ‹†åˆ†ç‚º 8 å€‹ç¨ç«‹çµ„ä»¶
10. **ğŸ†• React Query æ•´åˆ**ï¼šä½¿ç”¨ @tanstack/react-query å¯¦ç¾ SWR ç­–ç•¥
11. **ğŸ†• æ¨‚è§€æ›´æ–°**ï¼šæŒ‰è®šæ“ä½œæ”¯æ´å³æ™‚ UI æ›´æ–°èˆ‡å¤±æ•—å›æ»¾
12. **ğŸ†• ç„¡éšœç¤™å„ªåŒ–**ï¼šæ·»åŠ  aria-labelã€aria-hiddenã€role ç­‰å±¬æ€§

---

## ğŸ”§ é‡æ§‹å„ªåŒ– (2025/12/03)

### æ¶æ§‹è®Šæ›´

**åŸæ¶æ§‹**ï¼ˆå–®ä¸€ 748 è¡Œæª”æ¡ˆï¼‰ï¼š
```
Wall.tsx (748è¡Œ)
â”œâ”€â”€ Types å®šç¾©
â”œâ”€â”€ Mock è³‡æ–™
â”œâ”€â”€ Permission Helper
â””â”€â”€ æ‰€æœ‰çµ„ä»¶ (inline)
```

**æ–°æ¶æ§‹**ï¼ˆçµ„ä»¶åŒ– + ç¨ç«‹æ¨¡çµ„ï¼‰ï¼š
```
src/pages/Community/
â”œâ”€â”€ Wall.tsx (~120è¡Œ)           # ä¸»å®¹å™¨ï¼Œåªè² è²¬çµ„åˆ
â”œâ”€â”€ types.ts                     # å…±ç”¨å‹åˆ¥ + Permission Helper
â”œâ”€â”€ mockData.ts                  # Mock è³‡æ–™ç¨ç«‹ç®¡ç†
â””â”€â”€ components/
    â”œâ”€â”€ index.ts                 # çµ±ä¸€åŒ¯å‡º
    â”œâ”€â”€ Topbar.tsx              # é ‚éƒ¨å°èˆª
    â”œâ”€â”€ ReviewsSection.tsx      # è©•åƒ¹å€
    â”œâ”€â”€ PostsSection.tsx        # è²¼æ–‡å€
    â”œâ”€â”€ QASection.tsx           # å•ç­”å€
    â”œâ”€â”€ Sidebar.tsx             # å´é‚Šæ¬„
    â”œâ”€â”€ RoleSwitcher.tsx        # èº«ä»½åˆ‡æ›å™¨
    â”œâ”€â”€ MockToggle.tsx          # Mock åˆ‡æ›
    â””â”€â”€ BottomCTA.tsx           # åº•éƒ¨ CTA
```

### React Query Hook

æ–°å¢ `src/hooks/useCommunityWallQuery.ts`ï¼š
- ä½¿ç”¨ `@tanstack/react-query` å¯¦ç¾ SWR ç­–ç•¥
- staleTime é è¨­ 5 åˆ†é˜
- æ”¯æ´ refetchOnWindowFocus
- æ¨‚è§€æ›´æ–° + å¤±æ•—å›æ»¾æ©Ÿåˆ¶

```typescript
const { data, isLoading, toggleLike, createPost } = useCommunityWall(communityId, {
  includePrivate: true,
  staleTime: 5 * 60 * 1000,
  refetchOnWindowFocus: true,
});
```

### ç„¡éšœç¤™ (a11y) æ”¹é€²

| å…ƒç´  | æ”¹é€² |
|------|------|
| æŒ‰éˆ• | åŠ å…¥ `aria-label` èªªæ˜åŠŸèƒ½ |
| æ¨¡ç³Šå€å¡Š | åŠ å…¥ `aria-hidden="true"` |
| Tab åˆ‡æ› | åŠ å…¥ `role="tablist"` / `role="tab"` |
| å€å¡Šæ¨™é¡Œ | åŠ å…¥ `aria-labelledby` |
| èº«ä»½é¸å–® | åŠ å…¥ `role="listbox"` / `role="option"` |
| è£é£¾å…ƒç´  | åŠ å…¥ `aria-hidden="true"` |

### å‹åˆ¥çµ±ä¸€

å¾ `types.ts` çµ±ä¸€åŒ¯å…¥ï¼š
```typescript
import type { Role, WallTab, Post, Review, Question, Permissions } from './types';
import { getPermissions, GUEST_VISIBLE_COUNT } from './types';
```

---

## âš›ï¸ React ç‰ˆç¤¾å€ç‰† (2025/12/02)

### è·¯ç”±
```
/community/:id/wall
```
å¯¦éš›ç¶²å€ï¼š`https://maihouses.vercel.app/maihouses/community/{uuid}/wall`

### çµ„ä»¶çµæ§‹
```
Wall.tsx (748è¡Œ)
â”œâ”€â”€ Topbar          - é ‚éƒ¨å°èˆªï¼ˆå›é¦–é ã€é€šçŸ¥ã€æˆ‘çš„ï¼‰
â”œâ”€â”€ ReviewsSection  - è©•åƒ¹å€ï¼ˆblur é®ç½©ï¼‰
â”œâ”€â”€ PostsSection    - è²¼æ–‡å€ï¼ˆå…¬é–‹ç‰†/ç§å¯†ç‰† Tabï¼‰
â”œâ”€â”€ QASection       - å•ç­”å€ï¼ˆæœ‰å›ç­”/ç„¡å›ç­”åˆ†é–‹ï¼‰
â”œâ”€â”€ Sidebar         - å´é‚Šæ¬„ï¼ˆç¤¾å€è³‡è¨Šã€æ•¸æ“šã€å…¬ä»”ï¼‰
â”œâ”€â”€ BottomCTA       - åº•éƒ¨ CTAï¼ˆè¨ªå®¢/æœƒå“¡é¡¯ç¤ºï¼‰
â”œâ”€â”€ MockToggle      - Mock åˆ‡æ›æŒ‰éˆ•ï¼ˆå·¦ä¸‹è§’ï¼‰
â””â”€â”€ RoleSwitcher    - èº«ä»½åˆ‡æ›å™¨ï¼ˆå³ä¸‹è§’ï¼‰
```

### Mock åˆ‡æ›
- **å·¦ä¸‹è§’æŒ‰éˆ•**ï¼š`ğŸ§ª Mock è³‡æ–™` â†” `ğŸŒ API è³‡æ–™`
- Mock æ¨¡å¼ï¼šä½¿ç”¨å…§å»ºå‡è³‡æ–™ï¼ˆæƒ å®‡ä¸Šæ™´ï¼‰
- API æ¨¡å¼ï¼šå‘¼å« `/api/community/wall?communityId=xxx`

### èº«ä»½åˆ‡æ›å™¨
- **å³ä¸‹è§’æŒ‰éˆ•**ï¼š`ğŸ•¶ï¸ è¨ªå®¢æ¨¡å¼`
- å¯åˆ‡æ›ï¼šè¨ªå®¢ / æœƒå“¡ / ä½æˆ¶ / æˆ¿ä»²
- åˆ‡æ›å¾Œç«‹å³æ›´æ–°æ‰€æœ‰å€å¡Šçš„æ¬Šé™ç‹€æ…‹

### CSS è®Šæ•¸
React ç‰ˆéœ€è¦ä»¥ä¸‹ CSS è®Šæ•¸ï¼ˆå·²åŠ å…¥ `src/index.css`ï¼‰ï¼š
```css
--primary: #00385a;
--primary-dark: #002a44;
--primary-light: #005282;
--border: #E6EDF7;
--line: #e6edf7;
--bg-base: #f6f9ff;
--bg-alt: #eef3ff;
```

### Commits
| Hash | èªªæ˜ |
|------|------|
| `e474faa` | feat(ç¤¾å€ç‰†): React ç‰ˆå®Œæˆ - MVP HTML è½‰æ› |
| `b788dd7` | fix: é¦–é é€£çµä¿®æ­£ç‚º /maihouses/ |
| `cef78e7` | fix: Mock æŒ‰éˆ•æ”¹ç‚ºæ·±è—é»‘è‰²ï¼ˆèˆ‡ MVP ä¸€è‡´ï¼‰ |
| `e2c023e` | fix: åŠ å…¥ç¼ºå°‘çš„ CSS è®Šæ•¸ |

---

## ğŸ—„ï¸ SQL (å¾…åŸ·è¡Œ)

```sql
-- åœ¨ Supabase Dashboard åŸ·è¡Œå®Œæ•´æª”æ¡ˆï¼š
-- supabase/migrations/20241201_community_wall.sql

-- æˆ–å–®ç¨åŸ·è¡Œæ–°å¢çš„éƒ¨åˆ†ï¼š

-- 1. liked_by æ¬„ä½
ALTER TABLE community_posts ADD COLUMN IF NOT EXISTS liked_by UUID[] DEFAULT '{}';

-- 2. toggle_like å‡½æ•¸
CREATE OR REPLACE FUNCTION toggle_like(post_id UUID)
RETURNS JSON AS $$
DECLARE
  current_liked_by UUID[];
  new_liked_by UUID[];
  is_liked BOOLEAN;
BEGIN
  SELECT liked_by INTO current_liked_by FROM community_posts WHERE id = post_id;
  is_liked := auth.uid() = ANY(current_liked_by);
  IF is_liked THEN
    new_liked_by := array_remove(current_liked_by, auth.uid());
  ELSE
    new_liked_by := array_append(current_liked_by, auth.uid());
  END IF;
  UPDATE community_posts 
  SET liked_by = new_liked_by, likes_count = cardinality(new_liked_by)
  WHERE id = post_id;
  RETURN json_build_object('liked', NOT is_liked, 'likes_count', cardinality(new_liked_by));
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;

-- 3. community_reviews View
DROP TABLE IF EXISTS community_reviews CASCADE;
DROP VIEW IF EXISTS community_reviews CASCADE;
CREATE VIEW community_reviews AS
SELECT 
  p.id, p.community_id, p.agent_id AS author_id, p.created_at,
  jsonb_build_object(
    'pros', ARRAY[p.advantage_1, p.advantage_2],
    'cons', p.disadvantage,
    'property_title', p.title
  ) AS content
FROM properties p
WHERE p.community_id IS NOT NULL
  AND (p.advantage_1 IS NOT NULL OR p.advantage_2 IS NOT NULL OR p.disadvantage IS NOT NULL);
```

---

## ğŸ”§ ä¿®æ­£ç´€éŒ„

| æ™‚é–“ | å•é¡Œ | ä¿®æ­£ |
|------|------|------|
| 12/01 | å»ºéŒ¯æª” `community-wall-v2.html` | åˆªé™¤ï¼Œæ”¹ç”¨ `community-wall_mvp.html` |
| 12/01 | Mockåˆ‡æ›æ²’æ•ˆæœ | æ”¹ç‚º `renderAll()` å®Œæ•´é‡ç¹ª |
| 12/01 | `community_reviews` è¡¨ä¸å­˜åœ¨ | å»ºç«‹ View å°æ¥ properties |
| 12/01 | æˆ¿ä»²èº«ä»½å¯«æ­» | æ”¹æŸ¥ `agents` è¡¨ |
| 12/01 | è¨ªå®¢å¯çœ‹ç§å¯†ç‰† | åŠ å…¥æ¬Šé™æª¢æŸ¥ `canAccessPrivate` |
| 12/01 | Viewå»ºç«‹å¤±æ•—(å·²å­˜åœ¨Table) | å…ˆ DROP TABLE å†å»º View |
| 12/01 | è©•åƒ¹è¨ˆæ•¸éŒ¯èª¤(2å¼µå¡=6å‰‡) | æ”¹ç‚ºæ¯å€‹âœ…/âš–ï¸=1å‰‡ |
| 12/01 | bluråˆ‡æ›èº«ä»½å¾Œå£æ‰ | æ”¹ç”¨ body.role-xxx class |
| 12/01 | API getPostsç¼ºcount | åŠ ä¸Š { count: 'exact' } |
| 12/01 | QAå€bluræ²’æ§åˆ¶åˆ° | æ”¹ç”¨ blur-overlay + blur-target |
| 12/01 | likesåŠŸèƒ½ç¼ºå¤± | æ–°å¢ liked_by[] + API |
| 12/01 | éŒ¯åˆ¥å­—ï¼ˆæˆ¿ä»¿â†’æˆ¿ä»²ï¼‰ | å…¨ç«™çµ±ä¸€ç”¨è© |
| 12/01 | ç„¡è¼‰å…¥å‹•ç•« | æ–°å¢ skeleton loading CSS |
| 12/01 | API ç„¡å¿«å– | åŠ å…¥ Cache-Control header |
| 12/01 | SonarLint: feed-consumer.html | å¤šé …ä¿®æ­£ï¼ˆè¦‹ä¸‹æ–¹ï¼‰ |
| 12/02 | å…¬ä»” SVG é¡¯ç¤ºå•é¡Œ | æ”¹ç”¨ inline style + ç§»åˆ°å´é‚Šæ¬„ï¼ˆå·²è§£æ±ºï¼‰ |
| 12/02 | å´é‚Šæ¬„åŠ å…¥å…¬ä»”å¡ç‰‡ | ã€Œæœ‰å•é¡Œï¼Ÿå•å•é„°å±…ï¼ã€å°å¼•è‡³å•ç­”å€ |

---

## ğŸ  å…¬ä»”å¡ç‰‡ (12/02 å·²å®Œæˆ)

### æœ€çµ‚æ–¹æ¡ˆ
å°‡å…¬ä»”å¾ blur-cta ç§»é™¤ï¼Œæ”¹æ”¾åœ¨**å´é‚Šæ¬„æœ€ä¸‹æ–¹**ç¨ç«‹å¡ç‰‡ï¼š

```html
<!-- å´é‚Šæ¬„å…¬ä»”å¡ç‰‡ -->
<div class="sidebar-card" style="text-align:center;background:linear-gradient(135deg,#f0f7ff,#e8f4ff)">
  <svg style="width:80px;height:96px;color:#00385a" viewBox="0 0 200 240">
    <!-- æˆ¿å±‹å…¬ä»” SVG -->
  </svg>
  <p>æœ‰å•é¡Œï¼Ÿå•å•é„°å±…ï¼</p>
  <a href="#qa-section">å‰å¾€å•ç­”å€ â†’</a>
</div>
```

### æ•ˆæœ
- âœ… æ¡Œé¢ç‰ˆï¼šå´é‚Šæ¬„åº•éƒ¨é¡¯ç¤ºå…¬ä»”æ®æ‰‹ + å°å¼•æŒ‰éˆ•
- âœ… æ‰‹æ©Ÿç‰ˆï¼šå´é‚Šæ¬„éš±è—ï¼Œå…¬ä»”ä¹Ÿéš±è—ï¼ˆä¸ä½”ç©ºé–“ï¼‰
- âœ… æ®æ‰‹å‹•ç•«ï¼šå‡ç´šç‚º 5 æ®µè®ŠåŒ–ï¼Œæ›´ç”Ÿå‹•

### CSS å‹•ç•«
```css
@keyframes wave-hand {
  0%, 100% { transform: rotate(0deg); }
  20% { transform: rotate(-25deg); }
  40% { transform: rotate(10deg); }
  60% { transform: rotate(-20deg); }
  80% { transform: rotate(5deg); }
}
.mascot-hand {
  transform-origin: 85% 60%;
  animation: wave-hand 2.5s ease-in-out infinite;
}
```

---

## ğŸ” feed-consumer.html SonarLint ä¿®æ­£ (12/01)

| è­¦å‘Š | è¡Œè™Ÿ | ä¿®æ­£æ–¹å¼ |
|------|------|----------|
| `maximum-scale=1` é™åˆ¶ç¸®æ”¾ | L5 | ç§»é™¤ maximum-scale é™åˆ¶ |
| æ–‡å­—å°æ¯”åº¦ä¸è¶³ | L85 | `--muted` å¾ #6c7b91 æ”¹ç‚º #526070 |
| onclick ç„¡éµç›¤æ”¯æ´ | L218,289,417,418 | æ·»åŠ  `onkeydown` + `tabindex`/`role` |
| forEach ä¸å¦‚ for...of | L428,436,534 | æ”¹ç‚º for...of èªæ³• |
| èªçŸ¥è¤‡é›œåº¦éé«˜ | L480 | æ‹†åˆ† handler ç‚ºç¨ç«‹å‡½æ•¸ |
| å¦å®šæ¢ä»¶ if(!isPressed) | L488 | æ”¹ç‚ºæ­£å‘åˆ¤æ–· if(isPressed)...else |

---

## ğŸ§ª æ¸¬è©¦ç¶²å€

```
https://maihouses.vercel.app/maihouses/community-wall_mvp.html
```

å³ä¸‹è§’ ğŸ•¶ï¸ åˆ‡æ›èº«ä»½æ¸¬è©¦

---

## ğŸ“Œ å¾…è™•ç†

### ğŸ¯ é«”é©—èˆ‡æ˜“ç”¨æ€§
- [x] **å•ç­”å€æœƒå“¡è½‰æ›æ¼æ–—**ï¼šé®ç½©åŠ å…¥ã€ŒåŠ å…¥æœƒå“¡å¾Œå¯æ”¶åˆ°æ–°å›ç­”é€šçŸ¥ã€ç­‰åˆ©ç›Šé»ï¼ŒA/B æ¸¬è©¦ CTA æ–‡æ¡ˆèˆ‡è‰²å½©ï¼ˆå“ç‰Œè—ç³»ï¼‰
- [x] **ç„¡å›ç­”å•é¡Œèª˜å› **ï¼šåˆ—è¡¨é ‚éƒ¨åŠ ã€Œå¾…å›ç­”æ•¸é‡ã€æ‘˜è¦ ~~ã€Œæ¶å…ˆå›ç­”ã€å¢åŠ å¾½ç« /ç©åˆ†å›é¥‹~~ (å¾½ç« ç³»çµ±æš«ç·©)
- [x] **é›™æ¬„å¸ƒå±€è³‡è¨Šå¯†åº¦**ï¼šå´æ¬„åŠ å…¥ã€Œæœ€æ–°å•ç­”æ‘˜è¦ã€èˆ‡ã€Œç†±é–€è²¼æ–‡ã€å¡ç‰‡
- [x] **å…¬ä»”å“ç‰Œè­˜åˆ¥**ï¼šå´é‚Šæ¬„åº•éƒ¨åŠ å…¥å…¬ä»”å¡ç‰‡ï¼Œå°å¼•è‡³å•ç­”å€
- [ ] **å“ç‰Œä¸€è‡´æ€§**ï¼šToastã€æŒ‰éˆ•ã€éª¨æ¶å±èƒŒæ™¯å…¨é¢å¥—ç”¨åŒä¸€çµ„ token

### ğŸ› ï¸ å‰ç«¯å·¥ç¨‹
- [ ] **è³‡æ–™å¿«å–ç­–ç•¥**ï¼šæ”¹ç‚º stale-while-revalidateï¼ŒHook ä¸­é¡¯ç¤ºã€Œæ›´æ–°ä¸­ã€ç‹€æ…‹
- [ ] **æ¨‚è§€æ›´æ–°å›æ»¾**ï¼šæŒ‰è®š/ç™¼æ–‡/å›ç­”å¤±æ•—æ™‚æ¢å¾©åŸç‹€ã€é¡¯ç¤ºéŒ¯èª¤ Toastã€è¨˜éŒ„éŒ¯èª¤ç¢¼
- [ ] **å…§å®¹å¯©æ ¸ UX**ï¼šé¡¯ç¤ºã€Œè¢«è§¸ç™¼çš„è©å½™ã€ï¼Œæä¾›ã€Œç”³è¨´/æª¢èˆ‰ã€å…¥å£
- [ ] **åœ–ç‰‡ä¸Šå‚³ä½µç™¼èª¿å„ª**ï¼šä¾ç¶²é€Ÿè‡ªé©æ‡‰ï¼ˆè¨ˆç®— RTTï¼‰ï¼ŒåŠ å…¥æŒ‡æ•¸é€€é¿é‡è©¦ç­–ç•¥
- [ ] **CommunityPicker å„ªåŒ–**ï¼šåŠ  250-300ms é˜²æŠ–ã€ARIA ç‹€æ…‹ã€ç„¡çµæœæ™‚æä¾›ã€Œæ–°å¢ç¤¾å€ã€å‹•ç·š

### ğŸ” å¾Œç«¯èˆ‡è³‡æ–™å®‰å…¨
- [ ] **RLS æ”¹é€²**ï¼šåƒ…åŒç¤¾å€æˆå“¡å¯è®€ç§å¯†ç‰†
- [ ] **ç§»é™¤ agentId é è¨­å€¼**ï¼šç”± API ä»¥ session é©—è­‰è£œå…¨ï¼Œé¿å…å½é€ èº«ä»½
- [ ] **ç§å¯†ç‰†é©—è­‰æµç¨‹**ï¼šå»ºç«‹ã€Œé©—è­‰è«‹æ±‚ â†’ ä½æˆ¶å¯©æ ¸ â†’ ç³»çµ±æˆæ¬Šã€å¯©æ‰¹è¡¨ + community_members è¡¨
- [ ] **toggle_like å¼·åŒ–**ï¼šåŠ å…¥ FOR UPDATE é–å®šé˜²ç«¶æ…‹ï¼Œè¿”å›å€¼é™„å¸¶ updated_at
- [ ] **æ—¥èªŒèˆ‡ç¨½æ ¸**ï¼šç§å¯†ç‰†è®€å–/å•ç­”å¯«å…¥åŠ å¯©è¨ˆæ¬„ä½ï¼ˆIPã€UA hashã€actor roleï¼‰ï¼Œå»ºç«‹ç•°å¸¸å‘Šè­¦

### ğŸ“‹ ç¶­é‹èˆ‡é–‹ç™¼æµç¨‹
- [ ] **Dev Log ä½œæ¥­è¦ç¯„**ï¼šå»ºç«‹ lint/husky æª¢æŸ¥ï¼ˆç›¸é—œæª”æ¡ˆæ”¹å‹•æ™‚å¿…é ˆæ›´æ–° logï¼‰
- [ ] **æ¬Šé™çŸ©é™£è¿½è¹¤**ï¼šåŠ å…¥ç‰ˆæœ¬è™Ÿèˆ‡æ¸¬è©¦ç”¨ä¾‹é€£çµï¼ŒCI ä¸­åŠ å…¥è§’è‰²åˆ‡æ› E2E é©—è­‰
- [ ] **æ€§èƒ½ç›£æ¸¬**ï¼šWeb Vitalsã€TTI/TTFB ç›£æ¸¬ï¼Œå¿«å–å‘½ä¸­ç‡ä½æ™‚è‡ªå‹•é™é »æˆ–åŠ é•· TTL

### ğŸ—„ï¸ åŸæœ‰å¾…è™•ç†
- [ ] å‰ç«¯æ¥çœŸå¯¦ APIï¼ˆç›®å‰æ˜¯ Mock è³‡æ–™ï¼‰
- [ ] çµ±ä¸€ç¤¾å€ç‰†è·¯ç”±ï¼ˆæˆåŠŸé â†’/community/{id}ï¼Œè©³æƒ…é â†’/maihouses/...ï¼‰
- [ ] åœ°å€æŒ‡ç´‹è¨ˆç®—ç§»åˆ°å¾Œç«¯ APIï¼ˆé˜²æ­¢å®¢ç«¯æ“æ§ï¼‰

---

## ğŸš€ 2025/12/02 å‰å¾Œç«¯å„ªåŒ–

### 1. è¡¨å–®é©—è­‰ Hook (`usePropertyFormValidation`)
- æŠ½å–é©—è­‰é‚è¼¯ç‚ºç¨ç«‹ Hookï¼Œä¾¿æ–¼å–®å…ƒæ¸¬è©¦èˆ‡é‡ç”¨
- å³æ™‚é¡¯ç¤ºå­—æ•¸è¨ˆç®—èˆ‡éŒ¯èª¤è¨Šæ¯ï¼ˆå–ä»£ alertï¼‰
- é©—è­‰è¦å‰‡ï¼š
  - å„ªé»ï¼šè‡³å°‘ 5 å­—
  - å…¬é“è©±ï¼šè‡³å°‘ 10 å­—
  - åœ–ç‰‡ï¼šè‡³å°‘ 1 å¼µï¼Œæœ€å¤§ 10MBï¼Œåƒ… JPG/PNG/WebP
- **æ•æ„Ÿè©æª¢æ¸¬æ•´åˆ**ï¼š
  - æ•´åˆ `contentCheck.ts` å…§å®¹å¯©æ ¸
  - å³æ™‚é¡¯ç¤ºå…§å®¹è­¦å‘Šï¼ˆé»ƒè‰²ï¼šéœ€æ³¨æ„ï¼›ç´…è‰²ï¼šç¦æ­¢é€å‡ºï¼‰
  - æ•æ„Ÿè©æœƒé˜»æ“‹é€å‡ºï¼ˆ`canSubmit = false`ï¼‰
  - å»£å‘Šè©åƒ…è­¦å‘Šä¸é˜»æ“‹

### 2. Toast é€šçŸ¥çµ„ä»¶
- æ›¿ä»£æ‰€æœ‰ `alert()` å‘¼å«
- æ”¯æ´ 4 ç¨®é¡å‹ï¼šsuccess / error / warning / info
- éŒ¯èª¤è¨Šæ¯åŠ å…¥ã€Œé‡è©¦ã€èˆ‡ã€Œè¯çµ¡å®¢æœã€æŒ‰éˆ•
- è‡ªå‹•æ¶ˆå¤±ï¼ˆsuccess 3 ç§’ï¼Œerror ä¸æ¶ˆå¤±éœ€æ‰‹å‹•é—œé–‰ï¼‰

### 3. åœ–ç‰‡ä¸Šå‚³å„ªåŒ– (`propertyService.uploadImages`)
- å‰ç«¯é©—è­‰ï¼šæª”æ¡ˆé¡å‹ (MIME whitelist) + å¤§å°é™åˆ¶ (10MB)
- ä¸¦ç™¼æ§åˆ¶ï¼šé è¨­ 3 å¼µåŒæ™‚ä¸Šå‚³ï¼ˆå¯èª¿æ•´ï¼‰
- é€²åº¦å›å ±ï¼š`onProgress` callback
- è©³ç´°éŒ¯èª¤ï¼šå›å‚³å¤±æ•—æª”æ¡ˆåˆ—è¡¨ï¼Œå‘ŠçŸ¥ä½¿ç”¨è€…å“ªäº›æœªä¸Šå‚³

### 4. CommunityPicker å„ªåŒ–
- æ–°å¢æœå°‹å¤±æ•—æç¤ºï¼ˆåœ–ç¤º + æ–‡å­—å¼•å°ï¼‰
- Loading skeleton å‹•ç•«
- ã€Œç„¡ç¤¾å€ã€é¸é …æ›´æ¸…æ¥šï¼ˆé€å¤©/åº—é¢ç”¨ï¼‰
- **AbortController é˜²æ­¢ Race Condition**ï¼š
  - å¿«é€Ÿè¼¸å…¥æ™‚å–æ¶ˆå‰æ¬¡è«‹æ±‚
  - é¿å…èˆŠçµæœè¦†è“‹æ–°çµæœ

### 5. å…§å®¹å¯©æ ¸å·¥å…· (`contentCheck.ts`)
- å‰ç«¯åˆæ­¥éæ¿¾æ•æ„Ÿå…§å®¹ï¼Œå¾Œç«¯ä»éœ€è¤‡å¯©
- æ•æ„Ÿè©åˆ—è¡¨ï¼šè¾±ç½µé¡ã€è©é¨™é¡ã€ä¸ç•¶å…§å®¹
- å»£å‘Šè©åˆ—è¡¨ï¼šåŠ LINEã€é™æ™‚å„ªæƒ ã€æŠ˜æ‰£ç¢¼ç­‰
- ç¤¾å€åç¨±é»‘åå–®ï¼šé€å¤©ã€åº—é¢ã€æ€¥å”®ç­‰éæ­£å¼åç¨±
- æ ¼å¼æª¢æŸ¥ï¼šç´”åœ°å€ã€ç´”æ•¸å­—ç­‰

### 6. PropertyUploadPage æ•´åˆ
- ä½¿ç”¨é©—è­‰ Hook + Toast æ›¿ä»£ alert
- æ•æ„Ÿè©è­¦å‘Šå€å¡Šï¼ˆç´…è‰²/é»ƒè‰²å€å¡Šï¼‰
- å„æ¬„ä½ç¨ç«‹é¡¯ç¤ºå…§å®¹è­¦å‘Š

### 7. Community Wall API å°è£ (`communityService.ts`)
- çµ±ä¸€æ‰€æœ‰ç¤¾å€ç‰† API è«‹æ±‚
- å…§å»ºè¨˜æ†¶é«”å¿«å–ï¼ˆposts 5åˆ†é˜ã€reviews 10åˆ†é˜ï¼‰
- Auth token è‡ªå‹•é™„åŠ 
- éŒ¯èª¤è™•ç†æ¨™æº–åŒ–
- æ”¯æ´åŠŸèƒ½ï¼š
  - `getCommunityWall()` - å–å¾—å®Œæ•´è³‡æ–™
  - `getPublicPosts()` / `getPrivatePosts()` - åˆ†é å–å¾—è²¼æ–‡
  - `createPost()` - ç™¼å¸ƒè²¼æ–‡
  - `toggleLike()` - æŒ‰è®š
  - `askQuestion()` / `answerQuestion()` - å•ç­”

### 8. Community Wall Hook (`useCommunityWall.ts`)
- SWR é¢¨æ ¼çš„è³‡æ–™ç²å–
- æ¨‚è§€æ›´æ–°ï¼ˆæŒ‰è®šå³æ™‚åæ˜ ï¼‰
- è‡ªå‹•åˆ·æ–°ï¼ˆå¯è¨­å®šé–“éš”ï¼‰
- è¦–çª—èšç„¦æ™‚åˆ·æ–°
- åˆ†é è¼‰å…¥ Hook (`useCommunityPosts`)

### 9. å®‰å…¨æ€§æ”¹é€²
- å¾…è™•ç†ï¼šagentId é è¨­å€¼ç§»é™¤ï¼Œæ”¹ç”±å¾Œç«¯åˆ¤æ–·ç™»å…¥æ…‹

---

## 2025/12/02 - Layout é‡æ§‹ + é…è‰²ä¿®æ­£

### ğŸ¨ é…è‰²ä¿®æ­£ï¼ˆé‡è¦ï¼‰

**å•é¡Œ**ï¼šä¹‹å‰ç”¨äº†ä¸å±¬æ–¼å“ç‰Œçš„é¡è‰²ï¼ˆæ·ºç¶ ã€æ©˜è‰²ç­‰ï¼‰

**å·²ç§»é™¤**ï¼š
- `--secondary: #34c759` (ç¶ )
- `#e8faef` / `#0e8d52` (æ·ºç¶ /æ·±ç¶ )
- `#fff3e0` / `#e65100` (æ©˜)
- `#fce4ec` / `#c2185b` (ç²‰ç´…)

**çµ±ä¸€é…è‰²ï¼ˆèˆ‡ tailwind.config.cjs ä¸€è‡´ï¼‰**ï¼š
```css
--brand: #00385a;        /* æ·±è—ä¸»è‰² */
--brand-light: #009FE8;  /* äº®è— */
--brand-600: #004E7C;
--success: #0f6a23;      /* åªç”¨æ–¼æˆåŠŸç‹€æ…‹ */
--bg-base: #f6f9ff;
--bg-alt: #eef3ff;
--border: #E6EDF7;
--text-primary: #0a2246;
```

### ğŸ—ï¸ Header é‡æ§‹
- å·¦ï¼š`â† è¿”å›` æŒ‰éˆ•
- ä¸­ï¼šç¤¾å€åç¨± + ã€Œç¤¾å€ç‰†ã€å‰¯æ¨™é¡Œ
- å³ï¼šğŸ””é€šçŸ¥ + ğŸ‘¤æˆ‘çš„ ä¸‹æ‹‰é¸å–®
- èˆ‡ Feed é é¢é¢¨æ ¼ä¸€è‡´

### ğŸ–¥ï¸ æ¡Œæ©Ÿç‰ˆé›™æ¬„ Layout
- ä¸»å…§å®¹ `max-width: 600px`
- å´é‚Šæ¬„ `width: 280px`ï¼ˆ860px+ é¡¯ç¤ºï¼‰
- å´é‚Šæ¬„å¡ç‰‡ï¼š
  - ğŸ“ ç¤¾å€è³‡è¨Š
  - ğŸ“Š ç¤¾å€æ•¸æ“š
  - ğŸ”— å¿«é€Ÿé€£çµ

### Badge é¡è‰²
- å…¨éƒ¨æ”¹è—è‰²èª¿ï¼š`#e6edf7`ã€`#e0f4ff`ã€`#f6f9ff`
- æ–‡å­—ï¼š`#00385a`ã€`#004E7C`

---

## ğŸ“ ä¸‹æ¬¡æ›´æ–°æ™‚

**æ¯æ¬¡æ”¹å‹•ç¤¾å€ç‰†ç›¸é—œä»£ç¢¼ï¼Œæ›´æ–°é€™å€‹æª”æ¡ˆï¼**

---

## 2025/12/02 æ™šé–“ - Header å°èˆª + å•ç­”å€é‚è¼¯ä¿®æ­£

### ğŸ§­ Header å°èˆªæ›´æ–°

**å·¦å´æŒ‰éˆ•**ï¼š
- åŸï¼š`â† è¿”å›`
- æ”¹ï¼š`â† æˆ‘çš„å‹•æ…‹` â†’ é€£çµåˆ° `/maihouses/feed.html`

**ä¸‹æ‹‰é¸å–®é …ç›®**ï¼š
- åŸï¼š`å›åˆ°å‹•æ…‹`
- æ”¹ï¼š`å›åˆ°é¦–é ` â†’ é€£çµåˆ° `/maihouses/`

### â“ å•ç­”å€ï¼ˆæº–ä½æˆ¶å•ç­”ï¼‰é‡å¤§ä¿®æ­£

**å•é¡Œ**ï¼š
1. åŸæœ¬ blur é‚è¼¯æ˜¯åœ¨ã€Œå›ç­”å±¤ç´šã€(æ¯å‰‡å›ç­”åˆ†é–‹ blur)
2. ç”¨æˆ¶è¦æ±‚æ”¹æˆã€Œå•é¡Œå±¤ç´šã€blurï¼ˆå‰ 2 é¡Œå¯è¦‹ï¼Œå…¶é¤˜æ•´é¡Œ blurï¼‰
3. ç„¡å›ç­”çš„å•é¡Œéœ€è¦å–®ç¨é¡¯ç¤ºï¼Œé¼“å‹µç”¨æˆ¶å›ç­”

**ä¿®æ­£å¾Œé‚è¼¯**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æœ‰å›ç­”çš„å•é¡Œï¼ˆå‰ 2 é¡Œå¯è¦‹ï¼‰          â”‚
â”‚  â”œâ”€â”€ ç¬¬ 1 é¡Œï¼šå¯è¦‹                   â”‚
â”‚  â”œâ”€â”€ ç¬¬ 2 é¡Œï¼šå¯è¦‹                   â”‚
â”‚  â””â”€â”€ ç¬¬ 3+ é¡Œï¼šblur + é®ç½©           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  blur é®ç½©ï¼ˆè¨ªå®¢å°ˆç”¨ï¼‰               â”‚
â”‚  ã€Œæˆç‚ºæœƒå“¡çœ‹æ›´å¤šå•ç­”ã€CTA            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç„¡å›ç­”çš„å•é¡Œï¼ˆä¸ blurï¼Œé¼“å‹µå›ç­”ï¼‰    â”‚
â”‚  â”œâ”€â”€ ç‰¹æ®Šæ¨£å¼ï¼šè™›ç·šé‚Šæ¡†              â”‚
â”‚  â”œâ”€â”€ èƒŒæ™¯ï¼šæ·ºè— #f6f9ff              â”‚
â”‚  â””â”€â”€ CTAï¼šã€Œæ¶å…ˆå›ç­”ã€æŒ‰éˆ•           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**MOCK è³‡æ–™æ›´æ–°**ï¼š
- 4 é¡Œå•ç­”ï¼ˆåŸ 3 é¡Œï¼‰
- ç¬¬ 1 é¡Œï¼š2 å‰‡å›ç­”
- ç¬¬ 2 é¡Œï¼š1 å‰‡å›ç­”  
- ç¬¬ 3 é¡Œï¼š2 å‰‡å›ç­”
- ç¬¬ 4 é¡Œï¼š0 å‰‡å›ç­”ï¼ˆæ–°å¢ï¼Œæ¸¬è©¦ç„¡å›ç­”é‚è¼¯ï¼‰

**`renderQuestions()` å‡½æ•¸é‡å¯«**ï¼š
- åˆ†é›¢ã€Œæœ‰å›ç­”ã€å’Œã€Œç„¡å›ç­”ã€çš„å•é¡Œ
- æœ‰å›ç­”å•é¡Œå¥—ç”¨ `GUEST_VISIBLE_COUNT = 2` çš„ blur é‚è¼¯
- ç„¡å›ç­”å•é¡Œç¨ç«‹å€å¡Šæ¸²æŸ“ï¼Œæ°¸ä¸ blur
- ç„¡å›ç­”å•é¡ŒåŠ å…¥ç‰¹æ®Šæ¨£å¼æ¨™è­˜

### ğŸ”§ ä¿®æ­£ç´€éŒ„ï¼ˆæœ¬æ¬¡æ–°å¢ï¼‰

| æ™‚é–“ | å•é¡Œ | ä¿®æ­£ |
|------|------|------|
| 12/02 | Header å·¦éµã€Œè¿”å›ã€ä¸æ˜ç¢º | æ”¹ç‚ºã€Œæˆ‘çš„å‹•æ…‹ã€é€£çµåˆ° feed |
| 12/02 | ä¸‹æ‹‰é¸å–®ã€Œå›åˆ°å‹•æ…‹ã€èªæ„é‡è¤‡ | æ”¹ç‚ºã€Œå›åˆ°é¦–é ã€é€£çµåˆ° /maihouses/ |
| 12/02 | å•ç­” blur åœ¨å›ç­”å±¤ç´š | æ”¹ç‚ºå•é¡Œå±¤ç´š blur |
| 12/02 | ç„¡å›ç­”å•é¡Œä¹Ÿè¢« blur | åˆ†é›¢é‚è¼¯ï¼Œç„¡å›ç­”å•é¡Œæ°¸ä¸ blur |
| 12/02 | ç„¡å›ç­”å•é¡Œç„¡ CTA | æ–°å¢ã€Œæ¶å…ˆå›ç­”ã€æŒ‰éˆ• |

### ğŸ“¦ Commit ç´€éŒ„

```
8aeface - fix(ç¤¾å€ç‰†): å•ç­”å€é‚è¼¯èª¿æ•´ - æœ‰å›ç­”å•é¡Œblurã€ç„¡å›ç­”å•é¡Œå–®ç¨é¡¯ç¤º
```
