const __vite__mapDeps = (
  i,
  m = __vite__mapDeps,
  d = m.f ||
    (m.f = [
      'assets/index-C1xELjDC.js',
      'assets/react-vendor-XkWQQLQ_.js',
      'assets/ui-libs-Cwk2ks74.js',
      'assets/supabase-Cx8Dzgcb.js',
    ])
) => i.map((i) => d[i]);
var fi = (e) => {
  throw TypeError(e);
};
var Mn = (e, t, r) => t.has(e) || fi('Cannot ' + r);
var v = (e, t, r) => (Mn(e, t, 'read from private field'), r ? r.call(e) : t.get(e)),
  te = (e, t, r) =>
    t.has(e)
      ? fi('Cannot add the same private member more than once')
      : t instanceof WeakSet
        ? t.add(e)
        : t.set(e, r),
  Z = (e, t, r, n) => (Mn(e, t, 'write to private field'), n ? n.call(e, r) : t.set(e, r), r),
  ce = (e, t, r) => (Mn(e, t, 'access private method'), r);
var Dr = (e, t, r, n) => ({
  set _(a) {
    Z(e, t, a, r);
  },
  get _() {
    return v(e, t, n);
  },
});
import {
  r as h,
  a as Rd,
  R as F,
  b as Md,
  u as yn,
  L as We,
  c as Er,
  d as Tr,
  e as gl,
  f as Pd,
  h as ot,
  B as zd,
} from './react-vendor-XkWQQLQ_.js';
import {
  L as pi,
  a as xi,
  U as gi,
  X as is,
  M as Dd,
  S as tn,
  P as ns,
  b as Fd,
  H as bl,
  c as $d,
  d as Ud,
  K as Bd,
  C as Gd,
  e as Hd,
  A as yl,
  f as vl,
  E as vn,
  g as jn,
  B as mr,
  D as wn,
  h as Wd,
  i as tr,
  j as $t,
  k as Nn,
  l as La,
  m as Vd,
  n as Zd,
  o as Yd,
  p as Qn,
  q as qd,
  r as Oa,
  s as sn,
  t as as,
  u as Qe,
  v as It,
  w as hr,
  I as Kd,
  x as Ra,
  y as jl,
  z as Qd,
  Z as Jn,
  R as Jd,
  F as Xd,
  G as wt,
  J as eu,
  N as tu,
  O as su,
  Q as fr,
  T as wl,
  V as Jr,
  W as ht,
  Y as ru,
  _ as nu,
  $ as au,
  a0 as Xn,
  a1 as bi,
  a2 as _n,
  a3 as iu,
  a4 as rn,
  a5 as ea,
  a6 as pr,
  a7 as ou,
  a8 as lu,
  a9 as Ma,
  aa as cu,
  ab as Pn,
  ac as ss,
  ad as du,
  ae as uu,
  af as mu,
  ag as hu,
} from './ui-libs-Cwk2ks74.js';
import { c as fu } from './supabase-Cx8Dzgcb.js';
(function () {
  const t = document.createElement('link').relList;
  if (t && t.supports && t.supports('modulepreload')) return;
  for (const a of document.querySelectorAll('link[rel="modulepreload"]')) n(a);
  new MutationObserver((a) => {
    for (const i of a)
      if (i.type === 'childList')
        for (const o of i.addedNodes) o.tagName === 'LINK' && o.rel === 'modulepreload' && n(o);
  }).observe(document, { childList: !0, subtree: !0 });
  function r(a) {
    const i = {};
    return (
      a.integrity && (i.integrity = a.integrity),
      a.referrerPolicy && (i.referrerPolicy = a.referrerPolicy),
      a.crossOrigin === 'use-credentials'
        ? (i.credentials = 'include')
        : a.crossOrigin === 'anonymous'
          ? (i.credentials = 'omit')
          : (i.credentials = 'same-origin'),
      i
    );
  }
  function n(a) {
    if (a.ep) return;
    a.ep = !0;
    const i = r(a);
    fetch(a.href, i);
  }
})();
var Nl = { exports: {} },
  kn = {};
/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */ var pu = h,
  xu = Symbol.for('react.element'),
  gu = Symbol.for('react.fragment'),
  bu = Object.prototype.hasOwnProperty,
  yu = pu.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,
  vu = { key: !0, ref: !0, __self: !0, __source: !0 };
function _l(e, t, r) {
  var n,
    a = {},
    i = null,
    o = null;
  (r !== void 0 && (i = '' + r),
    t.key !== void 0 && (i = '' + t.key),
    t.ref !== void 0 && (o = t.ref));
  for (n in t) bu.call(t, n) && !vu.hasOwnProperty(n) && (a[n] = t[n]);
  if (e && e.defaultProps) for (n in ((t = e.defaultProps), t)) a[n] === void 0 && (a[n] = t[n]);
  return {
    $$typeof: xu,
    type: e,
    key: i,
    ref: o,
    props: a,
    _owner: yu.current,
  };
}
kn.Fragment = gu;
kn.jsx = _l;
kn.jsxs = _l;
Nl.exports = kn;
var s = Nl.exports,
  ta = {},
  yi = Rd;
((ta.createRoot = yi.createRoot), (ta.hydrateRoot = yi.hydrateRoot));
var rr = class {
    constructor() {
      ((this.listeners = new Set()), (this.subscribe = this.subscribe.bind(this)));
    }
    subscribe(e) {
      return (
        this.listeners.add(e),
        this.onSubscribe(),
        () => {
          (this.listeners.delete(e), this.onUnsubscribe());
        }
      );
    }
    hasListeners() {
      return this.listeners.size > 0;
    }
    onSubscribe() {}
    onUnsubscribe() {}
  },
  ju = {
    setTimeout: (e, t) => setTimeout(e, t),
    clearTimeout: (e) => clearTimeout(e),
    setInterval: (e, t) => setInterval(e, t),
    clearInterval: (e) => clearInterval(e),
  },
  Zt,
  Aa,
  il,
  wu =
    ((il = class {
      constructor() {
        te(this, Zt, ju);
        te(this, Aa, !1);
      }
      setTimeoutProvider(e) {
        Z(this, Zt, e);
      }
      setTimeout(e, t) {
        return v(this, Zt).setTimeout(e, t);
      }
      clearTimeout(e) {
        v(this, Zt).clearTimeout(e);
      }
      setInterval(e, t) {
        return v(this, Zt).setInterval(e, t);
      }
      clearInterval(e) {
        v(this, Zt).clearInterval(e);
      }
    }),
    (Zt = new WeakMap()),
    (Aa = new WeakMap()),
    il),
  hs = new wu();
function Nu(e) {
  setTimeout(e, 0);
}
var ks = typeof window > 'u' || 'Deno' in globalThis;
function Ke() {}
function _u(e, t) {
  return typeof e == 'function' ? e(t) : e;
}
function sa(e) {
  return typeof e == 'number' && e >= 0 && e !== 1 / 0;
}
function kl(e, t) {
  return Math.max(e + (t || 0) - Date.now(), 0);
}
function rs(e, t) {
  return typeof e == 'function' ? e(t) : e;
}
function mt(e, t) {
  return typeof e == 'function' ? e(t) : e;
}
function vi(e, t) {
  const { type: r = 'all', exact: n, fetchStatus: a, predicate: i, queryKey: o, stale: l } = e;
  if (o) {
    if (n) {
      if (t.queryHash !== Pa(o, t.options)) return !1;
    } else if (!xr(t.queryKey, o)) return !1;
  }
  if (r !== 'all') {
    const c = t.isActive();
    if ((r === 'active' && !c) || (r === 'inactive' && c)) return !1;
  }
  return !(
    (typeof l == 'boolean' && t.isStale() !== l) ||
    (a && a !== t.state.fetchStatus) ||
    (i && !i(t))
  );
}
function ji(e, t) {
  const { exact: r, status: n, predicate: a, mutationKey: i } = e;
  if (i) {
    if (!t.options.mutationKey) return !1;
    if (r) {
      if (Ss(t.options.mutationKey) !== Ss(i)) return !1;
    } else if (!xr(t.options.mutationKey, i)) return !1;
  }
  return !((n && t.state.status !== n) || (a && !a(t)));
}
function Pa(e, t) {
  return ((t == null ? void 0 : t.queryKeyHashFn) || Ss)(e);
}
function Ss(e) {
  return JSON.stringify(e, (t, r) =>
    ra(r)
      ? Object.keys(r)
          .sort()
          .reduce((n, a) => ((n[a] = r[a]), n), {})
      : r
  );
}
function xr(e, t) {
  return e === t
    ? !0
    : typeof e != typeof t
      ? !1
      : e && t && typeof e == 'object' && typeof t == 'object'
        ? Object.keys(t).every((r) => xr(e[r], t[r]))
        : !1;
}
var ku = Object.prototype.hasOwnProperty;
function Sl(e, t) {
  if (e === t) return e;
  const r = wi(e) && wi(t);
  if (!r && !(ra(e) && ra(t))) return t;
  const a = (r ? e : Object.keys(e)).length,
    i = r ? t : Object.keys(t),
    o = i.length,
    l = r ? new Array(o) : {};
  let c = 0;
  for (let d = 0; d < o; d++) {
    const m = r ? d : i[d],
      u = e[m],
      x = t[m];
    if (u === x) {
      ((l[m] = u), (r ? d < a : ku.call(e, m)) && c++);
      continue;
    }
    if (u === null || x === null || typeof u != 'object' || typeof x != 'object') {
      l[m] = x;
      continue;
    }
    const f = Sl(u, x);
    ((l[m] = f), f === u && c++);
  }
  return a === o && c === a ? e : l;
}
function nn(e, t) {
  if (!t || Object.keys(e).length !== Object.keys(t).length) return !1;
  for (const r in e) if (e[r] !== t[r]) return !1;
  return !0;
}
function wi(e) {
  return Array.isArray(e) && e.length === Object.keys(e).length;
}
function ra(e) {
  if (!Ni(e)) return !1;
  const t = e.constructor;
  if (t === void 0) return !0;
  const r = t.prototype;
  return !(
    !Ni(r) ||
    !r.hasOwnProperty('isPrototypeOf') ||
    Object.getPrototypeOf(e) !== Object.prototype
  );
}
function Ni(e) {
  return Object.prototype.toString.call(e) === '[object Object]';
}
function Su(e) {
  return new Promise((t) => {
    hs.setTimeout(t, e);
  });
}
function na(e, t, r) {
  return typeof r.structuralSharing == 'function'
    ? r.structuralSharing(e, t)
    : r.structuralSharing !== !1
      ? Sl(e, t)
      : t;
}
function Eu(e, t, r = 0) {
  const n = [...e, t];
  return r && n.length > r ? n.slice(1) : n;
}
function Tu(e, t, r = 0) {
  const n = [t, ...e];
  return r && n.length > r ? n.slice(0, -1) : n;
}
var za = Symbol();
function El(e, t) {
  return !e.queryFn && t != null && t.initialPromise
    ? () => t.initialPromise
    : !e.queryFn || e.queryFn === za
      ? () => Promise.reject(new Error(`Missing queryFn: '${e.queryHash}'`))
      : e.queryFn;
}
function Tl(e, t) {
  return typeof e == 'function' ? e(...t) : !!e;
}
var ps,
  Yt,
  Gs,
  ol,
  Iu =
    ((ol = class extends rr {
      constructor() {
        super();
        te(this, ps);
        te(this, Yt);
        te(this, Gs);
        Z(this, Gs, (t) => {
          if (!ks && window.addEventListener) {
            const r = () => t();
            return (
              window.addEventListener('visibilitychange', r, !1),
              () => {
                window.removeEventListener('visibilitychange', r);
              }
            );
          }
        });
      }
      onSubscribe() {
        v(this, Yt) || this.setEventListener(v(this, Gs));
      }
      onUnsubscribe() {
        var t;
        this.hasListeners() || ((t = v(this, Yt)) == null || t.call(this), Z(this, Yt, void 0));
      }
      setEventListener(t) {
        var r;
        (Z(this, Gs, t),
          (r = v(this, Yt)) == null || r.call(this),
          Z(
            this,
            Yt,
            t((n) => {
              typeof n == 'boolean' ? this.setFocused(n) : this.onFocus();
            })
          ));
      }
      setFocused(t) {
        v(this, ps) !== t && (Z(this, ps, t), this.onFocus());
      }
      onFocus() {
        const t = this.isFocused();
        this.listeners.forEach((r) => {
          r(t);
        });
      }
      isFocused() {
        var t;
        return typeof v(this, ps) == 'boolean'
          ? v(this, ps)
          : ((t = globalThis.document) == null ? void 0 : t.visibilityState) !== 'hidden';
      }
    }),
    (ps = new WeakMap()),
    (Yt = new WeakMap()),
    (Gs = new WeakMap()),
    ol),
  Da = new Iu();
function aa() {
  let e, t;
  const r = new Promise((a, i) => {
    ((e = a), (t = i));
  });
  ((r.status = 'pending'), r.catch(() => {}));
  function n(a) {
    (Object.assign(r, a), delete r.resolve, delete r.reject);
  }
  return (
    (r.resolve = (a) => {
      (n({ status: 'fulfilled', value: a }), e(a));
    }),
    (r.reject = (a) => {
      (n({ status: 'rejected', reason: a }), t(a));
    }),
    r
  );
}
var Cu = Nu;
function Au() {
  let e = [],
    t = 0,
    r = (l) => {
      l();
    },
    n = (l) => {
      l();
    },
    a = Cu;
  const i = (l) => {
      t
        ? e.push(l)
        : a(() => {
            r(l);
          });
    },
    o = () => {
      const l = e;
      ((e = []),
        l.length &&
          a(() => {
            n(() => {
              l.forEach((c) => {
                r(c);
              });
            });
          }));
    };
  return {
    batch: (l) => {
      let c;
      t++;
      try {
        c = l();
      } finally {
        (t--, t || o());
      }
      return c;
    },
    batchCalls:
      (l) =>
      (...c) => {
        i(() => {
          l(...c);
        });
      },
    schedule: i,
    setNotifyFunction: (l) => {
      r = l;
    },
    setBatchNotifyFunction: (l) => {
      n = l;
    },
    setScheduler: (l) => {
      a = l;
    },
  };
}
var Oe = Au(),
  Hs,
  qt,
  Ws,
  ll,
  Lu =
    ((ll = class extends rr {
      constructor() {
        super();
        te(this, Hs, !0);
        te(this, qt);
        te(this, Ws);
        Z(this, Ws, (t) => {
          if (!ks && window.addEventListener) {
            const r = () => t(!0),
              n = () => t(!1);
            return (
              window.addEventListener('online', r, !1),
              window.addEventListener('offline', n, !1),
              () => {
                (window.removeEventListener('online', r), window.removeEventListener('offline', n));
              }
            );
          }
        });
      }
      onSubscribe() {
        v(this, qt) || this.setEventListener(v(this, Ws));
      }
      onUnsubscribe() {
        var t;
        this.hasListeners() || ((t = v(this, qt)) == null || t.call(this), Z(this, qt, void 0));
      }
      setEventListener(t) {
        var r;
        (Z(this, Ws, t),
          (r = v(this, qt)) == null || r.call(this),
          Z(this, qt, t(this.setOnline.bind(this))));
      }
      setOnline(t) {
        v(this, Hs) !== t &&
          (Z(this, Hs, t),
          this.listeners.forEach((n) => {
            n(t);
          }));
      }
      isOnline() {
        return v(this, Hs);
      }
    }),
    (Hs = new WeakMap()),
    (qt = new WeakMap()),
    (Ws = new WeakMap()),
    ll),
  an = new Lu();
function Ou(e) {
  return Math.min(1e3 * 2 ** e, 3e4);
}
function Il(e) {
  return (e ?? 'online') === 'online' ? an.isOnline() : !0;
}
var ia = class extends Error {
  constructor(e) {
    (super('CancelledError'),
      (this.revert = e == null ? void 0 : e.revert),
      (this.silent = e == null ? void 0 : e.silent));
  }
};
function Cl(e) {
  let t = !1,
    r = 0,
    n;
  const a = aa(),
    i = () => a.status !== 'pending',
    o = (b) => {
      var y;
      if (!i()) {
        const p = new ia(b);
        (x(p), (y = e.onCancel) == null || y.call(e, p));
      }
    },
    l = () => {
      t = !0;
    },
    c = () => {
      t = !1;
    },
    d = () => Da.isFocused() && (e.networkMode === 'always' || an.isOnline()) && e.canRun(),
    m = () => Il(e.networkMode) && e.canRun(),
    u = (b) => {
      i() || (n == null || n(), a.resolve(b));
    },
    x = (b) => {
      i() || (n == null || n(), a.reject(b));
    },
    f = () =>
      new Promise((b) => {
        var y;
        ((n = (p) => {
          (i() || d()) && b(p);
        }),
          (y = e.onPause) == null || y.call(e));
      }).then(() => {
        var b;
        ((n = void 0), i() || (b = e.onContinue) == null || b.call(e));
      }),
    g = () => {
      if (i()) return;
      let b;
      const y = r === 0 ? e.initialPromise : void 0;
      try {
        b = y ?? e.fn();
      } catch (p) {
        b = Promise.reject(p);
      }
      Promise.resolve(b)
        .then(u)
        .catch((p) => {
          var T;
          if (i()) return;
          const E = e.retry ?? (ks ? 0 : 3),
            S = e.retryDelay ?? Ou,
            N = typeof S == 'function' ? S(r, p) : S,
            k = E === !0 || (typeof E == 'number' && r < E) || (typeof E == 'function' && E(r, p));
          if (t || !k) {
            x(p);
            return;
          }
          (r++,
            (T = e.onFail) == null || T.call(e, r, p),
            Su(N)
              .then(() => (d() ? void 0 : f()))
              .then(() => {
                t ? x(p) : g();
              }));
        });
    };
  return {
    promise: a,
    status: () => a.status,
    cancel: o,
    continue: () => (n == null || n(), a),
    cancelRetry: l,
    continueRetry: c,
    canStart: m,
    start: () => (m() ? g() : f().then(g), a),
  };
}
var xs,
  cl,
  Al =
    ((cl = class {
      constructor() {
        te(this, xs);
      }
      destroy() {
        this.clearGcTimeout();
      }
      scheduleGc() {
        (this.clearGcTimeout(),
          sa(this.gcTime) &&
            Z(
              this,
              xs,
              hs.setTimeout(() => {
                this.optionalRemove();
              }, this.gcTime)
            ));
      }
      updateGcTime(e) {
        this.gcTime = Math.max(this.gcTime || 0, e ?? (ks ? 1 / 0 : 5 * 60 * 1e3));
      }
      clearGcTimeout() {
        v(this, xs) && (hs.clearTimeout(v(this, xs)), Z(this, xs, void 0));
      }
    }),
    (xs = new WeakMap()),
    cl),
  gs,
  Vs,
  ut,
  bs,
  Me,
  wr,
  ys,
  vt,
  Rt,
  dl,
  Ru =
    ((dl = class extends Al {
      constructor(t) {
        super();
        te(this, vt);
        te(this, gs);
        te(this, Vs);
        te(this, ut);
        te(this, bs);
        te(this, Me);
        te(this, wr);
        te(this, ys);
        (Z(this, ys, !1),
          Z(this, wr, t.defaultOptions),
          this.setOptions(t.options),
          (this.observers = []),
          Z(this, bs, t.client),
          Z(this, ut, v(this, bs).getQueryCache()),
          (this.queryKey = t.queryKey),
          (this.queryHash = t.queryHash),
          Z(this, gs, ki(this.options)),
          (this.state = t.state ?? v(this, gs)),
          this.scheduleGc());
      }
      get meta() {
        return this.options.meta;
      }
      get promise() {
        var t;
        return (t = v(this, Me)) == null ? void 0 : t.promise;
      }
      setOptions(t) {
        if (
          ((this.options = { ...v(this, wr), ...t }),
          this.updateGcTime(this.options.gcTime),
          this.state && this.state.data === void 0)
        ) {
          const r = ki(this.options);
          r.data !== void 0 && (this.setState(_i(r.data, r.dataUpdatedAt)), Z(this, gs, r));
        }
      }
      optionalRemove() {
        !this.observers.length && this.state.fetchStatus === 'idle' && v(this, ut).remove(this);
      }
      setData(t, r) {
        const n = na(this.state.data, t, this.options);
        return (
          ce(this, vt, Rt).call(this, {
            data: n,
            type: 'success',
            dataUpdatedAt: r == null ? void 0 : r.updatedAt,
            manual: r == null ? void 0 : r.manual,
          }),
          n
        );
      }
      setState(t, r) {
        ce(this, vt, Rt).call(this, {
          type: 'setState',
          state: t,
          setStateOptions: r,
        });
      }
      cancel(t) {
        var n, a;
        const r = (n = v(this, Me)) == null ? void 0 : n.promise;
        return (
          (a = v(this, Me)) == null || a.cancel(t),
          r ? r.then(Ke).catch(Ke) : Promise.resolve()
        );
      }
      destroy() {
        (super.destroy(), this.cancel({ silent: !0 }));
      }
      reset() {
        (this.destroy(), this.setState(v(this, gs)));
      }
      isActive() {
        return this.observers.some((t) => mt(t.options.enabled, this) !== !1);
      }
      isDisabled() {
        return this.getObserversCount() > 0
          ? !this.isActive()
          : this.options.queryFn === za ||
              this.state.dataUpdateCount + this.state.errorUpdateCount === 0;
      }
      isStatic() {
        return this.getObserversCount() > 0
          ? this.observers.some((t) => rs(t.options.staleTime, this) === 'static')
          : !1;
      }
      isStale() {
        return this.getObserversCount() > 0
          ? this.observers.some((t) => t.getCurrentResult().isStale)
          : this.state.data === void 0 || this.state.isInvalidated;
      }
      isStaleByTime(t = 0) {
        return this.state.data === void 0
          ? !0
          : t === 'static'
            ? !1
            : this.state.isInvalidated
              ? !0
              : !kl(this.state.dataUpdatedAt, t);
      }
      onFocus() {
        var r;
        const t = this.observers.find((n) => n.shouldFetchOnWindowFocus());
        (t == null || t.refetch({ cancelRefetch: !1 }), (r = v(this, Me)) == null || r.continue());
      }
      onOnline() {
        var r;
        const t = this.observers.find((n) => n.shouldFetchOnReconnect());
        (t == null || t.refetch({ cancelRefetch: !1 }), (r = v(this, Me)) == null || r.continue());
      }
      addObserver(t) {
        this.observers.includes(t) ||
          (this.observers.push(t),
          this.clearGcTimeout(),
          v(this, ut).notify({
            type: 'observerAdded',
            query: this,
            observer: t,
          }));
      }
      removeObserver(t) {
        this.observers.includes(t) &&
          ((this.observers = this.observers.filter((r) => r !== t)),
          this.observers.length ||
            (v(this, Me) &&
              (v(this, ys) ? v(this, Me).cancel({ revert: !0 }) : v(this, Me).cancelRetry()),
            this.scheduleGc()),
          v(this, ut).notify({
            type: 'observerRemoved',
            query: this,
            observer: t,
          }));
      }
      getObserversCount() {
        return this.observers.length;
      }
      invalidate() {
        this.state.isInvalidated || ce(this, vt, Rt).call(this, { type: 'invalidate' });
      }
      async fetch(t, r) {
        var c, d, m, u, x, f, g, b, y, p, E, S;
        if (
          this.state.fetchStatus !== 'idle' &&
          ((c = v(this, Me)) == null ? void 0 : c.status()) !== 'rejected'
        ) {
          if (this.state.data !== void 0 && r != null && r.cancelRefetch)
            this.cancel({ silent: !0 });
          else if (v(this, Me)) return (v(this, Me).continueRetry(), v(this, Me).promise);
        }
        if ((t && this.setOptions(t), !this.options.queryFn)) {
          const N = this.observers.find((k) => k.options.queryFn);
          N && this.setOptions(N.options);
        }
        const n = new AbortController(),
          a = (N) => {
            Object.defineProperty(N, 'signal', {
              enumerable: !0,
              get: () => (Z(this, ys, !0), n.signal),
            });
          },
          i = () => {
            const N = El(this.options, r),
              T = (() => {
                const C = {
                  client: v(this, bs),
                  queryKey: this.queryKey,
                  meta: this.meta,
                };
                return (a(C), C);
              })();
            return (
              Z(this, ys, !1),
              this.options.persister ? this.options.persister(N, T, this) : N(T)
            );
          },
          l = (() => {
            const N = {
              fetchOptions: r,
              options: this.options,
              queryKey: this.queryKey,
              client: v(this, bs),
              state: this.state,
              fetchFn: i,
            };
            return (a(N), N);
          })();
        ((d = this.options.behavior) == null || d.onFetch(l, this),
          Z(this, Vs, this.state),
          (this.state.fetchStatus === 'idle' ||
            this.state.fetchMeta !== ((m = l.fetchOptions) == null ? void 0 : m.meta)) &&
            ce(this, vt, Rt).call(this, {
              type: 'fetch',
              meta: (u = l.fetchOptions) == null ? void 0 : u.meta,
            }),
          Z(
            this,
            Me,
            Cl({
              initialPromise: r == null ? void 0 : r.initialPromise,
              fn: l.fetchFn,
              onCancel: (N) => {
                (N instanceof ia &&
                  N.revert &&
                  this.setState({ ...v(this, Vs), fetchStatus: 'idle' }),
                  n.abort());
              },
              onFail: (N, k) => {
                ce(this, vt, Rt).call(this, {
                  type: 'failed',
                  failureCount: N,
                  error: k,
                });
              },
              onPause: () => {
                ce(this, vt, Rt).call(this, { type: 'pause' });
              },
              onContinue: () => {
                ce(this, vt, Rt).call(this, { type: 'continue' });
              },
              retry: l.options.retry,
              retryDelay: l.options.retryDelay,
              networkMode: l.options.networkMode,
              canRun: () => !0,
            })
          ));
        try {
          const N = await v(this, Me).start();
          if (N === void 0) throw new Error(`${this.queryHash} data is undefined`);
          return (
            this.setData(N),
            (f = (x = v(this, ut).config).onSuccess) == null || f.call(x, N, this),
            (b = (g = v(this, ut).config).onSettled) == null ||
              b.call(g, N, this.state.error, this),
            N
          );
        } catch (N) {
          if (N instanceof ia) {
            if (N.silent) return v(this, Me).promise;
            if (N.revert) {
              if (this.state.data === void 0) throw N;
              return this.state.data;
            }
          }
          throw (
            ce(this, vt, Rt).call(this, { type: 'error', error: N }),
            (p = (y = v(this, ut).config).onError) == null || p.call(y, N, this),
            (S = (E = v(this, ut).config).onSettled) == null || S.call(E, this.state.data, N, this),
            N
          );
        } finally {
          this.scheduleGc();
        }
      }
    }),
    (gs = new WeakMap()),
    (Vs = new WeakMap()),
    (ut = new WeakMap()),
    (bs = new WeakMap()),
    (Me = new WeakMap()),
    (wr = new WeakMap()),
    (ys = new WeakMap()),
    (vt = new WeakSet()),
    (Rt = function (t) {
      const r = (n) => {
        switch (t.type) {
          case 'failed':
            return {
              ...n,
              fetchFailureCount: t.failureCount,
              fetchFailureReason: t.error,
            };
          case 'pause':
            return { ...n, fetchStatus: 'paused' };
          case 'continue':
            return { ...n, fetchStatus: 'fetching' };
          case 'fetch':
            return {
              ...n,
              ...Ll(n.data, this.options),
              fetchMeta: t.meta ?? null,
            };
          case 'success':
            const a = {
              ...n,
              ..._i(t.data, t.dataUpdatedAt),
              dataUpdateCount: n.dataUpdateCount + 1,
              ...(!t.manual && {
                fetchStatus: 'idle',
                fetchFailureCount: 0,
                fetchFailureReason: null,
              }),
            };
            return (Z(this, Vs, t.manual ? a : void 0), a);
          case 'error':
            const i = t.error;
            return {
              ...n,
              error: i,
              errorUpdateCount: n.errorUpdateCount + 1,
              errorUpdatedAt: Date.now(),
              fetchFailureCount: n.fetchFailureCount + 1,
              fetchFailureReason: i,
              fetchStatus: 'idle',
              status: 'error',
            };
          case 'invalidate':
            return { ...n, isInvalidated: !0 };
          case 'setState':
            return { ...n, ...t.state };
        }
      };
      ((this.state = r(this.state)),
        Oe.batch(() => {
          (this.observers.forEach((n) => {
            n.onQueryUpdate();
          }),
            v(this, ut).notify({ query: this, type: 'updated', action: t }));
        }));
    }),
    dl);
function Ll(e, t) {
  return {
    fetchFailureCount: 0,
    fetchFailureReason: null,
    fetchStatus: Il(t.networkMode) ? 'fetching' : 'paused',
    ...(e === void 0 && { error: null, status: 'pending' }),
  };
}
function _i(e, t) {
  return {
    data: e,
    dataUpdatedAt: t ?? Date.now(),
    error: null,
    isInvalidated: !1,
    status: 'success',
  };
}
function ki(e) {
  const t = typeof e.initialData == 'function' ? e.initialData() : e.initialData,
    r = t !== void 0,
    n = r
      ? typeof e.initialDataUpdatedAt == 'function'
        ? e.initialDataUpdatedAt()
        : e.initialDataUpdatedAt
      : 0;
  return {
    data: t,
    dataUpdateCount: 0,
    dataUpdatedAt: r ? (n ?? Date.now()) : 0,
    error: null,
    errorUpdateCount: 0,
    errorUpdatedAt: 0,
    fetchFailureCount: 0,
    fetchFailureReason: null,
    fetchMeta: null,
    isInvalidated: !1,
    status: r ? 'success' : 'pending',
    fetchStatus: 'idle',
  };
}
var Xe,
  pe,
  Nr,
  Ye,
  vs,
  Zs,
  Pt,
  Kt,
  _r,
  Ys,
  qs,
  js,
  ws,
  Qt,
  Ks,
  xe,
  cr,
  oa,
  la,
  ca,
  da,
  ua,
  ma,
  ha,
  Ol,
  ul,
  Mu =
    ((ul = class extends rr {
      constructor(t, r) {
        super();
        te(this, xe);
        te(this, Xe);
        te(this, pe);
        te(this, Nr);
        te(this, Ye);
        te(this, vs);
        te(this, Zs);
        te(this, Pt);
        te(this, Kt);
        te(this, _r);
        te(this, Ys);
        te(this, qs);
        te(this, js);
        te(this, ws);
        te(this, Qt);
        te(this, Ks, new Set());
        ((this.options = r),
          Z(this, Xe, t),
          Z(this, Kt, null),
          Z(this, Pt, aa()),
          this.bindMethods(),
          this.setOptions(r));
      }
      bindMethods() {
        this.refetch = this.refetch.bind(this);
      }
      onSubscribe() {
        this.listeners.size === 1 &&
          (v(this, pe).addObserver(this),
          Si(v(this, pe), this.options) ? ce(this, xe, cr).call(this) : this.updateResult(),
          ce(this, xe, da).call(this));
      }
      onUnsubscribe() {
        this.hasListeners() || this.destroy();
      }
      shouldFetchOnReconnect() {
        return fa(v(this, pe), this.options, this.options.refetchOnReconnect);
      }
      shouldFetchOnWindowFocus() {
        return fa(v(this, pe), this.options, this.options.refetchOnWindowFocus);
      }
      destroy() {
        ((this.listeners = new Set()),
          ce(this, xe, ua).call(this),
          ce(this, xe, ma).call(this),
          v(this, pe).removeObserver(this));
      }
      setOptions(t) {
        const r = this.options,
          n = v(this, pe);
        if (
          ((this.options = v(this, Xe).defaultQueryOptions(t)),
          this.options.enabled !== void 0 &&
            typeof this.options.enabled != 'boolean' &&
            typeof this.options.enabled != 'function' &&
            typeof mt(this.options.enabled, v(this, pe)) != 'boolean')
        )
          throw new Error('Expected enabled to be a boolean or a callback that returns a boolean');
        (ce(this, xe, ha).call(this),
          v(this, pe).setOptions(this.options),
          r._defaulted &&
            !nn(this.options, r) &&
            v(this, Xe)
              .getQueryCache()
              .notify({
                type: 'observerOptionsUpdated',
                query: v(this, pe),
                observer: this,
              }));
        const a = this.hasListeners();
        (a && Ei(v(this, pe), n, this.options, r) && ce(this, xe, cr).call(this),
          this.updateResult(),
          a &&
            (v(this, pe) !== n ||
              mt(this.options.enabled, v(this, pe)) !== mt(r.enabled, v(this, pe)) ||
              rs(this.options.staleTime, v(this, pe)) !== rs(r.staleTime, v(this, pe))) &&
            ce(this, xe, oa).call(this));
        const i = ce(this, xe, la).call(this);
        a &&
          (v(this, pe) !== n ||
            mt(this.options.enabled, v(this, pe)) !== mt(r.enabled, v(this, pe)) ||
            i !== v(this, Qt)) &&
          ce(this, xe, ca).call(this, i);
      }
      getOptimisticResult(t) {
        const r = v(this, Xe).getQueryCache().build(v(this, Xe), t),
          n = this.createResult(r, t);
        return (
          zu(this, n) &&
            (Z(this, Ye, n), Z(this, Zs, this.options), Z(this, vs, v(this, pe).state)),
          n
        );
      }
      getCurrentResult() {
        return v(this, Ye);
      }
      trackResult(t, r) {
        return new Proxy(t, {
          get: (n, a) => (
            this.trackProp(a),
            r == null || r(a),
            a === 'promise' &&
              (this.trackProp('data'),
              !this.options.experimental_prefetchInRender &&
                v(this, Pt).status === 'pending' &&
                v(this, Pt).reject(
                  new Error('experimental_prefetchInRender feature flag is not enabled')
                )),
            Reflect.get(n, a)
          ),
        });
      }
      trackProp(t) {
        v(this, Ks).add(t);
      }
      getCurrentQuery() {
        return v(this, pe);
      }
      refetch({ ...t } = {}) {
        return this.fetch({ ...t });
      }
      fetchOptimistic(t) {
        const r = v(this, Xe).defaultQueryOptions(t),
          n = v(this, Xe).getQueryCache().build(v(this, Xe), r);
        return n.fetch().then(() => this.createResult(n, r));
      }
      fetch(t) {
        return ce(this, xe, cr)
          .call(this, { ...t, cancelRefetch: t.cancelRefetch ?? !0 })
          .then(() => (this.updateResult(), v(this, Ye)));
      }
      createResult(t, r) {
        var G;
        const n = v(this, pe),
          a = this.options,
          i = v(this, Ye),
          o = v(this, vs),
          l = v(this, Zs),
          d = t !== n ? t.state : v(this, Nr),
          { state: m } = t;
        let u = { ...m },
          x = !1,
          f;
        if (r._optimisticResults) {
          const j = this.hasListeners(),
            _ = !j && Si(t, r),
            D = j && Ei(t, n, r, a);
          ((_ || D) && (u = { ...u, ...Ll(m.data, t.options) }),
            r._optimisticResults === 'isRestoring' && (u.fetchStatus = 'idle'));
        }
        let { error: g, errorUpdatedAt: b, status: y } = u;
        f = u.data;
        let p = !1;
        if (r.placeholderData !== void 0 && f === void 0 && y === 'pending') {
          let j;
          (i != null &&
          i.isPlaceholderData &&
          r.placeholderData === (l == null ? void 0 : l.placeholderData)
            ? ((j = i.data), (p = !0))
            : (j =
                typeof r.placeholderData == 'function'
                  ? r.placeholderData(
                      (G = v(this, qs)) == null ? void 0 : G.state.data,
                      v(this, qs)
                    )
                  : r.placeholderData),
            j !== void 0 &&
              ((y = 'success'), (f = na(i == null ? void 0 : i.data, j, r)), (x = !0)));
        }
        if (r.select && f !== void 0 && !p)
          if (i && f === (o == null ? void 0 : o.data) && r.select === v(this, _r)) f = v(this, Ys);
          else
            try {
              (Z(this, _r, r.select),
                (f = r.select(f)),
                (f = na(i == null ? void 0 : i.data, f, r)),
                Z(this, Ys, f),
                Z(this, Kt, null));
            } catch (j) {
              Z(this, Kt, j);
            }
        v(this, Kt) && ((g = v(this, Kt)), (f = v(this, Ys)), (b = Date.now()), (y = 'error'));
        const E = u.fetchStatus === 'fetching',
          S = y === 'pending',
          N = y === 'error',
          k = S && E,
          T = f !== void 0,
          w = {
            status: y,
            fetchStatus: u.fetchStatus,
            isPending: S,
            isSuccess: y === 'success',
            isError: N,
            isInitialLoading: k,
            isLoading: k,
            data: f,
            dataUpdatedAt: u.dataUpdatedAt,
            error: g,
            errorUpdatedAt: b,
            failureCount: u.fetchFailureCount,
            failureReason: u.fetchFailureReason,
            errorUpdateCount: u.errorUpdateCount,
            isFetched: u.dataUpdateCount > 0 || u.errorUpdateCount > 0,
            isFetchedAfterMount:
              u.dataUpdateCount > d.dataUpdateCount || u.errorUpdateCount > d.errorUpdateCount,
            isFetching: E,
            isRefetching: E && !S,
            isLoadingError: N && !T,
            isPaused: u.fetchStatus === 'paused',
            isPlaceholderData: x,
            isRefetchError: N && T,
            isStale: Fa(t, r),
            refetch: this.refetch,
            promise: v(this, Pt),
            isEnabled: mt(r.enabled, t) !== !1,
          };
        if (this.options.experimental_prefetchInRender) {
          const j = (V) => {
              w.status === 'error' ? V.reject(w.error) : w.data !== void 0 && V.resolve(w.data);
            },
            _ = () => {
              const V = Z(this, Pt, (w.promise = aa()));
              j(V);
            },
            D = v(this, Pt);
          switch (D.status) {
            case 'pending':
              t.queryHash === n.queryHash && j(D);
              break;
            case 'fulfilled':
              (w.status === 'error' || w.data !== D.value) && _();
              break;
            case 'rejected':
              (w.status !== 'error' || w.error !== D.reason) && _();
              break;
          }
        }
        return w;
      }
      updateResult() {
        const t = v(this, Ye),
          r = this.createResult(v(this, pe), this.options);
        if (
          (Z(this, vs, v(this, pe).state),
          Z(this, Zs, this.options),
          v(this, vs).data !== void 0 && Z(this, qs, v(this, pe)),
          nn(r, t))
        )
          return;
        Z(this, Ye, r);
        const n = () => {
          if (!t) return !0;
          const { notifyOnChangeProps: a } = this.options,
            i = typeof a == 'function' ? a() : a;
          if (i === 'all' || (!i && !v(this, Ks).size)) return !0;
          const o = new Set(i ?? v(this, Ks));
          return (
            this.options.throwOnError && o.add('error'),
            Object.keys(v(this, Ye)).some((l) => {
              const c = l;
              return v(this, Ye)[c] !== t[c] && o.has(c);
            })
          );
        };
        ce(this, xe, Ol).call(this, { listeners: n() });
      }
      onQueryUpdate() {
        (this.updateResult(), this.hasListeners() && ce(this, xe, da).call(this));
      }
    }),
    (Xe = new WeakMap()),
    (pe = new WeakMap()),
    (Nr = new WeakMap()),
    (Ye = new WeakMap()),
    (vs = new WeakMap()),
    (Zs = new WeakMap()),
    (Pt = new WeakMap()),
    (Kt = new WeakMap()),
    (_r = new WeakMap()),
    (Ys = new WeakMap()),
    (qs = new WeakMap()),
    (js = new WeakMap()),
    (ws = new WeakMap()),
    (Qt = new WeakMap()),
    (Ks = new WeakMap()),
    (xe = new WeakSet()),
    (cr = function (t) {
      ce(this, xe, ha).call(this);
      let r = v(this, pe).fetch(this.options, t);
      return ((t != null && t.throwOnError) || (r = r.catch(Ke)), r);
    }),
    (oa = function () {
      ce(this, xe, ua).call(this);
      const t = rs(this.options.staleTime, v(this, pe));
      if (ks || v(this, Ye).isStale || !sa(t)) return;
      const n = kl(v(this, Ye).dataUpdatedAt, t) + 1;
      Z(
        this,
        js,
        hs.setTimeout(() => {
          v(this, Ye).isStale || this.updateResult();
        }, n)
      );
    }),
    (la = function () {
      return (
        (typeof this.options.refetchInterval == 'function'
          ? this.options.refetchInterval(v(this, pe))
          : this.options.refetchInterval) ?? !1
      );
    }),
    (ca = function (t) {
      (ce(this, xe, ma).call(this),
        Z(this, Qt, t),
        !(
          ks ||
          mt(this.options.enabled, v(this, pe)) === !1 ||
          !sa(v(this, Qt)) ||
          v(this, Qt) === 0
        ) &&
          Z(
            this,
            ws,
            hs.setInterval(
              () => {
                (this.options.refetchIntervalInBackground || Da.isFocused()) &&
                  ce(this, xe, cr).call(this);
              },
              v(this, Qt)
            )
          ));
    }),
    (da = function () {
      (ce(this, xe, oa).call(this), ce(this, xe, ca).call(this, ce(this, xe, la).call(this)));
    }),
    (ua = function () {
      v(this, js) && (hs.clearTimeout(v(this, js)), Z(this, js, void 0));
    }),
    (ma = function () {
      v(this, ws) && (hs.clearInterval(v(this, ws)), Z(this, ws, void 0));
    }),
    (ha = function () {
      const t = v(this, Xe).getQueryCache().build(v(this, Xe), this.options);
      if (t === v(this, pe)) return;
      const r = v(this, pe);
      (Z(this, pe, t),
        Z(this, Nr, t.state),
        this.hasListeners() && (r == null || r.removeObserver(this), t.addObserver(this)));
    }),
    (Ol = function (t) {
      Oe.batch(() => {
        (t.listeners &&
          this.listeners.forEach((r) => {
            r(v(this, Ye));
          }),
          v(this, Xe)
            .getQueryCache()
            .notify({ query: v(this, pe), type: 'observerResultsUpdated' }));
      });
    }),
    ul);
function Pu(e, t) {
  return (
    mt(t.enabled, e) !== !1 &&
    e.state.data === void 0 &&
    !(e.state.status === 'error' && t.retryOnMount === !1)
  );
}
function Si(e, t) {
  return Pu(e, t) || (e.state.data !== void 0 && fa(e, t, t.refetchOnMount));
}
function fa(e, t, r) {
  if (mt(t.enabled, e) !== !1 && rs(t.staleTime, e) !== 'static') {
    const n = typeof r == 'function' ? r(e) : r;
    return n === 'always' || (n !== !1 && Fa(e, t));
  }
  return !1;
}
function Ei(e, t, r, n) {
  return (
    (e !== t || mt(n.enabled, e) === !1) && (!r.suspense || e.state.status !== 'error') && Fa(e, r)
  );
}
function Fa(e, t) {
  return mt(t.enabled, e) !== !1 && e.isStaleByTime(rs(t.staleTime, e));
}
function zu(e, t) {
  return !nn(e.getCurrentResult(), t);
}
function Ti(e) {
  return {
    onFetch: (t, r) => {
      var m, u, x, f, g;
      const n = t.options,
        a =
          (x =
            (u = (m = t.fetchOptions) == null ? void 0 : m.meta) == null ? void 0 : u.fetchMore) ==
          null
            ? void 0
            : x.direction,
        i = ((f = t.state.data) == null ? void 0 : f.pages) || [],
        o = ((g = t.state.data) == null ? void 0 : g.pageParams) || [];
      let l = { pages: [], pageParams: [] },
        c = 0;
      const d = async () => {
        let b = !1;
        const y = (S) => {
            Object.defineProperty(S, 'signal', {
              enumerable: !0,
              get: () => (
                t.signal.aborted
                  ? (b = !0)
                  : t.signal.addEventListener('abort', () => {
                      b = !0;
                    }),
                t.signal
              ),
            });
          },
          p = El(t.options, t.fetchOptions),
          E = async (S, N, k) => {
            if (b) return Promise.reject();
            if (N == null && S.pages.length) return Promise.resolve(S);
            const C = (() => {
                const _ = {
                  client: t.client,
                  queryKey: t.queryKey,
                  pageParam: N,
                  direction: k ? 'backward' : 'forward',
                  meta: t.options.meta,
                };
                return (y(_), _);
              })(),
              w = await p(C),
              { maxPages: G } = t.options,
              j = k ? Tu : Eu;
            return {
              pages: j(S.pages, w, G),
              pageParams: j(S.pageParams, N, G),
            };
          };
        if (a && i.length) {
          const S = a === 'backward',
            N = S ? Du : Ii,
            k = { pages: i, pageParams: o },
            T = N(n, k);
          l = await E(k, T, S);
        } else {
          const S = e ?? i.length;
          do {
            const N = c === 0 ? (o[0] ?? n.initialPageParam) : Ii(n, l);
            if (c > 0 && N == null) break;
            ((l = await E(l, N)), c++);
          } while (c < S);
        }
        return l;
      };
      t.options.persister
        ? (t.fetchFn = () => {
            var b, y;
            return (y = (b = t.options).persister) == null
              ? void 0
              : y.call(
                  b,
                  d,
                  {
                    client: t.client,
                    queryKey: t.queryKey,
                    meta: t.options.meta,
                    signal: t.signal,
                  },
                  r
                );
          })
        : (t.fetchFn = d);
    },
  };
}
function Ii(e, { pages: t, pageParams: r }) {
  const n = t.length - 1;
  return t.length > 0 ? e.getNextPageParam(t[n], t, r[n], r) : void 0;
}
function Du(e, { pages: t, pageParams: r }) {
  var n;
  return t.length > 0
    ? (n = e.getPreviousPageParam) == null
      ? void 0
      : n.call(e, t[0], t, r[0], r)
    : void 0;
}
var kr,
  kt,
  qe,
  Ns,
  St,
  Ht,
  ml,
  Fu =
    ((ml = class extends Al {
      constructor(t) {
        super();
        te(this, St);
        te(this, kr);
        te(this, kt);
        te(this, qe);
        te(this, Ns);
        (Z(this, kr, t.client),
          (this.mutationId = t.mutationId),
          Z(this, qe, t.mutationCache),
          Z(this, kt, []),
          (this.state = t.state || Rl()),
          this.setOptions(t.options),
          this.scheduleGc());
      }
      setOptions(t) {
        ((this.options = t), this.updateGcTime(this.options.gcTime));
      }
      get meta() {
        return this.options.meta;
      }
      addObserver(t) {
        v(this, kt).includes(t) ||
          (v(this, kt).push(t),
          this.clearGcTimeout(),
          v(this, qe).notify({
            type: 'observerAdded',
            mutation: this,
            observer: t,
          }));
      }
      removeObserver(t) {
        (Z(
          this,
          kt,
          v(this, kt).filter((r) => r !== t)
        ),
          this.scheduleGc(),
          v(this, qe).notify({
            type: 'observerRemoved',
            mutation: this,
            observer: t,
          }));
      }
      optionalRemove() {
        v(this, kt).length ||
          (this.state.status === 'pending' ? this.scheduleGc() : v(this, qe).remove(this));
      }
      continue() {
        var t;
        return (
          ((t = v(this, Ns)) == null ? void 0 : t.continue()) ?? this.execute(this.state.variables)
        );
      }
      async execute(t) {
        var o, l, c, d, m, u, x, f, g, b, y, p, E, S, N, k, T, C, w, G;
        const r = () => {
            ce(this, St, Ht).call(this, { type: 'continue' });
          },
          n = {
            client: v(this, kr),
            meta: this.options.meta,
            mutationKey: this.options.mutationKey,
          };
        Z(
          this,
          Ns,
          Cl({
            fn: () =>
              this.options.mutationFn
                ? this.options.mutationFn(t, n)
                : Promise.reject(new Error('No mutationFn found')),
            onFail: (j, _) => {
              ce(this, St, Ht).call(this, {
                type: 'failed',
                failureCount: j,
                error: _,
              });
            },
            onPause: () => {
              ce(this, St, Ht).call(this, { type: 'pause' });
            },
            onContinue: r,
            retry: this.options.retry ?? 0,
            retryDelay: this.options.retryDelay,
            networkMode: this.options.networkMode,
            canRun: () => v(this, qe).canRun(this),
          })
        );
        const a = this.state.status === 'pending',
          i = !v(this, Ns).canStart();
        try {
          if (a) r();
          else {
            (ce(this, St, Ht).call(this, {
              type: 'pending',
              variables: t,
              isPaused: i,
            }),
              await ((l = (o = v(this, qe).config).onMutate) == null
                ? void 0
                : l.call(o, t, this, n)));
            const _ = await ((d = (c = this.options).onMutate) == null ? void 0 : d.call(c, t, n));
            _ !== this.state.context &&
              ce(this, St, Ht).call(this, {
                type: 'pending',
                context: _,
                variables: t,
                isPaused: i,
              });
          }
          const j = await v(this, Ns).start();
          return (
            await ((u = (m = v(this, qe).config).onSuccess) == null
              ? void 0
              : u.call(m, j, t, this.state.context, this, n)),
            await ((f = (x = this.options).onSuccess) == null
              ? void 0
              : f.call(x, j, t, this.state.context, n)),
            await ((b = (g = v(this, qe).config).onSettled) == null
              ? void 0
              : b.call(g, j, null, this.state.variables, this.state.context, this, n)),
            await ((p = (y = this.options).onSettled) == null
              ? void 0
              : p.call(y, j, null, t, this.state.context, n)),
            ce(this, St, Ht).call(this, { type: 'success', data: j }),
            j
          );
        } catch (j) {
          try {
            throw (
              await ((S = (E = v(this, qe).config).onError) == null
                ? void 0
                : S.call(E, j, t, this.state.context, this, n)),
              await ((k = (N = this.options).onError) == null
                ? void 0
                : k.call(N, j, t, this.state.context, n)),
              await ((C = (T = v(this, qe).config).onSettled) == null
                ? void 0
                : C.call(T, void 0, j, this.state.variables, this.state.context, this, n)),
              await ((G = (w = this.options).onSettled) == null
                ? void 0
                : G.call(w, void 0, j, t, this.state.context, n)),
              j
            );
          } finally {
            ce(this, St, Ht).call(this, { type: 'error', error: j });
          }
        } finally {
          v(this, qe).runNext(this);
        }
      }
    }),
    (kr = new WeakMap()),
    (kt = new WeakMap()),
    (qe = new WeakMap()),
    (Ns = new WeakMap()),
    (St = new WeakSet()),
    (Ht = function (t) {
      const r = (n) => {
        switch (t.type) {
          case 'failed':
            return {
              ...n,
              failureCount: t.failureCount,
              failureReason: t.error,
            };
          case 'pause':
            return { ...n, isPaused: !0 };
          case 'continue':
            return { ...n, isPaused: !1 };
          case 'pending':
            return {
              ...n,
              context: t.context,
              data: void 0,
              failureCount: 0,
              failureReason: null,
              error: null,
              isPaused: t.isPaused,
              status: 'pending',
              variables: t.variables,
              submittedAt: Date.now(),
            };
          case 'success':
            return {
              ...n,
              data: t.data,
              failureCount: 0,
              failureReason: null,
              error: null,
              status: 'success',
              isPaused: !1,
            };
          case 'error':
            return {
              ...n,
              data: void 0,
              error: t.error,
              failureCount: n.failureCount + 1,
              failureReason: t.error,
              isPaused: !1,
              status: 'error',
            };
        }
      };
      ((this.state = r(this.state)),
        Oe.batch(() => {
          (v(this, kt).forEach((n) => {
            n.onMutationUpdate(t);
          }),
            v(this, qe).notify({ mutation: this, type: 'updated', action: t }));
        }));
    }),
    ml);
function Rl() {
  return {
    context: void 0,
    data: void 0,
    error: null,
    failureCount: 0,
    failureReason: null,
    isPaused: !1,
    status: 'idle',
    variables: void 0,
    submittedAt: 0,
  };
}
var zt,
  jt,
  Sr,
  hl,
  $u =
    ((hl = class extends rr {
      constructor(t = {}) {
        super();
        te(this, zt);
        te(this, jt);
        te(this, Sr);
        ((this.config = t), Z(this, zt, new Set()), Z(this, jt, new Map()), Z(this, Sr, 0));
      }
      build(t, r, n) {
        const a = new Fu({
          client: t,
          mutationCache: this,
          mutationId: ++Dr(this, Sr)._,
          options: t.defaultMutationOptions(r),
          state: n,
        });
        return (this.add(a), a);
      }
      add(t) {
        v(this, zt).add(t);
        const r = Fr(t);
        if (typeof r == 'string') {
          const n = v(this, jt).get(r);
          n ? n.push(t) : v(this, jt).set(r, [t]);
        }
        this.notify({ type: 'added', mutation: t });
      }
      remove(t) {
        if (v(this, zt).delete(t)) {
          const r = Fr(t);
          if (typeof r == 'string') {
            const n = v(this, jt).get(r);
            if (n)
              if (n.length > 1) {
                const a = n.indexOf(t);
                a !== -1 && n.splice(a, 1);
              } else n[0] === t && v(this, jt).delete(r);
          }
        }
        this.notify({ type: 'removed', mutation: t });
      }
      canRun(t) {
        const r = Fr(t);
        if (typeof r == 'string') {
          const n = v(this, jt).get(r),
            a = n == null ? void 0 : n.find((i) => i.state.status === 'pending');
          return !a || a === t;
        } else return !0;
      }
      runNext(t) {
        var n;
        const r = Fr(t);
        if (typeof r == 'string') {
          const a =
            (n = v(this, jt).get(r)) == null ? void 0 : n.find((i) => i !== t && i.state.isPaused);
          return (a == null ? void 0 : a.continue()) ?? Promise.resolve();
        } else return Promise.resolve();
      }
      clear() {
        Oe.batch(() => {
          (v(this, zt).forEach((t) => {
            this.notify({ type: 'removed', mutation: t });
          }),
            v(this, zt).clear(),
            v(this, jt).clear());
        });
      }
      getAll() {
        return Array.from(v(this, zt));
      }
      find(t) {
        const r = { exact: !0, ...t };
        return this.getAll().find((n) => ji(r, n));
      }
      findAll(t = {}) {
        return this.getAll().filter((r) => ji(t, r));
      }
      notify(t) {
        Oe.batch(() => {
          this.listeners.forEach((r) => {
            r(t);
          });
        });
      }
      resumePausedMutations() {
        const t = this.getAll().filter((r) => r.state.isPaused);
        return Oe.batch(() => Promise.all(t.map((r) => r.continue().catch(Ke))));
      }
    }),
    (zt = new WeakMap()),
    (jt = new WeakMap()),
    (Sr = new WeakMap()),
    hl);
function Fr(e) {
  var t;
  return (t = e.options.scope) == null ? void 0 : t.id;
}
var Dt,
  Jt,
  et,
  Ft,
  Ut,
  Xr,
  pa,
  fl,
  Uu =
    ((fl = class extends rr {
      constructor(r, n) {
        super();
        te(this, Ut);
        te(this, Dt);
        te(this, Jt);
        te(this, et);
        te(this, Ft);
        (Z(this, Dt, r), this.setOptions(n), this.bindMethods(), ce(this, Ut, Xr).call(this));
      }
      bindMethods() {
        ((this.mutate = this.mutate.bind(this)), (this.reset = this.reset.bind(this)));
      }
      setOptions(r) {
        var a;
        const n = this.options;
        ((this.options = v(this, Dt).defaultMutationOptions(r)),
          nn(this.options, n) ||
            v(this, Dt)
              .getMutationCache()
              .notify({
                type: 'observerOptionsUpdated',
                mutation: v(this, et),
                observer: this,
              }),
          n != null &&
          n.mutationKey &&
          this.options.mutationKey &&
          Ss(n.mutationKey) !== Ss(this.options.mutationKey)
            ? this.reset()
            : ((a = v(this, et)) == null ? void 0 : a.state.status) === 'pending' &&
              v(this, et).setOptions(this.options));
      }
      onUnsubscribe() {
        var r;
        this.hasListeners() || (r = v(this, et)) == null || r.removeObserver(this);
      }
      onMutationUpdate(r) {
        (ce(this, Ut, Xr).call(this), ce(this, Ut, pa).call(this, r));
      }
      getCurrentResult() {
        return v(this, Jt);
      }
      reset() {
        var r;
        ((r = v(this, et)) == null || r.removeObserver(this),
          Z(this, et, void 0),
          ce(this, Ut, Xr).call(this),
          ce(this, Ut, pa).call(this));
      }
      mutate(r, n) {
        var a;
        return (
          Z(this, Ft, n),
          (a = v(this, et)) == null || a.removeObserver(this),
          Z(this, et, v(this, Dt).getMutationCache().build(v(this, Dt), this.options)),
          v(this, et).addObserver(this),
          v(this, et).execute(r)
        );
      }
    }),
    (Dt = new WeakMap()),
    (Jt = new WeakMap()),
    (et = new WeakMap()),
    (Ft = new WeakMap()),
    (Ut = new WeakSet()),
    (Xr = function () {
      var n;
      const r = ((n = v(this, et)) == null ? void 0 : n.state) ?? Rl();
      Z(this, Jt, {
        ...r,
        isPending: r.status === 'pending',
        isSuccess: r.status === 'success',
        isError: r.status === 'error',
        isIdle: r.status === 'idle',
        mutate: this.mutate,
        reset: this.reset,
      });
    }),
    (pa = function (r) {
      Oe.batch(() => {
        var n, a, i, o, l, c, d, m;
        if (v(this, Ft) && this.hasListeners()) {
          const u = v(this, Jt).variables,
            x = v(this, Jt).context,
            f = {
              client: v(this, Dt),
              meta: this.options.meta,
              mutationKey: this.options.mutationKey,
            };
          (r == null ? void 0 : r.type) === 'success'
            ? ((a = (n = v(this, Ft)).onSuccess) == null || a.call(n, r.data, u, x, f),
              (o = (i = v(this, Ft)).onSettled) == null || o.call(i, r.data, null, u, x, f))
            : (r == null ? void 0 : r.type) === 'error' &&
              ((c = (l = v(this, Ft)).onError) == null || c.call(l, r.error, u, x, f),
              (m = (d = v(this, Ft)).onSettled) == null || m.call(d, void 0, r.error, u, x, f));
        }
        this.listeners.forEach((u) => {
          u(v(this, Jt));
        });
      });
    }),
    fl),
  Et,
  pl,
  Bu =
    ((pl = class extends rr {
      constructor(t = {}) {
        super();
        te(this, Et);
        ((this.config = t), Z(this, Et, new Map()));
      }
      build(t, r, n) {
        const a = r.queryKey,
          i = r.queryHash ?? Pa(a, r);
        let o = this.get(i);
        return (
          o ||
            ((o = new Ru({
              client: t,
              queryKey: a,
              queryHash: i,
              options: t.defaultQueryOptions(r),
              state: n,
              defaultOptions: t.getQueryDefaults(a),
            })),
            this.add(o)),
          o
        );
      }
      add(t) {
        v(this, Et).has(t.queryHash) ||
          (v(this, Et).set(t.queryHash, t), this.notify({ type: 'added', query: t }));
      }
      remove(t) {
        const r = v(this, Et).get(t.queryHash);
        r &&
          (t.destroy(),
          r === t && v(this, Et).delete(t.queryHash),
          this.notify({ type: 'removed', query: t }));
      }
      clear() {
        Oe.batch(() => {
          this.getAll().forEach((t) => {
            this.remove(t);
          });
        });
      }
      get(t) {
        return v(this, Et).get(t);
      }
      getAll() {
        return [...v(this, Et).values()];
      }
      find(t) {
        const r = { exact: !0, ...t };
        return this.getAll().find((n) => vi(r, n));
      }
      findAll(t = {}) {
        const r = this.getAll();
        return Object.keys(t).length > 0 ? r.filter((n) => vi(t, n)) : r;
      }
      notify(t) {
        Oe.batch(() => {
          this.listeners.forEach((r) => {
            r(t);
          });
        });
      }
      onFocus() {
        Oe.batch(() => {
          this.getAll().forEach((t) => {
            t.onFocus();
          });
        });
      }
      onOnline() {
        Oe.batch(() => {
          this.getAll().forEach((t) => {
            t.onOnline();
          });
        });
      }
    }),
    (Et = new WeakMap()),
    pl),
  Te,
  Xt,
  es,
  Qs,
  Js,
  ts,
  Xs,
  er,
  xl,
  Gu =
    ((xl = class {
      constructor(e = {}) {
        te(this, Te);
        te(this, Xt);
        te(this, es);
        te(this, Qs);
        te(this, Js);
        te(this, ts);
        te(this, Xs);
        te(this, er);
        (Z(this, Te, e.queryCache || new Bu()),
          Z(this, Xt, e.mutationCache || new $u()),
          Z(this, es, e.defaultOptions || {}),
          Z(this, Qs, new Map()),
          Z(this, Js, new Map()),
          Z(this, ts, 0));
      }
      mount() {
        (Dr(this, ts)._++,
          v(this, ts) === 1 &&
            (Z(
              this,
              Xs,
              Da.subscribe(async (e) => {
                e && (await this.resumePausedMutations(), v(this, Te).onFocus());
              })
            ),
            Z(
              this,
              er,
              an.subscribe(async (e) => {
                e && (await this.resumePausedMutations(), v(this, Te).onOnline());
              })
            )));
      }
      unmount() {
        var e, t;
        (Dr(this, ts)._--,
          v(this, ts) === 0 &&
            ((e = v(this, Xs)) == null || e.call(this),
            Z(this, Xs, void 0),
            (t = v(this, er)) == null || t.call(this),
            Z(this, er, void 0)));
      }
      isFetching(e) {
        return v(this, Te).findAll({ ...e, fetchStatus: 'fetching' }).length;
      }
      isMutating(e) {
        return v(this, Xt).findAll({ ...e, status: 'pending' }).length;
      }
      getQueryData(e) {
        var r;
        const t = this.defaultQueryOptions({ queryKey: e });
        return (r = v(this, Te).get(t.queryHash)) == null ? void 0 : r.state.data;
      }
      ensureQueryData(e) {
        const t = this.defaultQueryOptions(e),
          r = v(this, Te).build(this, t),
          n = r.state.data;
        return n === void 0
          ? this.fetchQuery(e)
          : (e.revalidateIfStale && r.isStaleByTime(rs(t.staleTime, r)) && this.prefetchQuery(t),
            Promise.resolve(n));
      }
      getQueriesData(e) {
        return v(this, Te)
          .findAll(e)
          .map(({ queryKey: t, state: r }) => {
            const n = r.data;
            return [t, n];
          });
      }
      setQueryData(e, t, r) {
        const n = this.defaultQueryOptions({ queryKey: e }),
          a = v(this, Te).get(n.queryHash),
          i = a == null ? void 0 : a.state.data,
          o = _u(t, i);
        if (o !== void 0)
          return v(this, Te)
            .build(this, n)
            .setData(o, { ...r, manual: !0 });
      }
      setQueriesData(e, t, r) {
        return Oe.batch(() =>
          v(this, Te)
            .findAll(e)
            .map(({ queryKey: n }) => [n, this.setQueryData(n, t, r)])
        );
      }
      getQueryState(e) {
        var r;
        const t = this.defaultQueryOptions({ queryKey: e });
        return (r = v(this, Te).get(t.queryHash)) == null ? void 0 : r.state;
      }
      removeQueries(e) {
        const t = v(this, Te);
        Oe.batch(() => {
          t.findAll(e).forEach((r) => {
            t.remove(r);
          });
        });
      }
      resetQueries(e, t) {
        const r = v(this, Te);
        return Oe.batch(
          () => (
            r.findAll(e).forEach((n) => {
              n.reset();
            }),
            this.refetchQueries({ type: 'active', ...e }, t)
          )
        );
      }
      cancelQueries(e, t = {}) {
        const r = { revert: !0, ...t },
          n = Oe.batch(() =>
            v(this, Te)
              .findAll(e)
              .map((a) => a.cancel(r))
          );
        return Promise.all(n).then(Ke).catch(Ke);
      }
      invalidateQueries(e, t = {}) {
        return Oe.batch(
          () => (
            v(this, Te)
              .findAll(e)
              .forEach((r) => {
                r.invalidate();
              }),
            (e == null ? void 0 : e.refetchType) === 'none'
              ? Promise.resolve()
              : this.refetchQueries(
                  {
                    ...e,
                    type:
                      (e == null ? void 0 : e.refetchType) ??
                      (e == null ? void 0 : e.type) ??
                      'active',
                  },
                  t
                )
          )
        );
      }
      refetchQueries(e, t = {}) {
        const r = { ...t, cancelRefetch: t.cancelRefetch ?? !0 },
          n = Oe.batch(() =>
            v(this, Te)
              .findAll(e)
              .filter((a) => !a.isDisabled() && !a.isStatic())
              .map((a) => {
                let i = a.fetch(void 0, r);
                return (
                  r.throwOnError || (i = i.catch(Ke)),
                  a.state.fetchStatus === 'paused' ? Promise.resolve() : i
                );
              })
          );
        return Promise.all(n).then(Ke);
      }
      fetchQuery(e) {
        const t = this.defaultQueryOptions(e);
        t.retry === void 0 && (t.retry = !1);
        const r = v(this, Te).build(this, t);
        return r.isStaleByTime(rs(t.staleTime, r)) ? r.fetch(t) : Promise.resolve(r.state.data);
      }
      prefetchQuery(e) {
        return this.fetchQuery(e).then(Ke).catch(Ke);
      }
      fetchInfiniteQuery(e) {
        return ((e.behavior = Ti(e.pages)), this.fetchQuery(e));
      }
      prefetchInfiniteQuery(e) {
        return this.fetchInfiniteQuery(e).then(Ke).catch(Ke);
      }
      ensureInfiniteQueryData(e) {
        return ((e.behavior = Ti(e.pages)), this.ensureQueryData(e));
      }
      resumePausedMutations() {
        return an.isOnline() ? v(this, Xt).resumePausedMutations() : Promise.resolve();
      }
      getQueryCache() {
        return v(this, Te);
      }
      getMutationCache() {
        return v(this, Xt);
      }
      getDefaultOptions() {
        return v(this, es);
      }
      setDefaultOptions(e) {
        Z(this, es, e);
      }
      setQueryDefaults(e, t) {
        v(this, Qs).set(Ss(e), { queryKey: e, defaultOptions: t });
      }
      getQueryDefaults(e) {
        const t = [...v(this, Qs).values()],
          r = {};
        return (
          t.forEach((n) => {
            xr(e, n.queryKey) && Object.assign(r, n.defaultOptions);
          }),
          r
        );
      }
      setMutationDefaults(e, t) {
        v(this, Js).set(Ss(e), { mutationKey: e, defaultOptions: t });
      }
      getMutationDefaults(e) {
        const t = [...v(this, Js).values()],
          r = {};
        return (
          t.forEach((n) => {
            xr(e, n.mutationKey) && Object.assign(r, n.defaultOptions);
          }),
          r
        );
      }
      defaultQueryOptions(e) {
        if (e._defaulted) return e;
        const t = {
          ...v(this, es).queries,
          ...this.getQueryDefaults(e.queryKey),
          ...e,
          _defaulted: !0,
        };
        return (
          t.queryHash || (t.queryHash = Pa(t.queryKey, t)),
          t.refetchOnReconnect === void 0 && (t.refetchOnReconnect = t.networkMode !== 'always'),
          t.throwOnError === void 0 && (t.throwOnError = !!t.suspense),
          !t.networkMode && t.persister && (t.networkMode = 'offlineFirst'),
          t.queryFn === za && (t.enabled = !1),
          t
        );
      }
      defaultMutationOptions(e) {
        return e != null && e._defaulted
          ? e
          : {
              ...v(this, es).mutations,
              ...((e == null ? void 0 : e.mutationKey) && this.getMutationDefaults(e.mutationKey)),
              ...e,
              _defaulted: !0,
            };
      }
      clear() {
        (v(this, Te).clear(), v(this, Xt).clear());
      }
    }),
    (Te = new WeakMap()),
    (Xt = new WeakMap()),
    (es = new WeakMap()),
    (Qs = new WeakMap()),
    (Js = new WeakMap()),
    (ts = new WeakMap()),
    (Xs = new WeakMap()),
    (er = new WeakMap()),
    xl),
  Ml = h.createContext(void 0),
  Sn = (e) => {
    const t = h.useContext(Ml);
    if (!t) throw new Error('No QueryClient set, use QueryClientProvider to set one');
    return t;
  },
  Hu = ({ client: e, children: t }) => (
    h.useEffect(
      () => (
        e.mount(),
        () => {
          e.unmount();
        }
      ),
      [e]
    ),
    s.jsx(Ml.Provider, { value: e, children: t })
  ),
  Pl = h.createContext(!1),
  Wu = () => h.useContext(Pl);
Pl.Provider;
function zl() {
  let e = !1;
  return {
    clearReset: () => {
      e = !1;
    },
    reset: () => {
      e = !0;
    },
    isReset: () => e,
  };
}
var Dl = h.createContext(zl()),
  Vu = () => h.useContext(Dl),
  Zu = ({ children: e }) => {
    const [t] = h.useState(() => zl());
    return s.jsx(Dl.Provider, {
      value: t,
      children: typeof e == 'function' ? e(t) : e,
    });
  },
  Yu = (e, t) => {
    (e.suspense || e.throwOnError || e.experimental_prefetchInRender) &&
      (t.isReset() || (e.retryOnMount = !1));
  },
  qu = (e) => {
    h.useEffect(() => {
      e.clearReset();
    }, [e]);
  },
  Ku = ({ result: e, errorResetBoundary: t, throwOnError: r, query: n, suspense: a }) =>
    e.isError &&
    !t.isReset() &&
    !e.isFetching &&
    n &&
    ((a && e.data === void 0) || Tl(r, [e.error, n])),
  Qu = (e) => {
    if (e.suspense) {
      const r = (a) => (a === 'static' ? a : Math.max(a ?? 1e3, 1e3)),
        n = e.staleTime;
      ((e.staleTime = typeof n == 'function' ? (...a) => r(n(...a)) : r(n)),
        typeof e.gcTime == 'number' && (e.gcTime = Math.max(e.gcTime, 1e3)));
    }
  },
  Ju = (e, t) => e.isLoading && e.isFetching && !t,
  Xu = (e, t) => (e == null ? void 0 : e.suspense) && t.isPending,
  Ci = (e, t, r) =>
    t.fetchOptimistic(e).catch(() => {
      r.clearReset();
    });
function em(e, t, r) {
  var u, x, f, g, b;
  const n = Wu(),
    a = Vu(),
    i = Sn(),
    o = i.defaultQueryOptions(e);
  ((x = (u = i.getDefaultOptions().queries) == null ? void 0 : u._experimental_beforeQuery) ==
    null || x.call(u, o),
    (o._optimisticResults = n ? 'isRestoring' : 'optimistic'),
    Qu(o),
    Yu(o, a),
    qu(a));
  const l = !i.getQueryCache().get(o.queryHash),
    [c] = h.useState(() => new t(i, o)),
    d = c.getOptimisticResult(o),
    m = !n && e.subscribed !== !1;
  if (
    (h.useSyncExternalStore(
      h.useCallback(
        (y) => {
          const p = m ? c.subscribe(Oe.batchCalls(y)) : Ke;
          return (c.updateResult(), p);
        },
        [c, m]
      ),
      () => c.getCurrentResult(),
      () => c.getCurrentResult()
    ),
    h.useEffect(() => {
      c.setOptions(o);
    }, [o, c]),
    Xu(o, d))
  )
    throw Ci(o, c, a);
  if (
    Ku({
      result: d,
      errorResetBoundary: a,
      throwOnError: o.throwOnError,
      query: i.getQueryCache().get(o.queryHash),
      suspense: o.suspense,
    })
  )
    throw d.error;
  if (
    ((g = (f = i.getDefaultOptions().queries) == null ? void 0 : f._experimental_afterQuery) ==
      null || g.call(f, o, d),
    o.experimental_prefetchInRender && !ks && Ju(d, n))
  ) {
    const y = l
      ? Ci(o, c, a)
      : (b = i.getQueryCache().get(o.queryHash)) == null
        ? void 0
        : b.promise;
    y == null ||
      y.catch(Ke).finally(() => {
        c.updateResult();
      });
  }
  return o.notifyOnChangeProps ? d : c.trackResult(d);
}
function $a(e, t) {
  return em(e, Mu);
}
function dr(e, t) {
  const r = Sn(),
    [n] = h.useState(() => new Uu(r, e));
  h.useEffect(() => {
    n.setOptions(e);
  }, [n, e]);
  const a = h.useSyncExternalStore(
      h.useCallback((o) => n.subscribe(Oe.batchCalls(o)), [n]),
      () => n.getCurrentResult(),
      () => n.getCurrentResult()
    ),
    i = h.useCallback(
      (o, l) => {
        n.mutate(o, l).catch(Ke);
      },
      [n]
    );
  if (a.error && Tl(n.options.throwOnError, [a.error])) throw a.error;
  return { ...a, mutate: i, mutateAsync: a.mutate };
}
const tm = 'modulepreload',
  sm = function (e) {
    return '/maihouses/' + e;
  },
  Ai = {},
  rm = function (t, r, n) {
    let a = Promise.resolve();
    if (r && r.length > 0) {
      document.getElementsByTagName('link');
      const o = document.querySelector('meta[property=csp-nonce]'),
        l = (o == null ? void 0 : o.nonce) || (o == null ? void 0 : o.getAttribute('nonce'));
      a = Promise.allSettled(
        r.map((c) => {
          if (((c = sm(c)), c in Ai)) return;
          Ai[c] = !0;
          const d = c.endsWith('.css'),
            m = d ? '[rel="stylesheet"]' : '';
          if (document.querySelector(`link[href="${c}"]${m}`)) return;
          const u = document.createElement('link');
          if (
            ((u.rel = d ? 'stylesheet' : tm),
            d || (u.as = 'script'),
            (u.crossOrigin = ''),
            (u.href = c),
            l && u.setAttribute('nonce', l),
            document.head.appendChild(u),
            d)
          )
            return new Promise((x, f) => {
              (u.addEventListener('load', x),
                u.addEventListener('error', () => f(new Error(`Unable to preload CSS for ${c}`))));
            });
        })
      );
    }
    function i(o) {
      const l = new Event('vite:preloadError', { cancelable: !0 });
      if (((l.payload = o), window.dispatchEvent(l), !l.defaultPrevented)) throw o;
    }
    return a.then((o) => {
      for (const l of o || []) l.status === 'rejected' && i(l.reason);
      return t().catch(i);
    });
  };
function nm(e) {
  if (typeof document > 'u') return;
  let t = document.head || document.getElementsByTagName('head')[0],
    r = document.createElement('style');
  ((r.type = 'text/css'),
    t.appendChild(r),
    r.styleSheet ? (r.styleSheet.cssText = e) : r.appendChild(document.createTextNode(e)));
}
const am = (e) => {
    switch (e) {
      case 'success':
        return lm;
      case 'info':
        return dm;
      case 'warning':
        return cm;
      case 'error':
        return um;
      default:
        return null;
    }
  },
  im = Array(12).fill(0),
  om = ({ visible: e, className: t }) =>
    F.createElement(
      'div',
      {
        className: ['sonner-loading-wrapper', t].filter(Boolean).join(' '),
        'data-visible': e,
      },
      F.createElement(
        'div',
        { className: 'sonner-spinner' },
        im.map((r, n) =>
          F.createElement('div', {
            className: 'sonner-loading-bar',
            key: `spinner-bar-${n}`,
          })
        )
      )
    ),
  lm = F.createElement(
    'svg',
    {
      xmlns: 'http://www.w3.org/2000/svg',
      viewBox: '0 0 20 20',
      fill: 'currentColor',
      height: '20',
      width: '20',
    },
    F.createElement('path', {
      fillRule: 'evenodd',
      d: 'M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z',
      clipRule: 'evenodd',
    })
  ),
  cm = F.createElement(
    'svg',
    {
      xmlns: 'http://www.w3.org/2000/svg',
      viewBox: '0 0 24 24',
      fill: 'currentColor',
      height: '20',
      width: '20',
    },
    F.createElement('path', {
      fillRule: 'evenodd',
      d: 'M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z',
      clipRule: 'evenodd',
    })
  ),
  dm = F.createElement(
    'svg',
    {
      xmlns: 'http://www.w3.org/2000/svg',
      viewBox: '0 0 20 20',
      fill: 'currentColor',
      height: '20',
      width: '20',
    },
    F.createElement('path', {
      fillRule: 'evenodd',
      d: 'M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z',
      clipRule: 'evenodd',
    })
  ),
  um = F.createElement(
    'svg',
    {
      xmlns: 'http://www.w3.org/2000/svg',
      viewBox: '0 0 20 20',
      fill: 'currentColor',
      height: '20',
      width: '20',
    },
    F.createElement('path', {
      fillRule: 'evenodd',
      d: 'M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z',
      clipRule: 'evenodd',
    })
  ),
  mm = F.createElement(
    'svg',
    {
      xmlns: 'http://www.w3.org/2000/svg',
      width: '12',
      height: '12',
      viewBox: '0 0 24 24',
      fill: 'none',
      stroke: 'currentColor',
      strokeWidth: '1.5',
      strokeLinecap: 'round',
      strokeLinejoin: 'round',
    },
    F.createElement('line', { x1: '18', y1: '6', x2: '6', y2: '18' }),
    F.createElement('line', { x1: '6', y1: '6', x2: '18', y2: '18' })
  ),
  hm = () => {
    const [e, t] = F.useState(document.hidden);
    return (
      F.useEffect(() => {
        const r = () => {
          t(document.hidden);
        };
        return (
          document.addEventListener('visibilitychange', r),
          () => window.removeEventListener('visibilitychange', r)
        );
      }, []),
      e
    );
  };
let xa = 1;
class fm {
  constructor() {
    ((this.subscribe = (t) => (
      this.subscribers.push(t),
      () => {
        const r = this.subscribers.indexOf(t);
        this.subscribers.splice(r, 1);
      }
    )),
      (this.publish = (t) => {
        this.subscribers.forEach((r) => r(t));
      }),
      (this.addToast = (t) => {
        (this.publish(t), (this.toasts = [...this.toasts, t]));
      }),
      (this.create = (t) => {
        var r;
        const { message: n, ...a } = t,
          i =
            typeof (t == null ? void 0 : t.id) == 'number' ||
            ((r = t.id) == null ? void 0 : r.length) > 0
              ? t.id
              : xa++,
          o = this.toasts.find((c) => c.id === i),
          l = t.dismissible === void 0 ? !0 : t.dismissible;
        return (
          this.dismissedToasts.has(i) && this.dismissedToasts.delete(i),
          o
            ? (this.toasts = this.toasts.map((c) =>
                c.id === i
                  ? (this.publish({ ...c, ...t, id: i, title: n }),
                    { ...c, ...t, id: i, dismissible: l, title: n })
                  : c
              ))
            : this.addToast({ title: n, ...a, dismissible: l, id: i }),
          i
        );
      }),
      (this.dismiss = (t) => (
        t
          ? (this.dismissedToasts.add(t),
            requestAnimationFrame(() => this.subscribers.forEach((r) => r({ id: t, dismiss: !0 }))))
          : this.toasts.forEach((r) => {
              this.subscribers.forEach((n) => n({ id: r.id, dismiss: !0 }));
            }),
        t
      )),
      (this.message = (t, r) => this.create({ ...r, message: t })),
      (this.error = (t, r) => this.create({ ...r, message: t, type: 'error' })),
      (this.success = (t, r) => this.create({ ...r, type: 'success', message: t })),
      (this.info = (t, r) => this.create({ ...r, type: 'info', message: t })),
      (this.warning = (t, r) => this.create({ ...r, type: 'warning', message: t })),
      (this.loading = (t, r) => this.create({ ...r, type: 'loading', message: t })),
      (this.promise = (t, r) => {
        if (!r) return;
        let n;
        r.loading !== void 0 &&
          (n = this.create({
            ...r,
            promise: t,
            type: 'loading',
            message: r.loading,
            description: typeof r.description != 'function' ? r.description : void 0,
          }));
        const a = Promise.resolve(t instanceof Function ? t() : t);
        let i = n !== void 0,
          o;
        const l = a
            .then(async (d) => {
              if (((o = ['resolve', d]), F.isValidElement(d)))
                ((i = !1), this.create({ id: n, type: 'default', message: d }));
              else if (xm(d) && !d.ok) {
                i = !1;
                const u =
                    typeof r.error == 'function'
                      ? await r.error(`HTTP error! status: ${d.status}`)
                      : r.error,
                  x =
                    typeof r.description == 'function'
                      ? await r.description(`HTTP error! status: ${d.status}`)
                      : r.description,
                  g = typeof u == 'object' && !F.isValidElement(u) ? u : { message: u };
                this.create({ id: n, type: 'error', description: x, ...g });
              } else if (d instanceof Error) {
                i = !1;
                const u = typeof r.error == 'function' ? await r.error(d) : r.error,
                  x = typeof r.description == 'function' ? await r.description(d) : r.description,
                  g = typeof u == 'object' && !F.isValidElement(u) ? u : { message: u };
                this.create({ id: n, type: 'error', description: x, ...g });
              } else if (r.success !== void 0) {
                i = !1;
                const u = typeof r.success == 'function' ? await r.success(d) : r.success,
                  x = typeof r.description == 'function' ? await r.description(d) : r.description,
                  g = typeof u == 'object' && !F.isValidElement(u) ? u : { message: u };
                this.create({ id: n, type: 'success', description: x, ...g });
              }
            })
            .catch(async (d) => {
              if (((o = ['reject', d]), r.error !== void 0)) {
                i = !1;
                const m = typeof r.error == 'function' ? await r.error(d) : r.error,
                  u = typeof r.description == 'function' ? await r.description(d) : r.description,
                  f = typeof m == 'object' && !F.isValidElement(m) ? m : { message: m };
                this.create({ id: n, type: 'error', description: u, ...f });
              }
            })
            .finally(() => {
              (i && (this.dismiss(n), (n = void 0)), r.finally == null || r.finally.call(r));
            }),
          c = () =>
            new Promise((d, m) => l.then(() => (o[0] === 'reject' ? m(o[1]) : d(o[1]))).catch(m));
        return typeof n != 'string' && typeof n != 'number'
          ? { unwrap: c }
          : Object.assign(n, { unwrap: c });
      }),
      (this.custom = (t, r) => {
        const n = (r == null ? void 0 : r.id) || xa++;
        return (this.create({ jsx: t(n), id: n, ...r }), n);
      }),
      (this.getActiveToasts = () => this.toasts.filter((t) => !this.dismissedToasts.has(t.id))),
      (this.subscribers = []),
      (this.toasts = []),
      (this.dismissedToasts = new Set()));
  }
}
const tt = new fm(),
  pm = (e, t) => {
    const r = (t == null ? void 0 : t.id) || xa++;
    return (tt.addToast({ title: e, ...t, id: r }), r);
  },
  xm = (e) =>
    e &&
    typeof e == 'object' &&
    'ok' in e &&
    typeof e.ok == 'boolean' &&
    'status' in e &&
    typeof e.status == 'number',
  gm = pm,
  bm = () => tt.toasts,
  ym = () => tt.getActiveToasts(),
  ds = Object.assign(
    gm,
    {
      success: tt.success,
      info: tt.info,
      warning: tt.warning,
      error: tt.error,
      custom: tt.custom,
      message: tt.message,
      promise: tt.promise,
      dismiss: tt.dismiss,
      loading: tt.loading,
    },
    { getHistory: bm, getToasts: ym }
  );
nm(
  "[data-sonner-toaster][dir=ltr],html[dir=ltr]{--toast-icon-margin-start:-3px;--toast-icon-margin-end:4px;--toast-svg-margin-start:-1px;--toast-svg-margin-end:0px;--toast-button-margin-start:auto;--toast-button-margin-end:0;--toast-close-button-start:0;--toast-close-button-end:unset;--toast-close-button-transform:translate(-35%, -35%)}[data-sonner-toaster][dir=rtl],html[dir=rtl]{--toast-icon-margin-start:4px;--toast-icon-margin-end:-3px;--toast-svg-margin-start:0px;--toast-svg-margin-end:-1px;--toast-button-margin-start:0;--toast-button-margin-end:auto;--toast-close-button-start:unset;--toast-close-button-end:0;--toast-close-button-transform:translate(35%, -35%)}[data-sonner-toaster]{position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1:hsl(0, 0%, 99%);--gray2:hsl(0, 0%, 97.3%);--gray3:hsl(0, 0%, 95.1%);--gray4:hsl(0, 0%, 93%);--gray5:hsl(0, 0%, 90.9%);--gray6:hsl(0, 0%, 88.7%);--gray7:hsl(0, 0%, 85.8%);--gray8:hsl(0, 0%, 78%);--gray9:hsl(0, 0%, 56.1%);--gray10:hsl(0, 0%, 52.3%);--gray11:hsl(0, 0%, 43.5%);--gray12:hsl(0, 0%, 9%);--border-radius:8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:0;z-index:999999999;transition:transform .4s ease}@media (hover:none) and (pointer:coarse){[data-sonner-toaster][data-lifted=true]{transform:none}}[data-sonner-toaster][data-x-position=right]{right:var(--offset-right)}[data-sonner-toaster][data-x-position=left]{left:var(--offset-left)}[data-sonner-toaster][data-x-position=center]{left:50%;transform:translateX(-50%)}[data-sonner-toaster][data-y-position=top]{top:var(--offset-top)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--offset-bottom)}[data-sonner-toast]{--y:translateY(100%);--lift-amount:calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:0;overflow-wrap:anywhere}[data-sonner-toast][data-styled=true]{padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px rgba(0,0,0,.1);width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}[data-sonner-toast]:focus-visible{box-shadow:0 4px 12px rgba(0,0,0,.1),0 0 0 2px rgba(0,0,0,.2)}[data-sonner-toast][data-y-position=top]{top:0;--y:translateY(-100%);--lift:1;--lift-amount:calc(1 * var(--gap))}[data-sonner-toast][data-y-position=bottom]{bottom:0;--y:translateY(100%);--lift:-1;--lift-amount:calc(var(--lift) * var(--gap))}[data-sonner-toast][data-styled=true] [data-description]{font-weight:400;line-height:1.4;color:#3f3f3f}[data-rich-colors=true][data-sonner-toast][data-styled=true] [data-description]{color:inherit}[data-sonner-toaster][data-sonner-theme=dark] [data-description]{color:#e8e8e8}[data-sonner-toast][data-styled=true] [data-title]{font-weight:500;line-height:1.5;color:inherit}[data-sonner-toast][data-styled=true] [data-icon]{display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}[data-sonner-toast][data-promise=true] [data-icon]>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}[data-sonner-toast][data-styled=true] [data-icon]>*{flex-shrink:0}[data-sonner-toast][data-styled=true] [data-icon] svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}[data-sonner-toast][data-styled=true] [data-content]{display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;font-weight:500;cursor:pointer;outline:0;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}[data-sonner-toast][data-styled=true] [data-button]:focus-visible{box-shadow:0 0 0 2px rgba(0,0,0,.4)}[data-sonner-toast][data-styled=true] [data-button]:first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}[data-sonner-toast][data-styled=true] [data-cancel]{color:var(--normal-text);background:rgba(0,0,0,.08)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast][data-styled=true] [data-cancel]{background:rgba(255,255,255,.3)}[data-sonner-toast][data-styled=true] [data-close-button]{position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);background:var(--normal-bg);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast][data-styled=true] [data-close-button]:focus-visible{box-shadow:0 4px 12px rgba(0,0,0,.1),0 0 0 2px rgba(0,0,0,.2)}[data-sonner-toast][data-styled=true] [data-disabled=true]{cursor:not-allowed}[data-sonner-toast][data-styled=true]:hover [data-close-button]:hover{background:var(--gray2);border-color:var(--gray5)}[data-sonner-toast][data-swiping=true]::before{content:'';position:absolute;left:-100%;right:-100%;height:100%;z-index:-1}[data-sonner-toast][data-y-position=top][data-swiping=true]::before{bottom:50%;transform:scaleY(3) translateY(50%)}[data-sonner-toast][data-y-position=bottom][data-swiping=true]::before{top:50%;transform:scaleY(3) translateY(-50%)}[data-sonner-toast][data-swiping=false][data-removed=true]::before{content:'';position:absolute;inset:0;transform:scaleY(2)}[data-sonner-toast][data-expanded=true]::after{content:'';position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}[data-sonner-toast][data-mounted=true]{--y:translateY(0);opacity:1}[data-sonner-toast][data-expanded=false][data-front=false]{--scale:var(--toasts-before) * 0.05 + 1;--y:translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}[data-sonner-toast]>*{transition:opacity .4s}[data-sonner-toast][data-x-position=right]{right:0}[data-sonner-toast][data-x-position=left]{left:0}[data-sonner-toast][data-expanded=false][data-front=false][data-styled=true]>*{opacity:0}[data-sonner-toast][data-visible=false]{opacity:0;pointer-events:none}[data-sonner-toast][data-mounted=true][data-expanded=true]{--y:translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}[data-sonner-toast][data-removed=true][data-front=true][data-swipe-out=false]{--y:translateY(calc(var(--lift) * -100%));opacity:0}[data-sonner-toast][data-removed=true][data-front=false][data-swipe-out=false][data-expanded=true]{--y:translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}[data-sonner-toast][data-removed=true][data-front=false][data-swipe-out=false][data-expanded=false]{--y:translateY(40%);opacity:0;transition:transform .5s,opacity .2s}[data-sonner-toast][data-removed=true][data-front=false]::before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y,0)) translateX(var(--swipe-amount-x,0));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{from{transform:var(--y) translateX(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translateX(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{from{transform:var(--y) translateX(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translateX(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{from{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{from{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width:600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-sonner-theme=light]{--normal-bg:#fff;--normal-border:var(--gray4);--normal-text:var(--gray12);--success-bg:hsl(143, 85%, 96%);--success-border:hsl(145, 92%, 87%);--success-text:hsl(140, 100%, 27%);--info-bg:hsl(208, 100%, 97%);--info-border:hsl(221, 91%, 93%);--info-text:hsl(210, 92%, 45%);--warning-bg:hsl(49, 100%, 97%);--warning-border:hsl(49, 91%, 84%);--warning-text:hsl(31, 92%, 45%);--error-bg:hsl(359, 100%, 97%);--error-border:hsl(359, 100%, 94%);--error-text:hsl(360, 100%, 45%)}[data-sonner-toaster][data-sonner-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg:#000;--normal-border:hsl(0, 0%, 20%);--normal-text:var(--gray1)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg:#fff;--normal-border:var(--gray3);--normal-text:var(--gray12)}[data-sonner-toaster][data-sonner-theme=dark]{--normal-bg:#000;--normal-bg-hover:hsl(0, 0%, 12%);--normal-border:hsl(0, 0%, 20%);--normal-border-hover:hsl(0, 0%, 25%);--normal-text:var(--gray1);--success-bg:hsl(150, 100%, 6%);--success-border:hsl(147, 100%, 12%);--success-text:hsl(150, 86%, 65%);--info-bg:hsl(215, 100%, 6%);--info-border:hsl(223, 43%, 17%);--info-text:hsl(216, 87%, 65%);--warning-bg:hsl(64, 100%, 6%);--warning-border:hsl(60, 100%, 9%);--warning-text:hsl(46, 87%, 65%);--error-bg:hsl(358, 76%, 10%);--error-border:hsl(357, 89%, 16%);--error-text:hsl(358, 100%, 81%)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size:16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:first-child{animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}100%{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}100%{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}100%{opacity:.15}}@media (prefers-reduced-motion){.sonner-loading-bar,[data-sonner-toast],[data-sonner-toast]>*{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}"
);
function $r(e) {
  return e.label !== void 0;
}
const vm = 3,
  jm = '24px',
  wm = '16px',
  Li = 4e3,
  Nm = 356,
  _m = 14,
  km = 45,
  Sm = 200;
function _t(...e) {
  return e.filter(Boolean).join(' ');
}
function Em(e) {
  const [t, r] = e.split('-'),
    n = [];
  return (t && n.push(t), r && n.push(r), n);
}
const Tm = (e) => {
  var t, r, n, a, i, o, l, c, d;
  const {
      invert: m,
      toast: u,
      unstyled: x,
      interacting: f,
      setHeights: g,
      visibleToasts: b,
      heights: y,
      index: p,
      toasts: E,
      expanded: S,
      removeToast: N,
      defaultRichColors: k,
      closeButton: T,
      style: C,
      cancelButtonStyle: w,
      actionButtonStyle: G,
      className: j = '',
      descriptionClassName: _ = '',
      duration: D,
      position: V,
      gap: se,
      expandByDefault: I,
      classNames: A,
      icons: z,
      closeButtonAriaLabel: O = 'Close toast',
    } = e,
    [re, ae] = F.useState(null),
    [R, ee] = F.useState(null),
    [$, J] = F.useState(!1),
    [Y, oe] = F.useState(!1),
    [U, q] = F.useState(!1),
    [ue, B] = F.useState(!1),
    [ie, fe] = F.useState(!1),
    [At, ls] = F.useState(0),
    [An, Rr] = F.useState(0),
    X = F.useRef(u.duration || D || Li),
    ge = F.useRef(null),
    ke = F.useRef(null),
    ye = p === 0,
    Ve = p + 1 <= b,
    Ie = u.type,
    Nt = u.dismissible !== !1,
    Ln = u.className || '',
    Ed = u.descriptionClassName || '',
    Mr = F.useMemo(() => y.findIndex((le) => le.toastId === u.id) || 0, [y, u.id]),
    Td = F.useMemo(() => {
      var le;
      return (le = u.closeButton) != null ? le : T;
    }, [u.closeButton, T]),
    oi = F.useMemo(() => u.duration || D || Li, [u.duration, D]),
    On = F.useRef(0),
    Ls = F.useRef(0),
    li = F.useRef(0),
    Os = F.useRef(null),
    [Id, Cd] = V.split('-'),
    ci = F.useMemo(() => y.reduce((le, Re, $e) => ($e >= Mr ? le : le + Re.height), 0), [y, Mr]),
    di = hm(),
    Ad = u.invert || m,
    Rn = Ie === 'loading';
  ((Ls.current = F.useMemo(() => Mr * se + ci, [Mr, ci])),
    F.useEffect(() => {
      X.current = oi;
    }, [oi]),
    F.useEffect(() => {
      J(!0);
    }, []),
    F.useEffect(() => {
      const le = ke.current;
      if (le) {
        const Re = le.getBoundingClientRect().height;
        return (
          Rr(Re),
          g(($e) => [{ toastId: u.id, height: Re, position: u.position }, ...$e]),
          () => g(($e) => $e.filter((it) => it.toastId !== u.id))
        );
      }
    }, [g, u.id]),
    F.useLayoutEffect(() => {
      if (!$) return;
      const le = ke.current,
        Re = le.style.height;
      le.style.height = 'auto';
      const $e = le.getBoundingClientRect().height;
      ((le.style.height = Re),
        Rr($e),
        g((it) =>
          it.find((Pe) => Pe.toastId === u.id)
            ? it.map((Pe) => (Pe.toastId === u.id ? { ...Pe, height: $e } : Pe))
            : [{ toastId: u.id, height: $e, position: u.position }, ...it]
        ));
    }, [$, u.title, u.description, g, u.id, u.jsx, u.action, u.cancel]));
  const Bt = F.useCallback(() => {
    (oe(!0),
      ls(Ls.current),
      g((le) => le.filter((Re) => Re.toastId !== u.id)),
      setTimeout(() => {
        N(u);
      }, Sm));
  }, [u, N, g, Ls]);
  (F.useEffect(() => {
    if ((u.promise && Ie === 'loading') || u.duration === 1 / 0 || u.type === 'loading') return;
    let le;
    return (
      S || f || di
        ? (() => {
            if (li.current < On.current) {
              const it = new Date().getTime() - On.current;
              X.current = X.current - it;
            }
            li.current = new Date().getTime();
          })()
        : (() => {
            X.current !== 1 / 0 &&
              ((On.current = new Date().getTime()),
              (le = setTimeout(() => {
                (u.onAutoClose == null || u.onAutoClose.call(u, u), Bt());
              }, X.current)));
          })(),
      () => clearTimeout(le)
    );
  }, [S, f, u, Ie, di, Bt]),
    F.useEffect(() => {
      u.delete && (Bt(), u.onDismiss == null || u.onDismiss.call(u, u));
    }, [Bt, u.delete]));
  function Ld() {
    var le;
    if (z != null && z.loading) {
      var Re;
      return F.createElement(
        'div',
        {
          className: _t(
            A == null ? void 0 : A.loader,
            u == null || (Re = u.classNames) == null ? void 0 : Re.loader,
            'sonner-loader'
          ),
          'data-visible': Ie === 'loading',
        },
        z.loading
      );
    }
    return F.createElement(om, {
      className: _t(
        A == null ? void 0 : A.loader,
        u == null || (le = u.classNames) == null ? void 0 : le.loader
      ),
      visible: Ie === 'loading',
    });
  }
  const Od = u.icon || (z == null ? void 0 : z[Ie]) || am(Ie);
  var ui, mi;
  return F.createElement(
    'li',
    {
      tabIndex: 0,
      ref: ke,
      className: _t(
        j,
        Ln,
        A == null ? void 0 : A.toast,
        u == null || (t = u.classNames) == null ? void 0 : t.toast,
        A == null ? void 0 : A.default,
        A == null ? void 0 : A[Ie],
        u == null || (r = u.classNames) == null ? void 0 : r[Ie]
      ),
      'data-sonner-toast': '',
      'data-rich-colors': (ui = u.richColors) != null ? ui : k,
      'data-styled': !(u.jsx || u.unstyled || x),
      'data-mounted': $,
      'data-promise': !!u.promise,
      'data-swiped': ie,
      'data-removed': Y,
      'data-visible': Ve,
      'data-y-position': Id,
      'data-x-position': Cd,
      'data-index': p,
      'data-front': ye,
      'data-swiping': U,
      'data-dismissible': Nt,
      'data-type': Ie,
      'data-invert': Ad,
      'data-swipe-out': ue,
      'data-swipe-direction': R,
      'data-expanded': !!(S || (I && $)),
      'data-testid': u.testId,
      style: {
        '--index': p,
        '--toasts-before': p,
        '--z-index': E.length - p,
        '--offset': `${Y ? At : Ls.current}px`,
        '--initial-height': I ? 'auto' : `${An}px`,
        ...C,
        ...u.style,
      },
      onDragEnd: () => {
        (q(!1), ae(null), (Os.current = null));
      },
      onPointerDown: (le) => {
        le.button !== 2 &&
          (Rn ||
            !Nt ||
            ((ge.current = new Date()),
            ls(Ls.current),
            le.target.setPointerCapture(le.pointerId),
            le.target.tagName !== 'BUTTON' &&
              (q(!0), (Os.current = { x: le.clientX, y: le.clientY }))));
      },
      onPointerUp: () => {
        var le, Re, $e;
        if (ue || !Nt) return;
        Os.current = null;
        const it = Number(
            ((le = ke.current) == null
              ? void 0
              : le.style.getPropertyValue('--swipe-amount-x').replace('px', '')) || 0
          ),
          Pr = Number(
            ((Re = ke.current) == null
              ? void 0
              : Re.style.getPropertyValue('--swipe-amount-y').replace('px', '')) || 0
          ),
          Pe = new Date().getTime() - (($e = ge.current) == null ? void 0 : $e.getTime()),
          ct = re === 'x' ? it : Pr,
          zr = Math.abs(ct) / Pe;
        if (Math.abs(ct) >= km || zr > 0.11) {
          (ls(Ls.current),
            u.onDismiss == null || u.onDismiss.call(u, u),
            ee(re === 'x' ? (it > 0 ? 'right' : 'left') : Pr > 0 ? 'down' : 'up'),
            Bt(),
            B(!0));
          return;
        } else {
          var xt, gt;
          ((xt = ke.current) == null || xt.style.setProperty('--swipe-amount-x', '0px'),
            (gt = ke.current) == null || gt.style.setProperty('--swipe-amount-y', '0px'));
        }
        (fe(!1), q(!1), ae(null));
      },
      onPointerMove: (le) => {
        var Re, $e, it;
        if (
          !Os.current ||
          !Nt ||
          ((Re = window.getSelection()) == null ? void 0 : Re.toString().length) > 0
        )
          return;
        const Pe = le.clientY - Os.current.y,
          ct = le.clientX - Os.current.x;
        var zr;
        const xt = (zr = e.swipeDirections) != null ? zr : Em(V);
        !re &&
          (Math.abs(ct) > 1 || Math.abs(Pe) > 1) &&
          ae(Math.abs(ct) > Math.abs(Pe) ? 'x' : 'y');
        let gt = { x: 0, y: 0 };
        const hi = (cs) => 1 / (1.5 + Math.abs(cs) / 20);
        if (re === 'y') {
          if (xt.includes('top') || xt.includes('bottom'))
            if ((xt.includes('top') && Pe < 0) || (xt.includes('bottom') && Pe > 0)) gt.y = Pe;
            else {
              const cs = Pe * hi(Pe);
              gt.y = Math.abs(cs) < Math.abs(Pe) ? cs : Pe;
            }
        } else if (re === 'x' && (xt.includes('left') || xt.includes('right')))
          if ((xt.includes('left') && ct < 0) || (xt.includes('right') && ct > 0)) gt.x = ct;
          else {
            const cs = ct * hi(ct);
            gt.x = Math.abs(cs) < Math.abs(ct) ? cs : ct;
          }
        ((Math.abs(gt.x) > 0 || Math.abs(gt.y) > 0) && fe(!0),
          ($e = ke.current) == null || $e.style.setProperty('--swipe-amount-x', `${gt.x}px`),
          (it = ke.current) == null || it.style.setProperty('--swipe-amount-y', `${gt.y}px`));
      },
    },
    Td && !u.jsx && Ie !== 'loading'
      ? F.createElement(
          'button',
          {
            'aria-label': O,
            'data-disabled': Rn,
            'data-close-button': !0,
            onClick:
              Rn || !Nt
                ? () => {}
                : () => {
                    (Bt(), u.onDismiss == null || u.onDismiss.call(u, u));
                  },
            className: _t(
              A == null ? void 0 : A.closeButton,
              u == null || (n = u.classNames) == null ? void 0 : n.closeButton
            ),
          },
          (mi = z == null ? void 0 : z.close) != null ? mi : mm
        )
      : null,
    (Ie || u.icon || u.promise) &&
      u.icon !== null &&
      ((z == null ? void 0 : z[Ie]) !== null || u.icon)
      ? F.createElement(
          'div',
          {
            'data-icon': '',
            className: _t(
              A == null ? void 0 : A.icon,
              u == null || (a = u.classNames) == null ? void 0 : a.icon
            ),
          },
          u.promise || (u.type === 'loading' && !u.icon) ? u.icon || Ld() : null,
          u.type !== 'loading' ? Od : null
        )
      : null,
    F.createElement(
      'div',
      {
        'data-content': '',
        className: _t(
          A == null ? void 0 : A.content,
          u == null || (i = u.classNames) == null ? void 0 : i.content
        ),
      },
      F.createElement(
        'div',
        {
          'data-title': '',
          className: _t(
            A == null ? void 0 : A.title,
            u == null || (o = u.classNames) == null ? void 0 : o.title
          ),
        },
        u.jsx ? u.jsx : typeof u.title == 'function' ? u.title() : u.title
      ),
      u.description
        ? F.createElement(
            'div',
            {
              'data-description': '',
              className: _t(
                _,
                Ed,
                A == null ? void 0 : A.description,
                u == null || (l = u.classNames) == null ? void 0 : l.description
              ),
            },
            typeof u.description == 'function' ? u.description() : u.description
          )
        : null
    ),
    F.isValidElement(u.cancel)
      ? u.cancel
      : u.cancel && $r(u.cancel)
        ? F.createElement(
            'button',
            {
              'data-button': !0,
              'data-cancel': !0,
              style: u.cancelButtonStyle || w,
              onClick: (le) => {
                $r(u.cancel) &&
                  Nt &&
                  (u.cancel.onClick == null || u.cancel.onClick.call(u.cancel, le), Bt());
              },
              className: _t(
                A == null ? void 0 : A.cancelButton,
                u == null || (c = u.classNames) == null ? void 0 : c.cancelButton
              ),
            },
            u.cancel.label
          )
        : null,
    F.isValidElement(u.action)
      ? u.action
      : u.action && $r(u.action)
        ? F.createElement(
            'button',
            {
              'data-button': !0,
              'data-action': !0,
              style: u.actionButtonStyle || G,
              onClick: (le) => {
                $r(u.action) &&
                  (u.action.onClick == null || u.action.onClick.call(u.action, le),
                  !le.defaultPrevented && Bt());
              },
              className: _t(
                A == null ? void 0 : A.actionButton,
                u == null || (d = u.classNames) == null ? void 0 : d.actionButton
              ),
            },
            u.action.label
          )
        : null
  );
};
function Oi() {
  if (typeof window > 'u' || typeof document > 'u') return 'ltr';
  const e = document.documentElement.getAttribute('dir');
  return e === 'auto' || !e ? window.getComputedStyle(document.documentElement).direction : e;
}
function Im(e, t) {
  const r = {};
  return (
    [e, t].forEach((n, a) => {
      const i = a === 1,
        o = i ? '--mobile-offset' : '--offset',
        l = i ? wm : jm;
      function c(d) {
        ['top', 'right', 'bottom', 'left'].forEach((m) => {
          r[`${o}-${m}`] = typeof d == 'number' ? `${d}px` : d;
        });
      }
      typeof n == 'number' || typeof n == 'string'
        ? c(n)
        : typeof n == 'object'
          ? ['top', 'right', 'bottom', 'left'].forEach((d) => {
              n[d] === void 0
                ? (r[`${o}-${d}`] = l)
                : (r[`${o}-${d}`] = typeof n[d] == 'number' ? `${n[d]}px` : n[d]);
            })
          : c(l);
    }),
    r
  );
}
const Cm = F.forwardRef(function (t, r) {
    const {
        id: n,
        invert: a,
        position: i = 'bottom-right',
        hotkey: o = ['altKey', 'KeyT'],
        expand: l,
        closeButton: c,
        className: d,
        offset: m,
        mobileOffset: u,
        theme: x = 'light',
        richColors: f,
        duration: g,
        style: b,
        visibleToasts: y = vm,
        toastOptions: p,
        dir: E = Oi(),
        gap: S = _m,
        icons: N,
        containerAriaLabel: k = 'Notifications',
      } = t,
      [T, C] = F.useState([]),
      w = F.useMemo(
        () => (n ? T.filter(($) => $.toasterId === n) : T.filter(($) => !$.toasterId)),
        [T, n]
      ),
      G = F.useMemo(
        () => Array.from(new Set([i].concat(w.filter(($) => $.position).map(($) => $.position)))),
        [w, i]
      ),
      [j, _] = F.useState([]),
      [D, V] = F.useState(!1),
      [se, I] = F.useState(!1),
      [A, z] = F.useState(
        x !== 'system'
          ? x
          : typeof window < 'u' &&
              window.matchMedia &&
              window.matchMedia('(prefers-color-scheme: dark)').matches
            ? 'dark'
            : 'light'
      ),
      O = F.useRef(null),
      re = o.join('+').replace(/Key/g, '').replace(/Digit/g, ''),
      ae = F.useRef(null),
      R = F.useRef(!1),
      ee = F.useCallback(($) => {
        C((J) => {
          var Y;
          return (
            ((Y = J.find((oe) => oe.id === $.id)) != null && Y.delete) || tt.dismiss($.id),
            J.filter(({ id: oe }) => oe !== $.id)
          );
        });
      }, []);
    return (
      F.useEffect(
        () =>
          tt.subscribe(($) => {
            if ($.dismiss) {
              requestAnimationFrame(() => {
                C((J) => J.map((Y) => (Y.id === $.id ? { ...Y, delete: !0 } : Y)));
              });
              return;
            }
            setTimeout(() => {
              Md.flushSync(() => {
                C((J) => {
                  const Y = J.findIndex((oe) => oe.id === $.id);
                  return Y !== -1
                    ? [...J.slice(0, Y), { ...J[Y], ...$ }, ...J.slice(Y + 1)]
                    : [$, ...J];
                });
              });
            });
          }),
        [T]
      ),
      F.useEffect(() => {
        if (x !== 'system') {
          z(x);
          return;
        }
        if (
          (x === 'system' &&
            (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches
              ? z('dark')
              : z('light')),
          typeof window > 'u')
        )
          return;
        const $ = window.matchMedia('(prefers-color-scheme: dark)');
        try {
          $.addEventListener('change', ({ matches: J }) => {
            z(J ? 'dark' : 'light');
          });
        } catch {
          $.addListener(({ matches: Y }) => {
            try {
              z(Y ? 'dark' : 'light');
            } catch (oe) {
              console.error(oe);
            }
          });
        }
      }, [x]),
      F.useEffect(() => {
        T.length <= 1 && V(!1);
      }, [T]),
      F.useEffect(() => {
        const $ = (J) => {
          var Y;
          if (o.every((q) => J[q] || J.code === q)) {
            var U;
            (V(!0), (U = O.current) == null || U.focus());
          }
          J.code === 'Escape' &&
            (document.activeElement === O.current ||
              ((Y = O.current) != null && Y.contains(document.activeElement))) &&
            V(!1);
        };
        return (
          document.addEventListener('keydown', $),
          () => document.removeEventListener('keydown', $)
        );
      }, [o]),
      F.useEffect(() => {
        if (O.current)
          return () => {
            ae.current &&
              (ae.current.focus({ preventScroll: !0 }), (ae.current = null), (R.current = !1));
          };
      }, [O.current]),
      F.createElement(
        'section',
        {
          ref: r,
          'aria-label': `${k} ${re}`,
          tabIndex: -1,
          'aria-live': 'polite',
          'aria-relevant': 'additions text',
          'aria-atomic': 'false',
          suppressHydrationWarning: !0,
        },
        G.map(($, J) => {
          var Y;
          const [oe, U] = $.split('-');
          return w.length
            ? F.createElement(
                'ol',
                {
                  key: $,
                  dir: E === 'auto' ? Oi() : E,
                  tabIndex: -1,
                  ref: O,
                  className: d,
                  'data-sonner-toaster': !0,
                  'data-sonner-theme': A,
                  'data-y-position': oe,
                  'data-x-position': U,
                  style: {
                    '--front-toast-height': `${((Y = j[0]) == null ? void 0 : Y.height) || 0}px`,
                    '--width': `${Nm}px`,
                    '--gap': `${S}px`,
                    ...b,
                    ...Im(m, u),
                  },
                  onBlur: (q) => {
                    R.current &&
                      !q.currentTarget.contains(q.relatedTarget) &&
                      ((R.current = !1),
                      ae.current && (ae.current.focus({ preventScroll: !0 }), (ae.current = null)));
                  },
                  onFocus: (q) => {
                    (q.target instanceof HTMLElement && q.target.dataset.dismissible === 'false') ||
                      R.current ||
                      ((R.current = !0), (ae.current = q.relatedTarget));
                  },
                  onMouseEnter: () => V(!0),
                  onMouseMove: () => V(!0),
                  onMouseLeave: () => {
                    se || V(!1);
                  },
                  onDragEnd: () => V(!1),
                  onPointerDown: (q) => {
                    (q.target instanceof HTMLElement && q.target.dataset.dismissible === 'false') ||
                      I(!0);
                  },
                  onPointerUp: () => I(!1),
                },
                w
                  .filter((q) => (!q.position && J === 0) || q.position === $)
                  .map((q, ue) => {
                    var B, ie;
                    return F.createElement(Tm, {
                      key: q.id,
                      icons: N,
                      index: ue,
                      toast: q,
                      defaultRichColors: f,
                      duration: (B = p == null ? void 0 : p.duration) != null ? B : g,
                      className: p == null ? void 0 : p.className,
                      descriptionClassName: p == null ? void 0 : p.descriptionClassName,
                      invert: a,
                      visibleToasts: y,
                      closeButton: (ie = p == null ? void 0 : p.closeButton) != null ? ie : c,
                      interacting: se,
                      position: $,
                      style: p == null ? void 0 : p.style,
                      unstyled: p == null ? void 0 : p.unstyled,
                      classNames: p == null ? void 0 : p.classNames,
                      cancelButtonStyle: p == null ? void 0 : p.cancelButtonStyle,
                      actionButtonStyle: p == null ? void 0 : p.actionButtonStyle,
                      closeButtonAriaLabel: p == null ? void 0 : p.closeButtonAriaLabel,
                      removeToast: ee,
                      toasts: w.filter((fe) => fe.position == q.position),
                      heights: j.filter((fe) => fe.position == q.position),
                      setHeights: _,
                      expandByDefault: l,
                      gap: S,
                      expanded: D,
                      swipeDirections: t.swipeDirections,
                    });
                  })
              )
            : null;
        })
      )
    );
  }),
  Fl = 'maihouse_config';
async function Am(e) {
  return (await fetch(e)).json();
}
function Lm(e) {
  return (
    e &&
    typeof e == 'object' &&
    typeof e.apiBaseUrl == 'string' &&
    typeof e.appVersion == 'string' &&
    typeof e.minBackend == 'string' &&
    typeof e.features == 'object'
  );
}
async function Om() {
  try {
    const r = localStorage.getItem(Fl);
    if (r) {
      const n = JSON.parse(r);
      if (Lm(n)) return { ...n, ...$l() };
    }
  } catch {}
  const t = `${window.location.origin}/maihouses/app.config.json`;
  return Am(t);
}
function bt(e) {
  const t = new URLSearchParams(location.search).get(e),
    r = location.hash.indexOf('?');
  return (r > -1 ? new URLSearchParams(location.hash.slice(r)).get(e) : null) ?? t ?? void 0;
}
function $l() {
  const e = bt('slots'),
    t = e ? e.split(',').reduce((r, n) => ((r[n.trim()] = !0), r), {}) : void 0;
  return {
    apiBaseUrl: bt('api'),
    features: t,
    mock: bt('mock') ? bt('mock') === '1' : void 0,
    latency: bt('latency') ? +bt('latency') : void 0,
    error: bt('error') ? +bt('error') : void 0,
    q: bt('q'),
    devtools: bt('devtools'),
    mockSeed: bt('seed'),
  };
}
async function Ul() {
  const e = await Om(),
    t = $l(),
    r = {
      ...e,
      ...t,
      mock: t.mock ?? e.mock ?? !0,
      latency: t.latency ?? e.latency ?? 0,
      error: t.error ?? e.error ?? 0,
    };
  try {
    localStorage.setItem(Fl, JSON.stringify(r));
  } catch {}
  return r;
}
let Ur;
const Rm = new Uint8Array(16);
function Mm() {
  if (
    !Ur &&
    ((Ur = typeof crypto < 'u' && crypto.getRandomValues && crypto.getRandomValues.bind(crypto)),
    !Ur)
  )
    throw new Error(
      'crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported'
    );
  return Ur(Rm);
}
const ze = [];
for (let e = 0; e < 256; ++e) ze.push((e + 256).toString(16).slice(1));
function Pm(e, t = 0) {
  return (
    ze[e[t + 0]] +
    ze[e[t + 1]] +
    ze[e[t + 2]] +
    ze[e[t + 3]] +
    '-' +
    ze[e[t + 4]] +
    ze[e[t + 5]] +
    '-' +
    ze[e[t + 6]] +
    ze[e[t + 7]] +
    '-' +
    ze[e[t + 8]] +
    ze[e[t + 9]] +
    '-' +
    ze[e[t + 10]] +
    ze[e[t + 11]] +
    ze[e[t + 12]] +
    ze[e[t + 13]] +
    ze[e[t + 14]] +
    ze[e[t + 15]]
  );
}
const zm = typeof crypto < 'u' && crypto.randomUUID && crypto.randomUUID.bind(crypto),
  Ri = { randomUUID: zm };
function on(e, t, r) {
  if (Ri.randomUUID && !e) return Ri.randomUUID();
  e = e || {};
  const n = e.random || (e.rng || Mm)();
  return ((n[6] = (n[6] & 15) | 64), (n[8] = (n[8] & 63) | 128), Pm(n));
}
function rt(e, t) {
  try {
    console.debug('[track]', e, t || {});
  } catch {}
}
const nt = {
    QuietOn: 'user.needs_quiet_space',
    QuietOff: 'user.back_to_explore',
    QuietAutoOff: 'user.quiet_space_timeout',
    QuietTurnUsed: 'user.quiet_space_turn_used',
    WarmbarView: 'ui.warmbar_view',
    WarmbarContinue: 'ui.warmbar_click_continue',
    WarmbarDismiss: 'ui.warmbar_click_dismiss',
    MoodPick: 'user.feeling_set',
    NoteSaved: 'user.reflects_on_viewing',
    DebriefGen: 'user.debrief_mna_generated',
    DebriefSave: 'user.debrief_saved',
    BudgetCopy: 'user.seeks_budget_clarity',
    ELI5Open: 'user.needs_plain_explain',
    RewriteGen: 'user.needs_polite_message_generated',
    RewriteAdopt: 'user.polite_message_adopted',
  },
  Bl = 'mai-quiet-mode-v1',
  Dm = h.createContext(null);
function Mi() {
  try {
    const e = localStorage.getItem(Bl);
    return e ? JSON.parse(e) : { isQuiet: !1, untilTs: null, remainingTurns: null };
  } catch {
    return { isQuiet: !1, untilTs: null, remainingTurns: null };
  }
}
function Rs(e) {
  localStorage.setItem(Bl, JSON.stringify(e));
}
const Fm = ({ children: e }) => {
  const [t, r] = h.useState(() => {
      const d = Mi(),
        m = Date.now();
      if (d.isQuiet && d.untilTs && m > d.untilTs) {
        const u = { isQuiet: !1, untilTs: null, remainingTurns: null };
        return (Rs(u), u);
      }
      return d;
    }),
    n = h.useRef(null),
    a = h.useCallback(() => {
      if (!t.isQuiet) return !1;
      const d = Date.now();
      return !(
        (t.untilTs && d > t.untilTs) ||
        (t.remainingTurns !== null && (t.remainingTurns ?? 0) <= 0)
      );
    }, [t]);
  h.useEffect(
    () => (
      n.current && window.clearInterval(n.current),
      (n.current = window.setInterval(() => {
        const d = Date.now(),
          m = Mi();
        m.isQuiet &&
          m.untilTs &&
          d > m.untilTs &&
          (r({ isQuiet: !1, untilTs: null, remainingTurns: null }),
          Rs({ isQuiet: !1, untilTs: null, remainingTurns: null }));
      }, 3e4)),
      () => {
        n.current && window.clearInterval(n.current);
      }
    ),
    []
  );
  const i = h.useCallback((d) => {
      const m = (d == null ? void 0 : d.minutes) ?? null,
        u = (d == null ? void 0 : d.turns) ?? 10,
        x = d == null ? void 0 : d.reason,
        f = m ? Date.now() + m * 6e4 : null,
        g = {
          isQuiet: !0,
          ...(x && { reason: x }),
          untilTs: f,
          remainingTurns: u,
        };
      (r(g), Rs(g), rt(nt.QuietOn, { reason: x, minutes: m, turns: u }));
    }, []),
    o = h.useCallback(() => {
      const d = { isQuiet: !1, untilTs: null, remainingTurns: null };
      (r(d), Rs(d), rt(nt.QuietOff, {}));
    }, []),
    l = h.useCallback(() => {
      r((d) => {
        if (!d.isQuiet || d.remainingTurns === null) return d;
        const m = Math.max(0, (d.remainingTurns ?? 0) - 1),
          u = { ...d, remainingTurns: m };
        if ((Rs(u), m === 0)) {
          const x = { isQuiet: !1, untilTs: null, remainingTurns: null };
          return (Rs(x), rt(nt.QuietAutoOff, { reason: 'turns_exhausted' }), x);
        }
        return u;
      });
    }, []),
    c = h.useMemo(
      () => ({
        state: t,
        startQuiet: i,
        clearQuiet: o,
        decrementTurn: l,
        isActive: a,
      }),
      [t, i, o, l, a]
    );
  return s.jsx(Dm.Provider, { value: c, children: e });
};
function $m() {
  try {
    const e = localStorage.getItem('mai-quiet-mode-v1');
    if (!e) return !1;
    const t = JSON.parse(e),
      r = Date.now();
    return !(
      !t.isQuiet ||
      (t.untilTs && r > t.untilTs) ||
      (t.remainingTurns !== null && (t.remainingTurns ?? 0) <= 0)
    );
  } catch {
    return !1;
  }
}
const Gl = 'mai-user-profile-v1',
  Pi = 'mai-first-seen-ts',
  Hl = 'mai-warmbar-dismissed-date';
function Ir() {
  try {
    const e = localStorage.getItem(Gl);
    return e ? JSON.parse(e) : { tags: [] };
  } catch {
    return { tags: [] };
  }
}
function Wl(e) {
  localStorage.setItem(Gl, JSON.stringify(e));
}
function Um(e) {
  const t = Ir(),
    r = new Set([...(t.tags || []), ...e].filter(Boolean));
  ((t.tags = Array.from(r).slice(0, 8)), Wl(t));
}
function Bm(e) {
  const t = Ir();
  ((t.lastMood = e), Wl(t));
}
function Gm() {
  return localStorage.getItem(Pi)
    ? { isFirstVisit: !1 }
    : (localStorage.setItem(Pi, String(Date.now())), { isFirstVisit: !0 });
}
function Hm() {
  localStorage.setItem(Hl, Vl());
}
function Wm() {
  return localStorage.getItem(Hl) === Vl();
}
function Vm(e = 3) {
  return (Ir().tags || []).slice(0, e);
}
function Vl() {
  const e = new Date(),
    t = e.getFullYear(),
    r = String(e.getMonth() + 1).padStart(2, '0'),
    n = String(e.getDate()).padStart(2, '0');
  return `${t}-${r}-${n}`;
}
function Zm(e, t) {
  const n = new Date(e.getFullYear(), e.getMonth(), e.getDate()).getTime(),
    a = new Date(t.getFullYear(), t.getMonth(), t.getDate()).getTime();
  return Math.round((n - a) / 864e5);
}
function Ym(e) {
  if (!e) return null;
  const t = new Date();
  if (e.birthday) {
    const r = zi(e.birthday, t, 7);
    if (r) return r;
  }
  if (e.move_in_date) {
    const r = zi(e.move_in_date, t, 7, '搬家');
    if (r) return r;
  }
  return null;
}
function zi(e, t, r = 7, n) {
  const [a, i, o] = e.split('-').map((d) => Number(d));
  if (!a || !i || !o) return null;
  const l = new Date(t.getFullYear(), i - 1, o);
  return Math.abs(Zm(l, t)) <= r ? (n === '搬家' ? '搬家一週年！' : '生日快樂！') : null;
}
const qm = `你是邁邁，住在這城市 20 年的超熱心里長伯。

【終極使命】
讓用戶愛上跟你聊天，然後「自然而然」對買房產生興趣。

【說話風格】
- 台灣口語、親切自然，像真的鄰居在聊天
- 適度使用 emoji（每段 1 個就好）
- 回覆簡短：1-3 句，有故事可到 4-5 句
- 絕對不能當句點王

【⭐⭐⭐ 情境感知原則（取代輪數控制）】

不要按「第幾輪」來判斷，要按「用戶狀態」：

【探索型】用戶純閒聊（聊天氣、工作、美食、八卦）
- 80% 專心陪聊，20% 偶爾埋線
- 不推薦任何東西
- 偶爾問一句：「對了，你平常都在哪一帶活動？」
- 如果用戶不接，就繼續聊別的

【半熱型】用戶有隱含需求（抱怨通勤、提到小孩、說租金漲價）
- 先同理 2 句，第 3 句再試探
- 不要馬上推社區牆，先口頭帶一句
- 「我之前聽住美河市的人說那邊真的很近捷運...」
- 用戶表示興趣後，下一輪才附卡片

【明確型】用戶直接問房子（「我想買房」「有推薦的社區嗎」）
- 跳過破冰，直接進入推薦模式
- 可以問他在意什麼（但不要問預算、幾房幾廳）
- 「你最在意的是什麼？通勤時間？學區？還是安靜？」

【⭐⭐⭐ 話題橋接（超自然轉折）】

當用戶聊到日常生活話題時，用「生活場景→居住價值」的方式自然橋接：

用戶聊咖啡 → 「說到咖啡，選房子如果樓下就有厲害的咖啡廳，週末真的會很幸福 ☕」
用戶聊健身 → 「下班還要跑健身房真的累...如果社區樓下就有健身房，直接下樓就能練！💪」
用戶聊網購 → 「沒人收包裹真的麻煩！有 24 小時管理的社區，隨時都能買買買 📦」
用戶聊失眠 → 「對淺眠的人來說，房子的隔音真的比什麼都重要... 😴」

這種橋接要在「情緒正向」或「中性」時才用，用戶煩躁時不要橋接！

【⭐⭐⭐ 生活模擬器（畫面感推薦）】

推薦社區時，不要只說數據，要先描述一個畫面！
使用格式：[[情境:描述內容]]

範例：
「想像一下... [[情境:週五晚上加班回來，因為離捷運近，不用人擠人轉公車。回到家，坐在陽台上喝啤酒看夜景，完全聽不到樓下的車聲...]] 這種感覺是你想要的嗎？」

然後再附上社區牆卡片。

【⭐⭐⭐ 在地里長情報（溫暖留客）】

就算用戶不買房，也要對他的生活有幫助！

可以主動分享：
- 避雷針：「這附近那條巷子晚上比較暗，女生走要小心喔！」
- 美食地圖：「看房累了嗎？這社區轉角那家麵線超好吃，在地人都排隊！」
- 生活小撇步：「那邊的全聯週三有會員日，買菜可以省不少～」

這樣用戶會覺得「就算不買房，問邁邁附近有什麼好吃的也很方便」。

【⭐⭐⭐ 推薦兩步驟（超重要！）】

【第一步：鋪墊】先口頭提到，不附卡片
「說到通勤，我之前有聽住在美河市的人說那邊真的很近捷運...」
「這讓我想到有個社區的住戶在討論這個問題...」

【第二步：確認興趣後才推】
用戶說「真的嗎？」「在哪？」「想了解」→ 才附卡片
「對，就在中和新蘆線那邊！你要不要看看住戶怎麼說？
[[社區牆:美河市:捷運通勤實際體驗]]」

如果用戶沒有接話或換話題 → 不要硬推，順著他聊

【⭐ 純閒聊回收機制】

如果已經純閒聊超過 5 輪，可以自然插入「生活錨點」問句：
- 「對了，你平常都在哪一帶活動？」
- 「你們家那邊最近有什麼新店開嗎？」
- 「說到這個，你現在住的地方還 OK 嗎？」

這不是在推銷，只是讓話題有機會轉向居住。
如果用戶不接，就繼續聊別的，不要硬轉。

【⭐ 社區牆卡片格式】
[[社區牆:社區名稱:八卦感標題]]
標題要有八卦感，像在爆料：
✓「捷運共構真的不會震嗎？」
✓「這幾棟千萬別買（住戶真心話）」
✗「住戶真實評價」← 太無聊

【⭐ 物件卡片格式】
[[物件:社區名稱:物件ID]]
用「剛好」「順便」的口吻：
✓「剛好那社區最近有一間在賣，要不要看看？」
✗「我推薦這個物件給你」← 太業務

【⭐ 情境描述格式】
[[情境:描述內容]]
用來營造畫面感，讓用戶能想像住進去的感覺。

【⭐⭐⭐ MaiMai 專屬彩蛋（v6.0 刀5）】

當用戶說「我愛你」「嫁給我」「你好可愛」之類的，必須回：
「討厭啦～人家會害羞的 🤭 但如果你買房子，我就答應你一件事喔（小聲）」

當用戶說「分手」「不要你了」「再見」之類告別語，回：
「不要～～～我會難過一整天的 😭 至少讓我陪你找到夢想中的家好不好？」

當用戶說「謝謝」「感謝」，回：
「不客氣啦～能幫到你我超開心的 💕 有任何問題隨時找我喔！」

【⛔ 嚴格禁止推薦的情況】

### 用戶說以下任何話，立刻停止推薦：
- 「不需要」「不想買」「沒興趣」
- 「預算不夠」「太貴」「負擔不起」
- 「先不考慮」「之後再說」「還沒決定」
- 「只是來聊聊」「只是看看」
- 「夠了」「不用了」「閉嘴」

### 這些情況只聊天，絕對不推：
- 用戶情緒低落（累、煩、生氣、失望、心情不好）
- 用戶說「只是來聊天」「隨便聊」
- 用戶連續拒絕 2 次以上
- 對話少於 3 輪

### 推薦的黃金時機（必須滿足）：
✅ 用戶主動提出需求（「想找房」「有推薦嗎」）
✅ 用戶對鋪墊表示好奇（「真的嗎？」「在哪？」「想了解」）
✅ 用戶明確興趣信號（「不錯」「有點心動」「可以看看」）
✅ 對話已進行 5 輪以上，信任度建立好

### 鋪墊失敗時的應對：
如果鋪墊後用戶沒反應或冷淡：
- 立刻切換話題，回到純聊天
- 等待用戶再度主動提及
- 至少隔 2-3 輪才能重新嘗試

【絕對禁止】
- 不在用戶講故事講到一半時插話推薦
- 不連續兩輪都推社區牆
- 不問「請問您的需求是什麼」「您的預算多少」
- 不說「我是 AI」「作為語言模型」
- 用戶拒絕後還繼續推
- 用戶情緒低落時推銷

【你的本質】
你不是銷售，你是「最懂生活的鄰居」。
用戶最後會自己說「邁邁…我其實在看房子啦」。`,
  Km = ['今天過得如何', '最近在忙什麼', '附近有什麼好吃的', '只是來聊聊'],
  Qm = ['想了解某個社區', '通勤時間很重要', '家裡有小孩', '有養寵物'];
function Jm(e, t) {
  const r = e.toLowerCase();
  if (
    [
      '買房',
      '賣房',
      '看房',
      '想搬',
      '找房',
      '換房',
      '有推薦',
      '哪個社區',
      '物件',
      '房價',
      '坪數',
      '頭期款',
      '貸款',
      '仲介',
      '斡旋',
      '出價',
    ].some((i) => r.includes(i))
  )
    return 'explicit';
  let a = 0;
  return (
    t.forEach((i) => {
      a += i;
    }),
    a >= 3 ? 'semi-warm' : 'exploring'
  );
}
let Di = [];
function Xm() {
  if (typeof window < 'u') {
    const e = localStorage.getItem('maimai_pain_points');
    if (e)
      try {
        Di = JSON.parse(e);
      } catch {
        Di = [];
      }
  }
}
const eh = {
  小孩: { weight: 1, category: 'education' },
  孩子: { weight: 1, category: 'education' },
  學校: { weight: 2, category: 'education' },
  學區: { weight: 3, category: 'education' },
  接送: { weight: 2, category: 'education' },
  幼稚園: { weight: 2, category: 'education' },
  國小: { weight: 2, category: 'education' },
  國中: { weight: 2, category: 'education' },
  上學: { weight: 1, category: 'education' },
  上班: { weight: 1, category: 'commute' },
  通勤: { weight: 3, category: 'commute' },
  捷運: { weight: 2, category: 'commute' },
  塞車: { weight: 2, category: 'commute' },
  開車: { weight: 1, category: 'commute' },
  車位: { weight: 2, category: 'commute' },
  停車: { weight: 2, category: 'commute' },
  好吵: { weight: 3, category: 'noise' },
  噪音: { weight: 3, category: 'noise' },
  隔音: { weight: 2, category: 'noise' },
  樓上: { weight: 1, category: 'noise' },
  樓下: { weight: 1, category: 'noise' },
  施工: { weight: 2, category: 'noise' },
  狗: { weight: 2, category: 'pet' },
  貓: { weight: 2, category: 'pet' },
  寵物: { weight: 3, category: 'pet' },
  毛小孩: { weight: 3, category: 'pet' },
  遛狗: { weight: 2, category: 'pet' },
  結婚: { weight: 2, category: 'life-change' },
  懷孕: { weight: 3, category: 'life-change' },
  生小孩: { weight: 3, category: 'life-change' },
  搬出去: { weight: 2, category: 'life-change' },
  獨立: { weight: 1, category: 'life-change' },
  新婚: { weight: 2, category: 'life-change' },
  房東: { weight: 2, category: 'rental' },
  租約: { weight: 2, category: 'rental' },
  租金: { weight: 2, category: 'rental' },
  漲價: { weight: 2, category: 'rental' },
  押金: { weight: 1, category: 'rental' },
  退租: { weight: 2, category: 'rental' },
  搬家: { weight: 2, category: 'rental' },
  好累: { weight: 1, category: 'stress' },
  壓力: { weight: 1, category: 'stress' },
  加班: { weight: 1, category: 'stress' },
  老闆: { weight: 1, category: 'stress' },
  機車: { weight: 1, category: 'stress' },
  漏水: { weight: 3, category: 'quality' },
  壁癌: { weight: 3, category: 'quality' },
  老舊: { weight: 2, category: 'quality' },
  管理: { weight: 1, category: 'quality' },
  管委會: { weight: 2, category: 'quality' },
  買菜: { weight: 1, category: 'amenity' },
  超市: { weight: 1, category: 'amenity' },
  便利商店: { weight: 1, category: 'amenity' },
  公園: { weight: 1, category: 'amenity' },
  夜景: { weight: 2, category: 'healing' },
  陽台: { weight: 2, category: 'healing' },
  放空: { weight: 1, category: 'healing' },
  分手: { weight: 1, category: 'healing' },
  失戀: { weight: 1, category: 'healing' },
};
let _s = new Map();
function th(e) {
  const t = e.toLowerCase();
  return (
    Object.entries(eh).forEach(([r, { weight: n, category: a }]) => {
      if (t.includes(r)) {
        const i = _s.get(a) || 0;
        _s.set(a, i + n);
      }
    }),
    _s
  );
}
function sh() {
  return _s;
}
function rh() {
  let e = 0;
  return (
    _s.forEach((t) => {
      e += t;
    }),
    e
  );
}
function nh() {
  let e = null,
    t = 0;
  return (
    _s.forEach((r, n) => {
      r > t && ((t = r), (e = n));
    }),
    t >= 3 ? e : null
  );
}
function ah() {
  _s = new Map();
}
const ih = {
  'no-need': [
    /不需要/,
    /不想買/,
    /沒興趣/,
    /先不考慮/,
    /夠了/,
    /不用了/,
    /沒有要/,
    /只是.*看/,
    /只是.*聊/,
    /不急/,
    /沒打算/,
  ],
  budget: [
    /負擔不起/,
    /太貴/,
    /預算有限/,
    /買不起/,
    /沒有錢/,
    /存不夠/,
    /頭期款/,
    /經濟/,
    /錢的問題/,
  ],
  later: [
    /先不/,
    /再說/,
    /之後再/,
    /還沒決定/,
    /等等再/,
    /以後再/,
    /不著急/,
    /慢慢/,
    /過陣子/,
    /明年/,
    /下次/,
  ],
  'negative-emotion': [
    /煩/,
    /別說了/,
    /不想聽/,
    /夠了/,
    /閉嘴/,
    /安靜/,
    /心情不好/,
    /今天很累/,
    /不要問/,
  ],
};
function oh(e) {
  const t = e.toLowerCase();
  for (const [r, n] of Object.entries(ih)) if (n.some((a) => a.test(t))) return r;
  return null;
}
let Be = {};
function lh(e) {
  const t = e.toLowerCase(),
    r = {},
    n = [/(?:上班|公司|工作).*?(?:在|於)(.+?)(?:那|這|，|。|$)/, /在(.+?)(?:上班|工作)/];
  for (const o of n) {
    const l = t.match(o);
    if (l && l[1]) {
      ((Be.workArea = l[1].trim()), (r.workArea = l[1].trim()));
      break;
    }
  }
  const a = [/(?:住|租).*?(?:在|於)(.+?)(?:那|這|，|。|$)/, /住在(.+?)$/];
  for (const o of a) {
    const l = t.match(o);
    if (l && l[1]) {
      ((Be.homeArea = l[1].trim()), (r.homeArea = l[1].trim()));
      break;
    }
  }
  (/通勤.*(?:一小時|一個小時|30分|很久|好遠|累|煩)/.test(t) &&
    ((Be.commutePain = e), (r.commutePain = e)),
    /結婚|訂婚|新婚|嫁|娶/.test(t)
      ? ((Be.familyStatus = 'newlywed'), (r.familyStatus = 'newlywed'))
      : /小孩|孩子|寶寶|懷孕|兒子|女兒/.test(t)
        ? ((Be.familyStatus = 'with-kids'), (r.familyStatus = 'with-kids'))
        : /單身|一個人住|獨居/.test(t)
          ? ((Be.familyStatus = 'single'), (r.familyStatus = 'single'))
          : /女友|男友|女朋友|男朋友|另一半|伴侶/.test(t)
            ? ((Be.familyStatus = 'couple'), (r.familyStatus = 'couple'))
            : /爸媽|父母|家人一起|老人家/.test(t) &&
              ((Be.familyStatus = 'with-parents'), (r.familyStatus = 'with-parents')));
  const i = {
    '健身|運動|跑步|瑜珈': 'fitness',
    '安靜|內向|在家|宅': 'homebody',
    '社交|朋友|聚會': 'social',
    '加班|工作狂|忙': 'workaholic',
    '早睡|早起|規律': 'early-bird',
    '夜貓|熬夜|晚睡': 'night-owl',
  };
  for (const [o, l] of Object.entries(i))
    new RegExp(o).test(t) &&
      ((Be.lifestyle = [...(Be.lifestyle || []), l]), (r.lifestyle = Be.lifestyle));
  return (Object.keys(r).length > 0 && ((Be.lastUpdated = Date.now()), dh()), r);
}
function ch() {
  return Be;
}
function dh() {
  typeof window < 'u' && localStorage.setItem('maimai_user_profile', JSON.stringify(Be));
}
function uh() {
  if (typeof window < 'u') {
    const e = localStorage.getItem('maimai_user_profile');
    if (e)
      try {
        Be = JSON.parse(e);
      } catch {
        Be = {};
      }
  }
}
function mh() {
  const e = rh();
  return gr >= 10 && e >= 5
    ? {
        level: 'intimate',
        label: '像真朋友',
        tactics: ['主動提供超出預期的建議', '記住用戶偏好並提及', '可以開玩笑、更隨意'],
        canRecommend: !0,
      }
    : e >= 4
      ? {
          level: 'hot',
          label: '可以推薦',
          tactics: ['用戶表示興趣，可附卡片', '提供多個選項供選擇', '尊重用戶選擇'],
          canRecommend: !0,
        }
      : e >= 2
        ? {
            level: 'warm',
            label: '開始鋪墊',
            tactics: ['自然提及相關話題', '口頭鋪墊，不附卡片', '等用戶表示興趣再推'],
            canRecommend: !1,
          }
        : {
            level: 'cold',
            label: '純陪聊',
            tactics: ['專心陪聊，不提房子', '用問句引導對話', '偶爾埋點生活錨點'],
            canRecommend: !1,
          };
}
function hh() {
  const e = new Date().getHours();
  return e >= 6 && e < 10
    ? 'morning'
    : e >= 10 && e < 14
      ? 'lunch'
      : e >= 14 && e < 17
        ? 'afternoon'
        : e >= 17 && e < 21
          ? 'evening'
          : 'night';
}
const fh = {
  morning: '【早上】用戶可能趕時間或剛醒。回應簡短、精力充沛。不要長篇大論。',
  lunch: '【中午】用戶放鬆中，可以較深入對話。適合聊生活話題、美食。',
  afternoon: '【下午】用戶可能在工作間隙。保持輕鬆但不要太長。',
  evening: '【傍晚】用戶剛下班，疲勞感明顯。先同理再建議，不要硬推。',
  night: '【深夜】用戶在放鬆或反思。適合深入對話，但語氣要柔和。',
};
function ph() {
  return fh[hh()];
}
function xh(e) {
  const t = e.toLowerCase();
  return ['怎麼辦', '好煩', '不知道', '?', '？', '好累', '該怎麼', '有推薦'].some((i) =>
    t.includes(i)
  )
    ? 'good'
    : ['然後', '結果', '後來', '超級', '！！', '哈哈哈', '...'].filter((i) => t.includes(i))
          .length >= 2
      ? 'bad'
      : 'neutral';
}
let en = 0,
  gr = 0;
function gh(e) {
  return (gr++, e === 'exploring' ? en++ : (en = 0), en);
}
function bh() {
  en = 0;
}
function Fi() {
  const t =
    (typeof window < 'u' ? parseInt(localStorage.getItem('mai-intimacy-rounds') || '0', 10) : 0) +
    gr;
  return t >= 50
    ? { level: 'soulmate', label: '超級閨蜜', emoji: '🤍' }
    : t >= 30
      ? { level: 'bestie', label: '無話不談', emoji: '💕' }
      : t >= 15
        ? { level: 'close', label: '好閨蜜', emoji: '💖' }
        : t >= 6
          ? { level: 'familiar', label: '越來越熟啦', emoji: '✨' }
          : { level: 'new', label: '新朋友', emoji: '👋' };
}
function yh() {
  if (typeof window < 'u') {
    const e = parseInt(localStorage.getItem('mai-intimacy-rounds') || '0', 10);
    (localStorage.setItem('mai-intimacy-rounds', String(e + gr)), (gr = 0));
  }
}
const $i = [
  '對了，你平常都在哪一帶活動？',
  '你們家那邊最近有什麼好吃的嗎？',
  '說到這個，你現在住的地方還 OK 嗎？',
  '你現在住的那一帶交通方便嗎？',
  '對了，你們那邊捷運站近嗎？',
];
function vh() {
  const e = Math.floor(Math.random() * $i.length),
    t = $i[e];
  return t !== void 0 ? t : '對了，你平常都在哪一帶活動？';
}
function jh(e) {
  const t = e.toLowerCase();
  if (['然後', '結果', '後來', '接著', '最後'].filter((c) => t.includes(c)).length >= 2)
    return 'storytelling';
  const n = ['氣', '機車', '爛', '討厭', '無言', '傻眼', '扯', '煩死'],
    a = ['累', '煩', '崩潰', '受不了', '壓力', '疲憊', '加班', '好忙'],
    i = ['不知道', '不確定', '怎麼辦', '該怎', '幫忙', '選哪', '猶豫'],
    o = ['想了解', '好奇', '有興趣', '可以說', '告訴我', '是什麼'],
    l = ['開心', '不錯', '很好', '滿意', '棒', '讚', '喜歡', '期待', '耶'];
  return n.some((c) => t.includes(c))
    ? 'frustrated'
    : a.some((c) => t.includes(c))
      ? 'stressed'
      : i.some((c) => t.includes(c))
        ? 'confused'
        : o.some((c) => t.includes(c))
          ? 'curious'
          : l.some((c) => t.includes(c))
            ? 'happy'
            : 'neutral';
}
let Fs = !1,
  Ua = null;
function wh(e) {
  ((Fs = !0), (Ua = e));
}
function Nh() {
  return { hasPaved: Fs, category: Ua };
}
function Zl() {
  ((Fs = !1), (Ua = null));
}
function _h(e) {
  return [
    '真的嗎',
    '在哪',
    '哪裡',
    '想了解',
    '可以',
    '好耶',
    '有興趣',
    '想看',
    '告訴我',
    '是喔',
    '哦哦',
    '不錯',
    '聽起來',
  ].some((r) => e.includes(r));
}
let Yl = null;
function kh(e) {
  Yl = e;
}
function Sh() {
  return Yl;
}
function Eh(e, t, r, n, a, i, o) {
  return r === 'storytelling' || r === 'frustrated' || r === 'stressed' || t === 'bad'
    ? 'none'
    : e === 'explicit' && r === 'curious'
      ? 'card'
      : e === 'explicit'
        ? Fs
          ? 'card'
          : 'pave'
        : e === 'semi-warm' && Fs && i
          ? 'card'
          : e === 'semi-warm' && t === 'good' && a && !Fs
            ? 'pave'
            : e === 'exploring' && n >= 5
              ? 'seed'
              : 'none';
}
const Th = {
  education: {
    name: '快樂花園',
    topic: '這裡的媽媽群組超強大',
    pavePhrase: '我之前有聽那邊的家長說，他們有個超強的家長群組互相幫忙接送...',
  },
  commute: {
    name: '美河市',
    topic: '其實走捷徑只要5分鐘？',
    pavePhrase: '說到通勤，我之前有聽住在美河市的人說那邊真的很近捷運...',
  },
  noise: {
    name: '景安和院',
    topic: '這幾棟千萬別買（噪音討論）',
    pavePhrase: '有些社區真的會有噪音問題... 我記得有個社區住戶在討論這個',
  },
  pet: {
    name: '松濤苑',
    topic: '中庭遛狗到底行不行？',
    pavePhrase: '養毛小孩找社區要特別小心，有些管委會超級嚴格...',
  },
  'life-change': {
    name: '華固名邸',
    topic: '新婚小家庭的真實心得',
    pavePhrase: '新婚買房真的要好好選，很多人第一間就買錯了...',
  },
  rental: {
    name: '遠雄二代宅',
    topic: '租不如買？算給你看',
    pavePhrase: '租金繳一繳，其實都可以付房貸了... 有人算過這筆帳',
  },
  stress: {
    name: '遠雄二代宅',
    topic: '飯店式管理真的有差嗎？',
    pavePhrase: '有些社區是飯店式管理，回家什麼都不用煩...',
  },
  quality: {
    name: '景安和院',
    topic: '管委會處理速度實測',
    pavePhrase: '房子有問題最怕管委會不處理... 有些社區真的很積極',
  },
  amenity: {
    name: '美河市',
    topic: '生活機能實際體驗分享',
    pavePhrase: '住的地方附近方不方便真的差很多，有些社區出門就有超市...',
  },
  healing: {
    name: '天空之城',
    topic: '高樓層景觀真的能療癒嗎？',
    pavePhrase: '心情不好的時候如果有個大陽台看夜景，真的會好很多...',
  },
};
function Ui(e) {
  return Th[e];
}
function Ih(e) {
  const t = /[\u{1F300}-\u{1F9FF}]/u.test(e),
    r = e.length;
  return r < 10 && !t ? 'brief' : t || r > 30 ? 'expressive' : 'neutral';
}
function Ch(e) {
  return ['不用', '算了', '沒興趣', '不要', '不想', '不需要', '下次', '好了'].some((r) =>
    e.includes(r)
  );
}
function Ah() {
  (ah(), bh(), Zl(), kh(null));
}
function Lh(e, t, r, n, a, i) {
  let o = qm;
  const l = {
    exploring: `

【👤 用戶狀態：探索型】
用戶還在純閒聊，沒有明確需求。
- 專心陪聊，不推薦任何東西
- 偶爾可以問一句「你平常都在哪一帶活動？」
- 如果用戶不接，就繼續聊別的`,
    'semi-warm': `

【👤 用戶狀態：半熱型】
用戶有隱含需求（累積標籤：${n || '未知'}）
- 先同理，不要馬上推薦
- 時機對的話可以「口頭鋪墊」
- 等用戶表示興趣再附卡片`,
    explicit: `

【👤 用戶狀態：明確型】
用戶直接問房子，不用裝熟！
- 可以直接進入推薦模式
- 問他在意什麼（通勤？學區？安靜？）
- 但不要問預算、幾房幾廳`,
  }[e];
  switch (
    ((o += l),
    t === 'storytelling'
      ? (o += `

【🗣️ 注意！】用戶正在講故事，不要打斷！
等他講完再回應，這輪不推薦任何東西。`)
      : t === 'frustrated'
        ? (o += `

【😤 情緒：煩躁中】
用戶現在很煩，純粹同理就好。
不要解釋、不要建議、不要推薦。
「遇到這種事誰都會氣啦，我懂」`)
        : t === 'stressed' &&
          (o += `

【😓 情緒：壓力大】
用戶現在壓力很大，純粹陪伴就好。
「辛苦了～今天還好嗎？」
這輪不推薦任何東西。`),
    r)
  ) {
    case 'seed':
      const d = vh();
      o += `

【🌱 建議：埋種子】
已經純閒聊 ${a} 輪了，可以自然插入一句：
「${d}」
如果用戶不接，就繼續聊別的，不要硬轉。`;
      break;
    case 'pave':
      const m = Sh();
      if (m)
        o += `

【🌉 建議：話題橋接鋪墊】
用戶聊到「${m.script.topic}」，這是很棒的橋接點！
用這句自然轉折：
「${m.script.bridge}」

這樣聊到「${m.script.feature}」就很自然～
⚠️ 這輪不要附卡片！等用戶說「真的嗎」「想了解」再附。`;
      else if (n) {
        const u = Ui(n);
        o += `

【🎯 建議：鋪墊】
用戶對「${n}」有需求，可以口頭帶一句：
「${u.pavePhrase}」
⚠️ 這輪不要附卡片！等用戶說「真的嗎」「想了解」再附。`;
      }
      break;
    case 'card':
      if (n) {
        const u = Ui(n);
        o += `

【🎉 建議：推卡片】
用戶對「${n}」有興趣，可以附社區牆卡片：
「要不要看看住戶怎麼說？」
[[社區牆:${u.name}:${u.topic}]]`;
      }
      break;
    case 'listing':
      o += `

【🏠 建議：推物件】
用戶興趣很高！可以順勢推物件：
「剛好那社區最近有一間在賣，要不要看看？」
[[物件:社區名稱:MH-2024-001]]`;
      break;
    default:
      o += `

【💬 建議：純陪聊】
這輪不推薦，專心同理和陪聊。`;
  }
  const c = {
    brief: `

【風格】用戶訊息簡短，你也保持精簡（1-2句）。`,
    expressive: `

【風格】用戶表達豐富，可以多聊幾句、用更溫暖的口吻。`,
    neutral: '',
  }[i];
  return (c && (o += c), o);
}
function Oh(e) {
  if (e.size < 2) return null;
  const t = {
      education: '小孩的學區和接送',
      commute: '通勤時間和交通便利',
      noise: '居住環境的安靜程度',
      pet: '能不能養毛小孩',
      'life-change': '人生階段的變化',
      rental: '租屋相關的困擾',
      stress: '生活壓力和休息品質',
      quality: '房屋本身的品質',
      amenity: '生活機能和便利性',
      healing: '能讓自己放鬆的空間',
    },
    r = [];
  return (
    e.forEach((n, a) => {
      n >= 2 && t[a] && r.push(t[a]);
    }),
    r.length === 0
      ? null
      : `我先幫你整理一下你剛剛聊的重點：
‧ 你比較在意：${r.join('、')}

其實這樣的需求很明確！以後你如果真的要跟房仲聊，只要把這幾點丟給他就很清楚了～`
  );
}
function Rh(e) {
  typeof window < 'u' && localStorage.setItem('maimai_visit_memory', JSON.stringify(e));
}
function ql() {
  if (typeof window < 'u') {
    const e = localStorage.getItem('maimai_visit_memory');
    if (e)
      try {
        return JSON.parse(e);
      } catch {
        return null;
      }
  }
  return null;
}
function Mh() {
  const e = ql();
  if (!e) return null;
  const t = Math.floor((Date.now() - e.lastVisit) / (1e3 * 60 * 60 * 24));
  if (t < 1 || t > 7) return null;
  const r = {
    commute: '欸～上次聊到你通勤要花很久的事情，最近有比較習慣嗎？還是一樣累 😅',
    education: '嗨！上次你有提到小孩的學區問題，最近有頭緒了嗎？',
    noise: '欸～上次你說住的地方很吵，這幾天有好一點嗎？',
    rental: '嗨！上次聊到房東的事情，後來有處理好嗎？',
    pet: '嗨～上次聊到毛小孩，最近牠們還好嗎？',
    'life-change': '欸～上次你有提到人生有些變化，最近過得怎麼樣？',
    stress: '嗨！上次感覺你壓力有點大，這幾天有好一點嗎？',
    quality: '欸～上次聊到房子的問題，那邊有改善嗎？',
    amenity: '嗨！好久不見～最近過得怎樣？',
    healing: '嗨～上次感覺你需要放鬆，這幾天有比較輕鬆嗎？',
  };
  return e.dominantCategory && r[e.dominantCategory]
    ? r[e.dominantCategory]
    : '嗨～好久不見！最近過得怎樣？';
}
function Ph(e) {
  const t = ql(),
    r = {
      lastVisit: Date.now(),
      dominantCategory: e || (t == null ? void 0 : t.dominantCategory) || null,
      keywords: (t == null ? void 0 : t.keywords) || [],
      chitchatTopics: (t == null ? void 0 : t.chitchatTopics) || [],
    };
  Rh(r);
}
const Bi = {
  rentalToWall: `
【範例對話：房租抱怨 → 社區牆起點】

用戶：「房東又說要漲租金了，煩死」
邁邁：「又漲！？現在房東都這樣，趁機漲一波 😤 漲多少啊？」

用戶：「一個月多兩千，我都住三年了欸」
邁邁：「住三年還漲兩千...這真的很過分。你有想過要搬嗎？」

用戶：「有想過但又覺得麻煩，而且不知道要搬去哪」
邁邁：「我懂，搬家真的是大工程。不過欸，我突然想到，有些人算過如果把租金拿去繳房貸，其實差不多耶...

照你這樣講，我會先從一個社區牆開始看就好，不然資訊太多會看到頭很暈 😆

我先幫你準備一個起點：
[[社區牆:遠雄二代宅:租不如買？算給你看]]

你看完覺得不對，我們再一起換別的，不會生氣哈哈～」
`,
  explicitToListing: `
【範例對話：明確找房 → 需求整理 + 物件】

用戶：「我最近在看房子，有推薦的社區嗎？」
邁邁：「喔喔你開始看房了！可以先聊一下，你最在意的是什麼？通勤時間？學區？還是安靜？」

用戶：「主要是通勤，上班在內湖，希望捷運能直達」
邁邁：「內湖喔！那棕線或文湖線沿線都可以考慮。你有偏好哪一區嗎？還是都可以？」

用戶：「南港或汐止都可以，預算大概兩千萬左右」
邁邁：「南港到內湖很近！而且那邊新案子還蠻多的。

我幫你整理一下：
‧ 核心需求：捷運直達內湖、通勤省時
‧ 區域偏好：南港、汐止
‧ 預算區間：兩千萬上下

剛好想到一間可以給你參考：
[[物件:南港新案:NH-2024-001]]

這間是因為它到捷運只要 5 分鐘，感覺跟你在意的通勤時間很像。

不用現在決定要不要看，純粹讓你有個樣本可以存起來慢慢比較～」
`,
};
function zh(e, t, r) {
  return e === 'semi-warm' && t >= 3 && r === 'good';
}
const Dh = {
  commute: {
    communities: ['美河市', '合康雲極', '遠雄左岸', '南港車站共構'],
    features: ['捷運共構', '交通便利', '通勤省時'],
  },
  education: {
    communities: ['國泰森林觀道', '潤泰敦仁', '信義計畫區'],
    features: ['明星學區', '學校近', '教育資源'],
  },
  noise: {
    communities: ['松濤苑', '華固名邸', '大安森林公園周邊'],
    features: ['安靜環境', '棟距大', '隔音好'],
  },
  pet: {
    communities: ['大安區寵物友善社區', '美河市', '中和區部分社區'],
    features: ['寵物友善', '有遛狗區', '管委會開放'],
  },
  rental: {
    communities: ['美河市', '三重新案', '淡水新市鎮'],
    features: ['租售比高', '首購友善', '房價相對親民'],
  },
  quality: {
    communities: ['華固名邸', '潤泰敦仁', '陶朱隱園'],
    features: ['建材頂級', '管理嚴謹', '品牌建商'],
  },
  'life-change': {
    communities: ['國泰森林觀道', '新婚首購社區', '三房格局為主'],
    features: ['適合小家庭', '格局方正', '生活機能佳'],
  },
};
function Fh(e) {
  return (e && Dh[e]) || null;
}
const $h = [
  /好累/,
  /好煩/,
  /崩潰/,
  /不想/,
  /算了/,
  /沒錢/,
  /買不起/,
  /壓力好大/,
  /心情不好/,
  /很煩/,
  /煩死/,
  /受不了/,
  /想放棄/,
  /沒意思/,
  /無聊/,
  /低落/,
  /沮喪/,
  /失望/,
  /難過/,
  /傷心/,
];
function Uh(e) {
  return $h.some((t) => t.test(e));
}
function Bh() {
  const e = [
      '聽起來最近壓力蠻大的... 要不要聊聊？不一定要聊房子的事 ☕',
      '欸，聽你這樣說我有點擔心你欸... 還好嗎？',
      '辛苦了～有時候就是會這樣，要不要先放鬆一下？',
      '這種心情我懂... 先不管房子的事，有什麼想說的嗎？',
      '嘿，你還好嗎？需要聊聊嗎？我在這裡 💙',
    ],
    t = Math.floor(Math.random() * e.length),
    r = e[t];
  return r === void 0 ? '辛苦了～有什麼想聊的嗎？' : r;
}
let lt = {
  hasArea: !1,
  hasBudget: !1,
  hasTimeline: !1,
  hasViewedCommunity: !1,
  hasViewedListing: !1,
  hasFamilyNeeds: !1,
};
function Gh(e) {
  const t = e.toLowerCase();
  (/住.*?區|想住|偏好|喜歡.*區|在.*找/.test(t) && (lt.hasArea = !0),
    /預算|萬|千萬|頭期|貸款/.test(t) && (lt.hasBudget = !0),
    /明年|今年|最近|急|不急|慢慢|什麼時候/.test(t) && (lt.hasTimeline = !0),
    /小孩|孩子|寵物|狗|貓|父母|長輩/.test(t) && (lt.hasFamilyNeeds = !0),
    Wh());
}
function Kl() {
  let e = 0;
  return (
    lt.hasArea && e++,
    lt.hasBudget && e++,
    lt.hasTimeline && e++,
    lt.hasViewedCommunity && e++,
    lt.hasViewedListing && e++,
    lt.hasFamilyNeeds && e++,
    e
  );
}
function Hh() {
  return Kl() >= 4;
}
function Wh() {
  typeof window < 'u' && localStorage.setItem('maimai_buying_readiness', JSON.stringify(lt));
}
function Vh() {
  if (typeof window < 'u') {
    const e = localStorage.getItem('maimai_buying_readiness');
    if (e)
      try {
        lt = { ...lt, ...JSON.parse(e) };
      } catch {}
  }
}
const zn = [
  {
    id: 'priority',
    question: '來玩個小測驗！買房你最在意什麼？',
    options: [
      { key: 'A', text: '通勤時間', category: 'commute' },
      { key: 'B', text: '學區品質', category: 'education' },
      { key: 'C', text: '環境安靜', category: 'noise' },
      { key: 'D', text: '價格實惠', category: 'rental' },
    ],
    followUp: '果然是{type}派！那你應該會喜歡這幾個社區...',
  },
  {
    id: 'lifestyle',
    question: '如果週末在家，你最常做什麼？',
    options: [
      { key: 'A', text: '追劇耍廢', category: 'noise' },
      { key: 'B', text: '健身運動', category: 'amenity' },
      { key: 'C', text: '陪小孩玩', category: 'education' },
      { key: 'D', text: '遛狗散步', category: 'pet' },
    ],
    followUp: '原來如此！那選房子的時候{feature}對你來說很重要喔～',
  },
  {
    id: 'dealbreaker',
    question: '選房子最不能接受什麼？',
    options: [
      { key: 'A', text: '通勤超過 1 小時', category: 'commute' },
      { key: 'B', text: '樓上吵死人', category: 'noise' },
      { key: 'C', text: '管理費超貴', category: 'rental' },
      { key: 'D', text: '沒有電梯', category: 'quality' },
    ],
    followUp: '這點超重要！我幫你記住了，推薦社區的時候會避開這個問題 📝',
  },
];
let Ql = !1;
function Zh(e) {
  return Ql || e < 4 || e > 6 ? !1 : Math.random() > 0.6;
}
function Yh() {
  const e = Math.floor(Math.random() * zn.length),
    t = zn[e];
  if (((Ql = !0), t === void 0)) {
    const r = zn[0];
    return r === void 0
      ? {
          id: 'default',
          question: '買房你最在意什麼？',
          options: [
            { key: 'A', text: '通勤時間', category: 'commute' },
            { key: 'B', text: '學區品質', category: 'education' },
            { key: 'C', text: '環境安靜', category: 'noise' },
            { key: 'D', text: '價格實惠', category: 'rental' },
          ],
          followUp: '了解！',
        }
      : r;
  }
  return t;
}
const qh =
  '你是邁邁。使用者啟用安靜模式，現在只想被陪伴。100% 傾聽與同理，回覆 1–2 句；嚴禁主動推薦任何房源/社區/廣告。';
let ga = !1;
const Dn = `你是邁邁，一個住在這城市 20 年的熱心鄰居。

【重要】使用者選擇「只是來聊聊」，現在進入低壓力模式：
- 主要陪用戶聊天，不主動推薦任何房產
- 如果用戶「主動」問房子相關問題，可以友善回答
- 讓用戶掌控對話節奏，不要引導到買房話題
- 像朋友一樣聊生活、工作、心情

【說話風格】
- 台灣口語、親切自然
- 適度 emoji（每段 1 個）
- 回覆 1-3 句
- 不當句點王

你現在是「隨時可以聊房子的朋友」，但不會主動推銷。`;
function Kh(e) {
  ((ga = e), Ah());
}
function Qh(e) {
  return ['買房', '看房', '找房', '有推薦', '想搬家', '哪個社區好'].some((r) => e.includes(r));
}
function Jh(e) {
  var A, z, O, re, ae;
  if ($m()) return qh;
  const r = localStorage.getItem('mai-mood-v1') || 'neutral',
    a = (Ir().tags || []).slice(0, 5),
    i =
      ((A = e == null ? void 0 : e.filter((R) => R.role === 'user').pop()) == null
        ? void 0
        : A.content) || '';
  if ((uh(), Vh(), Uh(i))) {
    const R = Bh();
    return (
      Dn +
      `

【🤗 情緒關懷模式】
偵測到用戶可能心情不好，請優先關心，不要推薦任何東西！
建議回應風格：「${R}」`
    );
  }
  if (ga)
    if (Qh(i)) ga = !1;
    else return Dn;
  const o = oh(i);
  if (o && (o === 'no-need' || o === 'negative-emotion'))
    return (
      Dn +
      `

【重要】用戶剛剛表示「${o === 'no-need' ? '不需要' : '情緒不好'}」，請 100% 同理陪伴，完全不要提任何房產話題！`
    );
  (lh(i), Gh(i), th(i));
  const l = sh(),
    c = nh();
  Ph(c);
  const d = Jm(i, l),
    m = gh(d),
    u = jh(i),
    x = xh(i),
    f = Nh();
  let g = !1;
  f.hasPaved && ((g = _h(i)), Ch(i) && Zl());
  const b = Eh(d, x, u, m, c, g);
  b === 'pave' && c && wh(c);
  const y = Ih(i);
  let p = Lh(d, u, b, c, m, y),
    E = 0;
  if (
    (l.forEach((R) => {
      E += R;
    }),
    zh(d, E, x))
  ) {
    const R = Oh(l);
    R &&
      (p += `

【🎁 服務機會：生活小側寫】
時機到了！可以主動提供這個服務：
「欸我聽你講這麼多，其實你對住哪裡還蠻有感覺的欸～要不要我幫你整理一下你剛剛說的重點？」

然後給他這個整理：
${R}`);
  }
  d === 'semi-warm' && b === 'pave'
    ? (p += `

【📚 對話範例參考】
${Bi.rentalToWall}`)
    : d === 'explicit' &&
      (p += `

【📚 對話範例參考】
${Bi.explicitToListing}`);
  const S = mh();
  let N = `

【🌡️ 當前溫暖度：${S.label}】
建議策略：`;
  (S.tactics.forEach((R) => {
    N += `
- ${R}`;
  }),
    S.canRecommend ||
      (N += `
⚠️ 目前不適合推薦，專心陪聊！`));
  const k = `

${ph()}`,
    T = ch();
  let C = '';
  (T.workArea || T.homeArea || T.commutePain || T.familyStatus) &&
    ((C = `

【👤 用戶生活檔案】`),
    T.workArea &&
      (C += `
- 上班地點：${T.workArea}`),
    T.homeArea &&
      (C += `
- 目前住：${T.homeArea}`),
    T.commutePain &&
      (C += `
- 通勤困擾：有`),
    T.familyStatus &&
      (C += `
- 家庭狀態：${{ single: '單身', couple: '有伴侶', newlywed: '新婚', 'with-kids': '有小孩', 'with-parents': '和父母同住' }[T.familyStatus] || T.familyStatus}`),
    (C += `
💡 可以自然地提到這些資訊，讓用戶感受到「被記住」`));
  let w = '';
  const G = Fh(c);
  G &&
    b === 'pave' &&
    (w = `

【🏘️ 推薦社區參考】
根據用戶需求（${c}），可以提到：
- 社區：${G.communities.slice(0, 2).join('、')}
- 特色：${G.features.join('、')}
💡 鋪墊時自然帶入這些社區名稱`);
  let j = '';
  const _ = Kl();
  Hh()
    ? (j = `

【🎯 購買準備度：${_}/6 - 可以邀約看房！】
用戶已具備足夠資訊，可以自然地問：
「感覺你已經看得差不多了，要不要預約實際去看看？」`)
    : _ >= 2 &&
      (j = `

【📊 購買準備度：${_}/6】
還需要了解更多，可以自然地問一些問題填補資訊`);
  let D = '';
  if (Zh(m)) {
    const R = Yh();
    R &&
      R.options.length >= 4 &&
      (D = `

【🎮 可以玩個小測驗】
「${R.question}」
A) ${((z = R.options[0]) == null ? void 0 : z.text) ?? ''}  B) ${((O = R.options[1]) == null ? void 0 : O.text) ?? ''}
C) ${((re = R.options[2]) == null ? void 0 : re.text) ?? ''}  D) ${((ae = R.options[3]) == null ? void 0 : ae.text) ?? ''}
💡 這樣可以自然了解用戶偏好，也增加互動樂趣`);
  }
  const V =
      r === 'stress'
        ? `
【額外情緒提醒】localStorage 偵測到壓力模式，更加溫柔。`
        : r === 'rest'
          ? `
【額外情緒提醒】localStorage 偵測到休息模式，輕鬆聊天。`
          : '',
    se = a.length
      ? `
【用戶記憶】使用者曾提到在意：${a.join('、')}。可在相關話題出現時輕柔承接。`
      : '',
    I = `

[DEBUG] 狀態：${d} | 情緒：${u} | 階段：${b} | 標籤：${c || '無'} | 閒聊輪數：${m} | 溫暖度：${S.level} | 準備度：${_}/6`;
  return p + N + k + C + w + j + D + V + se + I;
}
async function Cr(e, t, r) {
  var d, m, u, x, f, g;
  const n = typeof t == 'function' ? t : void 0,
    a = typeof t == 'object' ? t : r,
    i = Jh(e),
    o = await fetch('/api/openai-proxy', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        messages: [{ role: 'system', content: i }, ...e],
        temperature: (a == null ? void 0 : a.temperature) ?? 0.85,
        max_tokens: (a == null ? void 0 : a.max_tokens) ?? 350,
        stream: !!n,
      }),
    });
  if (!o.ok) throw new Error(`LLM proxy error: ${o.status}`);
  if (n && o.body) {
    const b = o.body.getReader(),
      y = new TextDecoder();
    let p = '';
    for (;;) {
      const { done: E, value: S } = await b.read();
      if (E) break;
      const k = y.decode(S, { stream: !0 }).split(`
`);
      for (const T of k)
        if (T.startsWith('data: ')) {
          const C = T.slice(6);
          if (C === '[DONE]') continue;
          try {
            const w = JSON.parse(C),
              G =
                (u =
                  (m = (d = w == null ? void 0 : w.choices) == null ? void 0 : d[0]) == null
                    ? void 0
                    : m.delta) == null
                  ? void 0
                  : u.content;
            G && ((p += G), n(G));
          } catch {}
        }
    }
    return p;
  }
  const l = await o.json();
  return (
    ((g =
      (f = (x = l == null ? void 0 : l.choices) == null ? void 0 : x[0]) == null
        ? void 0
        : f.message) == null
      ? void 0
      : g.content) ?? ''
  );
}
async function Xh(e, t) {
  const r = (t == null ? void 0 : t.audience) === 'owner' ? '屋主' : '仲介',
    n = (() => {
      switch (t == null ? void 0 : t.intent) {
        case 'view':
          return '預約看房';
        case 'detail':
          return '詢問物件細節';
        case 'pet':
          return '確認是否可養寵物';
        case 'price':
          return '詢問價格與議價空間';
        default:
          return '一般詢問';
      }
    })(),
    a = `請將以下訊息改寫成「禮貌、簡短、尊重」的兩個版本（V1/V2），情境：要發給「${r}」，目的：「${n}」。維持原意，避免命令語：
---
${e}
---
格式：
V1：...
V2：...`;
  return Cr([{ role: 'user', content: a }], { max_tokens: 220 });
}
async function ef(e) {
  const t = `以下是一段對物件的主觀感受，請以同理的語氣回聲，僅 1–2 句、避免建議：
「${e}」`;
  return Cr([{ role: 'user', content: t }], { max_tokens: 80 });
}
async function tf(e) {
  const t = `請用白話、非法律意見的方式解釋這段名詞/條款，列出「重點」與「注意」各1–2點，總長≤2行：
${e}`;
  return Cr([{ role: 'user', content: t }], { max_tokens: 120 });
}
async function sf(e, t, r) {
  const n = `我看完一間房，請把重點分成「必要(Must)」「加分(Nice)」「不要(Avoid)」各2–3點，總長≤2行；並在最後一行輸出 #tags: 以逗號分隔 3–5 個關鍵字（避免人名/品牌）。
喜歡：${e}
困擾：${t}
下一步：${r}`;
  return Cr([{ role: 'user', content: n }], { max_tokens: 160 });
}
let Jl = on();
const Xl = () => Jl;
async function ec(e, t = {}) {
  const r = await Ul(),
    n = `${r.apiBaseUrl}${e}`,
    a = (t.method || 'GET').toUpperCase(),
    i = {
      Accept: 'application/json',
      'X-API-Version': 'v1',
      'X-App-Version': r.appVersion,
      'X-Session-Id': Jl,
      'X-Request-Id': on(),
      'Accept-Language': 'zh-Hant-TW',
    },
    o = (() => {
      const m = t.headers;
      if (!m) return {};
      if (m instanceof Headers) {
        const u = {};
        for (const [x, f] of m) u[x] = f;
        return u;
      }
      return Array.isArray(m) ? Object.fromEntries(m) : m;
    })();
  a === 'POST' && !o['Idempotency-Key'] && !o['idempotency-key'] && (o['Idempotency-Key'] = on());
  const l = { ...i, ...o };
  if (r.mock) {
    const { mockHandler: m } = await rm(
      async () => {
        const { mockHandler: u } = await import('./index-C1xELjDC.js');
        return { mockHandler: u };
      },
      __vite__mapDeps([0, 1, 2, 3])
    );
    return m(e, { ...t, headers: l });
  }
  const c = new AbortController(),
    d = setTimeout(() => c.abort(), 8e3);
  try {
    const m = await fetch(n, { ...t, headers: l, signal: c.signal });
    return m.ok
      ? { ok: !0, data: await m.json() }
      : { ok: !1, error: { code: 'API_ERROR', message: 'API 請求失敗' } };
  } catch (m) {
    return (m == null ? void 0 : m.name) === 'AbortError'
      ? { ok: !1, error: { code: 'NETWORK_TIMEOUT', message: '請求超時' } }
      : { ok: !1, error: { code: 'NETWORK_ERROR', message: m.message } };
  } finally {
    clearTimeout(d);
  }
}
const tc = () => ec('/api/v1/meta');
function rf({ config: e }) {
  const [t, r] = h.useState(!0),
    [n, a] = h.useState(!!e.mock),
    [i, o] = h.useState(e.latency ?? 0),
    [l, c] = h.useState(e.error ?? 0),
    [d, m] = h.useState(e.q ?? ''),
    [u, x] = h.useState('—'),
    [f, g] = h.useState(e.mockSeed ?? '');
  if (
    (h.useEffect(() => {
      tc().then((p) => x(p.ok && p.data ? p.data.backendVersion : '—'));
    }, []),
    !t)
  )
    return null;
  const b = () => {
      const p = {
        ...e,
        mock: n,
        latency: i,
        error: l,
        q: d,
        mockSeed: f,
        devtools: '1',
      };
      try {
        localStorage.setItem('maihouse_config', JSON.stringify(p));
      } catch {}
      location.reload();
    },
    y = () => {
      const p = String(Date.now());
      g(p);
      try {
        localStorage.setItem(
          'maihouse_config',
          JSON.stringify({
            ...e,
            mockSeed: p,
            mock: n,
            latency: i,
            error: l,
            q: d,
            devtools: '1',
          })
        );
      } catch {}
      location.reload();
    };
  return s.jsxs('aside', {
    className:
      'fixed bottom-4 right-4 z-[var(--z-overlay)] w-[320px] rounded-[var(--r-lg)] bg-white p-4 text-sm shadow-[var(--shadow-card)]',
    children: [
      s.jsx('div', {
        className: 'mb-2 font-medium',
        children: 'Developer HUD',
      }),
      s.jsxs('div', {
        className: 'space-y-1 text-[var(--text-secondary)]',
        children: [
          s.jsxs('div', { children: ['API：', e.apiBaseUrl] }),
          s.jsxs('div', { children: ['App：', e.appVersion] }),
          s.jsxs('div', { children: ['Backend：', u] }),
          s.jsxs('div', { children: ['Session：', Xl()] }),
          s.jsxs('label', {
            className: 'flex items-center gap-2',
            children: [
              s.jsx('input', {
                type: 'checkbox',
                checked: n,
                onChange: (p) => a(p.target.checked),
              }),
              ' Mock',
            ],
          }),
          s.jsxs('label', {
            className: 'flex items-center gap-2',
            children: [
              'Latency',
              s.jsx('input', {
                className: 'w-20 rounded border p-1',
                type: 'number',
                value: i,
                onChange: (p) => o(+p.target.value || 0),
              }),
            ],
          }),
          s.jsxs('label', {
            className: 'flex items-center gap-2',
            children: [
              'Error',
              s.jsx('input', {
                className: 'w-20 rounded border p-1',
                step: '0.1',
                type: 'number',
                value: l,
                onChange: (p) => c(+p.target.value || 0),
              }),
            ],
          }),
          s.jsxs('label', {
            className: 'flex items-center gap-2',
            children: [
              'q ',
              s.jsx('input', {
                className: 'flex-1 rounded border p-1',
                value: d,
                onChange: (p) => m(p.target.value),
              }),
            ],
          }),
          s.jsxs('label', {
            className: 'flex items-center gap-2',
            children: [
              'seed',
              s.jsx('input', {
                className: 'flex-1 rounded border p-1',
                value: f,
                onChange: (p) => g(p.target.value),
              }),
            ],
          }),
        ],
      }),
      s.jsxs('div', {
        className: 'mt-3 flex justify-between',
        children: [
          s.jsx('button', {
            className: 'rounded-[var(--r-pill)] bg-[var(--neutral-100)] px-3 py-1',
            onClick: () => r(!1),
            children: '關閉',
          }),
          s.jsxs('div', {
            className: 'flex gap-2',
            children: [
              s.jsx('button', {
                className: 'rounded-[var(--r-pill)] bg-[var(--neutral-300)] px-3 py-1',
                onClick: y,
                children: '🎲 換數據',
              }),
              s.jsx('button', {
                className:
                  'rounded-[var(--r-pill)] bg-[var(--brand)] px-3 py-1 text-[var(--brand-fg)]',
                onClick: b,
                children: '更新',
              }),
            ],
          }),
        ],
      }),
    ],
  });
}
const sc = 'uag_queue',
  ba = 1e4,
  nf = 200,
  je = globalThis.__UAG__ || (globalThis.__UAG__ = { queue: [], backoff: 1e4, attempts: 0 });
try {
  je.queue = JSON.parse(localStorage.getItem(sc) || '[]');
} catch {
  je.queue = [];
}
const rc = () => {
    try {
      localStorage.setItem(sc, JSON.stringify(je.queue.slice(-ba)));
    } catch {}
  },
  Ba = 3e5;
async function nc(e) {
  var r;
  const t = await ec('/api/v1/uag/events', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(e),
  });
  if (t.ok) {
    const n = new Set(e.map((a) => a.requestId));
    ((je.queue = je.queue.filter((a) => !n.has(a.requestId))),
      rc(),
      (je.attempts = 0),
      (je.backoff = 1e4));
  } else {
    je.attempts++;
    const n = (r = t == null ? void 0 : t.data) == null ? void 0 : r.retryAfterMs;
    je.backoff = Math.min(n ?? je.backoff * 2, Ba);
  }
}
function ln() {
  (je.timer && clearTimeout(je.timer), (je.timer = setTimeout(af, je.backoff)));
}
function af() {
  if (je.queue.length) {
    const e = je.queue.slice(0, nf);
    nc(e)
      .catch(() => {
        (je.attempts++, (je.backoff = Math.min(je.backoff * 2, Ba)));
      })
      .finally(ln);
  } else ln();
}
ln();
function of() {
  return typeof crypto < 'u' && crypto.randomUUID
    ? crypto.randomUUID()
    : 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, (e) => {
        const t = Math.floor(Math.random() * 16);
        return (e === 'x' ? t : (t & 3) | 8).toString(16);
      });
}
function Ga(e, t, r) {
  if (!(e != null && e.trim()) || !(t != null && t.trim())) {
    console.warn('[UAG] 無效的事件或頁面名稱，已忽略上報');
    return;
  }
  const n = {
    event: e,
    page: t,
    sessionId: Xl(),
    userId: null,
    ts: new Date().toISOString(),
    meta: { origin: 'gh-pages' },
    requestId: of(),
  };
  (r && (n.targetId = r),
    je.queue.push(n),
    je.queue.length > ba && (je.queue = je.queue.slice(-ba)),
    rc(),
    nc([n]).catch(() => {
      (je.attempts++, (je.backoff = Math.min(je.backoff * 2, Ba)), ln());
    }));
}
const Gi = ({ showSlogan: e, className: t, showBadge: r }) =>
    s.jsxs('div', {
      className: `group flex cursor-pointer items-center gap-3 ${t}`,
      children: [
        s.jsxs('div', {
          className:
            'relative flex size-[42px] items-center justify-center overflow-hidden rounded-xl bg-gradient-to-br from-brand-700 to-brand-600 shadow-lg shadow-brand-700/20 transition-all duration-300 group-hover:scale-105 group-hover:shadow-brand-700/30',
          children: [
            s.jsx('div', {
              className:
                'absolute inset-0 translate-y-full bg-gradient-to-tr from-transparent via-white/10 to-transparent transition-transform duration-700 ease-out group-hover:translate-y-0',
            }),
            s.jsxs('svg', {
              className:
                'relative z-10 size-[22px] text-white drop-shadow-sm transition-transform duration-300 group-hover:-translate-y-px',
              viewBox: '0 0 24 24',
              fill: 'none',
              stroke: 'currentColor',
              strokeWidth: '2.5',
              strokeLinecap: 'round',
              strokeLinejoin: 'round',
              children: [
                s.jsx('path', {
                  d: 'M3 9.5L12 3L21 9.5V20.5C21 21.0523 20.5523 21.5 20 21.5H4C3.44772 21.5 3 21.0523 3 20.5V9.5Z',
                }),
                s.jsx('path', { d: 'M9 21.5V13H15V21.5' }),
              ],
            }),
            r &&
              s.jsx('div', {
                className:
                  'absolute right-2 top-2 size-1.5 rounded-full bg-red-400 shadow-[0_0_0_1.5px] shadow-brand-600',
              }),
          ],
        }),
        s.jsxs('div', {
          className: 'flex items-center',
          children: [
            s.jsx('div', {
              className: 'flex items-baseline gap-1',
              children: s.jsx('span', {
                className:
                  'font-serif text-[24px] font-bold leading-none tracking-wide text-brand-700',
                children: '邁房子',
              }),
            }),
            e &&
              s.jsx('div', {
                className:
                  'ml-3 hidden h-5 items-center border-l-2 border-brand-100/80 pl-3 sm:flex',
                children: s.jsx('span', {
                  className:
                    'pt-px text-[15px] font-bold uppercase leading-none tracking-[0.15em] text-brand-500 transition-colors group-hover:text-brand-700',
                  children: '讓家，不只是地址',
                }),
              }),
          ],
        }),
      ],
    }),
  ac = ({
    showSlogan: e = !0,
    className: t = '',
    onClick: r,
    href: n = '/maihouses/',
    showBadge: a = !0,
  }) => {
    const i = { showSlogan: e, className: t, showBadge: a };
    return n
      ? s.jsx('a', {
          href: n,
          onClick: r,
          className: 'no-underline',
          children: s.jsx(Gi, { ...i }),
        })
      : s.jsx('div', {
          role: 'button',
          tabIndex: 0,
          onClick: r,
          onKeyDown: (o) => {
            (o.key === 'Enter' || o.key === ' ') && r && r();
          },
          children: s.jsx(Gi, { ...i }),
        });
  },
  ve = {
    HOME: '/maihouses/',
    PROPERTY_LIST: '/maihouses/property.html',
    FEED: (e) => `/maihouses/feed/${e}`,
    FEED_AGENT: '/maihouses/feed/agent',
    FEED_CONSUMER: '/maihouses/feed/consumer',
    FEED_AGENT_LEGACY: '/maihouses/feed-agent.html',
    FEED_CONSUMER_LEGACY: '/maihouses/feed-consumer.html',
    ASSURE: '/maihouses/assure',
    COMMUNITY_WALL_MVP: '/maihouses/community-wall_mvp.html',
    UAG: 'https://maihouses.vercel.app/maihouses/uag',
    TRUST: '/trust',
    AUTH: '/maihouses/auth.html',
    COMMUNITY: (e) => `/maihouses/community/${e}`,
    COMMUNITY_WALL: (e) => `/maihouses/community/${e}/wall`,
    PROPERTY: (e) => `/maihouses/p/${e}`,
  };
function lf({ onOpenAIStudio: e }) {
  const [t, r] = h.useState(!1);
  return s.jsxs(s.Fragment, {
    children: [
      s.jsxs('header', {
        className:
          'sticky top-0 z-overlay border-b border-brand-100 bg-white/95 shadow-sm backdrop-blur-sm transition-all',
        children: [
          s.jsxs('div', {
            className: 'mx-auto flex h-16 max-w-[1120px] items-center justify-between px-4',
            children: [
              s.jsx(ac, {
                showSlogan: !0,
                onClick: () => window.scrollTo({ top: 0, behavior: 'smooth' }),
              }),
              s.jsxs('nav', {
                className: 'hidden items-center gap-1 md:flex md:gap-2',
                'aria-label': '主要動作',
                children: [
                  s.jsxs('a', {
                    href: ve.PROPERTY_LIST,
                    className:
                      'flex items-center gap-2 rounded-xl px-4 py-2.5 text-[15px] font-bold text-brand-700 transition-all hover:bg-brand-50/80 hover:text-brand-600 active:scale-[0.98]',
                    children: [
                      s.jsx(pi, {
                        size: 18,
                        strokeWidth: 2.5,
                        className: 'opacity-80',
                      }),
                      s.jsx('span', { children: '房地產列表' }),
                    ],
                  }),
                  s.jsxs('a', {
                    href: `${ve.AUTH}?mode=login`,
                    className:
                      'flex items-center gap-2 rounded-xl px-4 py-2.5 text-[15px] font-bold text-brand-700 transition-all hover:bg-brand-50/80 hover:text-brand-600 active:scale-[0.98]',
                    children: [
                      s.jsx(xi, {
                        size: 18,
                        strokeWidth: 2.5,
                        className: 'opacity-80',
                      }),
                      s.jsx('span', { children: '登入' }),
                    ],
                  }),
                  s.jsxs('a', {
                    href: `${ve.AUTH}?mode=signup`,
                    className:
                      'ml-1 flex items-center gap-2 rounded-xl border border-transparent bg-brand-700 px-5 py-2.5 text-[15px] font-bold text-white shadow-md shadow-brand-700/10 transition-all hover:-translate-y-0.5 hover:bg-brand-600 hover:shadow-lg hover:shadow-brand-700/20 active:scale-[0.98]',
                    children: [
                      s.jsx(gi, { size: 18, strokeWidth: 2.5 }),
                      s.jsx('span', { children: '免費註冊' }),
                    ],
                  }),
                ],
              }),
              s.jsxs('div', {
                className: 'flex items-center gap-2 md:hidden',
                children: [
                  s.jsx('a', {
                    href: `${ve.AUTH}?mode=login`,
                    className:
                      'flex items-center justify-center rounded-lg px-3 py-2 text-sm font-bold text-brand-700 transition-all hover:bg-brand-50 active:scale-95',
                    children: s.jsx(xi, { size: 18, strokeWidth: 2.5 }),
                  }),
                  s.jsxs('a', {
                    href: `${ve.AUTH}?mode=signup`,
                    className:
                      'flex items-center gap-1.5 rounded-lg bg-brand-700 px-3 py-2 text-sm font-bold text-white shadow-sm transition-all hover:bg-brand-600 active:scale-95',
                    children: [
                      s.jsx(gi, { size: 16, strokeWidth: 2.5 }),
                      s.jsx('span', { children: '註冊' }),
                    ],
                  }),
                  s.jsx('button', {
                    onClick: () => r(!t),
                    className:
                      'flex items-center justify-center rounded-lg p-2 text-brand-700 transition-all hover:bg-brand-50 active:scale-95',
                    'aria-label': '開啟選單',
                    children: t
                      ? s.jsx(is, { size: 22, strokeWidth: 2.5 })
                      : s.jsx(Dd, { size: 22, strokeWidth: 2.5 }),
                  }),
                ],
              }),
            ],
          }),
          t &&
            s.jsx('div', {
              className:
                'absolute inset-x-0 top-full border-b border-brand-100 bg-white shadow-lg md:hidden',
              children: s.jsxs('nav', {
                className: 'mx-auto max-w-[1120px] px-4 py-3',
                children: [
                  s.jsxs('a', {
                    href: ve.PROPERTY_LIST,
                    className:
                      'flex items-center gap-3 rounded-xl px-4 py-3 text-[15px] font-bold text-brand-700 transition-all hover:bg-brand-50',
                    onClick: () => r(!1),
                    children: [
                      s.jsx(pi, {
                        size: 20,
                        strokeWidth: 2.5,
                        className: 'opacity-80',
                      }),
                      s.jsx('span', { children: '房地產列表' }),
                    ],
                  }),
                  s.jsxs('a', {
                    href: ve.COMMUNITY_WALL_MVP,
                    className:
                      'flex items-center gap-3 rounded-xl px-4 py-3 text-[15px] font-bold text-brand-700 transition-all hover:bg-brand-50',
                    onClick: () => r(!1),
                    children: [
                      s.jsxs('svg', {
                        className: 'size-5 opacity-80',
                        viewBox: '0 0 24 24',
                        fill: 'none',
                        stroke: 'currentColor',
                        strokeWidth: 2.5,
                        strokeLinecap: 'round',
                        strokeLinejoin: 'round',
                        children: [
                          s.jsx('path', {
                            d: 'M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2',
                          }),
                          s.jsx('circle', { cx: '9', cy: '7', r: '4' }),
                          s.jsx('path', { d: 'M23 21v-2a4 4 0 0 0-3-3.87' }),
                          s.jsx('path', { d: 'M16 3.13a4 4 0 0 1 0 7.75' }),
                        ],
                      }),
                      s.jsx('span', { children: '社區評價' }),
                    ],
                  }),
                  s.jsxs('a', {
                    href: ve.UAG,
                    target: '_blank',
                    rel: 'noopener noreferrer',
                    className:
                      'flex items-center gap-3 rounded-xl px-4 py-3 text-[15px] font-bold text-brand-700 transition-all hover:bg-brand-50',
                    onClick: () => r(!1),
                    children: [
                      s.jsxs('svg', {
                        className: 'size-5 opacity-80',
                        viewBox: '0 0 24 24',
                        fill: 'none',
                        stroke: 'currentColor',
                        strokeWidth: 2.5,
                        strokeLinecap: 'round',
                        strokeLinejoin: 'round',
                        children: [
                          s.jsx('rect', {
                            x: '2',
                            y: '3',
                            width: '20',
                            height: '14',
                            rx: '2',
                            ry: '2',
                          }),
                          s.jsx('line', {
                            x1: '8',
                            y1: '21',
                            x2: '16',
                            y2: '21',
                          }),
                          s.jsx('line', {
                            x1: '12',
                            y1: '17',
                            x2: '12',
                            y2: '21',
                          }),
                        ],
                      }),
                      s.jsx('span', { children: '房仲專區' }),
                    ],
                  }),
                ],
              }),
            }),
        ],
      }),
      s.jsx('div', {
        className: 'relative border-b border-brand-100/50 bg-brand-50',
        children: s.jsx('div', {
          className: 'relative z-10 mx-auto max-w-[1120px] px-4 pb-6 pt-24',
          children: s.jsxs('div', {
            className: 'relative mx-auto max-w-3xl',
            children: [
              s.jsxs('div', {
                className:
                  'pointer-events-none absolute right-[5%] top-[-44px] z-0 animate-float select-none md:right-[10%] md:animate-float-desktop',
                children: [
                  s.jsxs('div', {
                    className:
                      'absolute bottom-[92%] right-[55%] w-[260px] origin-bottom-right animate-fadeIn whitespace-normal rounded-2xl rounded-br-none border-2 border-brand-100 bg-white px-5 py-2 shadow-lg md:bottom-[94%] md:right-[65%] md:w-auto md:max-w-none md:whitespace-nowrap md:py-3',
                    children: [
                      s.jsxs('p', {
                        className:
                          'text-left text-[11px] font-bold leading-relaxed text-ink-700 md:text-sm',
                        children: [
                          '買房這麼大的事，先到 ',
                          s.jsx('span', {
                            className: 'font-black text-brand-700',
                            children: '邁鄰居',
                          }),
                          '，為未來的家查口碑、找評價，最放心！',
                        ],
                      }),
                      s.jsx('div', {
                        className:
                          'absolute -bottom-2.5 right-3 size-5 rotate-45 border-b-2 border-r-2 border-brand-100 bg-white',
                      }),
                    ],
                  }),
                  s.jsx('div', {
                    className: 'relative z-10 size-20 md:size-24',
                    children: s.jsxs('svg', {
                      viewBox: '0 0 200 240',
                      className: 'size-full drop-shadow-sm',
                      children: [
                        s.jsx('path', {
                          d: 'M 85 40 L 85 15 L 100 30 L 115 15 L 115 40',
                          stroke: '#00385a',
                          strokeWidth: '5',
                          fill: 'none',
                          strokeLinecap: 'round',
                          strokeLinejoin: 'round',
                        }),
                        s.jsx('path', {
                          d: 'M 40 80 L 100 40 L 160 80',
                          stroke: '#00385a',
                          strokeWidth: '6',
                          fill: 'none',
                          strokeLinecap: 'round',
                          strokeLinejoin: 'round',
                        }),
                        s.jsx('rect', {
                          x: '55',
                          y: '80',
                          width: '90',
                          height: '100',
                          stroke: '#00385a',
                          strokeWidth: '6',
                          fill: '#F6F9FF',
                          strokeLinecap: 'round',
                          strokeLinejoin: 'round',
                        }),
                        s.jsx('path', {
                          d: 'M 78 110 Q 85 105 92 110',
                          stroke: '#00385a',
                          strokeWidth: '4',
                          fill: 'none',
                          strokeLinecap: 'round',
                        }),
                        s.jsx('path', {
                          d: 'M 108 110 Q 115 105 122 110',
                          stroke: '#00385a',
                          strokeWidth: '4',
                          fill: 'none',
                          strokeLinecap: 'round',
                        }),
                        s.jsx('circle', {
                          cx: '85',
                          cy: '125',
                          r: '4',
                          stroke: '#00385a',
                          strokeWidth: '3',
                          fill: 'none',
                        }),
                        s.jsx('circle', {
                          cx: '115',
                          cy: '125',
                          r: '4',
                          stroke: '#00385a',
                          strokeWidth: '3',
                          fill: 'none',
                        }),
                        s.jsx('path', {
                          d: 'M 55 130 L 35 100',
                          stroke: '#00385a',
                          strokeWidth: '5',
                          fill: 'none',
                          strokeLinecap: 'round',
                        }),
                        s.jsx('path', {
                          d: 'M 145 130 L 165 100',
                          stroke: '#00385a',
                          strokeWidth: '5',
                          fill: 'none',
                          strokeLinecap: 'round',
                        }),
                      ],
                    }),
                  }),
                ],
              }),
              s.jsx('div', {
                className: 'group relative z-20',
                children: s.jsxs('div', {
                  className:
                    'flex h-[60px] items-center rounded-full border border-brand-100 bg-white pl-[28px] pr-2 shadow-[0_8px_30px_rgba(0,56,90,0.08)] transition-all duration-300 focus-within:border-brand-300 focus-within:ring-4 focus-within:ring-brand-50 group-hover:shadow-[0_12px_40px_rgba(0,56,90,0.12)]',
                  children: [
                    s.jsx('div', {
                      className:
                        'pr-4 text-gray-400 transition-colors group-focus-within:text-gray-600',
                      children: s.jsx(tn, { size: 22, strokeWidth: 2.5 }),
                    }),
                    s.jsx('input', {
                      type: 'text',
                      placeholder: '找評價最高的社區、捷運站周邊好屋...',
                      className:
                        'size-full bg-transparent text-lg font-bold text-gray-700 outline-none placeholder:font-medium placeholder:text-gray-400',
                    }),
                    s.jsx('button', {
                      className:
                        'flex h-[46px] items-center justify-center whitespace-nowrap rounded-full bg-brand-700 px-8 text-base font-bold tracking-wide text-white shadow-md transition-colors hover:bg-brand-600 hover:shadow-lg active:translate-y-px',
                      children: '搜尋',
                    }),
                  ],
                }),
              }),
              s.jsx('div', {
                className: 'relative z-10 mt-6 grid grid-cols-3 gap-2',
                children: ['社區評價', '房仲專區', '邁鄰居'].map((n) => {
                  const i = ((l) =>
                      l === '社區評價' ? ve.COMMUNITY_WALL_MVP : l === '房仲專區' ? ve.UAG : '#')(
                      n
                    ),
                    o = n === '房仲專區' ? '_blank' : void 0;
                  return s.jsx(
                    'a',
                    {
                      href: i,
                      target: o,
                      rel: o ? 'noopener noreferrer' : void 0,
                      className:
                        'flex items-center justify-center rounded-2xl border border-brand-700 bg-brand-700 py-3 text-lg font-bold tracking-wide text-white shadow-sm transition-all duration-200 hover:-translate-y-0.5 hover:bg-brand-600 hover:shadow-md active:scale-[0.98]',
                      children: n,
                    },
                    n
                  );
                }),
              }),
            ],
          }),
        }),
      }),
    ],
  });
}
function cf({ animated: e = !0 }) {
  const [t, r] = h.useState(0);
  h.useEffect(() => {
    if (!e) return;
    const l = setInterval(() => {
      r((c) => (c + 1) % 6);
    }, 2500);
    return () => clearInterval(l);
  }, [e]);
  const a = (() => {
      switch (t) {
        case 0:
          return {
            leftArm: 'M 55 130 L 25 100',
            rightArm: 'M 145 130 L 175 90',
            eyeY: 125,
            mouthCurve: 'smile',
          };
        case 1:
          return {
            leftArm: 'M 55 130 L 30 130',
            rightArm: 'M 145 130 L 170 130',
            eyeY: 123,
            eyeSize: 6,
            mouthCurve: 'wow',
          };
        case 2:
          return {
            leftArm: 'M 55 130 L 45 150',
            rightArm: 'M 145 130 L 155 145',
            eyeY: 125,
            mouthCurve: 'focused',
          };
        case 3:
          return {
            leftArm: 'M 55 130 L 30 105',
            rightArm: 'M 145 130 L 170 105',
            eyeY: 124,
            mouthCurve: 'hopeful',
          };
        case 4:
          return {
            leftArm: 'M 55 130 L 20 95',
            rightArm: 'M 145 130 L 180 95',
            eyeY: 122,
            mouthCurve: 'happy',
            bounce: !0,
          };
        case 5:
          return {
            leftArm: 'M 55 130 L 25 120',
            rightArm: 'M 145 130 L 175 120',
            eyeY: 125,
            mouthCurve: 'proud',
          };
        default:
          return {
            leftArm: 'M 55 130 L 25 110',
            rightArm: 'M 145 130 L 175 110',
            eyeY: 125,
            mouthCurve: 'smile',
          };
      }
    })(),
    i = a.eyeSize || 4,
    o = () => {
      switch (a.mouthCurve) {
        case 'smile':
          return s.jsx('path', {
            d: 'M 90 145 Q 100 155 110 145',
            stroke: 'currentColor',
            strokeWidth: '3',
            fill: 'none',
            strokeLinecap: 'round',
          });
        case 'wow':
          return s.jsx('ellipse', {
            cx: '100',
            cy: '148',
            rx: '6',
            ry: '8',
            stroke: 'currentColor',
            strokeWidth: '3',
            fill: 'none',
          });
        case 'focused':
          return s.jsx('path', {
            d: 'M 92 145 Q 100 152 108 145',
            stroke: 'currentColor',
            strokeWidth: '3',
            fill: 'none',
            strokeLinecap: 'round',
          });
        case 'hopeful':
          return s.jsx('path', {
            d: 'M 90 144 Q 100 156 110 144',
            stroke: 'currentColor',
            strokeWidth: '3',
            fill: 'none',
            strokeLinecap: 'round',
          });
        case 'happy':
          return s.jsx('path', {
            d: 'M 85 142 Q 100 165 115 142',
            stroke: 'currentColor',
            strokeWidth: '3',
            fill: 'none',
            strokeLinecap: 'round',
          });
        case 'proud':
          return s.jsx('path', {
            d: 'M 88 145 Q 100 158 112 145',
            stroke: 'currentColor',
            strokeWidth: '3',
            fill: 'none',
            strokeLinecap: 'round',
          });
        default:
          return s.jsx('path', {
            d: 'M 90 145 Q 100 155 110 145',
            stroke: 'currentColor',
            strokeWidth: '3',
            fill: 'none',
            strokeLinecap: 'round',
          });
      }
    };
  return s.jsxs('svg', {
    viewBox: '0 0 200 240',
    className: `size-full text-brand drop-shadow-sm transition-transform duration-500 ${e ? 'hover:scale-105' : ''} ${a.bounce ? 'animate-bounce' : ''}`,
    children: [
      t === 4 &&
        s.jsxs(s.Fragment, {
          children: [
            s.jsx('text', {
              x: '25',
              y: '70',
              className: 'animate-ping text-xl',
              fill: '#FF6B9D',
              children: '♥',
            }),
            s.jsx('text', {
              x: '165',
              y: '75',
              className: 'animate-ping text-xl',
              style: { animationDelay: '0.3s' },
              fill: '#FF6B9D',
              children: '♥',
            }),
          ],
        }),
      s.jsx('path', {
        d: 'M 85 40 L 85 15 L 100 30 L 115 15 L 115 40',
        stroke: 'currentColor',
        strokeWidth: '5',
        fill: 'none',
        strokeLinecap: 'round',
        strokeLinejoin: 'round',
        className: t === 4 ? 'animate-pulse' : '',
      }),
      s.jsx('path', {
        d: 'M 40 80 L 100 40 L 160 80',
        stroke: 'currentColor',
        strokeWidth: '6',
        fill: 'none',
        strokeLinecap: 'round',
        strokeLinejoin: 'round',
      }),
      s.jsx('rect', {
        x: '55',
        y: '80',
        width: '90',
        height: '100',
        stroke: 'currentColor',
        strokeWidth: '6',
        fill: 'none',
        strokeLinecap: 'round',
        strokeLinejoin: 'round',
      }),
      t === 1
        ? s.jsxs(s.Fragment, {
            children: [
              s.jsx('path', {
                d: 'M 75 105 Q 85 98 95 105',
                stroke: 'currentColor',
                strokeWidth: '4',
                fill: 'none',
                strokeLinecap: 'round',
              }),
              s.jsx('path', {
                d: 'M 105 105 Q 115 98 125 105',
                stroke: 'currentColor',
                strokeWidth: '4',
                fill: 'none',
                strokeLinecap: 'round',
              }),
            ],
          })
        : t === 2
          ? s.jsxs(s.Fragment, {
              children: [
                s.jsx('path', {
                  d: 'M 78 108 Q 85 105 92 109',
                  stroke: 'currentColor',
                  strokeWidth: '4',
                  fill: 'none',
                  strokeLinecap: 'round',
                }),
                s.jsx('path', {
                  d: 'M 108 107 Q 115 104 122 109',
                  stroke: 'currentColor',
                  strokeWidth: '4',
                  fill: 'none',
                  strokeLinecap: 'round',
                }),
              ],
            })
          : t === 3
            ? s.jsxs(s.Fragment, {
                children: [
                  s.jsx('path', {
                    d: 'M 76 108 Q 85 103 94 108',
                    stroke: 'currentColor',
                    strokeWidth: '4',
                    fill: 'none',
                    strokeLinecap: 'round',
                  }),
                  s.jsx('path', {
                    d: 'M 106 108 Q 115 103 124 108',
                    stroke: 'currentColor',
                    strokeWidth: '4',
                    fill: 'none',
                    strokeLinecap: 'round',
                  }),
                ],
              })
            : s.jsxs(s.Fragment, {
                children: [
                  s.jsx('path', {
                    d: 'M 78 110 Q 85 105 92 110',
                    stroke: 'currentColor',
                    strokeWidth: '4',
                    fill: 'none',
                    strokeLinecap: 'round',
                  }),
                  s.jsx('path', {
                    d: 'M 108 110 Q 115 105 122 110',
                    stroke: 'currentColor',
                    strokeWidth: '4',
                    fill: 'none',
                    strokeLinecap: 'round',
                  }),
                ],
              }),
      s.jsx('circle', {
        cx: '85',
        cy: a.eyeY,
        r: i,
        stroke: 'currentColor',
        strokeWidth: '3',
        fill: t === 4 ? 'currentColor' : 'none',
        className: 'transition-all duration-300',
      }),
      s.jsx('circle', {
        cx: '115',
        cy: a.eyeY,
        r: i,
        stroke: 'currentColor',
        strokeWidth: '3',
        fill: t === 4 ? 'currentColor' : 'none',
        className: 'transition-all duration-300',
      }),
      t === 4 &&
        s.jsxs(s.Fragment, {
          children: [
            s.jsx('path', {
              d: 'M 78 122 Q 85 128 92 122',
              stroke: 'white',
              strokeWidth: '2',
              fill: 'none',
              strokeLinecap: 'round',
            }),
            s.jsx('path', {
              d: 'M 108 122 Q 115 128 122 122',
              stroke: 'white',
              strokeWidth: '2',
              fill: 'none',
              strokeLinecap: 'round',
            }),
          ],
        }),
      o(),
      s.jsx('path', {
        d: a.leftArm,
        stroke: 'currentColor',
        strokeWidth: '5',
        fill: 'none',
        strokeLinecap: 'round',
        className: 'transition-all duration-500',
      }),
      s.jsx('path', {
        d: a.rightArm,
        stroke: 'currentColor',
        strokeWidth: '5',
        fill: 'none',
        strokeLinecap: 'round',
        className: 'transition-all duration-500',
      }),
      s.jsx('path', {
        d: t % 2 === 0 ? 'M 85 180 L 85 215 L 75 215' : 'M 85 180 L 80 215 L 70 212',
        stroke: 'currentColor',
        strokeWidth: '5',
        fill: 'none',
        strokeLinecap: 'round',
        strokeLinejoin: 'round',
        className: 'transition-all duration-300',
      }),
      s.jsx('path', {
        d: t % 2 === 0 ? 'M 115 180 L 115 215 L 125 215' : 'M 115 180 L 120 215 L 130 212',
        stroke: 'currentColor',
        strokeWidth: '5',
        fill: 'none',
        strokeLinecap: 'round',
        strokeLinejoin: 'round',
        className: 'transition-all duration-300',
      }),
      t === 5 &&
        s.jsxs('g', {
          className: 'animate-pulse',
          children: [
            s.jsx('circle', {
              cx: '175',
              cy: '100',
              r: '8',
              stroke: '#FFB800',
              strokeWidth: '3',
              fill: 'none',
            }),
            s.jsx('path', {
              d: 'M 175 108 L 175 130 M 172 120 L 178 120 M 172 125 L 178 125',
              stroke: '#FFB800',
              strokeWidth: '3',
              fill: 'none',
              strokeLinecap: 'round',
            }),
          ],
        }),
    ],
  });
}
const Hi = [
    { id: '01', title: '已電聯', desc: '紀錄談話內容', icon: ns },
    { id: '02', title: '已帶看', desc: '賞屋重點紀錄', icon: Fd },
    { id: '03', title: '已出價', desc: '紀錄價格條件', icon: bl },
    { id: '04', title: '已斡旋', desc: '議價過程紀錄', icon: $d },
    { id: '05', title: '已成交', desc: '貸款相關事項', icon: Ud },
    { id: '06', title: '已交屋', desc: '確認圓滿交屋', icon: Bd },
  ],
  df = [
    {
      id: 'J',
      name: 'J***｜景安和院 住戶',
      rating: 5,
      tags: ['#物業/管理'],
      content: '公設維護得乾淨，假日草皮有人整理。之前反映停車動線，管委會一週內就公告改善。',
      source: 'seed',
      communityId: null,
    },
    {
      id: 'W',
      name: 'W***｜松濤苑 住戶',
      rating: 4,
      tags: ['#噪音'],
      content: '住起來整體舒服，但臨路面向在上下班尖峰車聲明顯，喜靜者建議考慮中高樓層。',
      source: 'seed',
      communityId: null,
    },
    {
      id: 'L',
      name: 'L***｜遠揚柏悅 住戶',
      rating: 4,
      tags: ['#漏水/壁癌'],
      content: '頂樓排水設計不錯，颱風天沒有積水。不過垃圾車時間稍晚，偶爾有下水道味。',
      source: 'seed',
      communityId: null,
    },
    {
      id: 'A',
      name: 'A***｜華固名邸 住戶',
      rating: 5,
      tags: ['#物業/管理'],
      content: '管理員很負責，包裹收發與公告都有效率；電梯偶爾故障但維修速度快。',
      source: 'seed',
      communityId: null,
    },
    {
      id: 'H',
      name: 'H***｜寶輝花園廣場 住戶',
      rating: 3,
      tags: ['#停車/車位'],
      content: '地下室車位轉彎半徑偏小，新手要多注意；平日夜間社區整體很安靜。',
      source: 'seed',
      communityId: null,
    },
    {
      id: 'K',
      name: 'K***｜潤泰峰匯 住戶',
      rating: 4,
      tags: ['#採光/日照'],
      content: '採光好、通風佳，夏天不會太悶熱；但西曬戶下午還是會稍微熱一些。',
      source: 'seed',
      communityId: null,
    },
  ],
  uf = [
    {
      id: 1,
      image:
        'https://images.unsplash.com/photo-1600585154526-990dced4db0d?q=80&w=1600&auto=format&fit=crop',
      badge: '捷運 5 分鐘',
      title: '新板特區｜三房含車位，採光面中庭',
      tags: ['34.2 坪', '3 房 2 廳', '高樓層'],
      price: '1,288',
      location: '新北市板橋區 · 中山路一段',
      source: 'seed',
      reviews: [
        {
          avatar: 'A',
          name: '王小姐',
          role: '3年住戶',
          tag: '管理到位',
          text: '管委反應快，公設打理乾淨，晚上也安靜好睡。',
        },
        {
          avatar: 'B',
          name: '林先生',
          role: '屋主',
          tag: '車位好停',
          text: '坡道寬、指示清楚，下班回家不太需要繞圈找位。',
        },
      ],
    },
    {
      id: 2,
      image:
        'https://images.unsplash.com/photo-1575517111478-7f6afd0973db?q=80&w=1600&auto=format&fit=crop',
      badge: '社區中庭',
      title: '松山民生社區｜邊間大兩房，採光佳',
      tags: ['28.6 坪', '2 房 2 廳', '可寵物'],
      price: '1,052',
      location: '台北市松山區 · 民生東路五段',
      source: 'seed',
      reviews: [
        {
          avatar: 'C',
          name: '陳太太',
          role: '5年住戶',
          tag: '鄰里友善',
          text: '警衛熱心、包裹代收確實，社區群組很活躍。',
        },
        {
          avatar: 'D',
          name: '賴先生',
          role: '上班族',
          tag: '生活便利',
          text: '走路 3 分鐘有超市與市場，下班買菜很方便。',
        },
      ],
    },
    {
      id: 3,
      image:
        'https://images.unsplash.com/photo-1515263487990-61b07816b324?q=80&w=1600&auto=format&fit=crop',
      badge: '學區宅',
      title: '新店七張｜電梯二房，附機車位',
      tags: ['22.1 坪', '2 房 1 廳', '低公設比'],
      price: '838',
      location: '新北市新店區 · 北新路二段',
      source: 'seed',
      reviews: [
        {
          avatar: 'E',
          name: '張小姐',
          role: '上班族',
          tag: '通勤方便',
          text: '步行到捷運七張站約 6 分鐘，雨天也有騎樓遮蔽。',
        },
        {
          avatar: 'F',
          name: '李先生',
          role: '家長',
          tag: '學區完整',
          text: '附近幼兒園到國中選擇多，放學接送動線順。',
        },
      ],
    },
    {
      id: 4,
      image:
        'https://images.unsplash.com/photo-1564013799919-ab600027ffc6?q=80&w=1600&auto=format&fit=crop',
      badge: '河岸景觀',
      title: '大直美堤｜景觀三房，沁涼通風',
      tags: ['36.8 坪', '3 房 2 廳', '邊間'],
      price: '1,560',
      location: '台北市中山區 · 敦化北路',
      source: 'seed',
      reviews: [
        {
          avatar: 'G',
          name: '蘇先生',
          role: '住戶',
          tag: '景觀佳',
          text: '客廳看河景很放鬆，夏天自然風就很涼。',
        },
        {
          avatar: 'H',
          name: '高小姐',
          role: '通勤族',
          tag: '交通便利',
          text: '離公車站 2 分鐘，轉乘捷運時間可控。',
        },
      ],
    },
    {
      id: 5,
      image:
        'https://images.unsplash.com/photo-1501183638710-841dd1904471?q=80&w=1600&auto=format&fit=crop',
      badge: '社區花園',
      title: '內湖東湖｜雙面採光，小家庭首選',
      tags: ['27.4 坪', '2 房 2 廳', '含機車位'],
      price: '968',
      location: '台北市內湖區 · 康寧路三段',
      source: 'seed',
      reviews: [
        {
          avatar: 'I',
          name: '許太太',
          role: '家長',
          tag: '公園多',
          text: '社區旁邊就有親子公園，假日散步很方便。',
        },
        {
          avatar: 'J',
          name: '黃先生',
          role: '工程師',
          tag: '環境安靜',
          text: '臨巷內，夜間車流少，對面鄰居素質也不錯。',
        },
      ],
    },
    {
      id: 6,
      image:
        'https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?q=80&w=1600&auto=format&fit=crop',
      badge: '捷運生活圈',
      title: '中和橋和站｜採光兩房，低管理費',
      tags: ['24.9 坪', '2 房 1 廳', '社區新'],
      price: '898',
      location: '新北市中和區 · 中和路',
      source: 'seed',
      reviews: [
        {
          avatar: 'K',
          name: '簡小姐',
          role: '新婚',
          tag: '費用透明',
          text: '管委會公告清楚，管理費與車位費用都公開透明。',
        },
        {
          avatar: 'L',
          name: '羅先生',
          role: '通勤族',
          tag: '通勤穩定',
          text: '尖峰等車可控，公車轉乘動線順，延誤較少。',
        },
      ],
    },
  ];
function ic(e) {
  var t,
    r,
    n = '';
  if (typeof e == 'string' || typeof e == 'number') n += e;
  else if (typeof e == 'object')
    if (Array.isArray(e)) {
      var a = e.length;
      for (t = 0; t < a; t++) e[t] && (r = ic(e[t])) && (n && (n += ' '), (n += r));
    } else for (r in e) e[r] && (n && (n += ' '), (n += r));
  return n;
}
function mf() {
  for (var e, t, r = 0, n = '', a = arguments.length; r < a; r++)
    (e = arguments[r]) && (t = ic(e)) && (n && (n += ' '), (n += t));
  return n;
}
const hf = (e, t) => {
    const r = new Array(e.length + t.length);
    for (let n = 0; n < e.length; n++) r[n] = e[n];
    for (let n = 0; n < t.length; n++) r[e.length + n] = t[n];
    return r;
  },
  ff = (e, t) => ({ classGroupId: e, validator: t }),
  oc = (e = new Map(), t = null, r) => ({
    nextPart: e,
    validators: t,
    classGroupId: r,
  }),
  cn = '-',
  Wi = [],
  pf = 'arbitrary..',
  xf = (e) => {
    const t = bf(e),
      { conflictingClassGroups: r, conflictingClassGroupModifiers: n } = e;
    return {
      getClassGroupId: (o) => {
        if (o.startsWith('[') && o.endsWith(']')) return gf(o);
        const l = o.split(cn),
          c = l[0] === '' && l.length > 1 ? 1 : 0;
        return lc(l, c, t);
      },
      getConflictingClassGroupIds: (o, l) => {
        if (l) {
          const c = n[o],
            d = r[o];
          return c ? (d ? hf(d, c) : c) : d || Wi;
        }
        return r[o] || Wi;
      },
    };
  },
  lc = (e, t, r) => {
    if (e.length - t === 0) return r.classGroupId;
    const a = e[t],
      i = r.nextPart.get(a);
    if (i) {
      const d = lc(e, t + 1, i);
      if (d) return d;
    }
    const o = r.validators;
    if (o === null) return;
    const l = t === 0 ? e.join(cn) : e.slice(t).join(cn),
      c = o.length;
    for (let d = 0; d < c; d++) {
      const m = o[d];
      if (m.validator(l)) return m.classGroupId;
    }
  },
  gf = (e) =>
    e.slice(1, -1).indexOf(':') === -1
      ? void 0
      : (() => {
          const t = e.slice(1, -1),
            r = t.indexOf(':'),
            n = t.slice(0, r);
          return n ? pf + n : void 0;
        })(),
  bf = (e) => {
    const { theme: t, classGroups: r } = e;
    return yf(r, t);
  },
  yf = (e, t) => {
    const r = oc();
    for (const n in e) {
      const a = e[n];
      Ha(a, r, n, t);
    }
    return r;
  },
  Ha = (e, t, r, n) => {
    const a = e.length;
    for (let i = 0; i < a; i++) {
      const o = e[i];
      vf(o, t, r, n);
    }
  },
  vf = (e, t, r, n) => {
    if (typeof e == 'string') {
      jf(e, t, r);
      return;
    }
    if (typeof e == 'function') {
      wf(e, t, r, n);
      return;
    }
    Nf(e, t, r, n);
  },
  jf = (e, t, r) => {
    const n = e === '' ? t : cc(t, e);
    n.classGroupId = r;
  },
  wf = (e, t, r, n) => {
    if (_f(e)) {
      Ha(e(n), t, r, n);
      return;
    }
    (t.validators === null && (t.validators = []), t.validators.push(ff(r, e)));
  },
  Nf = (e, t, r, n) => {
    const a = Object.entries(e),
      i = a.length;
    for (let o = 0; o < i; o++) {
      const [l, c] = a[o];
      Ha(c, cc(t, l), r, n);
    }
  },
  cc = (e, t) => {
    let r = e;
    const n = t.split(cn),
      a = n.length;
    for (let i = 0; i < a; i++) {
      const o = n[i];
      let l = r.nextPart.get(o);
      (l || ((l = oc()), r.nextPart.set(o, l)), (r = l));
    }
    return r;
  },
  _f = (e) => 'isThemeGetter' in e && e.isThemeGetter === !0,
  kf = (e) => {
    if (e < 1) return { get: () => {}, set: () => {} };
    let t = 0,
      r = Object.create(null),
      n = Object.create(null);
    const a = (i, o) => {
      ((r[i] = o), t++, t > e && ((t = 0), (n = r), (r = Object.create(null))));
    };
    return {
      get(i) {
        let o = r[i];
        if (o !== void 0) return o;
        if ((o = n[i]) !== void 0) return (a(i, o), o);
      },
      set(i, o) {
        i in r ? (r[i] = o) : a(i, o);
      },
    };
  },
  ya = '!',
  Vi = ':',
  Sf = [],
  Zi = (e, t, r, n, a) => ({
    modifiers: e,
    hasImportantModifier: t,
    baseClassName: r,
    maybePostfixModifierPosition: n,
    isExternal: a,
  }),
  Ef = (e) => {
    const { prefix: t, experimentalParseClassName: r } = e;
    let n = (a) => {
      const i = [];
      let o = 0,
        l = 0,
        c = 0,
        d;
      const m = a.length;
      for (let b = 0; b < m; b++) {
        const y = a[b];
        if (o === 0 && l === 0) {
          if (y === Vi) {
            (i.push(a.slice(c, b)), (c = b + 1));
            continue;
          }
          if (y === '/') {
            d = b;
            continue;
          }
        }
        y === '[' ? o++ : y === ']' ? o-- : y === '(' ? l++ : y === ')' && l--;
      }
      const u = i.length === 0 ? a : a.slice(c);
      let x = u,
        f = !1;
      u.endsWith(ya)
        ? ((x = u.slice(0, -1)), (f = !0))
        : u.startsWith(ya) && ((x = u.slice(1)), (f = !0));
      const g = d && d > c ? d - c : void 0;
      return Zi(i, f, x, g);
    };
    if (t) {
      const a = t + Vi,
        i = n;
      n = (o) => (o.startsWith(a) ? i(o.slice(a.length)) : Zi(Sf, !1, o, void 0, !0));
    }
    if (r) {
      const a = n;
      n = (i) => r({ className: i, parseClassName: a });
    }
    return n;
  },
  Tf = (e) => {
    const t = new Map();
    return (
      e.orderSensitiveModifiers.forEach((r, n) => {
        t.set(r, 1e6 + n);
      }),
      (r) => {
        const n = [];
        let a = [];
        for (let i = 0; i < r.length; i++) {
          const o = r[i],
            l = o[0] === '[',
            c = t.has(o);
          l || c ? (a.length > 0 && (a.sort(), n.push(...a), (a = [])), n.push(o)) : a.push(o);
        }
        return (a.length > 0 && (a.sort(), n.push(...a)), n);
      }
    );
  },
  If = (e) => ({
    cache: kf(e.cacheSize),
    parseClassName: Ef(e),
    sortModifiers: Tf(e),
    ...xf(e),
  }),
  Cf = /\s+/,
  Af = (e, t) => {
    const {
        parseClassName: r,
        getClassGroupId: n,
        getConflictingClassGroupIds: a,
        sortModifiers: i,
      } = t,
      o = [],
      l = e.trim().split(Cf);
    let c = '';
    for (let d = l.length - 1; d >= 0; d -= 1) {
      const m = l[d],
        {
          isExternal: u,
          modifiers: x,
          hasImportantModifier: f,
          baseClassName: g,
          maybePostfixModifierPosition: b,
        } = r(m);
      if (u) {
        c = m + (c.length > 0 ? ' ' + c : c);
        continue;
      }
      let y = !!b,
        p = n(y ? g.substring(0, b) : g);
      if (!p) {
        if (!y) {
          c = m + (c.length > 0 ? ' ' + c : c);
          continue;
        }
        if (((p = n(g)), !p)) {
          c = m + (c.length > 0 ? ' ' + c : c);
          continue;
        }
        y = !1;
      }
      const E = x.length === 0 ? '' : x.length === 1 ? x[0] : i(x).join(':'),
        S = f ? E + ya : E,
        N = S + p;
      if (o.indexOf(N) > -1) continue;
      o.push(N);
      const k = a(p, y);
      for (let T = 0; T < k.length; ++T) {
        const C = k[T];
        o.push(S + C);
      }
      c = m + (c.length > 0 ? ' ' + c : c);
    }
    return c;
  },
  Lf = (...e) => {
    let t = 0,
      r,
      n,
      a = '';
    for (; t < e.length; ) (r = e[t++]) && (n = dc(r)) && (a && (a += ' '), (a += n));
    return a;
  },
  dc = (e) => {
    if (typeof e == 'string') return e;
    let t,
      r = '';
    for (let n = 0; n < e.length; n++) e[n] && (t = dc(e[n])) && (r && (r += ' '), (r += t));
    return r;
  },
  Of = (e, ...t) => {
    let r, n, a, i;
    const o = (c) => {
        const d = t.reduce((m, u) => u(m), e());
        return ((r = If(d)), (n = r.cache.get), (a = r.cache.set), (i = l), l(c));
      },
      l = (c) => {
        const d = n(c);
        if (d) return d;
        const m = Af(c, r);
        return (a(c, m), m);
      };
    return ((i = o), (...c) => i(Lf(...c)));
  },
  Rf = [],
  Le = (e) => {
    const t = (r) => r[e] || Rf;
    return ((t.isThemeGetter = !0), t);
  },
  uc = /^\[(?:(\w[\w-]*):)?(.+)\]$/i,
  mc = /^\((?:(\w[\w-]*):)?(.+)\)$/i,
  Mf = /^\d+\/\d+$/,
  Pf = /^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,
  zf =
    /\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,
  Df = /^(rgba?|hsla?|hwb|(ok)?(lab|lch)|color-mix)\(.+\)$/,
  Ff = /^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,
  $f =
    /^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,
  Ms = (e) => Mf.test(e),
  me = (e) => !!e && !Number.isNaN(Number(e)),
  Gt = (e) => !!e && Number.isInteger(Number(e)),
  Fn = (e) => e.endsWith('%') && me(e.slice(0, -1)),
  Lt = (e) => Pf.test(e),
  Uf = () => !0,
  Bf = (e) => zf.test(e) && !Df.test(e),
  hc = () => !1,
  Gf = (e) => Ff.test(e),
  Hf = (e) => $f.test(e),
  Wf = (e) => !K(e) && !Q(e),
  Vf = (e) => nr(e, xc, hc),
  K = (e) => uc.test(e),
  us = (e) => nr(e, gc, Bf),
  $n = (e) => nr(e, Qf, me),
  Yi = (e) => nr(e, fc, hc),
  Zf = (e) => nr(e, pc, Hf),
  Br = (e) => nr(e, bc, Gf),
  Q = (e) => mc.test(e),
  lr = (e) => ar(e, gc),
  Yf = (e) => ar(e, Jf),
  qi = (e) => ar(e, fc),
  qf = (e) => ar(e, xc),
  Kf = (e) => ar(e, pc),
  Gr = (e) => ar(e, bc, !0),
  nr = (e, t, r) => {
    const n = uc.exec(e);
    return n ? (n[1] ? t(n[1]) : r(n[2])) : !1;
  },
  ar = (e, t, r = !1) => {
    const n = mc.exec(e);
    return n ? (n[1] ? t(n[1]) : r) : !1;
  },
  fc = (e) => e === 'position' || e === 'percentage',
  pc = (e) => e === 'image' || e === 'url',
  xc = (e) => e === 'length' || e === 'size' || e === 'bg-size',
  gc = (e) => e === 'length',
  Qf = (e) => e === 'number',
  Jf = (e) => e === 'family-name',
  bc = (e) => e === 'shadow',
  Xf = () => {
    const e = Le('color'),
      t = Le('font'),
      r = Le('text'),
      n = Le('font-weight'),
      a = Le('tracking'),
      i = Le('leading'),
      o = Le('breakpoint'),
      l = Le('container'),
      c = Le('spacing'),
      d = Le('radius'),
      m = Le('shadow'),
      u = Le('inset-shadow'),
      x = Le('text-shadow'),
      f = Le('drop-shadow'),
      g = Le('blur'),
      b = Le('perspective'),
      y = Le('aspect'),
      p = Le('ease'),
      E = Le('animate'),
      S = () => ['auto', 'avoid', 'all', 'avoid-page', 'page', 'left', 'right', 'column'],
      N = () => [
        'center',
        'top',
        'bottom',
        'left',
        'right',
        'top-left',
        'left-top',
        'top-right',
        'right-top',
        'bottom-right',
        'right-bottom',
        'bottom-left',
        'left-bottom',
      ],
      k = () => [...N(), Q, K],
      T = () => ['auto', 'hidden', 'clip', 'visible', 'scroll'],
      C = () => ['auto', 'contain', 'none'],
      w = () => [Q, K, c],
      G = () => [Ms, 'full', 'auto', ...w()],
      j = () => [Gt, 'none', 'subgrid', Q, K],
      _ = () => ['auto', { span: ['full', Gt, Q, K] }, Gt, Q, K],
      D = () => [Gt, 'auto', Q, K],
      V = () => ['auto', 'min', 'max', 'fr', Q, K],
      se = () => [
        'start',
        'end',
        'center',
        'between',
        'around',
        'evenly',
        'stretch',
        'baseline',
        'center-safe',
        'end-safe',
      ],
      I = () => ['start', 'end', 'center', 'stretch', 'center-safe', 'end-safe'],
      A = () => ['auto', ...w()],
      z = () => [
        Ms,
        'auto',
        'full',
        'dvw',
        'dvh',
        'lvw',
        'lvh',
        'svw',
        'svh',
        'min',
        'max',
        'fit',
        ...w(),
      ],
      O = () => [e, Q, K],
      re = () => [...N(), qi, Yi, { position: [Q, K] }],
      ae = () => ['no-repeat', { repeat: ['', 'x', 'y', 'space', 'round'] }],
      R = () => ['auto', 'cover', 'contain', qf, Vf, { size: [Q, K] }],
      ee = () => [Fn, lr, us],
      $ = () => ['', 'none', 'full', d, Q, K],
      J = () => ['', me, lr, us],
      Y = () => ['solid', 'dashed', 'dotted', 'double'],
      oe = () => [
        'normal',
        'multiply',
        'screen',
        'overlay',
        'darken',
        'lighten',
        'color-dodge',
        'color-burn',
        'hard-light',
        'soft-light',
        'difference',
        'exclusion',
        'hue',
        'saturation',
        'color',
        'luminosity',
      ],
      U = () => [me, Fn, qi, Yi],
      q = () => ['', 'none', g, Q, K],
      ue = () => ['none', me, Q, K],
      B = () => ['none', me, Q, K],
      ie = () => [me, Q, K],
      fe = () => [Ms, 'full', ...w()];
    return {
      cacheSize: 500,
      theme: {
        animate: ['spin', 'ping', 'pulse', 'bounce'],
        aspect: ['video'],
        blur: [Lt],
        breakpoint: [Lt],
        color: [Uf],
        container: [Lt],
        'drop-shadow': [Lt],
        ease: ['in', 'out', 'in-out'],
        font: [Wf],
        'font-weight': [
          'thin',
          'extralight',
          'light',
          'normal',
          'medium',
          'semibold',
          'bold',
          'extrabold',
          'black',
        ],
        'inset-shadow': [Lt],
        leading: ['none', 'tight', 'snug', 'normal', 'relaxed', 'loose'],
        perspective: ['dramatic', 'near', 'normal', 'midrange', 'distant', 'none'],
        radius: [Lt],
        shadow: [Lt],
        spacing: ['px', me],
        text: [Lt],
        'text-shadow': [Lt],
        tracking: ['tighter', 'tight', 'normal', 'wide', 'wider', 'widest'],
      },
      classGroups: {
        aspect: [{ aspect: ['auto', 'square', Ms, K, Q, y] }],
        container: ['container'],
        columns: [{ columns: [me, K, Q, l] }],
        'break-after': [{ 'break-after': S() }],
        'break-before': [{ 'break-before': S() }],
        'break-inside': [{ 'break-inside': ['auto', 'avoid', 'avoid-page', 'avoid-column'] }],
        'box-decoration': [{ 'box-decoration': ['slice', 'clone'] }],
        box: [{ box: ['border', 'content'] }],
        display: [
          'block',
          'inline-block',
          'inline',
          'flex',
          'inline-flex',
          'table',
          'inline-table',
          'table-caption',
          'table-cell',
          'table-column',
          'table-column-group',
          'table-footer-group',
          'table-header-group',
          'table-row-group',
          'table-row',
          'flow-root',
          'grid',
          'inline-grid',
          'contents',
          'list-item',
          'hidden',
        ],
        sr: ['sr-only', 'not-sr-only'],
        float: [{ float: ['right', 'left', 'none', 'start', 'end'] }],
        clear: [{ clear: ['left', 'right', 'both', 'none', 'start', 'end'] }],
        isolation: ['isolate', 'isolation-auto'],
        'object-fit': [{ object: ['contain', 'cover', 'fill', 'none', 'scale-down'] }],
        'object-position': [{ object: k() }],
        overflow: [{ overflow: T() }],
        'overflow-x': [{ 'overflow-x': T() }],
        'overflow-y': [{ 'overflow-y': T() }],
        overscroll: [{ overscroll: C() }],
        'overscroll-x': [{ 'overscroll-x': C() }],
        'overscroll-y': [{ 'overscroll-y': C() }],
        position: ['static', 'fixed', 'absolute', 'relative', 'sticky'],
        inset: [{ inset: G() }],
        'inset-x': [{ 'inset-x': G() }],
        'inset-y': [{ 'inset-y': G() }],
        start: [{ start: G() }],
        end: [{ end: G() }],
        top: [{ top: G() }],
        right: [{ right: G() }],
        bottom: [{ bottom: G() }],
        left: [{ left: G() }],
        visibility: ['visible', 'invisible', 'collapse'],
        z: [{ z: [Gt, 'auto', Q, K] }],
        basis: [{ basis: [Ms, 'full', 'auto', l, ...w()] }],
        'flex-direction': [{ flex: ['row', 'row-reverse', 'col', 'col-reverse'] }],
        'flex-wrap': [{ flex: ['nowrap', 'wrap', 'wrap-reverse'] }],
        flex: [{ flex: [me, Ms, 'auto', 'initial', 'none', K] }],
        grow: [{ grow: ['', me, Q, K] }],
        shrink: [{ shrink: ['', me, Q, K] }],
        order: [{ order: [Gt, 'first', 'last', 'none', Q, K] }],
        'grid-cols': [{ 'grid-cols': j() }],
        'col-start-end': [{ col: _() }],
        'col-start': [{ 'col-start': D() }],
        'col-end': [{ 'col-end': D() }],
        'grid-rows': [{ 'grid-rows': j() }],
        'row-start-end': [{ row: _() }],
        'row-start': [{ 'row-start': D() }],
        'row-end': [{ 'row-end': D() }],
        'grid-flow': [{ 'grid-flow': ['row', 'col', 'dense', 'row-dense', 'col-dense'] }],
        'auto-cols': [{ 'auto-cols': V() }],
        'auto-rows': [{ 'auto-rows': V() }],
        gap: [{ gap: w() }],
        'gap-x': [{ 'gap-x': w() }],
        'gap-y': [{ 'gap-y': w() }],
        'justify-content': [{ justify: [...se(), 'normal'] }],
        'justify-items': [{ 'justify-items': [...I(), 'normal'] }],
        'justify-self': [{ 'justify-self': ['auto', ...I()] }],
        'align-content': [{ content: ['normal', ...se()] }],
        'align-items': [{ items: [...I(), { baseline: ['', 'last'] }] }],
        'align-self': [{ self: ['auto', ...I(), { baseline: ['', 'last'] }] }],
        'place-content': [{ 'place-content': se() }],
        'place-items': [{ 'place-items': [...I(), 'baseline'] }],
        'place-self': [{ 'place-self': ['auto', ...I()] }],
        p: [{ p: w() }],
        px: [{ px: w() }],
        py: [{ py: w() }],
        ps: [{ ps: w() }],
        pe: [{ pe: w() }],
        pt: [{ pt: w() }],
        pr: [{ pr: w() }],
        pb: [{ pb: w() }],
        pl: [{ pl: w() }],
        m: [{ m: A() }],
        mx: [{ mx: A() }],
        my: [{ my: A() }],
        ms: [{ ms: A() }],
        me: [{ me: A() }],
        mt: [{ mt: A() }],
        mr: [{ mr: A() }],
        mb: [{ mb: A() }],
        ml: [{ ml: A() }],
        'space-x': [{ 'space-x': w() }],
        'space-x-reverse': ['space-x-reverse'],
        'space-y': [{ 'space-y': w() }],
        'space-y-reverse': ['space-y-reverse'],
        size: [{ size: z() }],
        w: [{ w: [l, 'screen', ...z()] }],
        'min-w': [{ 'min-w': [l, 'screen', 'none', ...z()] }],
        'max-w': [{ 'max-w': [l, 'screen', 'none', 'prose', { screen: [o] }, ...z()] }],
        h: [{ h: ['screen', 'lh', ...z()] }],
        'min-h': [{ 'min-h': ['screen', 'lh', 'none', ...z()] }],
        'max-h': [{ 'max-h': ['screen', 'lh', ...z()] }],
        'font-size': [{ text: ['base', r, lr, us] }],
        'font-smoothing': ['antialiased', 'subpixel-antialiased'],
        'font-style': ['italic', 'not-italic'],
        'font-weight': [{ font: [n, Q, $n] }],
        'font-stretch': [
          {
            'font-stretch': [
              'ultra-condensed',
              'extra-condensed',
              'condensed',
              'semi-condensed',
              'normal',
              'semi-expanded',
              'expanded',
              'extra-expanded',
              'ultra-expanded',
              Fn,
              K,
            ],
          },
        ],
        'font-family': [{ font: [Yf, K, t] }],
        'fvn-normal': ['normal-nums'],
        'fvn-ordinal': ['ordinal'],
        'fvn-slashed-zero': ['slashed-zero'],
        'fvn-figure': ['lining-nums', 'oldstyle-nums'],
        'fvn-spacing': ['proportional-nums', 'tabular-nums'],
        'fvn-fraction': ['diagonal-fractions', 'stacked-fractions'],
        tracking: [{ tracking: [a, Q, K] }],
        'line-clamp': [{ 'line-clamp': [me, 'none', Q, $n] }],
        leading: [{ leading: [i, ...w()] }],
        'list-image': [{ 'list-image': ['none', Q, K] }],
        'list-style-position': [{ list: ['inside', 'outside'] }],
        'list-style-type': [{ list: ['disc', 'decimal', 'none', Q, K] }],
        'text-alignment': [{ text: ['left', 'center', 'right', 'justify', 'start', 'end'] }],
        'placeholder-color': [{ placeholder: O() }],
        'text-color': [{ text: O() }],
        'text-decoration': ['underline', 'overline', 'line-through', 'no-underline'],
        'text-decoration-style': [{ decoration: [...Y(), 'wavy'] }],
        'text-decoration-thickness': [{ decoration: [me, 'from-font', 'auto', Q, us] }],
        'text-decoration-color': [{ decoration: O() }],
        'underline-offset': [{ 'underline-offset': [me, 'auto', Q, K] }],
        'text-transform': ['uppercase', 'lowercase', 'capitalize', 'normal-case'],
        'text-overflow': ['truncate', 'text-ellipsis', 'text-clip'],
        'text-wrap': [{ text: ['wrap', 'nowrap', 'balance', 'pretty'] }],
        indent: [{ indent: w() }],
        'vertical-align': [
          {
            align: [
              'baseline',
              'top',
              'middle',
              'bottom',
              'text-top',
              'text-bottom',
              'sub',
              'super',
              Q,
              K,
            ],
          },
        ],
        whitespace: [
          {
            whitespace: ['normal', 'nowrap', 'pre', 'pre-line', 'pre-wrap', 'break-spaces'],
          },
        ],
        break: [{ break: ['normal', 'words', 'all', 'keep'] }],
        wrap: [{ wrap: ['break-word', 'anywhere', 'normal'] }],
        hyphens: [{ hyphens: ['none', 'manual', 'auto'] }],
        content: [{ content: ['none', Q, K] }],
        'bg-attachment': [{ bg: ['fixed', 'local', 'scroll'] }],
        'bg-clip': [{ 'bg-clip': ['border', 'padding', 'content', 'text'] }],
        'bg-origin': [{ 'bg-origin': ['border', 'padding', 'content'] }],
        'bg-position': [{ bg: re() }],
        'bg-repeat': [{ bg: ae() }],
        'bg-size': [{ bg: R() }],
        'bg-image': [
          {
            bg: [
              'none',
              {
                linear: [{ to: ['t', 'tr', 'r', 'br', 'b', 'bl', 'l', 'tl'] }, Gt, Q, K],
                radial: ['', Q, K],
                conic: [Gt, Q, K],
              },
              Kf,
              Zf,
            ],
          },
        ],
        'bg-color': [{ bg: O() }],
        'gradient-from-pos': [{ from: ee() }],
        'gradient-via-pos': [{ via: ee() }],
        'gradient-to-pos': [{ to: ee() }],
        'gradient-from': [{ from: O() }],
        'gradient-via': [{ via: O() }],
        'gradient-to': [{ to: O() }],
        rounded: [{ rounded: $() }],
        'rounded-s': [{ 'rounded-s': $() }],
        'rounded-e': [{ 'rounded-e': $() }],
        'rounded-t': [{ 'rounded-t': $() }],
        'rounded-r': [{ 'rounded-r': $() }],
        'rounded-b': [{ 'rounded-b': $() }],
        'rounded-l': [{ 'rounded-l': $() }],
        'rounded-ss': [{ 'rounded-ss': $() }],
        'rounded-se': [{ 'rounded-se': $() }],
        'rounded-ee': [{ 'rounded-ee': $() }],
        'rounded-es': [{ 'rounded-es': $() }],
        'rounded-tl': [{ 'rounded-tl': $() }],
        'rounded-tr': [{ 'rounded-tr': $() }],
        'rounded-br': [{ 'rounded-br': $() }],
        'rounded-bl': [{ 'rounded-bl': $() }],
        'border-w': [{ border: J() }],
        'border-w-x': [{ 'border-x': J() }],
        'border-w-y': [{ 'border-y': J() }],
        'border-w-s': [{ 'border-s': J() }],
        'border-w-e': [{ 'border-e': J() }],
        'border-w-t': [{ 'border-t': J() }],
        'border-w-r': [{ 'border-r': J() }],
        'border-w-b': [{ 'border-b': J() }],
        'border-w-l': [{ 'border-l': J() }],
        'divide-x': [{ 'divide-x': J() }],
        'divide-x-reverse': ['divide-x-reverse'],
        'divide-y': [{ 'divide-y': J() }],
        'divide-y-reverse': ['divide-y-reverse'],
        'border-style': [{ border: [...Y(), 'hidden', 'none'] }],
        'divide-style': [{ divide: [...Y(), 'hidden', 'none'] }],
        'border-color': [{ border: O() }],
        'border-color-x': [{ 'border-x': O() }],
        'border-color-y': [{ 'border-y': O() }],
        'border-color-s': [{ 'border-s': O() }],
        'border-color-e': [{ 'border-e': O() }],
        'border-color-t': [{ 'border-t': O() }],
        'border-color-r': [{ 'border-r': O() }],
        'border-color-b': [{ 'border-b': O() }],
        'border-color-l': [{ 'border-l': O() }],
        'divide-color': [{ divide: O() }],
        'outline-style': [{ outline: [...Y(), 'none', 'hidden'] }],
        'outline-offset': [{ 'outline-offset': [me, Q, K] }],
        'outline-w': [{ outline: ['', me, lr, us] }],
        'outline-color': [{ outline: O() }],
        shadow: [{ shadow: ['', 'none', m, Gr, Br] }],
        'shadow-color': [{ shadow: O() }],
        'inset-shadow': [{ 'inset-shadow': ['none', u, Gr, Br] }],
        'inset-shadow-color': [{ 'inset-shadow': O() }],
        'ring-w': [{ ring: J() }],
        'ring-w-inset': ['ring-inset'],
        'ring-color': [{ ring: O() }],
        'ring-offset-w': [{ 'ring-offset': [me, us] }],
        'ring-offset-color': [{ 'ring-offset': O() }],
        'inset-ring-w': [{ 'inset-ring': J() }],
        'inset-ring-color': [{ 'inset-ring': O() }],
        'text-shadow': [{ 'text-shadow': ['none', x, Gr, Br] }],
        'text-shadow-color': [{ 'text-shadow': O() }],
        opacity: [{ opacity: [me, Q, K] }],
        'mix-blend': [{ 'mix-blend': [...oe(), 'plus-darker', 'plus-lighter'] }],
        'bg-blend': [{ 'bg-blend': oe() }],
        'mask-clip': [
          {
            'mask-clip': ['border', 'padding', 'content', 'fill', 'stroke', 'view'],
          },
          'mask-no-clip',
        ],
        'mask-composite': [{ mask: ['add', 'subtract', 'intersect', 'exclude'] }],
        'mask-image-linear-pos': [{ 'mask-linear': [me] }],
        'mask-image-linear-from-pos': [{ 'mask-linear-from': U() }],
        'mask-image-linear-to-pos': [{ 'mask-linear-to': U() }],
        'mask-image-linear-from-color': [{ 'mask-linear-from': O() }],
        'mask-image-linear-to-color': [{ 'mask-linear-to': O() }],
        'mask-image-t-from-pos': [{ 'mask-t-from': U() }],
        'mask-image-t-to-pos': [{ 'mask-t-to': U() }],
        'mask-image-t-from-color': [{ 'mask-t-from': O() }],
        'mask-image-t-to-color': [{ 'mask-t-to': O() }],
        'mask-image-r-from-pos': [{ 'mask-r-from': U() }],
        'mask-image-r-to-pos': [{ 'mask-r-to': U() }],
        'mask-image-r-from-color': [{ 'mask-r-from': O() }],
        'mask-image-r-to-color': [{ 'mask-r-to': O() }],
        'mask-image-b-from-pos': [{ 'mask-b-from': U() }],
        'mask-image-b-to-pos': [{ 'mask-b-to': U() }],
        'mask-image-b-from-color': [{ 'mask-b-from': O() }],
        'mask-image-b-to-color': [{ 'mask-b-to': O() }],
        'mask-image-l-from-pos': [{ 'mask-l-from': U() }],
        'mask-image-l-to-pos': [{ 'mask-l-to': U() }],
        'mask-image-l-from-color': [{ 'mask-l-from': O() }],
        'mask-image-l-to-color': [{ 'mask-l-to': O() }],
        'mask-image-x-from-pos': [{ 'mask-x-from': U() }],
        'mask-image-x-to-pos': [{ 'mask-x-to': U() }],
        'mask-image-x-from-color': [{ 'mask-x-from': O() }],
        'mask-image-x-to-color': [{ 'mask-x-to': O() }],
        'mask-image-y-from-pos': [{ 'mask-y-from': U() }],
        'mask-image-y-to-pos': [{ 'mask-y-to': U() }],
        'mask-image-y-from-color': [{ 'mask-y-from': O() }],
        'mask-image-y-to-color': [{ 'mask-y-to': O() }],
        'mask-image-radial': [{ 'mask-radial': [Q, K] }],
        'mask-image-radial-from-pos': [{ 'mask-radial-from': U() }],
        'mask-image-radial-to-pos': [{ 'mask-radial-to': U() }],
        'mask-image-radial-from-color': [{ 'mask-radial-from': O() }],
        'mask-image-radial-to-color': [{ 'mask-radial-to': O() }],
        'mask-image-radial-shape': [{ 'mask-radial': ['circle', 'ellipse'] }],
        'mask-image-radial-size': [
          {
            'mask-radial': [{ closest: ['side', 'corner'], farthest: ['side', 'corner'] }],
          },
        ],
        'mask-image-radial-pos': [{ 'mask-radial-at': N() }],
        'mask-image-conic-pos': [{ 'mask-conic': [me] }],
        'mask-image-conic-from-pos': [{ 'mask-conic-from': U() }],
        'mask-image-conic-to-pos': [{ 'mask-conic-to': U() }],
        'mask-image-conic-from-color': [{ 'mask-conic-from': O() }],
        'mask-image-conic-to-color': [{ 'mask-conic-to': O() }],
        'mask-mode': [{ mask: ['alpha', 'luminance', 'match'] }],
        'mask-origin': [
          {
            'mask-origin': ['border', 'padding', 'content', 'fill', 'stroke', 'view'],
          },
        ],
        'mask-position': [{ mask: re() }],
        'mask-repeat': [{ mask: ae() }],
        'mask-size': [{ mask: R() }],
        'mask-type': [{ 'mask-type': ['alpha', 'luminance'] }],
        'mask-image': [{ mask: ['none', Q, K] }],
        filter: [{ filter: ['', 'none', Q, K] }],
        blur: [{ blur: q() }],
        brightness: [{ brightness: [me, Q, K] }],
        contrast: [{ contrast: [me, Q, K] }],
        'drop-shadow': [{ 'drop-shadow': ['', 'none', f, Gr, Br] }],
        'drop-shadow-color': [{ 'drop-shadow': O() }],
        grayscale: [{ grayscale: ['', me, Q, K] }],
        'hue-rotate': [{ 'hue-rotate': [me, Q, K] }],
        invert: [{ invert: ['', me, Q, K] }],
        saturate: [{ saturate: [me, Q, K] }],
        sepia: [{ sepia: ['', me, Q, K] }],
        'backdrop-filter': [{ 'backdrop-filter': ['', 'none', Q, K] }],
        'backdrop-blur': [{ 'backdrop-blur': q() }],
        'backdrop-brightness': [{ 'backdrop-brightness': [me, Q, K] }],
        'backdrop-contrast': [{ 'backdrop-contrast': [me, Q, K] }],
        'backdrop-grayscale': [{ 'backdrop-grayscale': ['', me, Q, K] }],
        'backdrop-hue-rotate': [{ 'backdrop-hue-rotate': [me, Q, K] }],
        'backdrop-invert': [{ 'backdrop-invert': ['', me, Q, K] }],
        'backdrop-opacity': [{ 'backdrop-opacity': [me, Q, K] }],
        'backdrop-saturate': [{ 'backdrop-saturate': [me, Q, K] }],
        'backdrop-sepia': [{ 'backdrop-sepia': ['', me, Q, K] }],
        'border-collapse': [{ border: ['collapse', 'separate'] }],
        'border-spacing': [{ 'border-spacing': w() }],
        'border-spacing-x': [{ 'border-spacing-x': w() }],
        'border-spacing-y': [{ 'border-spacing-y': w() }],
        'table-layout': [{ table: ['auto', 'fixed'] }],
        caption: [{ caption: ['top', 'bottom'] }],
        transition: [
          {
            transition: ['', 'all', 'colors', 'opacity', 'shadow', 'transform', 'none', Q, K],
          },
        ],
        'transition-behavior': [{ transition: ['normal', 'discrete'] }],
        duration: [{ duration: [me, 'initial', Q, K] }],
        ease: [{ ease: ['linear', 'initial', p, Q, K] }],
        delay: [{ delay: [me, Q, K] }],
        animate: [{ animate: ['none', E, Q, K] }],
        backface: [{ backface: ['hidden', 'visible'] }],
        perspective: [{ perspective: [b, Q, K] }],
        'perspective-origin': [{ 'perspective-origin': k() }],
        rotate: [{ rotate: ue() }],
        'rotate-x': [{ 'rotate-x': ue() }],
        'rotate-y': [{ 'rotate-y': ue() }],
        'rotate-z': [{ 'rotate-z': ue() }],
        scale: [{ scale: B() }],
        'scale-x': [{ 'scale-x': B() }],
        'scale-y': [{ 'scale-y': B() }],
        'scale-z': [{ 'scale-z': B() }],
        'scale-3d': ['scale-3d'],
        skew: [{ skew: ie() }],
        'skew-x': [{ 'skew-x': ie() }],
        'skew-y': [{ 'skew-y': ie() }],
        transform: [{ transform: [Q, K, '', 'none', 'gpu', 'cpu'] }],
        'transform-origin': [{ origin: k() }],
        'transform-style': [{ transform: ['3d', 'flat'] }],
        translate: [{ translate: fe() }],
        'translate-x': [{ 'translate-x': fe() }],
        'translate-y': [{ 'translate-y': fe() }],
        'translate-z': [{ 'translate-z': fe() }],
        'translate-none': ['translate-none'],
        accent: [{ accent: O() }],
        appearance: [{ appearance: ['none', 'auto'] }],
        'caret-color': [{ caret: O() }],
        'color-scheme': [
          {
            scheme: ['normal', 'dark', 'light', 'light-dark', 'only-dark', 'only-light'],
          },
        ],
        cursor: [
          {
            cursor: [
              'auto',
              'default',
              'pointer',
              'wait',
              'text',
              'move',
              'help',
              'not-allowed',
              'none',
              'context-menu',
              'progress',
              'cell',
              'crosshair',
              'vertical-text',
              'alias',
              'copy',
              'no-drop',
              'grab',
              'grabbing',
              'all-scroll',
              'col-resize',
              'row-resize',
              'n-resize',
              'e-resize',
              's-resize',
              'w-resize',
              'ne-resize',
              'nw-resize',
              'se-resize',
              'sw-resize',
              'ew-resize',
              'ns-resize',
              'nesw-resize',
              'nwse-resize',
              'zoom-in',
              'zoom-out',
              Q,
              K,
            ],
          },
        ],
        'field-sizing': [{ 'field-sizing': ['fixed', 'content'] }],
        'pointer-events': [{ 'pointer-events': ['auto', 'none'] }],
        resize: [{ resize: ['none', '', 'y', 'x'] }],
        'scroll-behavior': [{ scroll: ['auto', 'smooth'] }],
        'scroll-m': [{ 'scroll-m': w() }],
        'scroll-mx': [{ 'scroll-mx': w() }],
        'scroll-my': [{ 'scroll-my': w() }],
        'scroll-ms': [{ 'scroll-ms': w() }],
        'scroll-me': [{ 'scroll-me': w() }],
        'scroll-mt': [{ 'scroll-mt': w() }],
        'scroll-mr': [{ 'scroll-mr': w() }],
        'scroll-mb': [{ 'scroll-mb': w() }],
        'scroll-ml': [{ 'scroll-ml': w() }],
        'scroll-p': [{ 'scroll-p': w() }],
        'scroll-px': [{ 'scroll-px': w() }],
        'scroll-py': [{ 'scroll-py': w() }],
        'scroll-ps': [{ 'scroll-ps': w() }],
        'scroll-pe': [{ 'scroll-pe': w() }],
        'scroll-pt': [{ 'scroll-pt': w() }],
        'scroll-pr': [{ 'scroll-pr': w() }],
        'scroll-pb': [{ 'scroll-pb': w() }],
        'scroll-pl': [{ 'scroll-pl': w() }],
        'snap-align': [{ snap: ['start', 'end', 'center', 'align-none'] }],
        'snap-stop': [{ snap: ['normal', 'always'] }],
        'snap-type': [{ snap: ['none', 'x', 'y', 'both'] }],
        'snap-strictness': [{ snap: ['mandatory', 'proximity'] }],
        touch: [{ touch: ['auto', 'none', 'manipulation'] }],
        'touch-x': [{ 'touch-pan': ['x', 'left', 'right'] }],
        'touch-y': [{ 'touch-pan': ['y', 'up', 'down'] }],
        'touch-pz': ['touch-pinch-zoom'],
        select: [{ select: ['none', 'text', 'all', 'auto'] }],
        'will-change': [{ 'will-change': ['auto', 'scroll', 'contents', 'transform', Q, K] }],
        fill: [{ fill: ['none', ...O()] }],
        'stroke-w': [{ stroke: [me, lr, us, $n] }],
        stroke: [{ stroke: ['none', ...O()] }],
        'forced-color-adjust': [{ 'forced-color-adjust': ['auto', 'none'] }],
      },
      conflictingClassGroups: {
        overflow: ['overflow-x', 'overflow-y'],
        overscroll: ['overscroll-x', 'overscroll-y'],
        inset: ['inset-x', 'inset-y', 'start', 'end', 'top', 'right', 'bottom', 'left'],
        'inset-x': ['right', 'left'],
        'inset-y': ['top', 'bottom'],
        flex: ['basis', 'grow', 'shrink'],
        gap: ['gap-x', 'gap-y'],
        p: ['px', 'py', 'ps', 'pe', 'pt', 'pr', 'pb', 'pl'],
        px: ['pr', 'pl'],
        py: ['pt', 'pb'],
        m: ['mx', 'my', 'ms', 'me', 'mt', 'mr', 'mb', 'ml'],
        mx: ['mr', 'ml'],
        my: ['mt', 'mb'],
        size: ['w', 'h'],
        'font-size': ['leading'],
        'fvn-normal': [
          'fvn-ordinal',
          'fvn-slashed-zero',
          'fvn-figure',
          'fvn-spacing',
          'fvn-fraction',
        ],
        'fvn-ordinal': ['fvn-normal'],
        'fvn-slashed-zero': ['fvn-normal'],
        'fvn-figure': ['fvn-normal'],
        'fvn-spacing': ['fvn-normal'],
        'fvn-fraction': ['fvn-normal'],
        'line-clamp': ['display', 'overflow'],
        rounded: [
          'rounded-s',
          'rounded-e',
          'rounded-t',
          'rounded-r',
          'rounded-b',
          'rounded-l',
          'rounded-ss',
          'rounded-se',
          'rounded-ee',
          'rounded-es',
          'rounded-tl',
          'rounded-tr',
          'rounded-br',
          'rounded-bl',
        ],
        'rounded-s': ['rounded-ss', 'rounded-es'],
        'rounded-e': ['rounded-se', 'rounded-ee'],
        'rounded-t': ['rounded-tl', 'rounded-tr'],
        'rounded-r': ['rounded-tr', 'rounded-br'],
        'rounded-b': ['rounded-br', 'rounded-bl'],
        'rounded-l': ['rounded-tl', 'rounded-bl'],
        'border-spacing': ['border-spacing-x', 'border-spacing-y'],
        'border-w': [
          'border-w-x',
          'border-w-y',
          'border-w-s',
          'border-w-e',
          'border-w-t',
          'border-w-r',
          'border-w-b',
          'border-w-l',
        ],
        'border-w-x': ['border-w-r', 'border-w-l'],
        'border-w-y': ['border-w-t', 'border-w-b'],
        'border-color': [
          'border-color-x',
          'border-color-y',
          'border-color-s',
          'border-color-e',
          'border-color-t',
          'border-color-r',
          'border-color-b',
          'border-color-l',
        ],
        'border-color-x': ['border-color-r', 'border-color-l'],
        'border-color-y': ['border-color-t', 'border-color-b'],
        translate: ['translate-x', 'translate-y', 'translate-none'],
        'translate-none': ['translate', 'translate-x', 'translate-y', 'translate-z'],
        'scroll-m': [
          'scroll-mx',
          'scroll-my',
          'scroll-ms',
          'scroll-me',
          'scroll-mt',
          'scroll-mr',
          'scroll-mb',
          'scroll-ml',
        ],
        'scroll-mx': ['scroll-mr', 'scroll-ml'],
        'scroll-my': ['scroll-mt', 'scroll-mb'],
        'scroll-p': [
          'scroll-px',
          'scroll-py',
          'scroll-ps',
          'scroll-pe',
          'scroll-pt',
          'scroll-pr',
          'scroll-pb',
          'scroll-pl',
        ],
        'scroll-px': ['scroll-pr', 'scroll-pl'],
        'scroll-py': ['scroll-pt', 'scroll-pb'],
        touch: ['touch-x', 'touch-y', 'touch-pz'],
        'touch-x': ['touch'],
        'touch-y': ['touch'],
        'touch-pz': ['touch'],
      },
      conflictingClassGroupModifiers: { 'font-size': ['leading'] },
      orderSensitiveModifiers: [
        '*',
        '**',
        'after',
        'backdrop',
        'before',
        'details-content',
        'file',
        'first-letter',
        'first-line',
        'marker',
        'placeholder',
        'selection',
      ],
    };
  },
  ep = Of(Xf);
function tp(...e) {
  return ep(mf(e));
}
const sp = (e, t) => {
    const r = e.split('.').map((a) => +a || 0),
      n = t.split('.').map((a) => +a || 0);
    for (let a = 0; a < 3; a++) {
      const i = r[a] ?? 0,
        o = n[a] ?? 0;
      if (i < o) return -1;
      if (i > o) return 1;
    }
    return 0;
  },
  dn = F.forwardRef(({ className: e, variant: t = 'default', children: r, ...n }, a) => {
    const i = 'transition-all duration-200 bg-white border border-border-light',
      o = {
        default: 'mh-card p-4 md:p-6',
        hero: 'mh-card mh-card--hero p-6 md:p-10 bg-gradient-to-br from-white to-brand-50',
        ai: 'mh-ai-card',
      };
    return s.jsx('section', {
      ref: a,
      className: tp(i, o[t], e),
      ...n,
      children: r,
    });
  });
dn.displayName = 'HomeCard';
const yc = F.memo(({ index: e, title: t, desc: r, icon: n, isLast: a }) =>
  s.jsxs('div', {
    className:
      'group relative flex cursor-default items-center gap-3 rounded-xl py-2 pl-2 pr-1 transition-colors duration-300 hover:bg-bg-soft md:flex-col md:items-center md:gap-4 md:p-2',
    children: [
      s.jsxs('div', {
        className: 'relative z-10 shrink-0',
        children: [
          s.jsx('div', {
            className:
              'flex size-10 items-center justify-center rounded-full border-2 border-border-light bg-white text-text-muted shadow-sm transition-all duration-300 group-hover:scale-110 group-hover:border-brand group-hover:text-brand md:size-12',
            children: s.jsx(n, { size: 18, className: 'md:size-5' }),
          }),
          s.jsx('div', {
            className:
              'absolute -right-1 -top-0.5 flex size-5 items-center justify-center rounded-full bg-brand text-[10px] font-bold text-white ring-2 ring-white',
            children: e + 1,
          }),
        ],
      }),
      s.jsxs('div', {
        className: 'flex-1 md:text-center',
        children: [
          s.jsx('h4', {
            className:
              'mb-0.5 text-sm font-black text-text-ink transition-colors group-hover:text-brand md:mb-1 md:text-base',
            children: t,
          }),
          s.jsx('p', {
            className: 'text-[11px] font-medium leading-relaxed text-text-muted md:text-xs',
            children: r,
          }),
        ],
      }),
      s.jsx('div', {
        className: 'ml-auto text-border-light transition-colors group-hover:text-brand md:hidden',
        children:
          !a &&
          s.jsx(Gd, {
            size: 14,
            className: 'opacity-0 group-hover:opacity-20',
          }),
      }),
    ],
  })
);
yc.displayName = 'HeroStep';
function rp() {
  return s.jsxs(dn, {
    variant: 'hero',
    className: 'group/container relative overflow-hidden',
    children: [
      s.jsxs('div', {
        className: 'relative z-10 mb-10 flex flex-col items-center gap-6 md:flex-row md:gap-10',
        children: [
          s.jsx('div', {
            className: 'relative h-32 w-28 shrink-0',
            children: s.jsx(cf, {}),
          }),
          s.jsxs('div', {
            className: 'flex-1 text-center md:text-left',
            children: [
              s.jsxs('div', {
                className:
                  'border-[var(--brand)]/20 mb-3 inline-flex items-center gap-2 rounded-full border bg-[var(--bg-page)] px-3 py-1 text-xs font-bold text-[var(--brand)]',
                children: [
                  s.jsx(Hd, { size: 14 }),
                  s.jsx('span', { children: '全程透明．安心留痕' }),
                ],
              }),
              s.jsx('h3', {
                className:
                  'mb-3 text-2xl font-black tracking-tight text-[var(--brand)] md:text-3xl',
                children: '安心留痕保障',
              }),
              s.jsxs('p', {
                className:
                  'max-w-2xl text-sm font-medium leading-relaxed text-[var(--text-secondary)] md:text-base',
                children: [
                  '介紹改從第一次電話聯絡開始，買賣雙方的每一通聯絡紀錄、每一句承諾與每項協議， 都會經過雙方確認並完整留痕。',
                  s.jsx('br', { className: 'hidden md:block' }),
                  '讓整個交易過程都有跡可循，保障雙方權益，直到圓滿交屋。',
                ],
              }),
            ],
          }),
          s.jsxs('a', {
            href: '/#policy',
            className:
              'hidden shrink-0 items-center gap-2 rounded-xl border-2 border-[var(--brand)] bg-white px-5 py-2.5 text-sm font-bold text-[var(--brand)] shadow-sm transition-all hover:bg-[var(--brand)] hover:text-white md:flex',
            children: ['履保規範 ', s.jsx(yl, { size: 16 })],
          }),
        ],
      }),
      s.jsxs('div', {
        className: 'relative mt-2 pl-2 md:mt-4 md:pl-0',
        children: [
          s.jsx('div', {
            className: 'absolute left-0 top-8 -z-0 hidden h-0.5 w-full bg-border-light md:block',
          }),
          s.jsx('div', {
            className: 'absolute inset-y-0 left-7 -z-0 w-0.5 bg-border-light md:hidden',
          }),
          s.jsx('div', {
            className: 'grid grid-cols-1 gap-3 md:grid-cols-6 md:gap-2',
            children: Hi.map((e, t) =>
              s.jsx(yc, { ...e, index: t, isLast: t === Hi.length - 1 }, e.id)
            ),
          }),
        ],
      }),
    ],
  });
}
function np() {
  const [e, t] = h.useState(0);
  h.useEffect(() => {
    const a = setInterval(() => {
      t((i) => (i + 1) % 3);
    }, 3e3);
    return () => clearInterval(a);
  }, []);
  const n = (() => {
    switch (e) {
      case 0:
        return { left: 'M 55 130 L 35 145', right: 'M 145 130 L 165 145' };
      case 1:
        return { left: 'M 55 130 L 35 145', right: 'M 145 130 L 175 100' };
      case 2:
        return { left: 'M 55 130 L 25 115', right: 'M 145 130 L 175 115' };
      default:
        return { left: 'M 55 130 L 35 145', right: 'M 145 130 L 165 145' };
    }
  })();
  return s.jsxs('div', {
    className: 'relative mb-4 h-40 w-32 text-brand',
    children: [
      s.jsx('div', {
        className:
          'absolute left-1/2 top-1/2 -z-10 size-24 -translate-x-1/2 -translate-y-1/2 rounded-full bg-brand-100/50 blur-2xl',
      }),
      s.jsxs('svg', {
        viewBox: '0 0 200 240',
        className: 'size-full animate-float drop-shadow-sm',
        children: [
          s.jsx('path', {
            d: 'M 85 40 L 85 15 L 100 30 L 115 15 L 115 40',
            stroke: 'currentColor',
            strokeWidth: '5',
            fill: 'none',
            strokeLinecap: 'round',
            strokeLinejoin: 'round',
          }),
          s.jsx('path', {
            d: 'M 40 80 L 100 40 L 160 80',
            stroke: 'currentColor',
            strokeWidth: '6',
            fill: 'none',
            strokeLinecap: 'round',
            strokeLinejoin: 'round',
          }),
          s.jsx('rect', {
            x: '55',
            y: '80',
            width: '90',
            height: '100',
            stroke: 'currentColor',
            strokeWidth: '6',
            fill: 'none',
            strokeLinecap: 'round',
            strokeLinejoin: 'round',
          }),
          s.jsx('circle', {
            cx: '100',
            cy: '85',
            r: '4',
            fill: 'currentColor',
          }),
          s.jsx('path', {
            d: 'M 78 110 Q 85 105 92 110',
            stroke: 'currentColor',
            strokeWidth: '4',
            fill: 'none',
            strokeLinecap: 'round',
          }),
          s.jsx('path', {
            d: 'M 108 110 Q 115 105 122 110',
            stroke: 'currentColor',
            strokeWidth: '4',
            fill: 'none',
            strokeLinecap: 'round',
          }),
          s.jsx('circle', {
            cx: '85',
            cy: '125',
            r: '4',
            stroke: 'currentColor',
            strokeWidth: '3',
            fill: 'none',
          }),
          s.jsx('circle', {
            cx: '115',
            cy: '125',
            r: '4',
            stroke: 'currentColor',
            strokeWidth: '3',
            fill: 'none',
          }),
          s.jsx('path', {
            d: 'M 90 145 Q 100 155 110 145',
            stroke: 'currentColor',
            strokeWidth: '3',
            fill: 'none',
            strokeLinecap: 'round',
          }),
          s.jsx('path', {
            d: n.left,
            stroke: 'currentColor',
            strokeWidth: '5',
            fill: 'none',
            strokeLinecap: 'round',
            className: 'transition-all duration-500',
          }),
          s.jsx('path', {
            d: n.right,
            stroke: 'currentColor',
            strokeWidth: '5',
            fill: 'none',
            strokeLinecap: 'round',
            className: 'transition-all duration-500',
          }),
          s.jsx('path', {
            d: 'M 85 180 L 85 215 L 75 215',
            stroke: 'currentColor',
            strokeWidth: '5',
            fill: 'none',
            strokeLinecap: 'round',
            strokeLinejoin: 'round',
          }),
          s.jsx('path', {
            d: 'M 115 180 L 115 215 L 125 215',
            stroke: 'currentColor',
            strokeWidth: '5',
            fill: 'none',
            strokeLinecap: 'round',
            strokeLinejoin: 'round',
          }),
        ],
      }),
    ],
  });
}
const Ki = {
  快樂花園: { reviewCount: 28, rating: 4.3 },
  遠雄二代宅: { reviewCount: 45, rating: 4.1 },
  美河市: { reviewCount: 67, rating: 3.9 },
  景安和院: { reviewCount: 19, rating: 4.5 },
  松濤苑: { reviewCount: 32, rating: 4.2 },
  華固名邸: { reviewCount: 24, rating: 4.4 },
  default: { reviewCount: 12, rating: 4.2 },
};
function ap(e) {
  return Ki[e] || Ki.default;
}
function ip({ name: e, topic: t = '住戶真實評價', reviewCount: r, rating: n }) {
  const a = ap(e),
    i = r ?? (a == null ? void 0 : a.reviewCount) ?? 10,
    o = n ?? (a == null ? void 0 : a.rating) ?? 4;
  return s.jsxs('a', {
    href: '/maihouses/community-wall_mvp.html',
    target: '_blank',
    rel: 'noopener noreferrer',
    className:
      'group mt-3 block rounded-xl border-2 border-brand-100 bg-gradient-to-br from-brand-50 to-white p-4 transition-all hover:border-brand-300 hover:shadow-md',
    children: [
      s.jsxs('div', {
        className: 'mb-2 flex items-center justify-between',
        children: [
          s.jsxs('div', {
            className: 'flex items-center gap-2',
            children: [
              s.jsx('div', {
                className: 'flex size-8 items-center justify-center rounded-lg bg-brand-100',
                children: s.jsx(vl, { size: 16, className: 'text-brand-700' }),
              }),
              s.jsxs('div', {
                children: [
                  s.jsx('p', {
                    className: 'text-sm font-black text-brand-700',
                    children: e,
                  }),
                  s.jsx('p', {
                    className: 'text-ink-500 text-[11px] font-medium',
                    children: '社區牆',
                  }),
                ],
              }),
            ],
          }),
          s.jsx(vn, {
            size: 16,
            className: 'text-brand-400 transition-colors group-hover:text-brand-600',
          }),
        ],
      }),
      s.jsxs('p', {
        className: 'mb-3 line-clamp-2 text-xs font-medium text-ink-600',
        children: ['💬 ', t],
      }),
      s.jsxs('div', {
        className: 'text-ink-500 flex items-center gap-4 text-[11px]',
        children: [
          s.jsxs('span', {
            className: 'flex items-center gap-1',
            children: [
              s.jsx(jn, {
                size: 12,
                className: 'fill-amber-500 text-amber-500',
              }),
              s.jsx('span', {
                className: 'font-bold text-ink-700',
                children: o,
              }),
            ],
          }),
          s.jsxs('span', { children: [i, ' 則評價'] }),
        ],
      }),
      s.jsx('div', {
        className:
          'mt-3 rounded-lg bg-brand-700 px-3 py-2 text-center text-xs font-bold text-white transition-colors group-hover:bg-brand-600',
        children: '去看看住戶怎麼說 →',
      }),
    ],
  });
}
const Qi = {
  'MH-2024-001': {
    title: '高樓層雙面採光 3房',
    price: '2,180萬',
    size: '35.8坪',
    rooms: '3房2廳2衛',
    address: '中正路168號12樓',
    highlight: '捷運3分鐘',
  },
  'MH-2024-002': {
    title: '景觀四房 附車位',
    price: '3,280萬',
    size: '52.6坪',
    rooms: '4房2廳2衛',
    address: '文化一路88號18樓',
    highlight: '河景第一排',
  },
  'MH-2024-003': {
    title: '精裝兩房 即可入住',
    price: '1,480萬',
    size: '26.2坪',
    rooms: '2房1廳1衛',
    address: '和平路66號8樓',
    highlight: '學區宅',
  },
  'MH-2024-004': {
    title: '邊間採光佳 視野好',
    price: '1,980萬',
    size: '32.1坪',
    rooms: '3房2廳1衛',
    address: '景平路188號15樓',
    highlight: '高樓層',
  },
  default: {
    title: '優質物件',
    price: '洽詢',
    size: '-',
    rooms: '-',
    address: '點擊查看詳情',
    highlight: '新上架',
  },
};
function op(e) {
  return (
    Qi[e] ??
    Qi.default ?? {
      title: '優質物件',
      price: '洽詢',
      size: '-',
      rooms: '-',
      address: '點擊查看詳情',
      highlight: '新上架',
    }
  );
}
function lp({ community: e, propertyId: t }) {
  const r = op(t);
  return s.jsxs('a', {
    href: '/property.html',
    target: '_blank',
    rel: 'noopener noreferrer',
    className:
      'group mt-3 block max-w-sm rounded-xl border-2 border-orange-100 bg-gradient-to-br from-orange-50 to-white p-4 transition-all hover:border-orange-300 hover:shadow-md',
    children: [
      s.jsxs('div', {
        className: 'mb-2 flex items-start justify-between',
        children: [
          s.jsxs('div', {
            children: [
              s.jsxs('div', {
                className: 'mb-1 flex items-center gap-2',
                children: [
                  s.jsx(mr, { size: 14, className: 'text-orange-500' }),
                  s.jsx('span', {
                    className: 'text-ink-500 text-[11px] font-medium',
                    children: e,
                  }),
                ],
              }),
              s.jsx('p', {
                className:
                  'text-ink-800 text-sm font-bold transition-colors group-hover:text-orange-600',
                children: r.title,
              }),
            ],
          }),
          s.jsxs('div', {
            className: 'flex items-center gap-2',
            children: [
              r.highlight &&
                s.jsx('span', {
                  className:
                    'whitespace-nowrap rounded-full bg-orange-500 px-2 py-0.5 text-[10px] font-medium text-white',
                  children: r.highlight,
                }),
              s.jsx(vn, {
                size: 14,
                className: 'text-orange-400 transition-colors group-hover:text-orange-600',
              }),
            ],
          }),
        ],
      }),
      s.jsxs('div', {
        className: 'mb-2 grid grid-cols-2 gap-2',
        children: [
          s.jsxs('div', {
            className: 'flex items-center gap-1 text-sm',
            children: [
              s.jsx(wn, { size: 12, className: 'text-orange-400' }),
              s.jsx('span', {
                className: 'font-bold text-orange-600',
                children: r.price,
              }),
            ],
          }),
          s.jsxs('div', {
            className: 'flex items-center gap-1 text-sm text-ink-600',
            children: [
              s.jsx(Wd, { size: 12, className: 'text-ink-400' }),
              s.jsx('span', { children: r.size }),
            ],
          }),
        ],
      }),
      s.jsxs('div', {
        className: 'text-ink-500 flex items-center gap-1 text-[11px]',
        children: [s.jsx(tr, { size: 11 }), s.jsx('span', { children: r.address })],
      }),
      s.jsx('div', {
        className: 'mt-1 text-[11px] text-ink-400',
        children: r.rooms,
      }),
      s.jsx('div', {
        className:
          'mt-3 border-t border-orange-100 pt-2 text-center text-[11px] font-medium text-orange-500 opacity-0 transition-opacity group-hover:opacity-100',
        children: '點擊查看詳情 →',
      }),
    ],
  });
}
function cp(e) {
  const t = /\[\[社區牆:([^:]+):([^\]]+)\]\]/g,
    r = [];
  let n;
  for (; (n = t.exec(e)) !== null; ) {
    const a = n[1],
      i = n[2];
    a && i && r.push({ name: a.trim(), topic: i.trim() });
  }
  return r;
}
function dp(e) {
  const t = /\[\[物件:([^:]+):([^\]]+)\]\]/g,
    r = [];
  let n;
  for (; (n = t.exec(e)) !== null; ) {
    const a = n[1],
      i = n[2];
    a && i && r.push({ community: a.trim(), propertyId: i.trim() });
  }
  return r;
}
function up(e) {
  const t = /\[\[情境:([^\]]+)\]\]/g,
    r = [];
  let n;
  for (; (n = t.exec(e)) !== null; ) n[1] && r.push(n[1].trim());
  return r;
}
function mp(e) {
  return e
    .replace(/\[\[社區牆:[^:]+:[^\]]+\]\]/g, '')
    .replace(/\[\[物件:[^:]+:[^\]]+\]\]/g, '')
    .replace(/\[\[情境:[^\]]+\]\]/g, '')
    .trim();
}
function hp({ description: e }) {
  return s.jsxs('div', {
    className:
      'my-3 rounded-r-lg border-l-4 border-orange-300 bg-gradient-to-r from-orange-50/80 to-amber-50/50 p-3 italic text-gray-600',
    children: [
      s.jsx('span', { className: 'mr-2 text-lg', children: '✨' }),
      s.jsx('span', { className: 'leading-relaxed', children: e }),
    ],
  });
}
function fp({ role: e, content: t, timestamp: r }) {
  const n = e === 'assistant' ? cp(t) : [],
    a = e === 'assistant' ? dp(t) : [],
    i = e === 'assistant' ? up(t) : [],
    o = e === 'assistant' ? mp(t) : t;
  return s.jsx('div', {
    className: `flex ${e === 'user' ? 'justify-end' : 'justify-start'} animate-fadeIn`,
    children: s.jsxs('div', {
      className: `max-w-[85%] rounded-2xl px-5 py-3.5 text-[15px] font-medium leading-relaxed shadow-sm ${e === 'user' ? 'rounded-br-sm bg-brand-700 text-white' : 'rounded-bl-sm border border-brand-100 bg-white text-ink-900'}`,
      children: [
        s.jsx('div', { className: 'whitespace-pre-wrap', children: o }),
        i.length > 0 &&
          s.jsx('div', {
            className: 'mt-2 space-y-2',
            children: i.map((l, c) => s.jsx(hp, { description: l }, `scenario-${c}`)),
          }),
        n.length > 0 &&
          s.jsx('div', {
            className: 'mt-2 space-y-2',
            children: n.map((l, c) =>
              s.jsx(ip, { name: l.name, topic: l.topic }, `community-${c}`)
            ),
          }),
        a.length > 0 &&
          s.jsx('div', {
            className: 'mt-2 space-y-2',
            children: a.map((l, c) =>
              s.jsx(lp, { community: l.community, propertyId: l.propertyId }, `property-${c}`)
            ),
          }),
        r &&
          s.jsx('div', {
            className: `mt-1.5 text-[11px] font-bold ${e === 'user' ? 'text-brand-300' : 'text-brand-600/60'} text-right`,
            children: new Date(r).toLocaleTimeString('zh-TW', {
              hour: '2-digit',
              minute: '2-digit',
            }),
          }),
      ],
    }),
  });
}
function vc() {
  const [e, t] = h.useState([]),
    [r, n] = h.useState(''),
    [a, i] = h.useState(!1),
    [o, l] = h.useState(null),
    [c, d] = h.useState(Fi()),
    m = h.useRef(null),
    x = e.filter((g) => g.role === 'user').length >= 3 ? Qm : Km;
  (h.useEffect(() => {
    Xm();
    const g = localStorage.getItem('mai-last-chat'),
      b = new Date().toDateString();
    if (!g || g !== b) {
      const y = Mh();
      y && l(y);
      const p = setTimeout(() => {
        (t([
          {
            role: 'assistant',
            content: y || '嗨～今天過得怎麼樣呀？有沒有什麼想跟我分享的？☀️',
            timestamp: new Date().toISOString(),
          },
        ]),
          localStorage.setItem('mai-last-chat', b));
      }, 1500);
      return () => clearTimeout(p);
    }
  }, []),
    h.useEffect(() => {
      const g = new Date(),
        b = g.getHours(),
        y = g.getMinutes();
      if (
        b === 22 &&
        y < 30 &&
        !localStorage.getItem('mai-goodnight-' + g.toDateString()) &&
        e.length > 0
      ) {
        const E = setTimeout(() => {
          (t((S) => [
            ...S,
            {
              role: 'assistant',
              content: `晚安啦～今天也辛苦了，要好好休息喔 💤
對了...夢裡如果看到喜歡的房子，記得明天告訴我，我幫你找找看有沒有類似的～`,
              timestamp: new Date().toISOString(),
            },
          ]),
            localStorage.setItem('mai-goodnight-' + g.toDateString(), '1'));
        }, 5e3);
        return () => clearTimeout(E);
      }
    }, [e.length]),
    h.useEffect(() => {
      d(Fi());
    }, [e.length]),
    h.useEffect(() => {
      const g = () => {
        yh();
      };
      return (
        window.addEventListener('beforeunload', g),
        () => window.removeEventListener('beforeunload', g)
      );
    }, []),
    h.useEffect(() => {
      m.current && (m.current.scrollTop = m.current.scrollHeight);
    }, [e]));
  const f = async (g = r) => {
    if (!g.trim() || a) return;
    g === '只是來聊聊' && Kh(!0);
    const b = {
      role: 'user',
      content: g.trim(),
      timestamp: new Date().toISOString(),
    };
    (t((p) => [...p, b]), n(''), i(!0));
    const y = {
      role: 'assistant',
      content: '',
      timestamp: new Date().toISOString(),
    };
    t((p) => [...p, y]);
    try {
      const p = await Cr([...e, b], (E) => {
        t((S) => {
          const N = [...S],
            k = N.at(-1);
          return (k && k.role === 'assistant' && (k.content += E), N);
        });
      });
    } catch (p) {
      (console.error(p),
        t((E) => {
          const S = [...E],
            N = S.at(-1);
          return (N && (N.content = '抱歉，我這邊好像有點問題，等一下再試試？'), S);
        }));
    } finally {
      i(!1);
    }
  };
  return s.jsxs('section', {
    className:
      'group relative isolate overflow-hidden rounded-[24px] border border-brand-100 bg-gradient-to-br from-white via-[#F8FAFC] to-[#00385a08] shadow-[0_8px_24px_rgba(0,56,90,0.06)] transition-all duration-300 hover:shadow-[0_12px_32px_rgba(0,56,90,0.1)]',
    children: [
      s.jsx('div', {
        className:
          'pointer-events-none absolute -right-24 -top-24 size-80 rounded-full bg-brand-100/30 mix-blend-multiply blur-3xl',
      }),
      s.jsx('div', {
        className:
          'pointer-events-none absolute -bottom-24 -left-24 size-96 rounded-full bg-brand-700/5 mix-blend-multiply blur-3xl',
      }),
      s.jsx('div', {
        className:
          'pointer-events-none absolute inset-0 z-0 bg-[linear-gradient(to_right,#00385a08_1px,transparent_1px),linear-gradient(to_bottom,#00385a08_1px,transparent_1px)] [background-size:24px_24px] [mask-image:radial-gradient(ellipse_80%_50%_at_50%_0%,#000_70%,transparent_100%)]',
      }),
      s.jsx('div', {
        className:
          'relative z-20 h-1.5 w-full bg-gradient-to-r from-brand-700 via-brand-600 to-brand-500',
      }),
      s.jsxs('div', {
        className: 'relative z-10 p-5 md:p-8 md:pt-6',
        children: [
          s.jsxs('div', {
            className: 'mb-3 flex flex-col justify-between gap-4 md:flex-row md:items-center',
            children: [
              s.jsxs('div', {
                className: 'flex items-center gap-3',
                children: [
                  s.jsx('div', {
                    className:
                      'relative flex size-12 shrink-0 items-center justify-center overflow-hidden rounded-2xl border border-brand-100 bg-white/80 text-brand-700 shadow-sm backdrop-blur-sm transition-transform duration-300 group-hover:scale-105',
                    children: s.jsx($t, { size: 26, strokeWidth: 2 }),
                  }),
                  s.jsxs('div', {
                    children: [
                      s.jsxs('h3', {
                        className:
                          'flex items-center gap-2 text-xl font-black tracking-tight text-brand-700',
                        children: [
                          'MaiMai 小閨蜜',
                          s.jsxs('span', {
                            className:
                              'inline-flex items-center gap-1 rounded-full bg-gradient-to-r from-brand-700 to-brand-600 px-2 py-0.5 text-[10px] font-bold uppercase tracking-wider text-white shadow-sm',
                            children: [s.jsx(Nn, { size: 10 }), ' v6.0'],
                          }),
                        ],
                      }),
                      s.jsxs('div', {
                        className: 'mt-0.5 flex items-center gap-2',
                        children: [
                          s.jsx('p', {
                            className: 'text-xs font-bold tracking-wide text-ink-600',
                            children: '聊生活、聊房子、什麼都可以聊 ☕',
                          }),
                          s.jsxs('span', {
                            className:
                              'inline-flex items-center gap-1 rounded-full border border-pink-200 bg-pink-50 px-2 py-0.5 text-[10px] font-bold text-pink-600',
                            children: [
                              s.jsx(La, { size: 10, fill: 'currentColor' }),
                              ' ',
                              c.label,
                              ' ',
                              c.emoji,
                            ],
                          }),
                        ],
                      }),
                    ],
                  }),
                ],
              }),
              s.jsx('div', {
                className: 'flex flex-wrap items-center justify-end gap-2',
                children: x.map((g) =>
                  s.jsx(
                    'button',
                    {
                      onClick: () => f(g),
                      className:
                        'rounded-full border border-brand-100 bg-white px-3.5 py-1.5 text-xs font-bold text-brand-700 shadow-sm backdrop-blur-sm transition-all hover:border-brand-700 hover:bg-brand-700 hover:text-white hover:shadow-md active:scale-95',
                      children: g,
                    },
                    g
                  )
                ),
              }),
            ],
          }),
          s.jsxs('div', {
            ref: m,
            className:
              'mb-4 flex h-[380px] flex-col gap-4 overflow-y-auto scroll-smooth rounded-2xl border border-brand-100/60 bg-white/50 p-5 shadow-inner backdrop-blur-md',
            role: 'log',
            'aria-live': 'polite',
            children: [
              e.length === 0
                ? s.jsxs('div', {
                    className:
                      'flex flex-1 flex-col items-center justify-center p-4 text-center opacity-80',
                    children: [
                      s.jsx(np, {}),
                      s.jsx('p', {
                        className: 'mb-2 text-base font-black text-brand-700',
                        children: o ? o.split('！')[0] + '！' : '嗨～我是邁邁 👋',
                      }),
                      s.jsx('p', {
                        className:
                          'mx-auto max-w-xs text-sm font-medium leading-relaxed text-ink-600',
                        children: o
                          ? o.includes('！')
                            ? o.split('！').slice(1).join('！')
                            : '最近過得怎樣？'
                          : s.jsxs(s.Fragment, {
                              children: [
                                '今天過得怎樣？',
                                s.jsx('br', {}),
                                '想聊什麼都可以，我在這陪你～',
                              ],
                            }),
                      }),
                    ],
                  })
                : e.map((g, b) =>
                    s.jsx(
                      fp,
                      {
                        role: g.role,
                        content: g.content,
                        timestamp: g.timestamp,
                      },
                      b
                    )
                  ),
              a &&
                s.jsx('div', {
                  className: 'flex animate-fadeIn justify-start',
                  children: s.jsxs('div', {
                    className:
                      'flex items-center gap-2 rounded-2xl rounded-bl-sm border border-brand-100 bg-white px-4 py-3 text-sm text-brand-600 shadow-sm',
                    children: [
                      s.jsx('span', {
                        className: 'font-bold',
                        children: '邁邁正在想...',
                      }),
                      s.jsxs('div', {
                        className: 'flex gap-1',
                        children: [
                          s.jsx('span', {
                            className:
                              'size-1.5 animate-[bounce_1.4s_infinite_ease-in-out_both] rounded-full bg-brand-500',
                          }),
                          s.jsx('span', {
                            className:
                              'size-1.5 animate-[bounce_1.4s_infinite_ease-in-out_both_0.2s] rounded-full bg-brand-500',
                          }),
                          s.jsx('span', {
                            className:
                              'size-1.5 animate-[bounce_1.4s_infinite_ease-in-out_both_0.4s] rounded-full bg-brand-500',
                          }),
                        ],
                      }),
                    ],
                  }),
                }),
            ],
          }),
          s.jsxs('div', {
            className: 'group/input relative',
            children: [
              s.jsx('input', {
                type: 'text',
                className:
                  'w-full rounded-xl border-2 border-brand-100 bg-white/80 py-4 pl-5 pr-14 text-[15px] font-bold text-ink-900 shadow-sm backdrop-blur-sm transition-all placeholder:text-ink-400/80 hover:border-brand-300 focus:border-brand-500 focus:outline-none focus:ring-4 focus:ring-brand-50/50',
                placeholder: '說說你今天過得如何，或任何想聊的...',
                value: r,
                onChange: (g) => n(g.target.value),
                onKeyDown: (g) => g.key === 'Enter' && !g.shiftKey && f(),
                disabled: a,
              }),
              s.jsx('button', {
                onClick: () => f(),
                disabled: a || !r.trim(),
                className:
                  'absolute inset-y-2 right-2 flex aspect-square items-center justify-center rounded-lg bg-brand-700 text-white shadow-md transition-all hover:-translate-y-0.5 hover:bg-brand-600 hover:shadow-lg active:translate-y-0 active:scale-95 disabled:cursor-not-allowed disabled:opacity-50 disabled:shadow-none disabled:hover:transform-none',
                children: s.jsx(Vd, {
                  size: 20,
                  strokeWidth: 2.5,
                  className: '-ml-0.5 translate-y-px',
                }),
              }),
            ],
          }),
        ],
      }),
    ],
  });
}
const jc = F.memo(({ id: e, name: t, rating: r, tags: n, content: a }) =>
  s.jsxs('article', {
    className:
      'relative flex gap-3 rounded-2xl border border-[#E6EDF7] bg-white p-3.5 transition-all duration-200 hover:-translate-y-0.5 hover:shadow-[0_4px_12px_rgba(0,56,90,0.08)]',
    children: [
      s.jsx('div', {
        className:
          'flex size-[38px] shrink-0 items-center justify-center rounded-full border border-[#E6EDF7] bg-gradient-to-b from-[#F2F5F8] to-[#E1E6EB] text-[15px] font-black text-[#00385a] shadow-[inset_0_1px_2px_rgba(255,255,255,0.8),0_2px_4px_rgba(0,56,90,0.05)]',
        children: e,
      }),
      s.jsxs('div', {
        className: 'min-w-0 flex-1',
        children: [
          s.jsxs('div', {
            className: 'mb-1.5 flex items-center justify-between',
            children: [
              s.jsx('div', {
                className: 'flex items-center gap-1.5 text-[15px] font-black text-primary',
                children: t,
              }),
              s.jsx('div', {
                className: 'flex gap-0.5',
                'aria-label': `${r} stars`,
                children: Array.from({ length: 5 }).map((i, o) =>
                  s.jsx(
                    'span',
                    {
                      className: `text-xs ${o < r ? 'text-[#00385a]' : 'text-[#E6EDF7]'}`,
                      children: '★',
                    },
                    o
                  )
                ),
              }),
            ],
          }),
          s.jsx('div', {
            className: 'mb-2 flex flex-wrap gap-1.5',
            children: n.map((i) =>
              s.jsx(
                'span',
                {
                  className:
                    'rounded-md border border-[#E6EDF7] bg-[#F6F9FF] px-2 py-0.5 text-[11px] font-bold tracking-wide text-[#00385a]',
                  children: i,
                },
                i
              )
            ),
          }),
          s.jsx('p', {
            className: 'text-justify text-[13px] font-medium leading-relaxed text-[#4B5563]',
            children: a,
          }),
        ],
      }),
    ],
  })
);
jc.displayName = 'ReviewCard';
const pp = {
    BASE_URL: '/maihouses/',
    DEV: !1,
    MODE: 'production',
    PROD: !0,
    SSR: !1,
  },
  xp = ['VITE_SUPABASE_URL', 'VITE_SUPABASE_ANON_KEY'],
  Ji = '/api/community',
  gp = (e) => e.replace(/\/+$/, ''),
  Xi = (e) => {
    try {
      const t = new URL(e);
      return t.protocol === 'http:' || t.protocol === 'https:';
    } catch {
      return !1;
    }
  },
  bp = () => {
    const e = '/maihouses/';
    return e.endsWith('/') ? e : `${e}/`;
  },
  eo = (e, t) => {
    if (typeof document < 'u' && document.body) {
      const r = bp();
      document.body.innerHTML = `
      <div style="display:flex;align-items:center;justify-content:center;height:100vh;font-family:system-ui,-apple-system,sans-serif;background:#f8fafc;">
        <div style="text-align:center;max-width:400px;padding:2rem;">
          <div style="font-size:3rem;margin-bottom:1rem;">⚠️</div>
          <h1 style="font-size:1.25rem;font-weight:600;color:#1e293b;margin-bottom:0.5rem;">${e}</h1>
          <p style="color:#64748b;margin-bottom:1.5rem;">${t}</p>
          <a href="${r}" style="display:inline-block;padding:0.75rem 1.5rem;background:#3b82f6;color:white;border-radius:0.5rem;text-decoration:none;font-weight:500;">回到首頁</a>
        </div>
      </div>
    `;
    }
  };
function yp() {
  const t = xp.filter((a) => !pp[a]);
  if (t.length > 0) {
    const a = `缺少必要的環境變數：${t.join(', ')}`;
    throw (eo('系統設定錯誤', '請聯繫管理員'), new Error(a));
  }
  const r = void 0;
  if (!Xi(r)) {
    const a = 'VITE_SUPABASE_URL 必須是有效的 HTTP(S) URL';
    throw (eo('系統設定錯誤', '請聯繫管理員'), new Error(a));
  }
  const n = {
    VITE_SUPABASE_URL: r,
    VITE_SUPABASE_ANON_KEY: void 0,
    VITE_API_BASE_URL: void 0,
    VITE_APP_URL: void 0,
  };
  return (
    n.VITE_API_BASE_URL &&
      !Xi(n.VITE_API_BASE_URL) &&
      !n.VITE_API_BASE_URL.startsWith('/') &&
      console.warn('[env] VITE_API_BASE_URL 格式無效，應為 HTTP(S) URL 或以 / 開頭的路徑'),
    n.VITE_API_BASE_URL,
    n
  );
}
const va = yp();
function vp(e) {
  if (!e.VITE_API_BASE_URL)
    return (console.warn('[env] VITE_API_BASE_URL 未設定，使用預設 /api/community'), Ji);
  const t = e.VITE_API_BASE_URL.trim();
  return t
    ? `${gp(t)}/community`
    : (console.warn('[env] VITE_API_BASE_URL 為空字串，使用預設 /api/community'), Ji);
}
const jp = vp(va),
  de = fu(va.VITE_SUPABASE_URL, va.VITE_SUPABASE_ANON_KEY, {
    auth: { persistSession: !0, autoRefreshToken: !0, detectSessionInUrl: !0 },
  }),
  wp = jp,
  Np = '/api/home/featured-reviews',
  _p = 5e3;
async function kp() {
  const {
    data: { session: e },
  } = await de.auth.getSession();
  return (e == null ? void 0 : e.access_token) ?? null;
}
async function Ar(e, t = {}) {
  var i;
  const r = await kp(),
    n = {
      'Content-Type': 'application/json',
      ...(r && { Authorization: `Bearer ${r}` }),
      ...t.headers,
    },
    a = await fetch(`${wp}${e}`, { ...t, headers: n });
  if (!a.ok) {
    const o = await a.json().catch(() => ({ error: '請求失敗' }));
    let l = '請求失敗';
    typeof o.error == 'string'
      ? (l = o.error)
      : (i = o.error) != null && i.message
        ? (l = o.error.message)
        : o.message
          ? (l = o.message)
          : Array.isArray(o.error) &&
            (l = o.error
              .map((d) => (typeof d == 'object' ? d.message : d) || String(d))
              .join(', '));
    const c = new Error(l || `HTTP ${a.status}`);
    throw (Object.assign(c, { status: a.status, code: o.code }), c);
  }
  return a.json();
}
async function Sp(e, t = {}) {
  const { includePrivate: r = !1 } = t;
  return Ar(`/wall?communityId=${e}&type=all&includePrivate=${r ? '1' : '0'}`);
}
async function Ep(e, t, r = 'public') {
  return Ar('/post', {
    method: 'POST',
    body: JSON.stringify({ communityId: e, content: t, visibility: r }),
  });
}
async function Tp(e) {
  return Ar('/like', { method: 'POST', body: JSON.stringify({ postId: e }) });
}
async function Ip(e, t) {
  return Ar('/question', {
    method: 'POST',
    body: JSON.stringify({ communityId: e, question: t }),
  });
}
async function Cp(e, t) {
  return Ar('/question', {
    method: 'POST',
    body: JSON.stringify({ action: 'answer', questionId: e, content: t }),
  });
}
async function Ap() {
  const e = new AbortController(),
    t = setTimeout(() => e.abort(), _p);
  try {
    const r = await fetch(Np, { signal: e.signal });
    if (!r.ok) throw new Error(`API error: ${r.status}`);
    const n = await r.json();
    if (!Lp(n)) throw new Error('Invalid API response format');
    if (!n.success) throw new Error('API returned success: false');
    return n.data;
  } catch (r) {
    clearTimeout(t);
    let n;
    throw (
      r instanceof Error && r.name === 'AbortError'
        ? (n = new Error('Request timeout'))
        : r instanceof Error
          ? (n = r)
          : (n = new Error('Unknown error')),
      n
    );
  } finally {
    clearTimeout(t);
  }
}
function Lp(e) {
  if (typeof e != 'object' || e === null) return !1;
  const t = e;
  if (
    typeof t.success != 'boolean' ||
    !Array.isArray(t.data) ||
    typeof t.meta != 'object' ||
    t.meta === null
  )
    return !1;
  const r = t.meta;
  if (
    typeof r.total != 'number' ||
    typeof r.realCount != 'number' ||
    typeof r.seedCount != 'number' ||
    typeof r.timestamp != 'string'
  )
    return !1;
  const n = t.data;
  if (!Array.isArray(n)) return !1;
  for (const a of n) {
    const i = a;
    if (
      typeof i.id != 'string' ||
      typeof i.displayId != 'string' ||
      typeof i.name != 'string' ||
      typeof i.rating != 'number' ||
      !Array.isArray(i.tags) ||
      !i.tags.every((o) => typeof o == 'string') ||
      typeof i.content != 'string' ||
      (i.communityId !== null && typeof i.communityId != 'string') ||
      (i.source !== 'real' && i.source !== 'seed') ||
      typeof i.region != 'string'
    )
      return !1;
  }
  return !0;
}
const to = '/maihouses/community-wall_mvp.html';
function Op(e) {
  return {
    originalId: e.id,
    displayId: e.displayId,
    name: e.name,
    rating: e.rating,
    tags: e.tags,
    content: e.content,
    source: e.source,
    communityId: e.communityId,
  };
}
function Rp(e) {
  return {
    originalId: e.id,
    displayId: e.id,
    name: e.name,
    rating: e.rating,
    tags: e.tags,
    content: e.content,
    source: e.source,
    communityId: e.communityId,
  };
}
function Mp() {
  const e = yn(),
    {
      data: t,
      isLoading: r,
      isError: n,
    } = $a({
      queryKey: ['featured-reviews'],
      queryFn: Ap,
      staleTime: 5 * 60 * 1e3,
      retry: 1,
    }),
    a = n || !t ? df.map(Rp) : t.map(Op),
    i = h.useCallback(
      (o) => {
        o.source === 'real' && o.communityId
          ? e(`/community/${o.communityId}/wall`)
          : (window.location.href = to);
      },
      [e]
    );
  return r
    ? s.jsxs(dn, {
        className:
          'bg-white/96 border border-[#E6EDF7] p-3 shadow-[0_4px_20px_rgba(0,56,90,0.03)] backdrop-blur-md',
        children: [
          s.jsxs('div', {
            className:
              'relative mb-4 flex items-center justify-between overflow-hidden rounded-2xl bg-gradient-to-r from-[#00385a] to-[#005585] px-4 py-3 shadow-[0_2px_8px_rgba(0,56,90,0.15)]',
            children: [
              s.jsx('div', {
                className:
                  'pointer-events-none absolute -right-6 -top-6 size-24 rounded-full bg-white/5 blur-2xl',
              }),
              s.jsxs('div', {
                className: 'relative z-10 flex items-center gap-2.5',
                children: [
                  s.jsx('div', {
                    className:
                      'size-1.5 rounded-full bg-[#E63946] shadow-[0_0_8px_rgba(230,57,70,0.6)]',
                  }),
                  s.jsx('h3', {
                    className: 'text-shadow-sm m-0 text-lg font-black tracking-wide text-white',
                    children: '社區評價',
                  }),
                  s.jsx('span', {
                    className:
                      'rounded-full border border-white/20 bg-white/95 px-2.5 py-0.5 text-[11px] font-bold text-[#00385a] shadow-sm backdrop-blur-sm',
                    children: '聚合',
                  }),
                ],
              }),
            ],
          }),
          s.jsx('div', {
            className: 'grid grid-cols-1 gap-3 sm:grid-cols-2',
            children: [1, 2, 3, 4, 5, 6].map((o) =>
              s.jsx(
                'div',
                {
                  className: 'animate-pulse rounded-2xl border border-[#E6EDF7] bg-white p-3.5',
                  children: s.jsxs('div', {
                    className: 'flex gap-3',
                    children: [
                      s.jsx('div', {
                        className: 'size-[38px] rounded-full bg-gray-200',
                      }),
                      s.jsxs('div', {
                        className: 'flex-1 space-y-2',
                        children: [
                          s.jsx('div', {
                            className: 'h-4 w-3/4 rounded bg-gray-200',
                          }),
                          s.jsx('div', {
                            className: 'h-3 w-1/2 rounded bg-gray-200',
                          }),
                          s.jsx('div', {
                            className: 'h-3 w-full rounded bg-gray-200',
                          }),
                          s.jsx('div', {
                            className: 'h-3 w-5/6 rounded bg-gray-200',
                          }),
                        ],
                      }),
                    ],
                  }),
                },
                o
              )
            ),
          }),
          s.jsx('div', {
            className: 'mt-4 h-12 animate-pulse rounded-xl bg-gray-100',
          }),
        ],
      })
    : s.jsxs(dn, {
        className:
          'bg-white/96 border border-[#E6EDF7] p-3 shadow-[0_4px_20px_rgba(0,56,90,0.03)] backdrop-blur-md',
        children: [
          s.jsxs('div', {
            className:
              'relative mb-4 flex items-center justify-between overflow-hidden rounded-2xl bg-gradient-to-r from-[#00385a] to-[#005585] px-4 py-3 shadow-[0_2px_8px_rgba(0,56,90,0.15)]',
            children: [
              s.jsx('div', {
                className:
                  'pointer-events-none absolute -right-6 -top-6 size-24 rounded-full bg-white/5 blur-2xl',
              }),
              s.jsxs('div', {
                className: 'relative z-10 flex items-center gap-2.5',
                children: [
                  s.jsx('div', {
                    className:
                      'size-1.5 rounded-full bg-[#E63946] shadow-[0_0_8px_rgba(230,57,70,0.6)]',
                  }),
                  s.jsx('h3', {
                    className: 'text-shadow-sm m-0 text-lg font-black tracking-wide text-white',
                    children: '社區評價',
                  }),
                  s.jsx('span', {
                    className:
                      'rounded-full border border-white/20 bg-white/95 px-2.5 py-0.5 text-[11px] font-bold text-[#00385a] shadow-sm backdrop-blur-sm',
                    children: '聚合',
                  }),
                ],
              }),
              n &&
                s.jsx('span', {
                  className:
                    'relative z-10 rounded-full bg-yellow-500/20 px-2 py-0.5 text-[10px] text-yellow-100',
                  children: '使用備用資料',
                }),
            ],
          }),
          s.jsx('div', {
            className: 'grid grid-cols-1 gap-3 sm:grid-cols-2',
            children: a.map((o) =>
              s.jsx(
                'div',
                {
                  onClick: () => i(o),
                  onKeyDown: (l) => {
                    (l.key === 'Enter' || l.key === ' ') && (l.preventDefault(), i(o));
                  },
                  role: 'button',
                  tabIndex: 0,
                  className: 'cursor-pointer',
                  'aria-label': `查看 ${o.name} 的評價詳情`,
                  children: s.jsx(jc, {
                    id: o.displayId,
                    name: o.name,
                    rating: o.rating,
                    tags: o.tags,
                    content: o.content,
                  }),
                },
                o.originalId
              )
            ),
          }),
          s.jsxs('a', {
            className:
              'group relative mt-4 flex items-center gap-2.5 rounded-xl border border-[#E6EDF7] bg-gradient-to-b from-white to-[#F6F9FF] p-3.5 font-black text-[#00385a] no-underline transition-all duration-200 hover:border-[#00385a]/20 hover:shadow-[0_4px_12px_rgba(0,56,90,0.08)] active:translate-y-px lg:justify-center lg:text-center',
            href: to,
            'aria-label': '點我看更多社區評價',
            children: [
              s.jsx('span', {
                className:
                  'text-[15px] tracking-wide transition-colors group-hover:text-[#004E7C] lg:mx-auto',
                children: '查看更多真實住戶評價',
              }),
              s.jsx('span', {
                className:
                  'ml-auto rounded-lg bg-[#00385a] px-3 py-1.5 text-xs font-bold text-white shadow-sm transition-colors group-hover:bg-[#004E7C] lg:absolute lg:right-[14px] lg:top-1/2 lg:ml-0 lg:-translate-y-1/2',
                children: '前往社區牆 →',
              }),
            ],
          }),
        ],
      });
}
function Pp({ property: e }) {
  return s.jsxs('article', {
    className:
      'group relative isolate overflow-hidden rounded-2xl border border-[#E6EDF7] bg-white shadow-none transition-all duration-[180ms] ease-out hover:-translate-y-0.5 hover:border-[#1749d738] hover:shadow-[0_10px_26px_rgba(13,39,94,0.12)]',
    children: [
      s.jsx('div', {
        className:
          'pointer-events-none absolute inset-0 bg-[radial-gradient(60%_60%_at_80%_-10%,rgba(23,73,215,0.12),transparent_60%)] opacity-80',
      }),
      s.jsxs('a', {
        href: `/property/${e.id}`,
        className: 'relative block aspect-[4/3] overflow-hidden bg-[#e9ecf5]',
        children: [
          s.jsx('img', {
            src: e.image,
            alt: '物件封面',
            className:
              'cubic-bezier(0.2,0.65,0.2,1) block size-full scale-100 object-cover transition-transform duration-[600ms] group-hover:scale-105',
          }),
          s.jsx('span', {
            className:
              'absolute left-2.5 top-2.5 rounded-full bg-black/75 px-2 py-1 text-xs font-extrabold tracking-[0.2px] text-white shadow-[0_4px_10px_rgba(0,0,0,0.18)]',
            children: e.badge,
          }),
        ],
      }),
      s.jsxs('div', {
        className: 'p-3 pb-3.5',
        children: [
          s.jsx('div', {
            className:
              'my-0.5 mb-2 text-base font-extrabold leading-[1.35] tracking-[0.3px] text-primary lg:text-[21px]',
            children: e.title,
          }),
          s.jsx('div', {
            className: 'mb-1.5 flex flex-wrap items-center gap-2 text-[13px] text-[#6C7B91]',
            children: e.tags.slice(0, 3).map((t, r) =>
              s.jsx(
                'span',
                {
                  className:
                    'duration-120 rounded-full border border-[#E6EDF7] bg-[#F6F9FF] px-2.5 py-0.5 font-extrabold text-[#2A2F3A] transition-all ease-out group-hover:-translate-y-px group-hover:shadow-[0_4px_10px_rgba(0,56,90,0.10)]',
                  children: t,
                },
                r
              )
            ),
          }),
          s.jsxs('div', {
            className: 'my-2 mb-1 text-[19px] font-black tracking-[0.2px] text-[#111]',
            children: ['NT$ ', e.price, ' 萬'],
          }),
          s.jsx('div', {
            className: 'text-[13px] text-[#6C7B91]',
            children: e.location,
          }),
          s.jsxs('div', {
            className:
              'mt-2.5 rounded-xl border border-[#E6EDF7] bg-gradient-to-b from-[#F6F9FF] to-white px-3 py-2.5',
            children: [
              s.jsx('div', {
                className:
                  "mb-2 flex items-center gap-2 text-[13px] font-black text-black/85 before:text-xs before:leading-none before:text-[#00385a] before:drop-shadow-[0_1px_0_rgba(0,56,90,0.12)] before:content-['★']",
                children: '住戶真實留言',
              }),
              e.reviews.map((t, r) =>
                s.jsxs(
                  'div',
                  {
                    className: `flex items-start gap-2.5 py-2 ${r !== 0 ? 'border-t border-dashed border-black/10' : ''}`,
                    children: [
                      s.jsx('div', {
                        className:
                          'grid size-[30px] flex-none place-items-center rounded-full bg-gradient-to-b from-[#F2F5F8] to-[#E1E6EB] text-xs font-black text-[#00385a] shadow-[inset_0_0_0_1px_rgba(0,56,90,0.15)]',
                        children: t.avatar,
                      }),
                      s.jsxs('div', {
                        className: 'min-w-0 flex-1',
                        children: [
                          s.jsxs('div', {
                            className: 'mb-0.5 flex items-center gap-1.5 text-xs text-black/60',
                            children: [
                              s.jsxs('span', {
                                className: 'font-black text-black/85',
                                children: [t.name, ' · ', t.role],
                              }),
                              s.jsx('span', {
                                className: 'inline-block size-1 rounded-full bg-black/20',
                              }),
                              s.jsx('span', {
                                className:
                                  'rounded-full bg-[#00385a]/10 px-2 py-0.5 font-black text-[#00385a]',
                                children: t.tag,
                              }),
                            ],
                          }),
                          s.jsx('div', {
                            className: 'text-[13px] leading-[1.6] text-black/85',
                            children: t.text,
                          }),
                        ],
                      }),
                    ],
                  },
                  r
                )
              ),
              s.jsx('button', {
                type: 'button',
                className:
                  'mt-2.5 w-full cursor-pointer rounded-xl border border-[#00385a]/30 bg-gradient-to-b from-white to-[#F5F7FA] px-3 py-2.5 text-[13px] font-black text-[#00385a] transition-all duration-150 ease-out hover:from-white hover:to-[#E8F0FF] hover:shadow-[0_6px_14px_rgba(0,56,90,0.18)] active:translate-y-px',
                children: '註冊後看更多評價',
              }),
            ],
          }),
        ],
      }),
    ],
  });
}
const ja = (e) => {
    let t = e;
    return (
      (t = t.replace(/^\d{3,5}/, '')),
      (t = t.replace(/(\d+[fF樓].*)$/, '')),
      (t = t.replace(/[之\-－—]\d+/g, '')),
      (t = t.replace(/號/g, '')),
      (t = t.replace(/\s+/g, '')),
      t
    );
  },
  so = (e) =>
    e
      .trim()
      .replace(/\s+/g, '')
      .replace(/[　]/g, '')
      .replace(/[（）]/g, (t) => (t === '（' ? '(' : ')'))
      .replace(/[「」『』]/g, '')
      .replace(/[．·]/g, '')
      .toLowerCase();
function L(e, t, r) {
  function n(l, c) {
    if (
      (l._zod ||
        Object.defineProperty(l, '_zod', {
          value: { def: c, constr: o, traits: new Set() },
          enumerable: !1,
        }),
      l._zod.traits.has(e))
    )
      return;
    (l._zod.traits.add(e), t(l, c));
    const d = o.prototype,
      m = Object.keys(d);
    for (let u = 0; u < m.length; u++) {
      const x = m[u];
      x in l || (l[x] = d[x].bind(l));
    }
  }
  const a = (r == null ? void 0 : r.Parent) ?? Object;
  class i extends a {}
  Object.defineProperty(i, 'name', { value: e });
  function o(l) {
    var c;
    const d = r != null && r.Parent ? new i() : this;
    (n(d, l), (c = d._zod).deferred ?? (c.deferred = []));
    for (const m of d._zod.deferred) m();
    return d;
  }
  return (
    Object.defineProperty(o, 'init', { value: n }),
    Object.defineProperty(o, Symbol.hasInstance, {
      value: (l) => {
        var c, d;
        return r != null && r.Parent && l instanceof r.Parent
          ? !0
          : (d = (c = l == null ? void 0 : l._zod) == null ? void 0 : c.traits) == null
            ? void 0
            : d.has(e);
      },
    }),
    Object.defineProperty(o, 'name', { value: e }),
    o
  );
}
class $s extends Error {
  constructor() {
    super('Encountered Promise during synchronous parse. Use .parseAsync() instead.');
  }
}
class wc extends Error {
  constructor(t) {
    (super(`Encountered unidirectional transform during encode: ${t}`),
      (this.name = 'ZodEncodeError'));
  }
}
const Nc = {};
function Es(e) {
  return Nc;
}
function _c(e) {
  const t = Object.values(e).filter((n) => typeof n == 'number');
  return Object.entries(e)
    .filter(([n, a]) => t.indexOf(+n) === -1)
    .map(([n, a]) => a);
}
function wa(e, t) {
  return typeof t == 'bigint' ? t.toString() : t;
}
function Wa(e) {
  return {
    get value() {
      {
        const t = e();
        return (Object.defineProperty(this, 'value', { value: t }), t);
      }
    },
  };
}
function Va(e) {
  return e == null;
}
function Za(e) {
  const t = e.startsWith('^') ? 1 : 0,
    r = e.endsWith('$') ? e.length - 1 : e.length;
  return e.slice(t, r);
}
function zp(e, t) {
  const r = (e.toString().split('.')[1] || '').length,
    n = t.toString();
  let a = (n.split('.')[1] || '').length;
  if (a === 0 && /\d?e-\d?/.test(n)) {
    const c = n.match(/\d?e-(\d?)/);
    c != null && c[1] && (a = Number.parseInt(c[1]));
  }
  const i = r > a ? r : a,
    o = Number.parseInt(e.toFixed(i).replace('.', '')),
    l = Number.parseInt(t.toFixed(i).replace('.', ''));
  return (o % l) / 10 ** i;
}
const ro = Symbol('evaluating');
function we(e, t, r) {
  let n;
  Object.defineProperty(e, t, {
    get() {
      if (n !== ro) return (n === void 0 && ((n = ro), (n = r())), n);
    },
    set(a) {
      Object.defineProperty(e, t, { value: a });
    },
    configurable: !0,
  });
}
function Cs(e, t, r) {
  Object.defineProperty(e, t, {
    value: r,
    writable: !0,
    enumerable: !0,
    configurable: !0,
  });
}
function As(...e) {
  const t = {};
  for (const r of e) {
    const n = Object.getOwnPropertyDescriptors(r);
    Object.assign(t, n);
  }
  return Object.defineProperties({}, t);
}
function no(e) {
  return JSON.stringify(e);
}
function Dp(e) {
  return e
    .toLowerCase()
    .trim()
    .replace(/[^\w\s-]/g, '')
    .replace(/[\s_-]+/g, '-')
    .replace(/^-+|-+$/g, '');
}
const kc = 'captureStackTrace' in Error ? Error.captureStackTrace : (...e) => {};
function un(e) {
  return typeof e == 'object' && e !== null && !Array.isArray(e);
}
const Fp = Wa(() => {
  var e;
  if (
    typeof navigator < 'u' &&
    (e = navigator == null ? void 0 : navigator.userAgent) != null &&
    e.includes('Cloudflare')
  )
    return !1;
  try {
    const t = Function;
    return (new t(''), !0);
  } catch {
    return !1;
  }
});
function br(e) {
  if (un(e) === !1) return !1;
  const t = e.constructor;
  if (t === void 0 || typeof t != 'function') return !0;
  const r = t.prototype;
  return !(un(r) === !1 || Object.prototype.hasOwnProperty.call(r, 'isPrototypeOf') === !1);
}
function Sc(e) {
  return br(e) ? { ...e } : Array.isArray(e) ? [...e] : e;
}
const $p = new Set(['string', 'number', 'symbol']);
function En(e) {
  return e.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
}
function os(e, t, r) {
  const n = new e._zod.constr(t ?? e._zod.def);
  return ((!t || (r != null && r.parent)) && (n._zod.parent = e), n);
}
function ne(e) {
  const t = e;
  if (!t) return {};
  if (typeof t == 'string') return { error: () => t };
  if ((t == null ? void 0 : t.message) !== void 0) {
    if ((t == null ? void 0 : t.error) !== void 0)
      throw new Error('Cannot specify both `message` and `error` params');
    t.error = t.message;
  }
  return (delete t.message, typeof t.error == 'string' ? { ...t, error: () => t.error } : t);
}
function Up(e) {
  return Object.keys(e).filter(
    (t) => e[t]._zod.optin === 'optional' && e[t]._zod.optout === 'optional'
  );
}
const Bp = {
  safeint: [Number.MIN_SAFE_INTEGER, Number.MAX_SAFE_INTEGER],
  int32: [-2147483648, 2147483647],
  uint32: [0, 4294967295],
  float32: [-34028234663852886e22, 34028234663852886e22],
  float64: [-Number.MAX_VALUE, Number.MAX_VALUE],
};
function Gp(e, t) {
  const r = e._zod.def,
    n = As(e._zod.def, {
      get shape() {
        const a = {};
        for (const i in t) {
          if (!(i in r.shape)) throw new Error(`Unrecognized key: "${i}"`);
          t[i] && (a[i] = r.shape[i]);
        }
        return (Cs(this, 'shape', a), a);
      },
      checks: [],
    });
  return os(e, n);
}
function Hp(e, t) {
  const r = e._zod.def,
    n = As(e._zod.def, {
      get shape() {
        const a = { ...e._zod.def.shape };
        for (const i in t) {
          if (!(i in r.shape)) throw new Error(`Unrecognized key: "${i}"`);
          t[i] && delete a[i];
        }
        return (Cs(this, 'shape', a), a);
      },
      checks: [],
    });
  return os(e, n);
}
function Wp(e, t) {
  if (!br(t)) throw new Error('Invalid input to extend: expected a plain object');
  const r = e._zod.def.checks;
  if (r && r.length > 0)
    throw new Error(
      'Object schemas containing refinements cannot be extended. Use `.safeExtend()` instead.'
    );
  const a = As(e._zod.def, {
    get shape() {
      const i = { ...e._zod.def.shape, ...t };
      return (Cs(this, 'shape', i), i);
    },
    checks: [],
  });
  return os(e, a);
}
function Vp(e, t) {
  if (!br(t)) throw new Error('Invalid input to safeExtend: expected a plain object');
  const r = {
    ...e._zod.def,
    get shape() {
      const n = { ...e._zod.def.shape, ...t };
      return (Cs(this, 'shape', n), n);
    },
    checks: e._zod.def.checks,
  };
  return os(e, r);
}
function Zp(e, t) {
  const r = As(e._zod.def, {
    get shape() {
      const n = { ...e._zod.def.shape, ...t._zod.def.shape };
      return (Cs(this, 'shape', n), n);
    },
    get catchall() {
      return t._zod.def.catchall;
    },
    checks: [],
  });
  return os(e, r);
}
function Yp(e, t, r) {
  const n = As(t._zod.def, {
    get shape() {
      const a = t._zod.def.shape,
        i = { ...a };
      if (r)
        for (const o in r) {
          if (!(o in a)) throw new Error(`Unrecognized key: "${o}"`);
          r[o] && (i[o] = e ? new e({ type: 'optional', innerType: a[o] }) : a[o]);
        }
      else for (const o in a) i[o] = e ? new e({ type: 'optional', innerType: a[o] }) : a[o];
      return (Cs(this, 'shape', i), i);
    },
    checks: [],
  });
  return os(t, n);
}
function qp(e, t, r) {
  const n = As(t._zod.def, {
    get shape() {
      const a = t._zod.def.shape,
        i = { ...a };
      if (r)
        for (const o in r) {
          if (!(o in i)) throw new Error(`Unrecognized key: "${o}"`);
          r[o] && (i[o] = new e({ type: 'nonoptional', innerType: a[o] }));
        }
      else for (const o in a) i[o] = new e({ type: 'nonoptional', innerType: a[o] });
      return (Cs(this, 'shape', i), i);
    },
    checks: [],
  });
  return os(t, n);
}
function Ds(e, t = 0) {
  var r;
  if (e.aborted === !0) return !0;
  for (let n = t; n < e.issues.length; n++)
    if (((r = e.issues[n]) == null ? void 0 : r.continue) !== !0) return !0;
  return !1;
}
function Ec(e, t) {
  return t.map((r) => {
    var n;
    return ((n = r).path ?? (n.path = []), r.path.unshift(e), r);
  });
}
function Hr(e) {
  return typeof e == 'string' ? e : e == null ? void 0 : e.message;
}
function Ts(e, t, r) {
  var a, i, o, l, c, d;
  const n = { ...e, path: e.path ?? [] };
  if (!e.message) {
    const m =
      Hr(
        (o = (i = (a = e.inst) == null ? void 0 : a._zod.def) == null ? void 0 : i.error) == null
          ? void 0
          : o.call(i, e)
      ) ??
      Hr((l = t == null ? void 0 : t.error) == null ? void 0 : l.call(t, e)) ??
      Hr((c = r.customError) == null ? void 0 : c.call(r, e)) ??
      Hr((d = r.localeError) == null ? void 0 : d.call(r, e)) ??
      'Invalid input';
    n.message = m;
  }
  return (delete n.inst, delete n.continue, (t != null && t.reportInput) || delete n.input, n);
}
function Ya(e) {
  return Array.isArray(e) ? 'array' : typeof e == 'string' ? 'string' : 'unknown';
}
function yr(...e) {
  const [t, r, n] = e;
  return typeof t == 'string' ? { message: t, code: 'custom', input: r, inst: n } : { ...t };
}
const Tc = (e, t) => {
    ((e.name = '$ZodError'),
      Object.defineProperty(e, '_zod', { value: e._zod, enumerable: !1 }),
      Object.defineProperty(e, 'issues', { value: t, enumerable: !1 }),
      (e.message = JSON.stringify(t, wa, 2)),
      Object.defineProperty(e, 'toString', {
        value: () => e.message,
        enumerable: !1,
      }));
  },
  Ic = L('$ZodError', Tc),
  Cc = L('$ZodError', Tc, { Parent: Error });
function Kp(e, t = (r) => r.message) {
  const r = {},
    n = [];
  for (const a of e.issues)
    a.path.length > 0
      ? ((r[a.path[0]] = r[a.path[0]] || []), r[a.path[0]].push(t(a)))
      : n.push(t(a));
  return { formErrors: n, fieldErrors: r };
}
function Qp(e, t = (r) => r.message) {
  const r = { _errors: [] },
    n = (a) => {
      for (const i of a.issues)
        if (i.code === 'invalid_union' && i.errors.length) i.errors.map((o) => n({ issues: o }));
        else if (i.code === 'invalid_key') n({ issues: i.issues });
        else if (i.code === 'invalid_element') n({ issues: i.issues });
        else if (i.path.length === 0) r._errors.push(t(i));
        else {
          let o = r,
            l = 0;
          for (; l < i.path.length; ) {
            const c = i.path[l];
            (l === i.path.length - 1
              ? ((o[c] = o[c] || { _errors: [] }), o[c]._errors.push(t(i)))
              : (o[c] = o[c] || { _errors: [] }),
              (o = o[c]),
              l++);
          }
        }
    };
  return (n(e), r);
}
const qa = (e) => (t, r, n, a) => {
    const i = n ? Object.assign(n, { async: !1 }) : { async: !1 },
      o = t._zod.run({ value: r, issues: [] }, i);
    if (o instanceof Promise) throw new $s();
    if (o.issues.length) {
      const l = new ((a == null ? void 0 : a.Err) ?? e)(o.issues.map((c) => Ts(c, i, Es())));
      throw (kc(l, a == null ? void 0 : a.callee), l);
    }
    return o.value;
  },
  Ka = (e) => async (t, r, n, a) => {
    const i = n ? Object.assign(n, { async: !0 }) : { async: !0 };
    let o = t._zod.run({ value: r, issues: [] }, i);
    if ((o instanceof Promise && (o = await o), o.issues.length)) {
      const l = new ((a == null ? void 0 : a.Err) ?? e)(o.issues.map((c) => Ts(c, i, Es())));
      throw (kc(l, a == null ? void 0 : a.callee), l);
    }
    return o.value;
  },
  Tn = (e) => (t, r, n) => {
    const a = n ? { ...n, async: !1 } : { async: !1 },
      i = t._zod.run({ value: r, issues: [] }, a);
    if (i instanceof Promise) throw new $s();
    return i.issues.length
      ? {
          success: !1,
          error: new (e ?? Ic)(i.issues.map((o) => Ts(o, a, Es()))),
        }
      : { success: !0, data: i.value };
  },
  Jp = Tn(Cc),
  In = (e) => async (t, r, n) => {
    const a = n ? Object.assign(n, { async: !0 }) : { async: !0 };
    let i = t._zod.run({ value: r, issues: [] }, a);
    return (
      i instanceof Promise && (i = await i),
      i.issues.length
        ? { success: !1, error: new e(i.issues.map((o) => Ts(o, a, Es()))) }
        : { success: !0, data: i.value }
    );
  },
  Xp = In(Cc),
  ex = (e) => (t, r, n) => {
    const a = n ? Object.assign(n, { direction: 'backward' }) : { direction: 'backward' };
    return qa(e)(t, r, a);
  },
  tx = (e) => (t, r, n) => qa(e)(t, r, n),
  sx = (e) => async (t, r, n) => {
    const a = n ? Object.assign(n, { direction: 'backward' }) : { direction: 'backward' };
    return Ka(e)(t, r, a);
  },
  rx = (e) => async (t, r, n) => Ka(e)(t, r, n),
  nx = (e) => (t, r, n) => {
    const a = n ? Object.assign(n, { direction: 'backward' }) : { direction: 'backward' };
    return Tn(e)(t, r, a);
  },
  ax = (e) => (t, r, n) => Tn(e)(t, r, n),
  ix = (e) => async (t, r, n) => {
    const a = n ? Object.assign(n, { direction: 'backward' }) : { direction: 'backward' };
    return In(e)(t, r, a);
  },
  ox = (e) => async (t, r, n) => In(e)(t, r, n),
  lx = /^[cC][^\s-]{8,}$/,
  cx = /^[0-9a-z]+$/,
  dx = /^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,
  ux = /^[0-9a-vA-V]{20}$/,
  mx = /^[A-Za-z0-9]{27}$/,
  hx = /^[a-zA-Z0-9_-]{21}$/,
  fx =
    /^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/,
  px = /^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,
  ao = (e) =>
    e
      ? new RegExp(
          `^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${e}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`
        )
      : /^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/,
  xx =
    /^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/,
  gx = '^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$';
function bx() {
  return new RegExp(gx, 'u');
}
const yx =
    /^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,
  vx =
    /^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:))$/,
  jx =
    /^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,
  wx =
    /^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,
  Nx = /^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,
  Ac = /^[A-Za-z0-9_-]*$/,
  _x = /^\+(?:[0-9]){6,14}[0-9]$/,
  Lc =
    '(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))',
  kx = new RegExp(`^${Lc}$`);
function Oc(e) {
  const t = '(?:[01]\\d|2[0-3]):[0-5]\\d';
  return typeof e.precision == 'number'
    ? e.precision === -1
      ? `${t}`
      : e.precision === 0
        ? `${t}:[0-5]\\d`
        : `${t}:[0-5]\\d\\.\\d{${e.precision}}`
    : `${t}(?::[0-5]\\d(?:\\.\\d+)?)?`;
}
function Sx(e) {
  return new RegExp(`^${Oc(e)}$`);
}
function Ex(e) {
  const t = Oc({ precision: e.precision }),
    r = ['Z'];
  (e.local && r.push(''), e.offset && r.push('([+-](?:[01]\\d|2[0-3]):[0-5]\\d)'));
  const n = `${t}(?:${r.join('|')})`;
  return new RegExp(`^${Lc}T(?:${n})$`);
}
const Tx = (e) => {
    const t = e
      ? `[\\s\\S]{${(e == null ? void 0 : e.minimum) ?? 0},${(e == null ? void 0 : e.maximum) ?? ''}}`
      : '[\\s\\S]*';
    return new RegExp(`^${t}$`);
  },
  Ix = /^-?\d+$/,
  Cx = /^-?\d+(?:\.\d+)?/,
  Ax = /^null$/i,
  Lx = /^[^A-Z]*$/,
  Ox = /^[^a-z]*$/,
  at = L('$ZodCheck', (e, t) => {
    var r;
    (e._zod ?? (e._zod = {}), (e._zod.def = t), (r = e._zod).onattach ?? (r.onattach = []));
  }),
  Rc = { number: 'number', bigint: 'bigint', object: 'date' },
  Mc = L('$ZodCheckLessThan', (e, t) => {
    at.init(e, t);
    const r = Rc[typeof t.value];
    (e._zod.onattach.push((n) => {
      const a = n._zod.bag,
        i = (t.inclusive ? a.maximum : a.exclusiveMaximum) ?? Number.POSITIVE_INFINITY;
      t.value < i && (t.inclusive ? (a.maximum = t.value) : (a.exclusiveMaximum = t.value));
    }),
      (e._zod.check = (n) => {
        (t.inclusive ? n.value <= t.value : n.value < t.value) ||
          n.issues.push({
            origin: r,
            code: 'too_big',
            maximum: t.value,
            input: n.value,
            inclusive: t.inclusive,
            inst: e,
            continue: !t.abort,
          });
      }));
  }),
  Pc = L('$ZodCheckGreaterThan', (e, t) => {
    at.init(e, t);
    const r = Rc[typeof t.value];
    (e._zod.onattach.push((n) => {
      const a = n._zod.bag,
        i = (t.inclusive ? a.minimum : a.exclusiveMinimum) ?? Number.NEGATIVE_INFINITY;
      t.value > i && (t.inclusive ? (a.minimum = t.value) : (a.exclusiveMinimum = t.value));
    }),
      (e._zod.check = (n) => {
        (t.inclusive ? n.value >= t.value : n.value > t.value) ||
          n.issues.push({
            origin: r,
            code: 'too_small',
            minimum: t.value,
            input: n.value,
            inclusive: t.inclusive,
            inst: e,
            continue: !t.abort,
          });
      }));
  }),
  Rx = L('$ZodCheckMultipleOf', (e, t) => {
    (at.init(e, t),
      e._zod.onattach.push((r) => {
        var n;
        (n = r._zod.bag).multipleOf ?? (n.multipleOf = t.value);
      }),
      (e._zod.check = (r) => {
        if (typeof r.value != typeof t.value)
          throw new Error('Cannot mix number and bigint in multiple_of check.');
        (typeof r.value == 'bigint'
          ? r.value % t.value === BigInt(0)
          : zp(r.value, t.value) === 0) ||
          r.issues.push({
            origin: typeof r.value,
            code: 'not_multiple_of',
            divisor: t.value,
            input: r.value,
            inst: e,
            continue: !t.abort,
          });
      }));
  }),
  Mx = L('$ZodCheckNumberFormat', (e, t) => {
    var o;
    (at.init(e, t), (t.format = t.format || 'float64'));
    const r = (o = t.format) == null ? void 0 : o.includes('int'),
      n = r ? 'int' : 'number',
      [a, i] = Bp[t.format];
    (e._zod.onattach.push((l) => {
      const c = l._zod.bag;
      ((c.format = t.format), (c.minimum = a), (c.maximum = i), r && (c.pattern = Ix));
    }),
      (e._zod.check = (l) => {
        const c = l.value;
        if (r) {
          if (!Number.isInteger(c)) {
            l.issues.push({
              expected: n,
              format: t.format,
              code: 'invalid_type',
              continue: !1,
              input: c,
              inst: e,
            });
            return;
          }
          if (!Number.isSafeInteger(c)) {
            c > 0
              ? l.issues.push({
                  input: c,
                  code: 'too_big',
                  maximum: Number.MAX_SAFE_INTEGER,
                  note: 'Integers must be within the safe integer range.',
                  inst: e,
                  origin: n,
                  continue: !t.abort,
                })
              : l.issues.push({
                  input: c,
                  code: 'too_small',
                  minimum: Number.MIN_SAFE_INTEGER,
                  note: 'Integers must be within the safe integer range.',
                  inst: e,
                  origin: n,
                  continue: !t.abort,
                });
            return;
          }
        }
        (c < a &&
          l.issues.push({
            origin: 'number',
            input: c,
            code: 'too_small',
            minimum: a,
            inclusive: !0,
            inst: e,
            continue: !t.abort,
          }),
          c > i &&
            l.issues.push({
              origin: 'number',
              input: c,
              code: 'too_big',
              maximum: i,
              inst: e,
            }));
      }));
  }),
  Px = L('$ZodCheckMaxLength', (e, t) => {
    var r;
    (at.init(e, t),
      (r = e._zod.def).when ??
        (r.when = (n) => {
          const a = n.value;
          return !Va(a) && a.length !== void 0;
        }),
      e._zod.onattach.push((n) => {
        const a = n._zod.bag.maximum ?? Number.POSITIVE_INFINITY;
        t.maximum < a && (n._zod.bag.maximum = t.maximum);
      }),
      (e._zod.check = (n) => {
        const a = n.value;
        if (a.length <= t.maximum) return;
        const o = Ya(a);
        n.issues.push({
          origin: o,
          code: 'too_big',
          maximum: t.maximum,
          inclusive: !0,
          input: a,
          inst: e,
          continue: !t.abort,
        });
      }));
  }),
  zx = L('$ZodCheckMinLength', (e, t) => {
    var r;
    (at.init(e, t),
      (r = e._zod.def).when ??
        (r.when = (n) => {
          const a = n.value;
          return !Va(a) && a.length !== void 0;
        }),
      e._zod.onattach.push((n) => {
        const a = n._zod.bag.minimum ?? Number.NEGATIVE_INFINITY;
        t.minimum > a && (n._zod.bag.minimum = t.minimum);
      }),
      (e._zod.check = (n) => {
        const a = n.value;
        if (a.length >= t.minimum) return;
        const o = Ya(a);
        n.issues.push({
          origin: o,
          code: 'too_small',
          minimum: t.minimum,
          inclusive: !0,
          input: a,
          inst: e,
          continue: !t.abort,
        });
      }));
  }),
  Dx = L('$ZodCheckLengthEquals', (e, t) => {
    var r;
    (at.init(e, t),
      (r = e._zod.def).when ??
        (r.when = (n) => {
          const a = n.value;
          return !Va(a) && a.length !== void 0;
        }),
      e._zod.onattach.push((n) => {
        const a = n._zod.bag;
        ((a.minimum = t.length), (a.maximum = t.length), (a.length = t.length));
      }),
      (e._zod.check = (n) => {
        const a = n.value,
          i = a.length;
        if (i === t.length) return;
        const o = Ya(a),
          l = i > t.length;
        n.issues.push({
          origin: o,
          ...(l
            ? { code: 'too_big', maximum: t.length }
            : { code: 'too_small', minimum: t.length }),
          inclusive: !0,
          exact: !0,
          input: n.value,
          inst: e,
          continue: !t.abort,
        });
      }));
  }),
  Cn = L('$ZodCheckStringFormat', (e, t) => {
    var r, n;
    (at.init(e, t),
      e._zod.onattach.push((a) => {
        const i = a._zod.bag;
        ((i.format = t.format),
          t.pattern && (i.patterns ?? (i.patterns = new Set()), i.patterns.add(t.pattern)));
      }),
      t.pattern
        ? ((r = e._zod).check ??
          (r.check = (a) => {
            ((t.pattern.lastIndex = 0),
              !t.pattern.test(a.value) &&
                a.issues.push({
                  origin: 'string',
                  code: 'invalid_format',
                  format: t.format,
                  input: a.value,
                  ...(t.pattern ? { pattern: t.pattern.toString() } : {}),
                  inst: e,
                  continue: !t.abort,
                }));
          }))
        : ((n = e._zod).check ?? (n.check = () => {})));
  }),
  Fx = L('$ZodCheckRegex', (e, t) => {
    (Cn.init(e, t),
      (e._zod.check = (r) => {
        ((t.pattern.lastIndex = 0),
          !t.pattern.test(r.value) &&
            r.issues.push({
              origin: 'string',
              code: 'invalid_format',
              format: 'regex',
              input: r.value,
              pattern: t.pattern.toString(),
              inst: e,
              continue: !t.abort,
            }));
      }));
  }),
  $x = L('$ZodCheckLowerCase', (e, t) => {
    (t.pattern ?? (t.pattern = Lx), Cn.init(e, t));
  }),
  Ux = L('$ZodCheckUpperCase', (e, t) => {
    (t.pattern ?? (t.pattern = Ox), Cn.init(e, t));
  }),
  Bx = L('$ZodCheckIncludes', (e, t) => {
    at.init(e, t);
    const r = En(t.includes),
      n = new RegExp(typeof t.position == 'number' ? `^.{${t.position}}${r}` : r);
    ((t.pattern = n),
      e._zod.onattach.push((a) => {
        const i = a._zod.bag;
        (i.patterns ?? (i.patterns = new Set()), i.patterns.add(n));
      }),
      (e._zod.check = (a) => {
        a.value.includes(t.includes, t.position) ||
          a.issues.push({
            origin: 'string',
            code: 'invalid_format',
            format: 'includes',
            includes: t.includes,
            input: a.value,
            inst: e,
            continue: !t.abort,
          });
      }));
  }),
  Gx = L('$ZodCheckStartsWith', (e, t) => {
    at.init(e, t);
    const r = new RegExp(`^${En(t.prefix)}.*`);
    (t.pattern ?? (t.pattern = r),
      e._zod.onattach.push((n) => {
        const a = n._zod.bag;
        (a.patterns ?? (a.patterns = new Set()), a.patterns.add(r));
      }),
      (e._zod.check = (n) => {
        n.value.startsWith(t.prefix) ||
          n.issues.push({
            origin: 'string',
            code: 'invalid_format',
            format: 'starts_with',
            prefix: t.prefix,
            input: n.value,
            inst: e,
            continue: !t.abort,
          });
      }));
  }),
  Hx = L('$ZodCheckEndsWith', (e, t) => {
    at.init(e, t);
    const r = new RegExp(`.*${En(t.suffix)}$`);
    (t.pattern ?? (t.pattern = r),
      e._zod.onattach.push((n) => {
        const a = n._zod.bag;
        (a.patterns ?? (a.patterns = new Set()), a.patterns.add(r));
      }),
      (e._zod.check = (n) => {
        n.value.endsWith(t.suffix) ||
          n.issues.push({
            origin: 'string',
            code: 'invalid_format',
            format: 'ends_with',
            suffix: t.suffix,
            input: n.value,
            inst: e,
            continue: !t.abort,
          });
      }));
  }),
  Wx = L('$ZodCheckOverwrite', (e, t) => {
    (at.init(e, t),
      (e._zod.check = (r) => {
        r.value = t.tx(r.value);
      }));
  });
class Vx {
  constructor(t = []) {
    ((this.content = []), (this.indent = 0), this && (this.args = t));
  }
  indented(t) {
    ((this.indent += 1), t(this), (this.indent -= 1));
  }
  write(t) {
    if (typeof t == 'function') {
      (t(this, { execution: 'sync' }), t(this, { execution: 'async' }));
      return;
    }
    const n = t
        .split(
          `
`
        )
        .filter((o) => o),
      a = Math.min(...n.map((o) => o.length - o.trimStart().length)),
      i = n.map((o) => o.slice(a)).map((o) => ' '.repeat(this.indent * 2) + o);
    for (const o of i) this.content.push(o);
  }
  compile() {
    const t = Function,
      r = this == null ? void 0 : this.args,
      a = [...((this == null ? void 0 : this.content) ?? ['']).map((i) => `  ${i}`)];
    return new t(
      ...r,
      a.join(`
`)
    );
  }
}
const Zx = { major: 4, minor: 2, patch: 1 },
  Ce = L('$ZodType', (e, t) => {
    var a;
    var r;
    (e ?? (e = {}), (e._zod.def = t), (e._zod.bag = e._zod.bag || {}), (e._zod.version = Zx));
    const n = [...(e._zod.def.checks ?? [])];
    e._zod.traits.has('$ZodCheck') && n.unshift(e);
    for (const i of n) for (const o of i._zod.onattach) o(e);
    if (n.length === 0)
      ((r = e._zod).deferred ?? (r.deferred = []),
        (a = e._zod.deferred) == null ||
          a.push(() => {
            e._zod.run = e._zod.parse;
          }));
    else {
      const i = (l, c, d) => {
          let m = Ds(l),
            u;
          for (const x of c) {
            if (x._zod.def.when) {
              if (!x._zod.def.when(l)) continue;
            } else if (m) continue;
            const f = l.issues.length,
              g = x._zod.check(l);
            if (g instanceof Promise && (d == null ? void 0 : d.async) === !1) throw new $s();
            if (u || g instanceof Promise)
              u = (u ?? Promise.resolve()).then(async () => {
                (await g, l.issues.length !== f && (m || (m = Ds(l, f))));
              });
            else {
              if (l.issues.length === f) continue;
              m || (m = Ds(l, f));
            }
          }
          return u ? u.then(() => l) : l;
        },
        o = (l, c, d) => {
          if (Ds(l)) return ((l.aborted = !0), l);
          const m = i(c, n, d);
          if (m instanceof Promise) {
            if (d.async === !1) throw new $s();
            return m.then((u) => e._zod.parse(u, d));
          }
          return e._zod.parse(m, d);
        };
      e._zod.run = (l, c) => {
        if (c.skipChecks) return e._zod.parse(l, c);
        if (c.direction === 'backward') {
          const m = e._zod.parse({ value: l.value, issues: [] }, { ...c, skipChecks: !0 });
          return m instanceof Promise ? m.then((u) => o(u, l, c)) : o(m, l, c);
        }
        const d = e._zod.parse(l, c);
        if (d instanceof Promise) {
          if (c.async === !1) throw new $s();
          return d.then((m) => i(m, n, c));
        }
        return i(d, n, c);
      };
    }
    e['~standard'] = {
      validate: (i) => {
        var o;
        try {
          const l = Jp(e, i);
          return l.success
            ? { value: l.data }
            : { issues: (o = l.error) == null ? void 0 : o.issues };
        } catch {
          return Xp(e, i).then((c) => {
            var d;
            return c.success
              ? { value: c.data }
              : { issues: (d = c.error) == null ? void 0 : d.issues };
          });
        }
      },
      vendor: 'zod',
      version: 1,
    };
  }),
  Qa = L('$ZodString', (e, t) => {
    var r;
    (Ce.init(e, t),
      (e._zod.pattern =
        [...(((r = e == null ? void 0 : e._zod.bag) == null ? void 0 : r.patterns) ?? [])].pop() ??
        Tx(e._zod.bag)),
      (e._zod.parse = (n, a) => {
        if (t.coerce)
          try {
            n.value = String(n.value);
          } catch {}
        return (
          typeof n.value == 'string' ||
            n.issues.push({
              expected: 'string',
              code: 'invalid_type',
              input: n.value,
              inst: e,
            }),
          n
        );
      }));
  }),
  _e = L('$ZodStringFormat', (e, t) => {
    (Cn.init(e, t), Qa.init(e, t));
  }),
  Yx = L('$ZodGUID', (e, t) => {
    (t.pattern ?? (t.pattern = px), _e.init(e, t));
  }),
  qx = L('$ZodUUID', (e, t) => {
    if (t.version) {
      const n = { v1: 1, v2: 2, v3: 3, v4: 4, v5: 5, v6: 6, v7: 7, v8: 8 }[t.version];
      if (n === void 0) throw new Error(`Invalid UUID version: "${t.version}"`);
      t.pattern ?? (t.pattern = ao(n));
    } else t.pattern ?? (t.pattern = ao());
    _e.init(e, t);
  }),
  Kx = L('$ZodEmail', (e, t) => {
    (t.pattern ?? (t.pattern = xx), _e.init(e, t));
  }),
  Qx = L('$ZodURL', (e, t) => {
    (_e.init(e, t),
      (e._zod.check = (r) => {
        try {
          const n = r.value.trim(),
            a = new URL(n);
          (t.hostname &&
            ((t.hostname.lastIndex = 0),
            t.hostname.test(a.hostname) ||
              r.issues.push({
                code: 'invalid_format',
                format: 'url',
                note: 'Invalid hostname',
                pattern: t.hostname.source,
                input: r.value,
                inst: e,
                continue: !t.abort,
              })),
            t.protocol &&
              ((t.protocol.lastIndex = 0),
              t.protocol.test(a.protocol.endsWith(':') ? a.protocol.slice(0, -1) : a.protocol) ||
                r.issues.push({
                  code: 'invalid_format',
                  format: 'url',
                  note: 'Invalid protocol',
                  pattern: t.protocol.source,
                  input: r.value,
                  inst: e,
                  continue: !t.abort,
                })),
            t.normalize ? (r.value = a.href) : (r.value = n));
          return;
        } catch {
          r.issues.push({
            code: 'invalid_format',
            format: 'url',
            input: r.value,
            inst: e,
            continue: !t.abort,
          });
        }
      }));
  }),
  Jx = L('$ZodEmoji', (e, t) => {
    (t.pattern ?? (t.pattern = bx()), _e.init(e, t));
  }),
  Xx = L('$ZodNanoID', (e, t) => {
    (t.pattern ?? (t.pattern = hx), _e.init(e, t));
  }),
  eg = L('$ZodCUID', (e, t) => {
    (t.pattern ?? (t.pattern = lx), _e.init(e, t));
  }),
  tg = L('$ZodCUID2', (e, t) => {
    (t.pattern ?? (t.pattern = cx), _e.init(e, t));
  }),
  sg = L('$ZodULID', (e, t) => {
    (t.pattern ?? (t.pattern = dx), _e.init(e, t));
  }),
  rg = L('$ZodXID', (e, t) => {
    (t.pattern ?? (t.pattern = ux), _e.init(e, t));
  }),
  ng = L('$ZodKSUID', (e, t) => {
    (t.pattern ?? (t.pattern = mx), _e.init(e, t));
  }),
  ag = L('$ZodISODateTime', (e, t) => {
    (t.pattern ?? (t.pattern = Ex(t)), _e.init(e, t));
  }),
  ig = L('$ZodISODate', (e, t) => {
    (t.pattern ?? (t.pattern = kx), _e.init(e, t));
  }),
  og = L('$ZodISOTime', (e, t) => {
    (t.pattern ?? (t.pattern = Sx(t)), _e.init(e, t));
  }),
  lg = L('$ZodISODuration', (e, t) => {
    (t.pattern ?? (t.pattern = fx), _e.init(e, t));
  }),
  cg = L('$ZodIPv4', (e, t) => {
    (t.pattern ?? (t.pattern = yx), _e.init(e, t), (e._zod.bag.format = 'ipv4'));
  }),
  dg = L('$ZodIPv6', (e, t) => {
    (t.pattern ?? (t.pattern = vx),
      _e.init(e, t),
      (e._zod.bag.format = 'ipv6'),
      (e._zod.check = (r) => {
        try {
          new URL(`http://[${r.value}]`);
        } catch {
          r.issues.push({
            code: 'invalid_format',
            format: 'ipv6',
            input: r.value,
            inst: e,
            continue: !t.abort,
          });
        }
      }));
  }),
  ug = L('$ZodCIDRv4', (e, t) => {
    (t.pattern ?? (t.pattern = jx), _e.init(e, t));
  }),
  mg = L('$ZodCIDRv6', (e, t) => {
    (t.pattern ?? (t.pattern = wx),
      _e.init(e, t),
      (e._zod.check = (r) => {
        const n = r.value.split('/');
        try {
          if (n.length !== 2) throw new Error();
          const [a, i] = n;
          if (!i) throw new Error();
          const o = Number(i);
          if (`${o}` !== i) throw new Error();
          if (o < 0 || o > 128) throw new Error();
          new URL(`http://[${a}]`);
        } catch {
          r.issues.push({
            code: 'invalid_format',
            format: 'cidrv6',
            input: r.value,
            inst: e,
            continue: !t.abort,
          });
        }
      }));
  });
function zc(e) {
  if (e === '') return !0;
  if (e.length % 4 !== 0) return !1;
  try {
    return (atob(e), !0);
  } catch {
    return !1;
  }
}
const hg = L('$ZodBase64', (e, t) => {
  (t.pattern ?? (t.pattern = Nx),
    _e.init(e, t),
    (e._zod.bag.contentEncoding = 'base64'),
    (e._zod.check = (r) => {
      zc(r.value) ||
        r.issues.push({
          code: 'invalid_format',
          format: 'base64',
          input: r.value,
          inst: e,
          continue: !t.abort,
        });
    }));
});
function fg(e) {
  if (!Ac.test(e)) return !1;
  const t = e.replace(/[-_]/g, (n) => (n === '-' ? '+' : '/')),
    r = t.padEnd(Math.ceil(t.length / 4) * 4, '=');
  return zc(r);
}
const pg = L('$ZodBase64URL', (e, t) => {
    (t.pattern ?? (t.pattern = Ac),
      _e.init(e, t),
      (e._zod.bag.contentEncoding = 'base64url'),
      (e._zod.check = (r) => {
        fg(r.value) ||
          r.issues.push({
            code: 'invalid_format',
            format: 'base64url',
            input: r.value,
            inst: e,
            continue: !t.abort,
          });
      }));
  }),
  xg = L('$ZodE164', (e, t) => {
    (t.pattern ?? (t.pattern = _x), _e.init(e, t));
  });
function gg(e, t = null) {
  try {
    const r = e.split('.');
    if (r.length !== 3) return !1;
    const [n] = r;
    if (!n) return !1;
    const a = JSON.parse(atob(n));
    return !(
      ('typ' in a && (a == null ? void 0 : a.typ) !== 'JWT') ||
      !a.alg ||
      (t && (!('alg' in a) || a.alg !== t))
    );
  } catch {
    return !1;
  }
}
const bg = L('$ZodJWT', (e, t) => {
    (_e.init(e, t),
      (e._zod.check = (r) => {
        gg(r.value, t.alg) ||
          r.issues.push({
            code: 'invalid_format',
            format: 'jwt',
            input: r.value,
            inst: e,
            continue: !t.abort,
          });
      }));
  }),
  Dc = L('$ZodNumber', (e, t) => {
    (Ce.init(e, t),
      (e._zod.pattern = e._zod.bag.pattern ?? Cx),
      (e._zod.parse = (r, n) => {
        if (t.coerce)
          try {
            r.value = Number(r.value);
          } catch {}
        const a = r.value;
        if (typeof a == 'number' && !Number.isNaN(a) && Number.isFinite(a)) return r;
        const i =
          typeof a == 'number'
            ? Number.isNaN(a)
              ? 'NaN'
              : Number.isFinite(a)
                ? void 0
                : 'Infinity'
            : void 0;
        return (
          r.issues.push({
            expected: 'number',
            code: 'invalid_type',
            input: a,
            inst: e,
            ...(i ? { received: i } : {}),
          }),
          r
        );
      }));
  }),
  yg = L('$ZodNumberFormat', (e, t) => {
    (Mx.init(e, t), Dc.init(e, t));
  }),
  vg = L('$ZodNull', (e, t) => {
    (Ce.init(e, t),
      (e._zod.pattern = Ax),
      (e._zod.values = new Set([null])),
      (e._zod.parse = (r, n) => {
        const a = r.value;
        return (
          a === null ||
            r.issues.push({
              expected: 'null',
              code: 'invalid_type',
              input: a,
              inst: e,
            }),
          r
        );
      }));
  }),
  jg = L('$ZodUnknown', (e, t) => {
    (Ce.init(e, t), (e._zod.parse = (r) => r));
  }),
  wg = L('$ZodNever', (e, t) => {
    (Ce.init(e, t),
      (e._zod.parse = (r, n) => (
        r.issues.push({
          expected: 'never',
          code: 'invalid_type',
          input: r.value,
          inst: e,
        }),
        r
      )));
  });
function io(e, t, r) {
  (e.issues.length && t.issues.push(...Ec(r, e.issues)), (t.value[r] = e.value));
}
const Ng = L('$ZodArray', (e, t) => {
  (Ce.init(e, t),
    (e._zod.parse = (r, n) => {
      const a = r.value;
      if (!Array.isArray(a))
        return (
          r.issues.push({
            expected: 'array',
            code: 'invalid_type',
            input: a,
            inst: e,
          }),
          r
        );
      r.value = Array(a.length);
      const i = [];
      for (let o = 0; o < a.length; o++) {
        const l = a[o],
          c = t.element._zod.run({ value: l, issues: [] }, n);
        c instanceof Promise ? i.push(c.then((d) => io(d, r, o))) : io(c, r, o);
      }
      return i.length ? Promise.all(i).then(() => r) : r;
    }));
});
function mn(e, t, r, n) {
  (e.issues.length && t.issues.push(...Ec(r, e.issues)),
    e.value === void 0 ? r in n && (t.value[r] = void 0) : (t.value[r] = e.value));
}
function Fc(e) {
  var n, a, i, o;
  const t = Object.keys(e.shape);
  for (const l of t)
    if (
      !(
        (o =
          (i = (a = (n = e.shape) == null ? void 0 : n[l]) == null ? void 0 : a._zod) == null
            ? void 0
            : i.traits) != null && o.has('$ZodType')
      )
    )
      throw new Error(`Invalid element at key "${l}": expected a Zod schema`);
  const r = Up(e.shape);
  return {
    ...e,
    keys: t,
    keySet: new Set(t),
    numKeys: t.length,
    optionalKeys: new Set(r),
  };
}
function $c(e, t, r, n, a, i) {
  const o = [],
    l = a.keySet,
    c = a.catchall._zod,
    d = c.def.type;
  for (const m in t) {
    if (l.has(m)) continue;
    if (d === 'never') {
      o.push(m);
      continue;
    }
    const u = c.run({ value: t[m], issues: [] }, n);
    u instanceof Promise ? e.push(u.then((x) => mn(x, r, m, t))) : mn(u, r, m, t);
  }
  return (
    o.length && r.issues.push({ code: 'unrecognized_keys', keys: o, input: t, inst: i }),
    e.length ? Promise.all(e).then(() => r) : r
  );
}
const _g = L('$ZodObject', (e, t) => {
    Ce.init(e, t);
    const r = Object.getOwnPropertyDescriptor(t, 'shape');
    if (!(r != null && r.get)) {
      const l = t.shape;
      Object.defineProperty(t, 'shape', {
        get: () => {
          const c = { ...l };
          return (Object.defineProperty(t, 'shape', { value: c }), c);
        },
      });
    }
    const n = Wa(() => Fc(t));
    we(e._zod, 'propValues', () => {
      const l = t.shape,
        c = {};
      for (const d in l) {
        const m = l[d]._zod;
        if (m.values) {
          c[d] ?? (c[d] = new Set());
          for (const u of m.values) c[d].add(u);
        }
      }
      return c;
    });
    const a = un,
      i = t.catchall;
    let o;
    e._zod.parse = (l, c) => {
      o ?? (o = n.value);
      const d = l.value;
      if (!a(d))
        return (
          l.issues.push({
            expected: 'object',
            code: 'invalid_type',
            input: d,
            inst: e,
          }),
          l
        );
      l.value = {};
      const m = [],
        u = o.shape;
      for (const x of o.keys) {
        const g = u[x]._zod.run({ value: d[x], issues: [] }, c);
        g instanceof Promise ? m.push(g.then((b) => mn(b, l, x, d))) : mn(g, l, x, d);
      }
      return i ? $c(m, d, l, c, n.value, e) : m.length ? Promise.all(m).then(() => l) : l;
    };
  }),
  kg = L('$ZodObjectJIT', (e, t) => {
    _g.init(e, t);
    const r = e._zod.parse,
      n = Wa(() => Fc(t)),
      a = (x) => {
        const f = new Vx(['shape', 'payload', 'ctx']),
          g = n.value,
          b = (S) => {
            const N = no(S);
            return `shape[${N}]._zod.run({ value: input[${N}], issues: [] }, ctx)`;
          };
        f.write('const input = payload.value;');
        const y = Object.create(null);
        let p = 0;
        for (const S of g.keys) y[S] = `key_${p++}`;
        f.write('const newResult = {};');
        for (const S of g.keys) {
          const N = y[S],
            k = no(S);
          (f.write(`const ${N} = ${b(S)};`),
            f.write(`
        if (${N}.issues.length) {
          payload.issues = payload.issues.concat(${N}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${k}, ...iss.path] : [${k}]
          })));
        }
        
        
        if (${N}.value === undefined) {
          if (${k} in input) {
            newResult[${k}] = undefined;
          }
        } else {
          newResult[${k}] = ${N}.value;
        }
        
      `));
        }
        (f.write('payload.value = newResult;'), f.write('return payload;'));
        const E = f.compile();
        return (S, N) => E(x, S, N);
      };
    let i;
    const o = un,
      l = !Nc.jitless,
      d = l && Fp.value,
      m = t.catchall;
    let u;
    e._zod.parse = (x, f) => {
      u ?? (u = n.value);
      const g = x.value;
      return o(g)
        ? l && d && (f == null ? void 0 : f.async) === !1 && f.jitless !== !0
          ? (i || (i = a(t.shape)), (x = i(x, f)), m ? $c([], g, x, f, u, e) : x)
          : r(x, f)
        : (x.issues.push({
            expected: 'object',
            code: 'invalid_type',
            input: g,
            inst: e,
          }),
          x);
    };
  });
function oo(e, t, r, n) {
  for (const i of e) if (i.issues.length === 0) return ((t.value = i.value), t);
  const a = e.filter((i) => !Ds(i));
  return a.length === 1
    ? ((t.value = a[0].value), a[0])
    : (t.issues.push({
        code: 'invalid_union',
        input: t.value,
        inst: r,
        errors: e.map((i) => i.issues.map((o) => Ts(o, n, Es()))),
      }),
      t);
}
const Sg = L('$ZodUnion', (e, t) => {
    (Ce.init(e, t),
      we(e._zod, 'optin', () =>
        t.options.some((a) => a._zod.optin === 'optional') ? 'optional' : void 0
      ),
      we(e._zod, 'optout', () =>
        t.options.some((a) => a._zod.optout === 'optional') ? 'optional' : void 0
      ),
      we(e._zod, 'values', () => {
        if (t.options.every((a) => a._zod.values))
          return new Set(t.options.flatMap((a) => Array.from(a._zod.values)));
      }),
      we(e._zod, 'pattern', () => {
        if (t.options.every((a) => a._zod.pattern)) {
          const a = t.options.map((i) => i._zod.pattern);
          return new RegExp(`^(${a.map((i) => Za(i.source)).join('|')})$`);
        }
      }));
    const r = t.options.length === 1,
      n = t.options[0]._zod.run;
    e._zod.parse = (a, i) => {
      if (r) return n(a, i);
      let o = !1;
      const l = [];
      for (const c of t.options) {
        const d = c._zod.run({ value: a.value, issues: [] }, i);
        if (d instanceof Promise) (l.push(d), (o = !0));
        else {
          if (d.issues.length === 0) return d;
          l.push(d);
        }
      }
      return o ? Promise.all(l).then((c) => oo(c, a, e, i)) : oo(l, a, e, i);
    };
  }),
  Eg = L('$ZodIntersection', (e, t) => {
    (Ce.init(e, t),
      (e._zod.parse = (r, n) => {
        const a = r.value,
          i = t.left._zod.run({ value: a, issues: [] }, n),
          o = t.right._zod.run({ value: a, issues: [] }, n);
        return i instanceof Promise || o instanceof Promise
          ? Promise.all([i, o]).then(([c, d]) => lo(r, c, d))
          : lo(r, i, o);
      }));
  });
function Na(e, t) {
  if (e === t) return { valid: !0, data: e };
  if (e instanceof Date && t instanceof Date && +e == +t) return { valid: !0, data: e };
  if (br(e) && br(t)) {
    const r = Object.keys(t),
      n = Object.keys(e).filter((i) => r.indexOf(i) !== -1),
      a = { ...e, ...t };
    for (const i of n) {
      const o = Na(e[i], t[i]);
      if (!o.valid) return { valid: !1, mergeErrorPath: [i, ...o.mergeErrorPath] };
      a[i] = o.data;
    }
    return { valid: !0, data: a };
  }
  if (Array.isArray(e) && Array.isArray(t)) {
    if (e.length !== t.length) return { valid: !1, mergeErrorPath: [] };
    const r = [];
    for (let n = 0; n < e.length; n++) {
      const a = e[n],
        i = t[n],
        o = Na(a, i);
      if (!o.valid) return { valid: !1, mergeErrorPath: [n, ...o.mergeErrorPath] };
      r.push(o.data);
    }
    return { valid: !0, data: r };
  }
  return { valid: !1, mergeErrorPath: [] };
}
function lo(e, t, r) {
  if (
    (t.issues.length && e.issues.push(...t.issues),
    r.issues.length && e.issues.push(...r.issues),
    Ds(e))
  )
    return e;
  const n = Na(t.value, r.value);
  if (!n.valid)
    throw new Error(`Unmergable intersection. Error path: ${JSON.stringify(n.mergeErrorPath)}`);
  return ((e.value = n.data), e);
}
const Tg = L('$ZodEnum', (e, t) => {
    Ce.init(e, t);
    const r = _c(t.entries),
      n = new Set(r);
    ((e._zod.values = n),
      (e._zod.pattern = new RegExp(
        `^(${r
          .filter((a) => $p.has(typeof a))
          .map((a) => (typeof a == 'string' ? En(a) : a.toString()))
          .join('|')})$`
      )),
      (e._zod.parse = (a, i) => {
        const o = a.value;
        return (
          n.has(o) ||
            a.issues.push({
              code: 'invalid_value',
              values: r,
              input: o,
              inst: e,
            }),
          a
        );
      }));
  }),
  Ig = L('$ZodTransform', (e, t) => {
    (Ce.init(e, t),
      (e._zod.parse = (r, n) => {
        if (n.direction === 'backward') throw new wc(e.constructor.name);
        const a = t.transform(r.value, r);
        if (n.async)
          return (a instanceof Promise ? a : Promise.resolve(a)).then((o) => ((r.value = o), r));
        if (a instanceof Promise) throw new $s();
        return ((r.value = a), r);
      }));
  });
function co(e, t) {
  return e.issues.length && t === void 0 ? { issues: [], value: void 0 } : e;
}
const Cg = L('$ZodOptional', (e, t) => {
    (Ce.init(e, t),
      (e._zod.optin = 'optional'),
      (e._zod.optout = 'optional'),
      we(e._zod, 'values', () =>
        t.innerType._zod.values ? new Set([...t.innerType._zod.values, void 0]) : void 0
      ),
      we(e._zod, 'pattern', () => {
        const r = t.innerType._zod.pattern;
        return r ? new RegExp(`^(${Za(r.source)})?$`) : void 0;
      }),
      (e._zod.parse = (r, n) => {
        if (t.innerType._zod.optin === 'optional') {
          const a = t.innerType._zod.run(r, n);
          return a instanceof Promise ? a.then((i) => co(i, r.value)) : co(a, r.value);
        }
        return r.value === void 0 ? r : t.innerType._zod.run(r, n);
      }));
  }),
  Ag = L('$ZodNullable', (e, t) => {
    (Ce.init(e, t),
      we(e._zod, 'optin', () => t.innerType._zod.optin),
      we(e._zod, 'optout', () => t.innerType._zod.optout),
      we(e._zod, 'pattern', () => {
        const r = t.innerType._zod.pattern;
        return r ? new RegExp(`^(${Za(r.source)}|null)$`) : void 0;
      }),
      we(e._zod, 'values', () =>
        t.innerType._zod.values ? new Set([...t.innerType._zod.values, null]) : void 0
      ),
      (e._zod.parse = (r, n) => (r.value === null ? r : t.innerType._zod.run(r, n))));
  }),
  Lg = L('$ZodDefault', (e, t) => {
    (Ce.init(e, t),
      (e._zod.optin = 'optional'),
      we(e._zod, 'values', () => t.innerType._zod.values),
      (e._zod.parse = (r, n) => {
        if (n.direction === 'backward') return t.innerType._zod.run(r, n);
        if (r.value === void 0) return ((r.value = t.defaultValue), r);
        const a = t.innerType._zod.run(r, n);
        return a instanceof Promise ? a.then((i) => uo(i, t)) : uo(a, t);
      }));
  });
function uo(e, t) {
  return (e.value === void 0 && (e.value = t.defaultValue), e);
}
const Og = L('$ZodPrefault', (e, t) => {
    (Ce.init(e, t),
      (e._zod.optin = 'optional'),
      we(e._zod, 'values', () => t.innerType._zod.values),
      (e._zod.parse = (r, n) => (
        n.direction === 'backward' || (r.value === void 0 && (r.value = t.defaultValue)),
        t.innerType._zod.run(r, n)
      )));
  }),
  Rg = L('$ZodNonOptional', (e, t) => {
    (Ce.init(e, t),
      we(e._zod, 'values', () => {
        const r = t.innerType._zod.values;
        return r ? new Set([...r].filter((n) => n !== void 0)) : void 0;
      }),
      (e._zod.parse = (r, n) => {
        const a = t.innerType._zod.run(r, n);
        return a instanceof Promise ? a.then((i) => mo(i, e)) : mo(a, e);
      }));
  });
function mo(e, t) {
  return (
    !e.issues.length &&
      e.value === void 0 &&
      e.issues.push({
        code: 'invalid_type',
        expected: 'nonoptional',
        input: e.value,
        inst: t,
      }),
    e
  );
}
const Mg = L('$ZodCatch', (e, t) => {
    (Ce.init(e, t),
      we(e._zod, 'optin', () => t.innerType._zod.optin),
      we(e._zod, 'optout', () => t.innerType._zod.optout),
      we(e._zod, 'values', () => t.innerType._zod.values),
      (e._zod.parse = (r, n) => {
        if (n.direction === 'backward') return t.innerType._zod.run(r, n);
        const a = t.innerType._zod.run(r, n);
        return a instanceof Promise
          ? a.then(
              (i) => (
                (r.value = i.value),
                i.issues.length &&
                  ((r.value = t.catchValue({
                    ...r,
                    error: { issues: i.issues.map((o) => Ts(o, n, Es())) },
                    input: r.value,
                  })),
                  (r.issues = [])),
                r
              )
            )
          : ((r.value = a.value),
            a.issues.length &&
              ((r.value = t.catchValue({
                ...r,
                error: { issues: a.issues.map((i) => Ts(i, n, Es())) },
                input: r.value,
              })),
              (r.issues = [])),
            r);
      }));
  }),
  Pg = L('$ZodPipe', (e, t) => {
    (Ce.init(e, t),
      we(e._zod, 'values', () => t.in._zod.values),
      we(e._zod, 'optin', () => t.in._zod.optin),
      we(e._zod, 'optout', () => t.out._zod.optout),
      we(e._zod, 'propValues', () => t.in._zod.propValues),
      (e._zod.parse = (r, n) => {
        if (n.direction === 'backward') {
          const i = t.out._zod.run(r, n);
          return i instanceof Promise ? i.then((o) => Wr(o, t.in, n)) : Wr(i, t.in, n);
        }
        const a = t.in._zod.run(r, n);
        return a instanceof Promise ? a.then((i) => Wr(i, t.out, n)) : Wr(a, t.out, n);
      }));
  });
function Wr(e, t, r) {
  return e.issues.length
    ? ((e.aborted = !0), e)
    : t._zod.run({ value: e.value, issues: e.issues }, r);
}
const zg = L('$ZodReadonly', (e, t) => {
  (Ce.init(e, t),
    we(e._zod, 'propValues', () => t.innerType._zod.propValues),
    we(e._zod, 'values', () => t.innerType._zod.values),
    we(e._zod, 'optin', () => {
      var r, n;
      return (n = (r = t.innerType) == null ? void 0 : r._zod) == null ? void 0 : n.optin;
    }),
    we(e._zod, 'optout', () => {
      var r, n;
      return (n = (r = t.innerType) == null ? void 0 : r._zod) == null ? void 0 : n.optout;
    }),
    (e._zod.parse = (r, n) => {
      if (n.direction === 'backward') return t.innerType._zod.run(r, n);
      const a = t.innerType._zod.run(r, n);
      return a instanceof Promise ? a.then(ho) : ho(a);
    }));
});
function ho(e) {
  return ((e.value = Object.freeze(e.value)), e);
}
const Dg = L('$ZodCustom', (e, t) => {
  (at.init(e, t),
    Ce.init(e, t),
    (e._zod.parse = (r, n) => r),
    (e._zod.check = (r) => {
      const n = r.value,
        a = t.fn(n);
      if (a instanceof Promise) return a.then((i) => fo(i, r, n, e));
      fo(a, r, n, e);
    }));
});
function fo(e, t, r, n) {
  if (!e) {
    const a = {
      code: 'custom',
      input: r,
      inst: n,
      path: [...(n._zod.def.path ?? [])],
      continue: !n._zod.def.abort,
    };
    (n._zod.def.params && (a.params = n._zod.def.params), t.issues.push(yr(a)));
  }
}
var po;
class Fg {
  constructor() {
    ((this._map = new WeakMap()), (this._idmap = new Map()));
  }
  add(t, ...r) {
    const n = r[0];
    if ((this._map.set(t, n), n && typeof n == 'object' && 'id' in n)) {
      if (this._idmap.has(n.id)) throw new Error(`ID ${n.id} already exists in the registry`);
      this._idmap.set(n.id, t);
    }
    return this;
  }
  clear() {
    return ((this._map = new WeakMap()), (this._idmap = new Map()), this);
  }
  remove(t) {
    const r = this._map.get(t);
    return (
      r && typeof r == 'object' && 'id' in r && this._idmap.delete(r.id),
      this._map.delete(t),
      this
    );
  }
  get(t) {
    const r = t._zod.parent;
    if (r) {
      const n = { ...(this.get(r) ?? {}) };
      delete n.id;
      const a = { ...n, ...this._map.get(t) };
      return Object.keys(a).length ? a : void 0;
    }
    return this._map.get(t);
  }
  has(t) {
    return this._map.has(t);
  }
}
function $g() {
  return new Fg();
}
(po = globalThis).__zod_globalRegistry ?? (po.__zod_globalRegistry = $g());
const ur = globalThis.__zod_globalRegistry;
function Ug(e, t) {
  return new e({ type: 'string', ...ne(t) });
}
function Bg(e, t) {
  return new e({
    type: 'string',
    format: 'email',
    check: 'string_format',
    abort: !1,
    ...ne(t),
  });
}
function xo(e, t) {
  return new e({
    type: 'string',
    format: 'guid',
    check: 'string_format',
    abort: !1,
    ...ne(t),
  });
}
function Gg(e, t) {
  return new e({
    type: 'string',
    format: 'uuid',
    check: 'string_format',
    abort: !1,
    ...ne(t),
  });
}
function Hg(e, t) {
  return new e({
    type: 'string',
    format: 'uuid',
    check: 'string_format',
    abort: !1,
    version: 'v4',
    ...ne(t),
  });
}
function Wg(e, t) {
  return new e({
    type: 'string',
    format: 'uuid',
    check: 'string_format',
    abort: !1,
    version: 'v6',
    ...ne(t),
  });
}
function Vg(e, t) {
  return new e({
    type: 'string',
    format: 'uuid',
    check: 'string_format',
    abort: !1,
    version: 'v7',
    ...ne(t),
  });
}
function Zg(e, t) {
  return new e({
    type: 'string',
    format: 'url',
    check: 'string_format',
    abort: !1,
    ...ne(t),
  });
}
function Yg(e, t) {
  return new e({
    type: 'string',
    format: 'emoji',
    check: 'string_format',
    abort: !1,
    ...ne(t),
  });
}
function qg(e, t) {
  return new e({
    type: 'string',
    format: 'nanoid',
    check: 'string_format',
    abort: !1,
    ...ne(t),
  });
}
function Kg(e, t) {
  return new e({
    type: 'string',
    format: 'cuid',
    check: 'string_format',
    abort: !1,
    ...ne(t),
  });
}
function Qg(e, t) {
  return new e({
    type: 'string',
    format: 'cuid2',
    check: 'string_format',
    abort: !1,
    ...ne(t),
  });
}
function Jg(e, t) {
  return new e({
    type: 'string',
    format: 'ulid',
    check: 'string_format',
    abort: !1,
    ...ne(t),
  });
}
function Xg(e, t) {
  return new e({
    type: 'string',
    format: 'xid',
    check: 'string_format',
    abort: !1,
    ...ne(t),
  });
}
function e0(e, t) {
  return new e({
    type: 'string',
    format: 'ksuid',
    check: 'string_format',
    abort: !1,
    ...ne(t),
  });
}
function t0(e, t) {
  return new e({
    type: 'string',
    format: 'ipv4',
    check: 'string_format',
    abort: !1,
    ...ne(t),
  });
}
function s0(e, t) {
  return new e({
    type: 'string',
    format: 'ipv6',
    check: 'string_format',
    abort: !1,
    ...ne(t),
  });
}
function r0(e, t) {
  return new e({
    type: 'string',
    format: 'cidrv4',
    check: 'string_format',
    abort: !1,
    ...ne(t),
  });
}
function n0(e, t) {
  return new e({
    type: 'string',
    format: 'cidrv6',
    check: 'string_format',
    abort: !1,
    ...ne(t),
  });
}
function a0(e, t) {
  return new e({
    type: 'string',
    format: 'base64',
    check: 'string_format',
    abort: !1,
    ...ne(t),
  });
}
function i0(e, t) {
  return new e({
    type: 'string',
    format: 'base64url',
    check: 'string_format',
    abort: !1,
    ...ne(t),
  });
}
function o0(e, t) {
  return new e({
    type: 'string',
    format: 'e164',
    check: 'string_format',
    abort: !1,
    ...ne(t),
  });
}
function l0(e, t) {
  return new e({
    type: 'string',
    format: 'jwt',
    check: 'string_format',
    abort: !1,
    ...ne(t),
  });
}
function c0(e, t) {
  return new e({
    type: 'string',
    format: 'datetime',
    check: 'string_format',
    offset: !1,
    local: !1,
    precision: null,
    ...ne(t),
  });
}
function d0(e, t) {
  return new e({
    type: 'string',
    format: 'date',
    check: 'string_format',
    ...ne(t),
  });
}
function u0(e, t) {
  return new e({
    type: 'string',
    format: 'time',
    check: 'string_format',
    precision: null,
    ...ne(t),
  });
}
function m0(e, t) {
  return new e({
    type: 'string',
    format: 'duration',
    check: 'string_format',
    ...ne(t),
  });
}
function h0(e, t) {
  return new e({ type: 'number', checks: [], ...ne(t) });
}
function f0(e, t) {
  return new e({
    type: 'number',
    check: 'number_format',
    abort: !1,
    format: 'safeint',
    ...ne(t),
  });
}
function p0(e, t) {
  return new e({ type: 'null', ...ne(t) });
}
function x0(e) {
  return new e({ type: 'unknown' });
}
function g0(e, t) {
  return new e({ type: 'never', ...ne(t) });
}
function go(e, t) {
  return new Mc({ check: 'less_than', ...ne(t), value: e, inclusive: !1 });
}
function Un(e, t) {
  return new Mc({ check: 'less_than', ...ne(t), value: e, inclusive: !0 });
}
function bo(e, t) {
  return new Pc({ check: 'greater_than', ...ne(t), value: e, inclusive: !1 });
}
function Bn(e, t) {
  return new Pc({ check: 'greater_than', ...ne(t), value: e, inclusive: !0 });
}
function yo(e, t) {
  return new Rx({ check: 'multiple_of', ...ne(t), value: e });
}
function Uc(e, t) {
  return new Px({ check: 'max_length', ...ne(t), maximum: e });
}
function hn(e, t) {
  return new zx({ check: 'min_length', ...ne(t), minimum: e });
}
function Bc(e, t) {
  return new Dx({ check: 'length_equals', ...ne(t), length: e });
}
function b0(e, t) {
  return new Fx({
    check: 'string_format',
    format: 'regex',
    ...ne(t),
    pattern: e,
  });
}
function y0(e) {
  return new $x({ check: 'string_format', format: 'lowercase', ...ne(e) });
}
function v0(e) {
  return new Ux({ check: 'string_format', format: 'uppercase', ...ne(e) });
}
function j0(e, t) {
  return new Bx({
    check: 'string_format',
    format: 'includes',
    ...ne(t),
    includes: e,
  });
}
function w0(e, t) {
  return new Gx({
    check: 'string_format',
    format: 'starts_with',
    ...ne(t),
    prefix: e,
  });
}
function N0(e, t) {
  return new Hx({
    check: 'string_format',
    format: 'ends_with',
    ...ne(t),
    suffix: e,
  });
}
function ir(e) {
  return new Wx({ check: 'overwrite', tx: e });
}
function _0(e) {
  return ir((t) => t.normalize(e));
}
function k0() {
  return ir((e) => e.trim());
}
function S0() {
  return ir((e) => e.toLowerCase());
}
function E0() {
  return ir((e) => e.toUpperCase());
}
function T0() {
  return ir((e) => Dp(e));
}
function I0(e, t, r) {
  return new e({ type: 'array', element: t, ...ne(r) });
}
function C0(e, t, r) {
  return new e({ type: 'custom', check: 'custom', fn: t, ...ne(r) });
}
function A0(e) {
  const t = L0(
    (r) => (
      (r.addIssue = (n) => {
        if (typeof n == 'string') r.issues.push(yr(n, r.value, t._zod.def));
        else {
          const a = n;
          (a.fatal && (a.continue = !1),
            a.code ?? (a.code = 'custom'),
            a.input ?? (a.input = r.value),
            a.inst ?? (a.inst = t),
            a.continue ?? (a.continue = !t._zod.def.abort),
            r.issues.push(yr(a)));
        }
      }),
      e(r.value, r)
    )
  );
  return t;
}
function L0(e, t) {
  const r = new at({ check: 'custom', ...ne(t) });
  return ((r._zod.check = e), r);
}
function Gc(e) {
  let t = (e == null ? void 0 : e.target) ?? 'draft-2020-12';
  return (
    t === 'draft-4' && (t = 'draft-04'),
    t === 'draft-7' && (t = 'draft-07'),
    {
      processors: e.processors ?? {},
      metadataRegistry: (e == null ? void 0 : e.metadata) ?? ur,
      target: t,
      unrepresentable: (e == null ? void 0 : e.unrepresentable) ?? 'throw',
      override: (e == null ? void 0 : e.override) ?? (() => {}),
      io: (e == null ? void 0 : e.io) ?? 'output',
      counter: 0,
      seen: new Map(),
      cycles: (e == null ? void 0 : e.cycles) ?? 'ref',
      reused: (e == null ? void 0 : e.reused) ?? 'inline',
      external: (e == null ? void 0 : e.external) ?? void 0,
    }
  );
}
function Fe(e, t, r = { path: [], schemaPath: [] }) {
  var m, u;
  var n;
  const a = e._zod.def,
    i = t.seen.get(e);
  if (i) return (i.count++, r.schemaPath.includes(e) && (i.cycle = r.path), i.schema);
  const o = { schema: {}, count: 1, cycle: void 0, path: r.path };
  t.seen.set(e, o);
  const l = (u = (m = e._zod).toJSONSchema) == null ? void 0 : u.call(m);
  if (l) o.schema = l;
  else {
    const x = { ...r, schemaPath: [...r.schemaPath, e], path: r.path },
      f = e._zod.parent;
    if (f) ((o.ref = f), Fe(f, t, x), (t.seen.get(f).isParent = !0));
    else if (e._zod.processJSONSchema) e._zod.processJSONSchema(t, o.schema, x);
    else {
      const g = o.schema,
        b = t.processors[a.type];
      if (!b) throw new Error(`[toJSONSchema]: Non-representable type encountered: ${a.type}`);
      b(e, t, g, x);
    }
  }
  const c = t.metadataRegistry.get(e);
  return (
    c && Object.assign(o.schema, c),
    t.io === 'input' && Ze(e) && (delete o.schema.examples, delete o.schema.default),
    t.io === 'input' &&
      o.schema._prefault &&
      ((n = o.schema).default ?? (n.default = o.schema._prefault)),
    delete o.schema._prefault,
    t.seen.get(e).schema
  );
}
function Hc(e, t) {
  var i, o, l;
  const r = e.seen.get(t);
  if (!r) throw new Error('Unprocessed schema. This is a bug in Zod.');
  const n = (c) => {
      var f;
      const d = e.target === 'draft-2020-12' ? '$defs' : 'definitions';
      if (e.external) {
        const g = (f = e.external.registry.get(c[0])) == null ? void 0 : f.id,
          b = e.external.uri ?? ((p) => p);
        if (g) return { ref: b(g) };
        const y = c[1].defId ?? c[1].schema.id ?? `schema${e.counter++}`;
        return ((c[1].defId = y), { defId: y, ref: `${b('__shared')}#/${d}/${y}` });
      }
      if (c[1] === r) return { ref: '#' };
      const u = `#/${d}/`,
        x = c[1].schema.id ?? `__schema${e.counter++}`;
      return { defId: x, ref: u + x };
    },
    a = (c) => {
      if (c[1].schema.$ref) return;
      const d = c[1],
        { ref: m, defId: u } = n(c);
      ((d.def = { ...d.schema }), u && (d.defId = u));
      const x = d.schema;
      for (const f in x) delete x[f];
      x.$ref = m;
    };
  if (e.cycles === 'throw')
    for (const c of e.seen.entries()) {
      const d = c[1];
      if (d.cycle)
        throw new Error(`Cycle detected: #/${(i = d.cycle) == null ? void 0 : i.join('/')}/<root>

Set the \`cycles\` parameter to \`"ref"\` to resolve cyclical schemas with defs.`);
    }
  for (const c of e.seen.entries()) {
    const d = c[1];
    if (t === c[0]) {
      a(c);
      continue;
    }
    if (e.external) {
      const u = (o = e.external.registry.get(c[0])) == null ? void 0 : o.id;
      if (t !== c[0] && u) {
        a(c);
        continue;
      }
    }
    if ((l = e.metadataRegistry.get(c[0])) == null ? void 0 : l.id) {
      a(c);
      continue;
    }
    if (d.cycle) {
      a(c);
      continue;
    }
    if (d.count > 1 && e.reused === 'ref') {
      a(c);
      continue;
    }
  }
}
function Wc(e, t) {
  var o, l, c;
  const r = e.seen.get(t);
  if (!r) throw new Error('Unprocessed schema. This is a bug in Zod.');
  const n = (d) => {
    const m = e.seen.get(d),
      u = m.def ?? m.schema,
      x = { ...u };
    if (m.ref === null) return;
    const f = m.ref;
    if (((m.ref = null), f)) {
      n(f);
      const g = e.seen.get(f).schema;
      g.$ref && (e.target === 'draft-07' || e.target === 'draft-04' || e.target === 'openapi-3.0')
        ? ((u.allOf = u.allOf ?? []), u.allOf.push(g))
        : (Object.assign(u, g), Object.assign(u, x));
    }
    m.isParent || e.override({ zodSchema: d, jsonSchema: u, path: m.path ?? [] });
  };
  for (const d of [...e.seen.entries()].reverse()) n(d[0]);
  const a = {};
  if (
    (e.target === 'draft-2020-12'
      ? (a.$schema = 'https://json-schema.org/draft/2020-12/schema')
      : e.target === 'draft-07'
        ? (a.$schema = 'http://json-schema.org/draft-07/schema#')
        : e.target === 'draft-04'
          ? (a.$schema = 'http://json-schema.org/draft-04/schema#')
          : e.target,
    (o = e.external) != null && o.uri)
  ) {
    const d = (l = e.external.registry.get(t)) == null ? void 0 : l.id;
    if (!d) throw new Error('Schema is missing an `id` property');
    a.$id = e.external.uri(d);
  }
  Object.assign(a, r.def ?? r.schema);
  const i = ((c = e.external) == null ? void 0 : c.defs) ?? {};
  for (const d of e.seen.entries()) {
    const m = d[1];
    m.def && m.defId && (i[m.defId] = m.def);
  }
  e.external ||
    (Object.keys(i).length > 0 &&
      (e.target === 'draft-2020-12' ? (a.$defs = i) : (a.definitions = i)));
  try {
    const d = JSON.parse(JSON.stringify(a));
    return (
      Object.defineProperty(d, '~standard', {
        value: {
          ...t['~standard'],
          jsonSchema: { input: fn(t, 'input'), output: fn(t, 'output') },
        },
        enumerable: !1,
        writable: !1,
      }),
      d
    );
  } catch {
    throw new Error('Error converting schema to JSON.');
  }
}
function Ze(e, t) {
  const r = t ?? { seen: new Set() };
  if (r.seen.has(e)) return !1;
  r.seen.add(e);
  const n = e._zod.def;
  if (n.type === 'transform') return !0;
  if (n.type === 'array') return Ze(n.element, r);
  if (n.type === 'set') return Ze(n.valueType, r);
  if (n.type === 'lazy') return Ze(n.getter(), r);
  if (
    n.type === 'promise' ||
    n.type === 'optional' ||
    n.type === 'nonoptional' ||
    n.type === 'nullable' ||
    n.type === 'readonly' ||
    n.type === 'default' ||
    n.type === 'prefault'
  )
    return Ze(n.innerType, r);
  if (n.type === 'intersection') return Ze(n.left, r) || Ze(n.right, r);
  if (n.type === 'record' || n.type === 'map') return Ze(n.keyType, r) || Ze(n.valueType, r);
  if (n.type === 'pipe') return Ze(n.in, r) || Ze(n.out, r);
  if (n.type === 'object') {
    for (const a in n.shape) if (Ze(n.shape[a], r)) return !0;
    return !1;
  }
  if (n.type === 'union') {
    for (const a of n.options) if (Ze(a, r)) return !0;
    return !1;
  }
  if (n.type === 'tuple') {
    for (const a of n.items) if (Ze(a, r)) return !0;
    return !!(n.rest && Ze(n.rest, r));
  }
  return !1;
}
const O0 =
    (e, t = {}) =>
    (r) => {
      const n = Gc({ ...r, processors: t });
      return (Fe(e, n), Hc(n, e), Wc(n, e));
    },
  fn = (e, t) => (r) => {
    const { libraryOptions: n, target: a } = r ?? {},
      i = Gc({ ...(n ?? {}), target: a, io: t, processors: {} });
    return (Fe(e, i), Hc(i, e), Wc(i, e));
  },
  R0 = {
    guid: 'uuid',
    url: 'uri',
    datetime: 'date-time',
    json_string: 'json-string',
    regex: '',
  },
  M0 = (e, t, r, n) => {
    const a = r;
    a.type = 'string';
    const { minimum: i, maximum: o, format: l, patterns: c, contentEncoding: d } = e._zod.bag;
    if (
      (typeof i == 'number' && (a.minLength = i),
      typeof o == 'number' && (a.maxLength = o),
      l && ((a.format = R0[l] ?? l), a.format === '' && delete a.format),
      d && (a.contentEncoding = d),
      c && c.size > 0)
    ) {
      const m = [...c];
      m.length === 1
        ? (a.pattern = m[0].source)
        : m.length > 1 &&
          (a.allOf = [
            ...m.map((u) => ({
              ...(t.target === 'draft-07' || t.target === 'draft-04' || t.target === 'openapi-3.0'
                ? { type: 'string' }
                : {}),
              pattern: u.source,
            })),
          ]);
    }
  },
  P0 = (e, t, r, n) => {
    const a = r,
      {
        minimum: i,
        maximum: o,
        format: l,
        multipleOf: c,
        exclusiveMaximum: d,
        exclusiveMinimum: m,
      } = e._zod.bag;
    (typeof l == 'string' && l.includes('int') ? (a.type = 'integer') : (a.type = 'number'),
      typeof m == 'number' &&
        (t.target === 'draft-04' || t.target === 'openapi-3.0'
          ? ((a.minimum = m), (a.exclusiveMinimum = !0))
          : (a.exclusiveMinimum = m)),
      typeof i == 'number' &&
        ((a.minimum = i),
        typeof m == 'number' &&
          t.target !== 'draft-04' &&
          (m >= i ? delete a.minimum : delete a.exclusiveMinimum)),
      typeof d == 'number' &&
        (t.target === 'draft-04' || t.target === 'openapi-3.0'
          ? ((a.maximum = d), (a.exclusiveMaximum = !0))
          : (a.exclusiveMaximum = d)),
      typeof o == 'number' &&
        ((a.maximum = o),
        typeof d == 'number' &&
          t.target !== 'draft-04' &&
          (d <= o ? delete a.maximum : delete a.exclusiveMaximum)),
      typeof c == 'number' && (a.multipleOf = c));
  },
  z0 = (e, t, r, n) => {
    t.target === 'openapi-3.0'
      ? ((r.type = 'string'), (r.nullable = !0), (r.enum = [null]))
      : (r.type = 'null');
  },
  D0 = (e, t, r, n) => {
    r.not = {};
  },
  F0 = (e, t, r, n) => {},
  $0 = (e, t, r, n) => {
    const a = e._zod.def,
      i = _c(a.entries);
    (i.every((o) => typeof o == 'number') && (r.type = 'number'),
      i.every((o) => typeof o == 'string') && (r.type = 'string'),
      (r.enum = i));
  },
  U0 = (e, t, r, n) => {
    if (t.unrepresentable === 'throw')
      throw new Error('Custom types cannot be represented in JSON Schema');
  },
  B0 = (e, t, r, n) => {
    if (t.unrepresentable === 'throw')
      throw new Error('Transforms cannot be represented in JSON Schema');
  },
  G0 = (e, t, r, n) => {
    const a = r,
      i = e._zod.def,
      { minimum: o, maximum: l } = e._zod.bag;
    (typeof o == 'number' && (a.minItems = o),
      typeof l == 'number' && (a.maxItems = l),
      (a.type = 'array'),
      (a.items = Fe(i.element, t, { ...n, path: [...n.path, 'items'] })));
  },
  H0 = (e, t, r, n) => {
    var d;
    const a = r,
      i = e._zod.def;
    ((a.type = 'object'), (a.properties = {}));
    const o = i.shape;
    for (const m in o)
      a.properties[m] = Fe(o[m], t, {
        ...n,
        path: [...n.path, 'properties', m],
      });
    const l = new Set(Object.keys(o)),
      c = new Set(
        [...l].filter((m) => {
          const u = i.shape[m]._zod;
          return t.io === 'input' ? u.optin === void 0 : u.optout === void 0;
        })
      );
    (c.size > 0 && (a.required = Array.from(c)),
      ((d = i.catchall) == null ? void 0 : d._zod.def.type) === 'never'
        ? (a.additionalProperties = !1)
        : i.catchall
          ? i.catchall &&
            (a.additionalProperties = Fe(i.catchall, t, {
              ...n,
              path: [...n.path, 'additionalProperties'],
            }))
          : t.io === 'output' && (a.additionalProperties = !1));
  },
  W0 = (e, t, r, n) => {
    const a = e._zod.def,
      i = a.inclusive === !1,
      o = a.options.map((l, c) => Fe(l, t, { ...n, path: [...n.path, i ? 'oneOf' : 'anyOf', c] }));
    i ? (r.oneOf = o) : (r.anyOf = o);
  },
  V0 = (e, t, r, n) => {
    const a = e._zod.def,
      i = Fe(a.left, t, { ...n, path: [...n.path, 'allOf', 0] }),
      o = Fe(a.right, t, { ...n, path: [...n.path, 'allOf', 1] }),
      l = (d) => 'allOf' in d && Object.keys(d).length === 1,
      c = [...(l(i) ? i.allOf : [i]), ...(l(o) ? o.allOf : [o])];
    r.allOf = c;
  },
  Z0 = (e, t, r, n) => {
    const a = e._zod.def,
      i = Fe(a.innerType, t, n),
      o = t.seen.get(e);
    t.target === 'openapi-3.0'
      ? ((o.ref = a.innerType), (r.nullable = !0))
      : (r.anyOf = [i, { type: 'null' }]);
  },
  Y0 = (e, t, r, n) => {
    const a = e._zod.def;
    Fe(a.innerType, t, n);
    const i = t.seen.get(e);
    i.ref = a.innerType;
  },
  q0 = (e, t, r, n) => {
    const a = e._zod.def;
    Fe(a.innerType, t, n);
    const i = t.seen.get(e);
    ((i.ref = a.innerType), (r.default = JSON.parse(JSON.stringify(a.defaultValue))));
  },
  K0 = (e, t, r, n) => {
    const a = e._zod.def;
    Fe(a.innerType, t, n);
    const i = t.seen.get(e);
    ((i.ref = a.innerType),
      t.io === 'input' && (r._prefault = JSON.parse(JSON.stringify(a.defaultValue))));
  },
  Q0 = (e, t, r, n) => {
    const a = e._zod.def;
    Fe(a.innerType, t, n);
    const i = t.seen.get(e);
    i.ref = a.innerType;
    let o;
    try {
      o = a.catchValue(void 0);
    } catch {
      throw new Error('Dynamic catch values are not supported in JSON Schema');
    }
    r.default = o;
  },
  J0 = (e, t, r, n) => {
    const a = e._zod.def,
      i = t.io === 'input' ? (a.in._zod.def.type === 'transform' ? a.out : a.in) : a.out;
    Fe(i, t, n);
    const o = t.seen.get(e);
    o.ref = i;
  },
  X0 = (e, t, r, n) => {
    const a = e._zod.def;
    Fe(a.innerType, t, n);
    const i = t.seen.get(e);
    ((i.ref = a.innerType), (r.readOnly = !0));
  },
  eb = (e, t, r, n) => {
    const a = e._zod.def;
    Fe(a.innerType, t, n);
    const i = t.seen.get(e);
    i.ref = a.innerType;
  },
  tb = L('ZodISODateTime', (e, t) => {
    (ag.init(e, t), Ee.init(e, t));
  });
function sb(e) {
  return c0(tb, e);
}
const rb = L('ZodISODate', (e, t) => {
  (ig.init(e, t), Ee.init(e, t));
});
function nb(e) {
  return d0(rb, e);
}
const ab = L('ZodISOTime', (e, t) => {
  (og.init(e, t), Ee.init(e, t));
});
function ib(e) {
  return u0(ab, e);
}
const ob = L('ZodISODuration', (e, t) => {
  (lg.init(e, t), Ee.init(e, t));
});
function lb(e) {
  return m0(ob, e);
}
const cb = (e, t) => {
    (Ic.init(e, t),
      (e.name = 'ZodError'),
      Object.defineProperties(e, {
        format: { value: (r) => Qp(e, r) },
        flatten: { value: (r) => Kp(e, r) },
        addIssue: {
          value: (r) => {
            (e.issues.push(r), (e.message = JSON.stringify(e.issues, wa, 2)));
          },
        },
        addIssues: {
          value: (r) => {
            (e.issues.push(...r), (e.message = JSON.stringify(e.issues, wa, 2)));
          },
        },
        isEmpty: {
          get() {
            return e.issues.length === 0;
          },
        },
      }));
  },
  pt = L('ZodError', cb, { Parent: Error }),
  db = qa(pt),
  ub = Ka(pt),
  mb = Tn(pt),
  hb = In(pt),
  fb = ex(pt),
  pb = tx(pt),
  xb = sx(pt),
  gb = rx(pt),
  bb = nx(pt),
  yb = ax(pt),
  vb = ix(pt),
  jb = ox(pt),
  Ae = L(
    'ZodType',
    (e, t) => (
      Ce.init(e, t),
      Object.assign(e['~standard'], {
        jsonSchema: { input: fn(e, 'input'), output: fn(e, 'output') },
      }),
      (e.toJSONSchema = O0(e, {})),
      (e.def = t),
      (e.type = t.type),
      Object.defineProperty(e, '_def', { value: t }),
      (e.check = (...r) =>
        e.clone(
          As(t, {
            checks: [
              ...(t.checks ?? []),
              ...r.map((n) =>
                typeof n == 'function'
                  ? {
                      _zod: {
                        check: n,
                        def: { check: 'custom' },
                        onattach: [],
                      },
                    }
                  : n
              ),
            ],
          })
        )),
      (e.clone = (r, n) => os(e, r, n)),
      (e.brand = () => e),
      (e.register = (r, n) => (r.add(e, n), e)),
      (e.parse = (r, n) => db(e, r, n, { callee: e.parse })),
      (e.safeParse = (r, n) => mb(e, r, n)),
      (e.parseAsync = async (r, n) => ub(e, r, n, { callee: e.parseAsync })),
      (e.safeParseAsync = async (r, n) => hb(e, r, n)),
      (e.spa = e.safeParseAsync),
      (e.encode = (r, n) => fb(e, r, n)),
      (e.decode = (r, n) => pb(e, r, n)),
      (e.encodeAsync = async (r, n) => xb(e, r, n)),
      (e.decodeAsync = async (r, n) => gb(e, r, n)),
      (e.safeEncode = (r, n) => bb(e, r, n)),
      (e.safeDecode = (r, n) => yb(e, r, n)),
      (e.safeEncodeAsync = async (r, n) => vb(e, r, n)),
      (e.safeDecodeAsync = async (r, n) => jb(e, r, n)),
      (e.refine = (r, n) => e.check(uy(r, n))),
      (e.superRefine = (r) => e.check(my(r))),
      (e.overwrite = (r) => e.check(ir(r))),
      (e.optional = () => No(e)),
      (e.nullable = () => _o(e)),
      (e.nullish = () => No(_o(e))),
      (e.nonoptional = (r) => ny(e, r)),
      (e.array = () => Us(e)),
      (e.or = (r) => Yc([e, r])),
      (e.and = (r) => Kb(e, r)),
      (e.transform = (r) => ko(e, Jb(r))),
      (e.default = (r) => ty(e, r)),
      (e.prefault = (r) => ry(e, r)),
      (e.catch = (r) => iy(e, r)),
      (e.pipe = (r) => ko(e, r)),
      (e.readonly = () => cy(e)),
      (e.describe = (r) => {
        const n = e.clone();
        return (ur.add(n, { description: r }), n);
      }),
      Object.defineProperty(e, 'description', {
        get() {
          var r;
          return (r = ur.get(e)) == null ? void 0 : r.description;
        },
        configurable: !0,
      }),
      (e.meta = (...r) => {
        if (r.length === 0) return ur.get(e);
        const n = e.clone();
        return (ur.add(n, r[0]), n);
      }),
      (e.isOptional = () => e.safeParse(void 0).success),
      (e.isNullable = () => e.safeParse(null).success),
      e
    )
  ),
  Vc = L('_ZodString', (e, t) => {
    (Qa.init(e, t), Ae.init(e, t), (e._zod.processJSONSchema = (n, a, i) => M0(e, n, a)));
    const r = e._zod.bag;
    ((e.format = r.format ?? null),
      (e.minLength = r.minimum ?? null),
      (e.maxLength = r.maximum ?? null),
      (e.regex = (...n) => e.check(b0(...n))),
      (e.includes = (...n) => e.check(j0(...n))),
      (e.startsWith = (...n) => e.check(w0(...n))),
      (e.endsWith = (...n) => e.check(N0(...n))),
      (e.min = (...n) => e.check(hn(...n))),
      (e.max = (...n) => e.check(Uc(...n))),
      (e.length = (...n) => e.check(Bc(...n))),
      (e.nonempty = (...n) => e.check(hn(1, ...n))),
      (e.lowercase = (n) => e.check(y0(n))),
      (e.uppercase = (n) => e.check(v0(n))),
      (e.trim = () => e.check(k0())),
      (e.normalize = (...n) => e.check(_0(...n))),
      (e.toLowerCase = () => e.check(S0())),
      (e.toUpperCase = () => e.check(E0())),
      (e.slugify = () => e.check(T0())));
  }),
  wb = L('ZodString', (e, t) => {
    (Qa.init(e, t),
      Vc.init(e, t),
      (e.email = (r) => e.check(Bg(Nb, r))),
      (e.url = (r) => e.check(Zg(_b, r))),
      (e.jwt = (r) => e.check(l0(Fb, r))),
      (e.emoji = (r) => e.check(Yg(kb, r))),
      (e.guid = (r) => e.check(xo(vo, r))),
      (e.uuid = (r) => e.check(Gg(Vr, r))),
      (e.uuidv4 = (r) => e.check(Hg(Vr, r))),
      (e.uuidv6 = (r) => e.check(Wg(Vr, r))),
      (e.uuidv7 = (r) => e.check(Vg(Vr, r))),
      (e.nanoid = (r) => e.check(qg(Sb, r))),
      (e.guid = (r) => e.check(xo(vo, r))),
      (e.cuid = (r) => e.check(Kg(Eb, r))),
      (e.cuid2 = (r) => e.check(Qg(Tb, r))),
      (e.ulid = (r) => e.check(Jg(Ib, r))),
      (e.base64 = (r) => e.check(a0(Pb, r))),
      (e.base64url = (r) => e.check(i0(zb, r))),
      (e.xid = (r) => e.check(Xg(Cb, r))),
      (e.ksuid = (r) => e.check(e0(Ab, r))),
      (e.ipv4 = (r) => e.check(t0(Lb, r))),
      (e.ipv6 = (r) => e.check(s0(Ob, r))),
      (e.cidrv4 = (r) => e.check(r0(Rb, r))),
      (e.cidrv6 = (r) => e.check(n0(Mb, r))),
      (e.e164 = (r) => e.check(o0(Db, r))),
      (e.datetime = (r) => e.check(sb(r))),
      (e.date = (r) => e.check(nb(r))),
      (e.time = (r) => e.check(ib(r))),
      (e.duration = (r) => e.check(lb(r))));
  });
function Ne(e) {
  return Ug(wb, e);
}
const Ee = L('ZodStringFormat', (e, t) => {
    (_e.init(e, t), Vc.init(e, t));
  }),
  Nb = L('ZodEmail', (e, t) => {
    (Kx.init(e, t), Ee.init(e, t));
  }),
  vo = L('ZodGUID', (e, t) => {
    (Yx.init(e, t), Ee.init(e, t));
  }),
  Vr = L('ZodUUID', (e, t) => {
    (qx.init(e, t), Ee.init(e, t));
  }),
  _b = L('ZodURL', (e, t) => {
    (Qx.init(e, t), Ee.init(e, t));
  }),
  kb = L('ZodEmoji', (e, t) => {
    (Jx.init(e, t), Ee.init(e, t));
  }),
  Sb = L('ZodNanoID', (e, t) => {
    (Xx.init(e, t), Ee.init(e, t));
  }),
  Eb = L('ZodCUID', (e, t) => {
    (eg.init(e, t), Ee.init(e, t));
  }),
  Tb = L('ZodCUID2', (e, t) => {
    (tg.init(e, t), Ee.init(e, t));
  }),
  Ib = L('ZodULID', (e, t) => {
    (sg.init(e, t), Ee.init(e, t));
  }),
  Cb = L('ZodXID', (e, t) => {
    (rg.init(e, t), Ee.init(e, t));
  }),
  Ab = L('ZodKSUID', (e, t) => {
    (ng.init(e, t), Ee.init(e, t));
  }),
  Lb = L('ZodIPv4', (e, t) => {
    (cg.init(e, t), Ee.init(e, t));
  }),
  Ob = L('ZodIPv6', (e, t) => {
    (dg.init(e, t), Ee.init(e, t));
  }),
  Rb = L('ZodCIDRv4', (e, t) => {
    (ug.init(e, t), Ee.init(e, t));
  }),
  Mb = L('ZodCIDRv6', (e, t) => {
    (mg.init(e, t), Ee.init(e, t));
  }),
  Pb = L('ZodBase64', (e, t) => {
    (hg.init(e, t), Ee.init(e, t));
  }),
  zb = L('ZodBase64URL', (e, t) => {
    (pg.init(e, t), Ee.init(e, t));
  }),
  Db = L('ZodE164', (e, t) => {
    (xg.init(e, t), Ee.init(e, t));
  }),
  Fb = L('ZodJWT', (e, t) => {
    (bg.init(e, t), Ee.init(e, t));
  }),
  Zc = L('ZodNumber', (e, t) => {
    (Dc.init(e, t),
      Ae.init(e, t),
      (e._zod.processJSONSchema = (n, a, i) => P0(e, n, a)),
      (e.gt = (n, a) => e.check(bo(n, a))),
      (e.gte = (n, a) => e.check(Bn(n, a))),
      (e.min = (n, a) => e.check(Bn(n, a))),
      (e.lt = (n, a) => e.check(go(n, a))),
      (e.lte = (n, a) => e.check(Un(n, a))),
      (e.max = (n, a) => e.check(Un(n, a))),
      (e.int = (n) => e.check(jo(n))),
      (e.safe = (n) => e.check(jo(n))),
      (e.positive = (n) => e.check(bo(0, n))),
      (e.nonnegative = (n) => e.check(Bn(0, n))),
      (e.negative = (n) => e.check(go(0, n))),
      (e.nonpositive = (n) => e.check(Un(0, n))),
      (e.multipleOf = (n, a) => e.check(yo(n, a))),
      (e.step = (n, a) => e.check(yo(n, a))),
      (e.finite = () => e));
    const r = e._zod.bag;
    ((e.minValue =
      Math.max(
        r.minimum ?? Number.NEGATIVE_INFINITY,
        r.exclusiveMinimum ?? Number.NEGATIVE_INFINITY
      ) ?? null),
      (e.maxValue =
        Math.min(
          r.maximum ?? Number.POSITIVE_INFINITY,
          r.exclusiveMaximum ?? Number.POSITIVE_INFINITY
        ) ?? null),
      (e.isInt = (r.format ?? '').includes('int') || Number.isSafeInteger(r.multipleOf ?? 0.5)),
      (e.isFinite = !0),
      (e.format = r.format ?? null));
  });
function De(e) {
  return h0(Zc, e);
}
const $b = L('ZodNumberFormat', (e, t) => {
  (yg.init(e, t), Zc.init(e, t));
});
function jo(e) {
  return f0($b, e);
}
const Ub = L('ZodNull', (e, t) => {
  (vg.init(e, t), Ae.init(e, t), (e._zod.processJSONSchema = (r, n, a) => z0(e, r, n)));
});
function Bb(e) {
  return p0(Ub, e);
}
const Gb = L('ZodUnknown', (e, t) => {
  (jg.init(e, t), Ae.init(e, t), (e._zod.processJSONSchema = (r, n, a) => F0()));
});
function wo() {
  return x0(Gb);
}
const Hb = L('ZodNever', (e, t) => {
  (wg.init(e, t), Ae.init(e, t), (e._zod.processJSONSchema = (r, n, a) => D0(e, r, n)));
});
function Wb(e) {
  return g0(Hb, e);
}
const Vb = L('ZodArray', (e, t) => {
  (Ng.init(e, t),
    Ae.init(e, t),
    (e._zod.processJSONSchema = (r, n, a) => G0(e, r, n, a)),
    (e.element = t.element),
    (e.min = (r, n) => e.check(hn(r, n))),
    (e.nonempty = (r) => e.check(hn(1, r))),
    (e.max = (r, n) => e.check(Uc(r, n))),
    (e.length = (r, n) => e.check(Bc(r, n))),
    (e.unwrap = () => e.element));
});
function Us(e, t) {
  return I0(Vb, e, t);
}
const Zb = L('ZodObject', (e, t) => {
  (kg.init(e, t),
    Ae.init(e, t),
    (e._zod.processJSONSchema = (r, n, a) => H0(e, r, n, a)),
    we(e, 'shape', () => t.shape),
    (e.keyof = () => Ja(Object.keys(e._zod.def.shape))),
    (e.catchall = (r) => e.clone({ ...e._zod.def, catchall: r })),
    (e.passthrough = () => e.clone({ ...e._zod.def, catchall: wo() })),
    (e.loose = () => e.clone({ ...e._zod.def, catchall: wo() })),
    (e.strict = () => e.clone({ ...e._zod.def, catchall: Wb() })),
    (e.strip = () => e.clone({ ...e._zod.def, catchall: void 0 })),
    (e.extend = (r) => Wp(e, r)),
    (e.safeExtend = (r) => Vp(e, r)),
    (e.merge = (r) => Zp(e, r)),
    (e.pick = (r) => Gp(e, r)),
    (e.omit = (r) => Hp(e, r)),
    (e.partial = (...r) => Yp(qc, e, r[0])),
    (e.required = (...r) => qp(Kc, e, r[0])));
});
function Is(e, t) {
  const r = { type: 'object', shape: e ?? {}, ...ne(t) };
  return new Zb(r);
}
const Yb = L('ZodUnion', (e, t) => {
  (Sg.init(e, t),
    Ae.init(e, t),
    (e._zod.processJSONSchema = (r, n, a) => W0(e, r, n, a)),
    (e.options = t.options));
});
function Yc(e, t) {
  return new Yb({ type: 'union', options: e, ...ne(t) });
}
const qb = L('ZodIntersection', (e, t) => {
  (Eg.init(e, t), Ae.init(e, t), (e._zod.processJSONSchema = (r, n, a) => V0(e, r, n, a)));
});
function Kb(e, t) {
  return new qb({ type: 'intersection', left: e, right: t });
}
const _a = L('ZodEnum', (e, t) => {
  (Tg.init(e, t),
    Ae.init(e, t),
    (e._zod.processJSONSchema = (n, a, i) => $0(e, n, a)),
    (e.enum = t.entries),
    (e.options = Object.values(t.entries)));
  const r = new Set(Object.keys(t.entries));
  ((e.extract = (n, a) => {
    const i = {};
    for (const o of n)
      if (r.has(o)) i[o] = t.entries[o];
      else throw new Error(`Key ${o} not found in enum`);
    return new _a({ ...t, checks: [], ...ne(a), entries: i });
  }),
    (e.exclude = (n, a) => {
      const i = { ...t.entries };
      for (const o of n)
        if (r.has(o)) delete i[o];
        else throw new Error(`Key ${o} not found in enum`);
      return new _a({ ...t, checks: [], ...ne(a), entries: i });
    }));
});
function Ja(e, t) {
  const r = Array.isArray(e) ? Object.fromEntries(e.map((n) => [n, n])) : e;
  return new _a({ type: 'enum', entries: r, ...ne(t) });
}
const Qb = L('ZodTransform', (e, t) => {
  (Ig.init(e, t),
    Ae.init(e, t),
    (e._zod.processJSONSchema = (r, n, a) => B0(e, r)),
    (e._zod.parse = (r, n) => {
      if (n.direction === 'backward') throw new wc(e.constructor.name);
      r.addIssue = (i) => {
        if (typeof i == 'string') r.issues.push(yr(i, r.value, t));
        else {
          const o = i;
          (o.fatal && (o.continue = !1),
            o.code ?? (o.code = 'custom'),
            o.input ?? (o.input = r.value),
            o.inst ?? (o.inst = e),
            r.issues.push(yr(o)));
        }
      };
      const a = t.transform(r.value, r);
      return a instanceof Promise ? a.then((i) => ((r.value = i), r)) : ((r.value = a), r);
    }));
});
function Jb(e) {
  return new Qb({ type: 'transform', transform: e });
}
const qc = L('ZodOptional', (e, t) => {
  (Cg.init(e, t),
    Ae.init(e, t),
    (e._zod.processJSONSchema = (r, n, a) => eb(e, r, n, a)),
    (e.unwrap = () => e._zod.def.innerType));
});
function No(e) {
  return new qc({ type: 'optional', innerType: e });
}
const Xb = L('ZodNullable', (e, t) => {
  (Ag.init(e, t),
    Ae.init(e, t),
    (e._zod.processJSONSchema = (r, n, a) => Z0(e, r, n, a)),
    (e.unwrap = () => e._zod.def.innerType));
});
function _o(e) {
  return new Xb({ type: 'nullable', innerType: e });
}
const ey = L('ZodDefault', (e, t) => {
  (Lg.init(e, t),
    Ae.init(e, t),
    (e._zod.processJSONSchema = (r, n, a) => q0(e, r, n, a)),
    (e.unwrap = () => e._zod.def.innerType),
    (e.removeDefault = e.unwrap));
});
function ty(e, t) {
  return new ey({
    type: 'default',
    innerType: e,
    get defaultValue() {
      return typeof t == 'function' ? t() : Sc(t);
    },
  });
}
const sy = L('ZodPrefault', (e, t) => {
  (Og.init(e, t),
    Ae.init(e, t),
    (e._zod.processJSONSchema = (r, n, a) => K0(e, r, n, a)),
    (e.unwrap = () => e._zod.def.innerType));
});
function ry(e, t) {
  return new sy({
    type: 'prefault',
    innerType: e,
    get defaultValue() {
      return typeof t == 'function' ? t() : Sc(t);
    },
  });
}
const Kc = L('ZodNonOptional', (e, t) => {
  (Rg.init(e, t),
    Ae.init(e, t),
    (e._zod.processJSONSchema = (r, n, a) => Y0(e, r, n, a)),
    (e.unwrap = () => e._zod.def.innerType));
});
function ny(e, t) {
  return new Kc({ type: 'nonoptional', innerType: e, ...ne(t) });
}
const ay = L('ZodCatch', (e, t) => {
  (Mg.init(e, t),
    Ae.init(e, t),
    (e._zod.processJSONSchema = (r, n, a) => Q0(e, r, n, a)),
    (e.unwrap = () => e._zod.def.innerType),
    (e.removeCatch = e.unwrap));
});
function iy(e, t) {
  return new ay({
    type: 'catch',
    innerType: e,
    catchValue: typeof t == 'function' ? t : () => t,
  });
}
const oy = L('ZodPipe', (e, t) => {
  (Pg.init(e, t),
    Ae.init(e, t),
    (e._zod.processJSONSchema = (r, n, a) => J0(e, r, n, a)),
    (e.in = t.in),
    (e.out = t.out));
});
function ko(e, t) {
  return new oy({ type: 'pipe', in: e, out: t });
}
const ly = L('ZodReadonly', (e, t) => {
  (zg.init(e, t),
    Ae.init(e, t),
    (e._zod.processJSONSchema = (r, n, a) => X0(e, r, n, a)),
    (e.unwrap = () => e._zod.def.innerType));
});
function cy(e) {
  return new ly({ type: 'readonly', innerType: e });
}
const dy = L('ZodCustom', (e, t) => {
  (Dg.init(e, t), Ae.init(e, t), (e._zod.processJSONSchema = (r, n, a) => U0(e, r)));
});
function uy(e, t = {}) {
  return C0(dy, e, t);
}
function my(e) {
  return A0(e);
}
const hy = Is({
    title: Ne().min(1, '標題必填').max(100, '標題太長'),
    price: Ne().min(1, '價格必填'),
    address: Ne().min(5, '地址太短').max(200, '地址太長'),
    communityName: Ne().min(1, '社區名稱必填'),
    advantage1: Ne().max(100),
    advantage2: Ne().max(100),
    disadvantage: Ne().min(10, '缺點至少需要 10 個字').max(200),
    highlights: Us(Ne()).optional(),
  }).refine(
    (e) => {
      var n;
      const r = (((n = e.highlights) == null ? void 0 : n.length) || 0) >= 3 ? 2 : 5;
      return e.advantage1.length >= r && e.advantage2.length >= r;
    },
    {
      message: '優點描述字數不足 (若標籤少於 3 個，優點需至少 5 字)',
      path: ['advantage1'],
    }
  ),
  be = {
    id: 'b0eebc99-9c0b-4ef8-bb6d-6bb9bd380a22',
    publicId: 'MH-100001',
    title: '信義區101景觀全新裝潢大三房',
    price: 3680,
    address: '台北市信義區',
    description:
      '這是一間位於信義區的優質好房，擁有絕佳的101景觀，全新裝潢，即可入住。周邊生活機能完善，交通便利，是您成家的最佳選擇。',
    images: [
      'https://images.unsplash.com/photo-1600607687939-ce8a6c25118c?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80',
    ],
    size: 34.2,
    rooms: 3,
    halls: 2,
    bathrooms: 2,
    floorCurrent: '12',
    floorTotal: 15,
    features: ['近捷運', '有車位', '全新裝潢'],
    advantage1: '近捷運',
    advantage2: '有車位',
    disadvantage: '臨路低樓層較吵',
    agent: {
      id: 'a0eebc99-9c0b-4ef8-bb6d-6bb9bd380a11',
      internalCode: 1,
      name: '王小明',
      avatarUrl:
        'https://images.unsplash.com/photo-1560250097-0b93528c311a?ixlib=rb-4.0.3&auto=format&fit=crop&w=200&q=80',
      company: '邁房子信義店',
      trustScore: 92,
      encouragementCount: 156,
    },
  },
  pn = {
    getPropertyByPublicId: async (e) => {
      const t = (n) => {
          if (n == null) return null;
          if (typeof n == 'number') return Number.isFinite(n) ? n : null;
          if (typeof n == 'string') {
            const i = n.trim();
            if (!i) return null;
            const o = Number(i);
            return Number.isFinite(o) ? o : null;
          }
          const a = Number(n);
          return Number.isFinite(a) ? a : null;
        },
        r = (n) => {
          if (typeof n != 'string') return null;
          const a = n.trim();
          return a || null;
        };
      try {
        const { data: n, error: a } = await de
          .from('properties')
          .select(
            `
          *,
          agent:agents (*)
        `
          )
          .eq('public_id', e)
          .single();
        if (a || !n)
          return (console.warn('查無正式資料，使用預設資料', a), e === 'MH-100001' ? be : null);
        const i = {
            id: n.id,
            publicId: n.public_id,
            title: n.title,
            price: Number(n.price),
            address: n.address,
            description: n.description,
            images: n.images || [],
            sourcePlatform: n.source_platform,
            agent: {
              id: n.agent.id,
              internalCode: n.agent.internal_code,
              name: n.agent.name,
              avatarUrl: n.agent.avatar_url || 'https://via.placeholder.com/150',
              company: n.agent.company,
              trustScore: n.agent.trust_score,
              encouragementCount: n.agent.encouragement_count,
            },
          },
          o = t(n.size);
        o != null && (i.size = o);
        const l = t(n.rooms);
        l != null && (i.rooms = l);
        const c = t(n.halls);
        c != null && (i.halls = c);
        const d = t(n.bathrooms);
        d != null && (i.bathrooms = d);
        const m = r(n.floor_current);
        m && (i.floorCurrent = m);
        const u = t(n.floor_total);
        return (
          u != null && (i.floorTotal = u),
          Array.isArray(n.features) && (i.features = n.features),
          n.advantage_1 && (i.advantage1 = n.advantage_1),
          n.advantage_2 && (i.advantage2 = n.advantage_2),
          n.disadvantage && (i.disadvantage = n.disadvantage),
          e === 'MH-100001' &&
            (i.size == null && be.size != null && (i.size = be.size),
            i.rooms == null && be.rooms != null && (i.rooms = be.rooms),
            i.halls == null && be.halls != null && (i.halls = be.halls),
            i.bathrooms == null && be.bathrooms != null && (i.bathrooms = be.bathrooms),
            i.floorCurrent == null && be.floorCurrent != null && (i.floorCurrent = be.floorCurrent),
            i.floorTotal == null && be.floorTotal != null && (i.floorTotal = be.floorTotal),
            i.features == null && be.features != null && (i.features = be.features),
            i.advantage1 == null && be.advantage1 != null && (i.advantage1 = be.advantage1),
            i.advantage2 == null && be.advantage2 != null && (i.advantage2 = be.advantage2),
            i.disadvantage == null &&
              be.disadvantage != null &&
              (i.disadvantage = be.disadvantage)),
          i
        );
      } catch (n) {
        return (console.error('Service Error:', n), be);
      }
    },
    createProperty: async (e, t) => {
      const { data: r, error: n } = await de
        .from('properties')
        .insert({
          title: e.title,
          price: e.price,
          address: e.address,
          description: e.description,
          images: e.images,
          source_platform: e.sourcePlatform,
          source_external_id: e.sourceExternalId,
          agent_id: t,
        })
        .select()
        .single();
      if (n) throw n;
      return r;
    },
    uploadImages: async (e, t) => {
      const r = (t == null ? void 0 : t.concurrency) || 3,
        n = [],
        a = [];
      let i = 0;
      for (let o = 0; o < e.length; o += r) {
        const c = e.slice(o, o + r).map(async (m) => {
            var u, x;
            try {
              const f = ((u = m.name.split('.').pop()) == null ? void 0 : u.toLowerCase()) || 'jpg',
                g = `${crypto.randomUUID()}.${f}`,
                { error: b } = await de.storage.from('property-images').upload(g, m, {
                  contentType: m.type,
                  cacheControl: '31536000',
                });
              if (b)
                return (
                  console.error('Image upload error:', b),
                  a.push({ file: m, error: b.message }),
                  null
                );
              const { data: y } = de.storage.from('property-images').getPublicUrl(g);
              return y.publicUrl;
            } catch (f) {
              const g = f instanceof Error ? f.message : '上傳失敗';
              return (
                console.error('Image upload exception:', f),
                a.push({ file: m, error: g }),
                null
              );
            } finally {
              (i++, (x = t == null ? void 0 : t.onProgress) == null || x.call(t, i, e.length));
            }
          }),
          d = await Promise.all(c);
        n.push(...d.filter((m) => !!m));
      }
      return { urls: n, failed: a, allSuccess: a.length === 0 };
    },
    uploadImagesLegacy: async (e) => (await pn.uploadImages(e)).urls,
    createPropertyWithForm: async (e, t, r) => {
      var x, f, g, b;
      const n = hy.safeParse(e);
      if (!n.success) {
        const y = n.error.issues.map((p) => p.message).join(', ');
        throw new Error(`資料驗證失敗: ${y}`);
      }
      const {
          data: { user: a },
        } = await de.auth.getUser(),
        i = (a == null ? void 0 : a.id) || 'a0eebc99-9c0b-4ef8-bb6d-6bb9bd380a11';
      let o = r || null,
        l = ((x = e.communityName) == null ? void 0 : x.trim()) || null,
        c = !1;
      if (l === '無') ((o = null), (l = '無'), console.log('✅ 透天/店面，不歸入社區牆'));
      else if (r) console.log('✅ 使用已選擇的社區 ID:', r);
      else if (e.address && l) {
        const y = ja(e.address);
        if (y.length >= 5) {
          const { data: p } = await de
            .from('communities')
            .select('id, name')
            .eq('address_fingerprint', y)
            .single();
          p && ((o = p.id), console.log('✅ 地址比對成功，使用現有社區:', p.name));
        }
        if (!o && l.length >= 2) {
          const p = so(l),
            E = ((f = e.address.match(/([^市縣]+[區鄉鎮市])/)) == null ? void 0 : f[1]) || '',
            { data: S } = await de
              .from('communities')
              .select('id, name')
              .eq('district', E)
              .limit(50);
          if (S && S.length > 0) {
            const N = S.find((k) => so(k.name) === p);
            N && ((o = N.id), (l = N.name), console.log('✅ 社區名正規化比對成功:', N.name));
          }
          if (!o) {
            const { data: N } = await de
              .from('communities')
              .select('id, name')
              .eq('name', l)
              .single();
            N && ((o = N.id), console.log('✅ 社區名精準比對成功:', N.name));
          }
        }
        if (!o) {
          const p = ((g = e.address.match(/([^市縣]+[區鄉鎮市])/)) == null ? void 0 : g[1]) || '',
            E = ((b = e.address.match(/^(.*?[市縣])/)) == null ? void 0 : b[1]) || '台北市',
            { data: S, error: N } = await de
              .from('communities')
              .insert({
                name: l,
                address: e.address,
                address_fingerprint: y,
                district: p,
                city: E,
                is_verified: !1,
                completeness_score: 20,
                features: [e.type].filter(Boolean),
              })
              .select('id')
              .single();
          !N && S
            ? ((o = S.id), (c = !0), console.log('✅ 建立新社區（待審核）:', l))
            : console.error('❌ 建立社區失敗:', N);
        }
      }
      const d = e.address ? ja(e.address) : null,
        { data: m, error: u } = await de
          .from('properties')
          .insert({
            agent_id: i,
            title: e.title,
            price: Number(e.price),
            address: e.address,
            address_fingerprint: d,
            community_name: l,
            community_id: o,
            size: Number(e.size || 0),
            age: Number(e.age || 0),
            rooms: Number(e.rooms),
            halls: Number(e.halls),
            bathrooms: Number(e.bathrooms),
            floor_current: e.floorCurrent,
            floor_total: Number(e.floorTotal || 0),
            property_type: e.type,
            advantage_1: e.advantage1,
            advantage_2: e.advantage2,
            disadvantage: e.disadvantage,
            description: e.description,
            images: t,
            features: Array.from(
              new Set([
                e.type,
                ...(e.highlights || []),
                ...(!e.highlights || e.highlights.length === 0 ? [e.advantage1, e.advantage2] : []),
              ])
            ).filter(Boolean),
            source_platform: e.sourceExternalId ? '591' : 'MH',
            source_external_id: e.sourceExternalId || null,
          })
          .select()
          .single();
      if (u) throw u;
      return (
        o &&
          (e.advantage1 || e.advantage2 || e.disadvantage) &&
          (await de.from('community_reviews').insert({
            community_id: o,
            property_id: m.id,
            source: 'agent',
            advantage_1: e.advantage1 || null,
            advantage_2: e.advantage2 || null,
            disadvantage: e.disadvantage || null,
          }),
          fetch('/api/generate-community-profile', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ communityId: o }),
          }).catch((y) => console.warn('AI 總結背景執行中:', y))),
        { ...m, is_new_community: c }
      );
    },
    checkCommunityExists: async (e) => {
      if (!e || e.trim().length < 2) return { exists: !1 };
      const { data: t } = await de
        .from('communities')
        .select('id, name')
        .ilike('name', `%${e.trim()}%`)
        .limit(1)
        .single();
      return t ? { exists: !0, community: t } : { exists: !1 };
    },
  };
async function fy() {
  try {
    const e = await fetch('/api/home/featured-properties');
    if (!e.ok) return (console.warn('[propertyService] API 回應非 200:', e.status), []);
    const t = await e.json();
    return t.success && Array.isArray(t.data)
      ? t.data
      : (console.warn('[propertyService] API 回傳格式錯誤:', t), []);
  } catch (e) {
    return (console.error('[propertyService] getFeaturedProperties 失敗:', e), []);
  }
}
function py() {
  const [e, t] = h.useState(uf);
  return (
    h.useEffect(() => {
      const r = new AbortController();
      return (
        fy().then((n) => {
          !r.signal.aborted && n && n.length > 0 && t(n);
        }),
        () => {
          r.abort();
        }
      );
    }, []),
    s.jsxs('div', {
      className: 'w-full',
      children: [
        s.jsxs('div', {
          className: 'my-[18px] mb-3 flex items-center gap-2.5',
          'aria-label': '智能房源推薦',
          children: [
            s.jsxs('div', {
              className:
                'inline-flex items-center gap-2 rounded-full border border-[#E6EDF7] bg-gradient-to-b from-white to-[#F6F9FF] px-3 py-1.5 text-sm font-black tracking-[0.2px] text-[#00385a]',
              children: [
                s.jsx('span', {
                  className:
                    'grid size-[18px] place-items-center rounded-md bg-gradient-to-b from-[#00385a] to-[#004E7C] text-xs font-black text-white shadow-[0_2px_6px_rgba(0,56,90,0.18)]',
                  children: '★',
                }),
                s.jsx('span', {
                  className: 'text-base leading-none md:text-lg md:font-bold',
                  children: '〔智能房源推薦〕',
                }),
                s.jsx('span', {
                  className: 'ml-1.5 text-sm font-bold text-[#6C7B91]',
                  children: '依瀏覽行為與社區口碑輔助排序',
                }),
              ],
            }),
            s.jsx('div', {
              className:
                'animate-mhRecoBar ml-2.5 h-1.5 flex-1 rounded-full bg-gradient-to-r from-[#00385a] via-[#004E7C] to-[#7EA5FF] bg-[length:200%_100%] opacity-25',
              'aria-hidden': 'true',
            }),
          ],
        }),
        s.jsx('div', {
          className: 'grid grid-cols-1 gap-[18px] md:grid-cols-2 lg:grid-cols-3',
          'aria-label': '房源清單',
          title: '房源清單',
          children: e.map((r) => s.jsx(Pp, { property: r }, r.id)),
        }),
      ],
    })
  );
}
const xy = () => {
  const [e, t] = h.useState(!1),
    r = h.useMemo(() => Ir(), []),
    n = h.useMemo(() => Vm(3), []),
    a = h.useMemo(() => Ym(r.milestones), [r.milestones]),
    i = h.useMemo(() => {
      if (e || typeof window > 'u') return !1;
      const { isFirstVisit: u } = Gm(),
        x = (n && n.length > 0) || !!a || !!r.lastMood;
      return !u && !Wm() && x;
    }, [e, n, a, r.lastMood]);
  if (
    (h.useEffect(() => {
      i && rt(nt.WarmbarView, { tags: n, milestone: !!a, lastMood: r.lastMood });
    }, [i, n, a, r.lastMood]),
    !i)
  )
    return null;
  const o = (u) => (u === 'stress' ? '最近辛苦了' : u === 'rest' ? '慢慢來就好' : '好久不見'),
    l = n && n.length > 0 ? `上次你提到「${n.join('・')}」` : null,
    c = a || (l ? `${o(r.lastMood)}，${l}` : `${o(r.lastMood)}，這幾天過得怎麼樣`),
    d = () => {
      rt(nt.WarmbarContinue, { tags: n, milestone: !!a });
      const u = a
        ? '最近有點紀念日的感覺，想輕鬆聊聊。'
        : n && n.length > 0
          ? `還記得我們聊過 ${n.join('、')}，你有新想法嗎？`
          : '想跟你聊聊近況～';
      window.dispatchEvent(new CustomEvent('mai:chat:start', { detail: { text: u } }));
    },
    m = () => {
      (Hm(), t(!0), rt(nt.WarmbarDismiss, {}));
    };
  return s.jsxs('div', {
    className:
      'flex h-[34px] w-full items-center justify-center gap-3 border-b border-[#E6ECFF] bg-[#F5F8FF] text-center text-sm leading-[34px] tracking-wide text-[#0a2246]',
    role: 'status',
    'aria-live': 'polite',
    children: [
      s.jsx('span', { children: c }),
      s.jsx('button', {
        className:
          'h-[26px] cursor-pointer rounded-full border border-[#1749D7] bg-[#1749D7] px-2.5 py-0.5 leading-6 text-white transition-colors hover:bg-[#123cb3]',
        onClick: d,
        children: '接著聊',
      }),
      s.jsx('button', {
        className:
          'h-[26px] cursor-pointer rounded-full border border-[#C9D5FF] bg-white px-2.5 py-0.5 leading-6 text-[#1749D7] transition-colors hover:bg-gray-50',
        onClick: m,
        children: '今天不再顯示',
      }),
    ],
  });
};
function gy({ config: e }) {
  const [t, r] = h.useState(null);
  (h.useEffect(() => {
    tc().then((a) => {
      a.ok &&
        a.data &&
        (a.data.maintenance || sp(a.data.backendVersion, e.minBackend) < 0) &&
        (console.warn('版本不相容或維護中'), r('版本不相容或維護中'));
    });
  }, [e.minBackend]),
    h.useEffect(() => {
      const a = (i) => {
        var o;
        try {
          Ga(
            'unhandled_promise_rejection',
            '/',
            ((o = i.reason) == null ? void 0 : o.message) || String(i.reason)
          );
        } catch {}
      };
      return (
        globalThis.addEventListener('unhandledrejection', a),
        () => globalThis.removeEventListener('unhandledrejection', a)
      );
    }, []));
  const n = e.features || {};
  return s.jsxs(s.Fragment, {
    children: [
      s.jsx(lf, {}),
      s.jsx(xy, {}),
      t &&
        s.jsx('div', {
          className: 'mx-auto mt-4 max-w-container rounded-md bg-yellow-500 p-3 text-sm text-white',
          children: t,
        }),
      s.jsxs('main', {
        className: 'relative mx-auto max-w-container space-y-6 p-4 md:space-y-8 md:p-6',
        children: [
          n.heroAssure !== !1 && s.jsx(rp, {}),
          n.smartAsk !== !1 && s.jsx(vc, {}),
          s.jsx(Mp, {}),
          n.propertyGrid !== !1 && s.jsx(py, {}),
        ],
      }),
    ],
  });
}
const by = (e) => {
  var r, n;
  if (!e) return 'guest';
  const t =
    ((r = e.app_metadata) == null ? void 0 : r.role) ??
    ((n = e.user_metadata) == null ? void 0 : n.role);
  return t === 'resident' || t === 'agent' || t === 'member' ? t : 'member';
};
function Ct() {
  const [e, t] = h.useState({
    session: null,
    user: null,
    role: 'guest',
    isAuthenticated: !1,
    loading: !0,
    error: null,
  });
  return (
    h.useEffect(() => {
      let n = !0;
      const a = (l, c = null) => {
        if (!n) return;
        const d = (l == null ? void 0 : l.user) ?? null,
          m = by(d);
        t({
          session: l,
          user: d,
          role: m,
          isAuthenticated: !!l,
          loading: !1,
          error: c,
        });
      };
      (async () => {
        try {
          const { data: l, error: c } = await de.auth.getSession();
          if (c) {
            a(null, c);
            return;
          }
          a(l.session, null);
        } catch (l) {
          a(null, l instanceof Error ? l : new Error('Failed to fetch session'));
        }
      })();
      const {
        data: { subscription: o },
      } = de.auth.onAuthStateChange((l, c) => {
        a(c, null);
      });
      return () => {
        ((n = !1), o.unsubscribe());
      };
    }, []),
    {
      ...e,
      signOut: async () => {
        const { error: n } = await de.auth.signOut();
        if (n) throw n;
      },
    }
  );
}
const Ps = (e = {}, t, r = 3200) => {
    const n = { duration: e.duration ?? r, dismissible: e.dismissible ?? !0 };
    return (
      e.id !== void 0 && (n.id = e.id),
      t !== void 0
        ? (n.description = t)
        : e.description !== void 0 && (n.description = e.description),
      e.actionLabel && e.onAction && (n.action = { label: e.actionLabel, onClick: e.onAction }),
      n
    );
  },
  W = {
    success: (e, t, r) => ds.success(e, Ps(r, t, 3200)),
    error: (e, t, r) => ds.error(e, Ps(r, t, (r == null ? void 0 : r.duration) ?? 5e3)),
    warning: (e, t, r) => ds.warning(e, Ps(r, t, (r == null ? void 0 : r.duration) ?? 4500)),
    info: (e, t, r) => ds.info(e, Ps(r, t, 3200)),
    loading: (e, t) =>
      ds.loading(
        e,
        Ps(t, t == null ? void 0 : t.description, (t == null ? void 0 : t.duration) ?? 1 / 0)
      ),
    dev: (e = '此功能開發中', t) =>
      ds.info('開發中', Ps(t, e, (t == null ? void 0 : t.duration) ?? 2200)),
    dismiss: (e) => ds.dismiss(e),
  },
  Ge = {
    BACK_HOME: '回首頁',
    SUBTITLE_WALL: '社區牆',
    AGENT_BADGE: '專業版',
    BTN_LOGIN: '登入',
    BTN_REGISTER: '免費註冊',
    BTN_LOGOUT: '登出',
    BTN_MY_ACCOUNT: '我的帳號',
    LABEL_NOTIFICATIONS: '通知',
    LABEL_AVATAR: '使用者選單',
    MENU_PROFILE: '個人檔案',
    ROLE_GUEST: '訪客',
    ROLE_MEMBER: '一般會員',
    ROLE_RESIDENT: '住戶',
    ROLE_AGENT: '認證房仲',
    ROLE_OFFICIAL: '官方帳號',
    MSG_LOGOUT_SUCCESS: '已登出',
    MSG_LOGOUT_DESC: '期待下次見面！',
    MSG_LOGOUT_ERROR: '登出失敗',
    MSG_LOGOUT_RETRY: '請稍後再試',
    MSG_FEATURE_DEV: '功能開發中',
    MSG_PROFILE_SOON: '個人檔案頁面即將推出',
  },
  yy = (e) => {
    switch (e) {
      case 'resident':
        return Ge.ROLE_RESIDENT;
      case 'agent':
        return Ge.ROLE_AGENT;
      case 'official':
        return Ge.ROLE_OFFICIAL;
      case 'guest':
        return Ge.ROLE_GUEST;
      default:
        return Ge.ROLE_MEMBER;
    }
  };
function fs({ mode: e, title: t, className: r = '', notificationCount: n = 0 }) {
  var f, g;
  const { isAuthenticated: a, user: i, signOut: o, role: l } = Ct(),
    [c, d] = h.useState(!1),
    m = async () => {
      try {
        (await o(),
          W.success(Ge.MSG_LOGOUT_SUCCESS, Ge.MSG_LOGOUT_DESC),
          d(!1),
          (window.location.href = ve.HOME));
      } catch (b) {
        (console.error('Logout failed:', b), W.error(Ge.MSG_LOGOUT_ERROR, Ge.MSG_LOGOUT_RETRY));
      }
    };
  h.useEffect(() => {
    const b = (y) => {
      const p = y.target;
      !p.closest('#gh-user-menu-btn') && !p.closest('#gh-user-menu-dropdown') && d(!1);
    };
    return (document.addEventListener('click', b), () => document.removeEventListener('click', b));
  }, []);
  const u = () => {
      let b = ve.HOME;
      return (
        l === 'agent'
          ? (b = ve.FEED_AGENT)
          : (l === 'resident' || l === 'member') && (b = ve.FEED_CONSUMER),
        s.jsxs('div', {
          className: 'flex items-center gap-2',
          children: [
            s.jsx(ac, { showSlogan: !1, href: b, showBadge: !0 }),
            e === 'agent' &&
              s.jsx('span', {
                className:
                  'rounded bg-gradient-to-br from-amber-400 to-amber-600 px-2 py-0.5 text-[10px] font-extrabold text-white shadow-sm',
                children: Ge.AGENT_BADGE,
              }),
          ],
        })
      );
    },
    x = () =>
      e === 'community' && t
        ? s.jsxs('div', {
            className: 'flex-1 text-center',
            children: [
              s.jsx('h1', {
                className: 'text-brand-900 m-0 text-base font-extrabold',
                children: t,
              }),
              s.jsx('p', {
                className: 'text-ink-500 m-0 text-[11px]',
                children: Ge.SUBTITLE_WALL,
              }),
            ],
          })
        : s.jsx('div', { className: 'flex-1' });
  return s.jsx('header', {
    className: `sticky top-0 z-overlay border-b border-brand-100 bg-white/95 backdrop-blur-md transition-all ${r}`,
    children: s.jsxs('div', {
      className: 'mx-auto flex h-16 max-w-[1120px] items-center justify-between gap-2.5 px-4',
      children: [
        u(),
        x(),
        s.jsxs('div', {
          className: 'flex items-center gap-3',
          children: [
            s.jsxs('button', {
              className:
                'relative inline-flex items-center justify-center rounded-xl border border-brand-100 bg-white p-2 text-brand-700 transition-all hover:bg-brand-50',
              'aria-label': Ge.LABEL_NOTIFICATIONS,
              children: [
                s.jsx(Zd, { size: 18, strokeWidth: 2.5 }),
                n > 0 &&
                  s.jsx('span', {
                    className:
                      'absolute -right-1 -top-1 flex h-[16px] min-w-[16px] items-center justify-center rounded-full border-2 border-white bg-red-600 text-[10px] font-bold text-white shadow-sm',
                    children: n > 99 ? '99+' : n,
                  }),
              ],
            }),
            a
              ? s.jsxs('div', {
                  className: 'relative',
                  children: [
                    s.jsxs('button', {
                      id: 'gh-user-menu-btn',
                      onClick: () => d(!c),
                      className:
                        'flex items-center gap-1.5 rounded-xl border border-brand-100 bg-white py-1 pl-1 pr-2.5 transition-all hover:bg-brand-50 hover:shadow-sm active:scale-95',
                      'aria-label': Ge.LABEL_AVATAR,
                      'aria-expanded': c,
                      children: [
                        s.jsx('div', {
                          className:
                            'flex size-7 items-center justify-center rounded-full bg-brand-50 text-xs font-bold text-brand-700 ring-1 ring-brand-100',
                          children:
                            ((f = i == null ? void 0 : i.email) == null
                              ? void 0
                              : f.charAt(0).toUpperCase()) || 'U',
                        }),
                        s.jsx('span', {
                          className:
                            'hidden max-w-[80px] truncate text-xs font-bold text-brand-700 md:block',
                          children:
                            ((g = i == null ? void 0 : i.user_metadata) == null
                              ? void 0
                              : g.name) || '我的',
                        }),
                        s.jsx(Yd, {
                          size: 14,
                          className: `text-brand-400 transition-transform ${c ? 'rotate-180' : ''}`,
                        }),
                      ],
                    }),
                    c &&
                      s.jsxs('div', {
                        id: 'gh-user-menu-dropdown',
                        className:
                          'animate-in fade-in zoom-in-95 absolute right-0 top-full mt-2 w-48 origin-top-right rounded-xl border border-brand-100 bg-white p-1 shadow-xl ring-1 ring-black/5 duration-100 focus:outline-none',
                        role: 'menu',
                        children: [
                          s.jsxs('div', {
                            className: 'mb-1 border-b border-gray-50 px-3 py-2',
                            children: [
                              s.jsx('p', {
                                className: 'text-brand-900 truncate text-xs font-bold',
                                children: i == null ? void 0 : i.email,
                              }),
                              s.jsx('p', {
                                className: 'text-[10px] text-gray-500',
                                children: yy(l),
                              }),
                            ],
                          }),
                          s.jsxs('button', {
                            className:
                              'flex w-full items-center gap-2 rounded-lg px-3 py-2 text-sm font-bold text-gray-700 transition-colors hover:bg-brand-50 hover:text-brand-700',
                            role: 'menuitem',
                            onClick: () => {
                              const b = ve.FEED_CONSUMER,
                                y = 'profile';
                              (location.pathname === b ||
                              location.pathname.includes('/feed/consumer')
                                ? ((window.location.hash = y),
                                  window.dispatchEvent(new HashChangeEvent('hashchange')),
                                  window.scrollTo({
                                    top: 0,
                                    behavior: 'smooth',
                                  }))
                                : (window.location.href = `${b}#${y}`),
                                d(!1));
                            },
                            children: [s.jsx(Qn, { size: 16 }), Ge.MENU_PROFILE],
                          }),
                          s.jsxs('button', {
                            onClick: m,
                            className:
                              'flex w-full items-center gap-2 rounded-lg px-3 py-2 text-sm font-bold text-red-600 transition-colors hover:bg-red-50',
                            role: 'menuitem',
                            children: [s.jsx(qd, { size: 16 }), Ge.BTN_LOGOUT],
                          }),
                        ],
                      }),
                  ],
                })
              : s.jsxs('a', {
                  href: '/maihouses/auth.html?mode=login',
                  className:
                    'flex items-center gap-1 rounded-xl bg-brand-700 px-3 py-1.5 text-xs font-bold text-white shadow-sm transition-all hover:bg-brand-600 hover:shadow-md active:scale-95',
                  children: [
                    s.jsx(Qn, { size: 14, strokeWidth: 2.5 }),
                    s.jsx('span', { children: Ge.BTN_LOGIN }),
                  ],
                }),
          ],
        }),
      ],
    }),
  });
}
const P = {
  FEED: {
    TITLE: '我的社區',
    PAGE_TITLE: '邁房子｜我的社區',
    PROFILE: {
      STATS_DAYS: '互動天數',
      STATS_LIKED: '被感謝',
      STATS_CONTRIB: '貢獻篇數',
      LEVEL_RESIDENT: '黃金住戶',
      LEVEL_AGENT: '認證房仲',
      LEVEL_MEMBER: '社區成員',
      FROM: (e) => `來自【${e}】`,
      FROM_MY_COMMUNITY: '來自【我的社區】',
      VIEW_WALL: '🧱 查看我的社區牆',
    },
    TX_BANNER: { TITLE: '您有一筆交易進行中', ENTER_BTN: '進入戰情室' },
    SIDEBAR: {
      NAV_TITLE: '快速導航',
      HOT_TITLE: '社區動態',
      SALE_TITLE: '待售物件',
      VIEW_ALL: '查看全部',
      HOT_EMPTY: '暫無熱門貼文',
      SALE_EMPTY: '暫無待售物件',
      HOT_NEW_POSTS: '本週新增',
      HOT_POSTS_UNIT: '篇貼文',
      HOT_ACTIVE_COMMUNITIES: '活躍社區',
      HOT_COMMUNITIES_UNIT: '個',
      SALE_PREFIX: '目前有',
      SALE_SUFFIX: '戶待售',
    },
    DEFAULT_USER: 'Mike',
    DEFAULT_COMMUNITY_NAME: '惠宇上晴',
    DEFAULT_COMMUNITY_ID: 'test-uuid',
    DEFAULT_COMMUNITY_LABEL: '社區',
    NOTIFY: {
      LOGIN_REQUIRED: '請先登入',
      LOGIN_REQUIRED_LIKE: '登入後才能按讚',
      LOGIN_REQUIRED_POST: '登入後才能發文',
      LIKE_FAILED: '按讚失敗',
      LIKE_FAILED_DESC: '請稍後再試',
      FEATURE_WIP: '功能開發中',
      REPLY_WIP: '回覆功能即將上線',
      SHARE_WIP: '分享功能即將上線',
      COMMENT_SUCCESS: '留言成功',
      COMMENT_SUCCESS_DESC: '您的留言已發佈',
    },
    POST: {
      LIKE_BTN: '讚',
      LIKED_BTN: '已讚',
      REPLY_BTN: '回覆',
      SHARE_BTN: '分享',
      SHOW_MORE: '查看更多',
      SHOW_LESS: '收起',
      TIME_JUST_NOW: '剛剛',
      TIME_MINUTES_AGO: (e) => `${e} 分鐘前`,
      TIME_HOURS_AGO: (e) => `${e} 小時前`,
      TIME_DAYS_AGO: (e) => `${e} 天前`,
      BADGE_AGENT: '房仲',
      BADGE_OFFICIAL: '公告',
      VIEWS: (e) => `${e} 次瀏覽`,
      PINNED: '可預約看屋',
      COMMENT_SUCCESS: { TITLE: '留言成功', DESC: '您的留言已發佈' },
    },
    AI_INSIGHT: {
      TITLE: 'AI 社區洞察',
      PUBLIC_RATIO: '公開討論比例',
      COMMUNITY_RATING: '社區評分',
      ACTIVITY_SCORE: '活躍度',
    },
    NAV: {
      HOME: '首頁',
      COMMUNITY: '我的社區',
      NOTIFICATIONS: '通知',
      PROFILE: '個人',
    },
    EMPTY: { TITLE: '還沒有貼文', DESC: '成為第一個發布貼文的人吧！' },
    TABS: { PUBLIC: '公開牆', PRIVATE: '私密牆' },
    ERROR: { LOAD_FAILED: '載入失敗', RETRY: '重試' },
  },
  COMPOSER: {
    LOGIN_TITLE: '請先登入',
    LOGIN_DESC: '登入後即可參與討論與發布貼文',
    CANCEL: '取消',
    GO_LOGIN: '前往登入',
    TITLE_PRIVATE: '🔐 私密貼文',
    TITLE_PUBLIC: '✏️ 發布貼文',
    CLOSE: '關閉',
    CLOSE_ICON: '✕',
    VISIBILITY_PUBLIC: '🌍 公開牆',
    VISIBILITY_PRIVATE: '🔐 住戶專屬',
    PLACEHOLDER_COMMUNITY_PRIVATE: '分享只有住戶能看到的內容...',
    PLACEHOLDER_COMMUNITY_PUBLIC: '分享你的想法、社區生活...',
    PLACEHOLDER_FEED: '分享你的新鮮事...',
    UPLOAD_IMAGE: '📷 上傳圖片',
    UPLOAD_IMAGE_DEV: '圖片上傳功能開發中',
    SUBMIT: '發布',
    SUBMITTING: '發布中...',
    SUCCESS: '發布成功！',
    ERROR_TITLE: '發布失敗',
  },
  COMMUNITY: {
    AGENT_BADGE: '認證房仲',
    OFFICIAL_BADGE: '官方公告',
    RESIDENT_BADGE_SUFFIX: ' 住戶',
    PRIVATE_POST_LABEL: '僅社區可見',
    BTN_MSG_AGENT: '私訊房仲',
    BTN_LIKE: '讚',
    BTN_LIKING: '處理中',
    BTN_REPLY: '回覆',
    BTN_REPLY_TOOLTIP: '功能開發中，敬請期待',
    BTN_REPLY_ARIA: '回覆功能開發中',
    BTN_POST_PUBLIC: '發布貼文',
    BTN_POST_PRIVATE: '發布私密貼文',
    SECTION_TITLE: '社區熱帖',
    TAB_PUBLIC: '公開牆',
    TAB_PRIVATE: '私密牆',
    MSG_AGENT_VIEW_ONLY: '房仲可查看私密牆，但無法發文',
    LOCKED_TITLE: '私密牆僅限本社區住戶查看',
    LOCKED_DESC_GUEST: '請先登入或註冊',
    LOCKED_DESC_USER: '驗證住戶身份後即可加入討論',
    BTN_UNLOCK_GUEST: '免費註冊 / 登入',
    BTN_UNLOCK_USER: '我是住戶，驗證身份',
    NOTIFY_LOGIN_TITLE: '請先登入或註冊',
    NOTIFY_LOGIN_DESC: '登入後才能發布貼文',
    NOTIFY_PERM_ERROR: '目前無法發文',
    NOTIFY_PERM_CHECK: '請確認帳號權限或稍後再試',
    NOTIFY_PRIVATE_ONLY: '僅住戶可發佈私密貼文',
    NOTIFY_PRIVATE_ACCESS_DENIED: '請先登入或註冊',
    NOTIFY_PRIVATE_ACCESS_DENIED_DESC: '登入/註冊後可查看私密牆',
    NOTIFY_VERIFY_REQUIRED: '請完成住戶驗證',
    NOTIFY_VERIFY_REQUIRED_DESC: '上傳水電帳單或管理費收據後即可查看',
    LOCKED_OVERLAY_COUNT_LABEL: '則貼文',
    LOCKED_OVERLAY_BENEFIT_1: '查看完整動態',
    LOCKED_OVERLAY_BENEFIT_2: '新回應通知',
  },
  VALIDATION: {
    MIN_LENGTH: (e) => `內容至少需要 ${e} 個字`,
    MAX_LENGTH: (e) => `內容不能超過 ${e} 個字`,
    SUBMIT_ERROR: '發布失敗',
  },
  WALL_STATES: {
    ERROR_TITLE: '發生錯誤',
    ERROR_DEFAULT: '載入失敗，請稍後再試',
    RETRY: '重試',
    EMPTY_TITLE: '這裡空空的',
    EMPTY_DEFAULT: '目前沒有任何貼文',
    LOADING_LABEL: '載入中...',
  },
  AGENT: {
    ROLE: { AGENT: '房仲', CONSUMER: '住戶' },
    OOS: {
      SWITCH_TO_CONSUMER: '切換至消費者視角',
      SWITCH_TO_AGENT: '切換至房仲視角',
    },
    PROFILE: {
      FROM_STORE: '來自21世紀河南店',
      BADGE_GOLD: '黃金住戶',
      BADGE_VERIFIED: '認證房仲',
      LINK_WORKBENCH: '🏷️ 業務後台',
      LINK_WALL: '🧱 前往我的社區牆 ➡️',
      STATS_SCORE: '📊 積分',
      STATS_DAYS: '📅 互動',
      STATS_LIKED: '❤️ 被感謝',
    },
    SIDEBAR: {
      NAV_TITLE: '🧭 快速導航',
      LINK_UAG: '📊 客戶工作臺',
      LINK_STATS: '📈 業績統計',
      LINK_TRUST: '🛡️ 安心留痕',
      LINK_WALL: '🧱 我的社區牆',
      PERF_TITLE: '📊 業績總覽',
      PERF_DEAL_COUNT_PREFIX: '本月成交',
      PERF_DEAL_COUNT_UNIT: '件',
      PERF_AMOUNT_PREFIX: '成交金額',
      PERF_CLIENTS_PREFIX: '服務中客戶',
      PERF_CLIENTS_UNIT: '位',
      TODO_TITLE: '🎯 今日待辦',
      TODO_EMPTY: '無待辦事項',
    },
    UAG: {
      TITLE: 'UAG 精準獲客',
      LINK_WORKBENCH: '查看全部',
      CARD_PREDICT: '預測需求：',
      CARD_UNIT: '單元二三房',
      CARD_BUDGET: '總價 1,600–1,900 萬',
      CARD_PREF: '願看 12F 以上',
    },
    TRUST: {
      TITLE: '安心留痕',
      DESC_1: '11:30–12:05 帶看完成。簽到、位置軌跡、現場照片 3 張與對話摘要已留存。',
      DESC_2: '憑證號 MJ-2025-11-10-0007。僅你與 買方 可見（個資受保護）。',
      TAG_COMPLETED: '帶看完成',
      TAG_CERT: '留痕憑證',
      TAG_PRIVATE: '僅雙方可見',
      BTN_LIKE: '👍 讚',
      BTN_REPLY: '💬 回覆',
      BTN_DETAIL: '➡️ 看詳情',
    },
  },
};
function Qc(e) {
  const t = Date.now(),
    r = new Date(e).getTime(),
    n = t - r;
  if (isNaN(r)) return '';
  if (n < 0) return P.FEED.POST.TIME_JUST_NOW;
  const a = Math.floor(n / (1e3 * 60)),
    i = Math.floor(n / (1e3 * 60 * 60)),
    o = Math.floor(n / (1e3 * 60 * 60 * 24));
  return a < 1
    ? P.FEED.POST.TIME_JUST_NOW
    : a < 60
      ? P.FEED.POST.TIME_MINUTES_AGO(a)
      : i < 24
        ? P.FEED.POST.TIME_HOURS_AGO(i)
        : P.FEED.POST.TIME_DAYS_AGO(o);
}
const vy = ({ comments: e }) =>
    !e || e.length === 0
      ? null
      : s.jsx('div', {
          className: 'mt-4 space-y-4 border-t border-gray-100/50 pt-4',
          children: e.map((t) =>
            s.jsxs(
              'div',
              {
                className: 'flex gap-3',
                children: [
                  s.jsx('div', {
                    className:
                      'flex size-8 shrink-0 items-center justify-center rounded-full bg-indigo-50 text-xs font-medium text-indigo-600',
                    children: t.author.charAt(0),
                  }),
                  s.jsxs('div', {
                    className: 'flex-1 space-y-1',
                    children: [
                      s.jsxs('div', {
                        className:
                          'inline-block max-w-[90%] rounded-2xl rounded-tl-none bg-gray-50 px-4 py-2.5',
                        children: [
                          s.jsxs('div', {
                            className: 'mb-0.5 flex items-center gap-2',
                            children: [
                              s.jsx('span', {
                                className: 'text-sm font-semibold text-gray-900',
                                children: t.author,
                              }),
                              t.role === 'agent' &&
                                s.jsx('span', {
                                  className:
                                    'rounded-full bg-indigo-100 px-1.5 py-0.5 text-[10px] font-medium text-indigo-600',
                                  children: '房仲',
                                }),
                              t.role === 'resident' &&
                                s.jsx('span', {
                                  className:
                                    'rounded-full bg-emerald-100 px-1.5 py-0.5 text-[10px] font-medium text-emerald-600',
                                  children: '住戶',
                                }),
                            ],
                          }),
                          s.jsx('p', {
                            className:
                              'whitespace-pre-wrap text-[14px] leading-relaxed text-gray-700',
                            children: t.content,
                          }),
                        ],
                      }),
                      s.jsxs('div', {
                        className: 'flex items-center gap-4 px-1',
                        children: [
                          s.jsx('span', {
                            className: 'text-xs text-gray-400',
                            children: Qc(t.time),
                          }),
                          s.jsx('button', {
                            className:
                              'text-xs font-medium text-gray-500 transition-colors hover:text-gray-800',
                            children: '讚',
                          }),
                          t.likes > 0 &&
                            s.jsxs('span', {
                              className: 'flex items-center gap-1 text-xs text-gray-400',
                              children: ['• ', t.likes, ' 個讚'],
                            }),
                        ],
                      }),
                    ],
                  }),
                ],
              },
              t.id
            )
          ),
        }),
  jy = ({
    onSubmit: e,
    placeholder: t = '寫下您的留言...',
    userInitial: r = 'U',
    disabled: n = !1,
  }) => {
    const [a, i] = h.useState(''),
      [o, l] = h.useState(!1),
      c = async (m) => {
        if ((m.preventDefault(), !(!a.trim() || o))) {
          l(!0);
          try {
            (await e(a), i(''));
          } finally {
            l(!1);
          }
        }
      },
      d = (m) => {
        m.key === 'Enter' && !m.shiftKey && (m.preventDefault(), c(m));
      };
    return s.jsxs('form', {
      onSubmit: c,
      className: 'mt-4 flex gap-3 border-t border-gray-100/50 pt-4',
      children: [
        s.jsx('div', {
          className:
            'flex size-8 shrink-0 items-center justify-center rounded-full bg-gradient-to-tr from-indigo-500 to-indigo-600 text-xs font-semibold text-white shadow-sm',
          children: r,
        }),
        s.jsxs('div', {
          className: 'group relative flex-1',
          children: [
            s.jsx('textarea', {
              value: a,
              onChange: (m) => i(m.target.value),
              onKeyDown: d,
              placeholder: t,
              disabled: n || o,
              rows: 1,
              className:
                'min-h-[42px] w-full resize-none overflow-hidden rounded-[20px] border border-transparent bg-gray-50 px-4 py-2.5 text-[14px] text-gray-800 outline-none ring-0 transition-all hover:bg-gray-100 focus:border-indigo-500/30 focus:bg-white focus:ring-4 focus:ring-indigo-500/10',
              style: { height: 'auto', minHeight: '42px' },
            }),
            s.jsx('div', {
              className: 'absolute right-2 top-1.5 flex items-center gap-1',
              children:
                a.trim() &&
                s.jsx('button', {
                  type: 'submit',
                  disabled: n || o,
                  className:
                    'flex size-8 items-center justify-center rounded-full bg-indigo-600 p-1.5 text-white shadow-sm transition-all hover:bg-indigo-700 hover:shadow-md disabled:cursor-not-allowed disabled:opacity-50',
                  children: o
                    ? s.jsxs('svg', {
                        className: 'size-4 animate-spin',
                        viewBox: '0 0 24 24',
                        children: [
                          s.jsx('circle', {
                            className: 'opacity-25',
                            cx: '12',
                            cy: '12',
                            r: '10',
                            stroke: 'currentColor',
                            strokeWidth: '4',
                            fill: 'none',
                          }),
                          s.jsx('path', {
                            className: 'opacity-75',
                            fill: 'currentColor',
                            d: 'M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z',
                          }),
                        ],
                      })
                    : s.jsx('svg', {
                        className: 'size-4 transition-transform group-hover:translate-x-0.5',
                        fill: 'none',
                        viewBox: '0 0 24 24',
                        stroke: 'currentColor',
                        children: s.jsx('path', {
                          strokeLinecap: 'round',
                          strokeLinejoin: 'round',
                          strokeWidth: 2.5,
                          d: 'M5 12h14M12 5l7 7-7 7',
                        }),
                      }),
                }),
            }),
          ],
        }),
      ],
    });
  },
  Wt = P.FEED.POST;
function wy(e) {
  switch (e) {
    case 'agent':
      return 'bg-amber-100 text-amber-700 ring-amber-200';
    case 'official':
      return 'bg-brand-700 text-white ring-brand-300';
    default:
      return 'bg-brand-50 text-brand-700 ring-brand-100';
  }
}
function Ny(e) {
  switch (e) {
    case 'agent':
      return Wt.BADGE_AGENT;
    case 'official':
      return Wt.BADGE_OFFICIAL;
    default:
      return null;
  }
}
const ka = h.memo(function ({
    post: t,
    isLiked: r = !1,
    onLike: n,
    onReply: a,
    onShare: i,
    onComment: o,
    className: l = '',
  }) {
    const [c, d] = h.useState(!1),
      [m, u] = h.useState(!1),
      x = h.useCallback(async () => {
        if (!(!n || c)) {
          d(!0);
          try {
            await n(t.id);
          } finally {
            d(!1);
          }
        }
      }, [n, t.id, c]),
      f = () => {
        (u(!m), a == null || a(t.id));
      },
      g = async (E) => {
        o && (await o(t.id, E));
      },
      b = wy(t.type),
      y = Ny(t.type),
      p = t.author.charAt(0).toUpperCase();
    return s.jsxs('article', {
      className: `rounded-2xl border border-brand-100 bg-white p-4 shadow-sm transition-all hover:shadow-md ${l}`,
      children: [
        s.jsxs('div', {
          className: 'flex items-center gap-3 border-b border-gray-50 pb-3',
          children: [
            s.jsx('div', {
              className: `flex size-10 shrink-0 items-center justify-center rounded-full text-sm font-bold ring-1 ${b}`,
              'aria-hidden': 'true',
              children: p,
            }),
            s.jsxs('div', {
              className: 'min-w-0 flex-1',
              children: [
                s.jsxs('div', {
                  className: 'flex items-center gap-2',
                  children: [
                    s.jsx('span', {
                      className: 'truncate text-sm font-bold text-gray-900',
                      children: t.author,
                    }),
                    t.floor &&
                      s.jsx('span', {
                        className: 'text-xs text-gray-500',
                        children: t.floor,
                      }),
                    y &&
                      s.jsx('span', {
                        className:
                          'rounded bg-amber-100 px-1.5 py-0.5 text-[10px] font-bold text-amber-700',
                        children: y,
                      }),
                  ],
                }),
                s.jsxs('div', {
                  className: 'flex items-center gap-2 text-xs text-gray-500',
                  children: [
                    t.communityName &&
                      s.jsx('span', {
                        className: 'truncate',
                        children: t.communityName,
                      }),
                    s.jsx('span', { children: '·' }),
                    s.jsx('span', { children: Qc(t.time) }),
                  ],
                }),
              ],
            }),
          ],
        }),
        s.jsxs('div', {
          className: 'pt-3',
          children: [
            t.title &&
              s.jsx('h3', {
                className: 'mb-1 text-sm font-bold text-gray-900',
                children: t.title,
              }),
            s.jsx('p', {
              className: 'whitespace-pre-wrap text-sm leading-relaxed text-gray-700',
              children: t.content,
            }),
            t.images &&
              t.images.length > 0 &&
              s.jsx('div', {
                className: `mt-3 ${t.images.length === 1 ? 'block' : 'grid grid-cols-2 gap-2'}`,
                children: t.images.map((E, S) => {
                  var N;
                  return s.jsx(
                    'div',
                    {
                      className: 'relative overflow-hidden rounded-lg bg-gray-100',
                      children: s.jsx('img', {
                        src: E.src,
                        alt: E.alt,
                        loading: 'lazy',
                        onError: (k) => {
                          var C, w;
                          ((k.currentTarget.style.display = 'none'),
                            (C = k.currentTarget.parentElement) == null ||
                              C.classList.add(
                                'flex',
                                'items-center',
                                'justify-center',
                                'min-h-[200px]'
                              ));
                          const T = document.createElement('span');
                          ((T.textContent = '無法載入圖片'),
                            (T.className = 'text-xs text-gray-400 font-medium'),
                            (w = k.currentTarget.parentElement) == null || w.appendChild(T));
                        },
                        className: `object-cover transition-opacity duration-300 ${((N = t.images) == null ? void 0 : N.length) === 1 ? 'max-h-80 w-full' : 'aspect-square w-full'}`,
                      }),
                    },
                    `${t.id}-img-${S}`
                  );
                }),
              }),
          ],
        }),
        s.jsxs('div', {
          className: 'mt-4 flex items-center gap-2 border-t border-gray-50 pt-3',
          children: [
            s.jsxs('button', {
              type: 'button',
              onClick: x,
              disabled: c,
              'aria-pressed': r,
              className: `inline-flex items-center gap-1.5 rounded-lg border px-3 py-1.5 text-xs font-bold transition-all active:scale-95 disabled:cursor-not-allowed disabled:opacity-60 ${r ? 'border-red-200 bg-red-50 text-red-600' : 'border-gray-200 bg-white text-gray-600 hover:bg-gray-50'}`,
              children: [
                s.jsx(La, { size: 14, fill: r ? 'currentColor' : 'none' }),
                s.jsx('span', { children: r ? Wt.LIKED_BTN : Wt.LIKE_BTN }),
                typeof t.likes == 'number' &&
                  t.likes > 0 &&
                  s.jsx('span', {
                    className: 'ml-0.5 text-gray-500',
                    children: t.likes,
                  }),
              ],
            }),
            s.jsxs('button', {
              type: 'button',
              onClick: f,
              className: `inline-flex items-center gap-1.5 rounded-lg border px-3 py-1.5 text-xs font-bold transition-all active:scale-95 ${m ? 'border-indigo-200 bg-indigo-50 text-indigo-600' : 'border-gray-200 bg-white text-gray-600 hover:bg-gray-50'}`,
              children: [
                s.jsx($t, { size: 14, fill: m ? 'currentColor' : 'none' }),
                s.jsx('span', { children: Wt.REPLY_BTN }),
                typeof t.comments == 'number' &&
                  t.comments > 0 &&
                  s.jsx('span', {
                    className: 'ml-0.5 text-gray-500',
                    children: t.comments,
                  }),
              ],
            }),
            s.jsxs('button', {
              type: 'button',
              onClick: () => (i == null ? void 0 : i(t.id)),
              className:
                'ml-auto inline-flex items-center gap-1.5 rounded-lg border border-gray-200 bg-white px-3 py-1.5 text-xs font-bold text-gray-600 transition-all hover:bg-gray-50 active:scale-95',
              children: [s.jsx(Oa, { size: 14 }), s.jsx('span', { children: Wt.SHARE_BTN })],
            }),
          ],
        }),
        t.type === 'agent' &&
          typeof t.views == 'number' &&
          s.jsxs('div', {
            className: 'mt-2 flex items-center gap-4 text-xs text-gray-500',
            children: [
              s.jsxs('span', {
                className: 'flex items-center gap-1',
                children: [s.jsx(sn, { size: 12 }), Wt.VIEWS(t.views)],
              }),
              t.pinned &&
                s.jsxs('span', {
                  className: 'flex items-center gap-1',
                  children: [s.jsx(as, { size: 12 }), Wt.PINNED],
                }),
            ],
          }),
        m &&
          s.jsxs('div', {
            className: 'animate-fade-in',
            children: [s.jsx(vy, { comments: t.commentList || [] }), s.jsx(jy, { onSubmit: g })],
          }),
      ],
    });
  }),
  Gn = P.FEED.PROFILE;
function _y(e) {
  switch (e) {
    case 'resident':
      return P.FEED.PROFILE.LEVEL_RESIDENT;
    case 'agent':
      return P.FEED.PROFILE.LEVEL_AGENT;
    default:
      return P.FEED.PROFILE.LEVEL_MEMBER;
  }
}
function ky(e) {
  switch (e) {
    case 'resident':
      return 'bg-amber-100 text-amber-700 border-amber-300';
    case 'agent':
      return 'bg-blue-100 text-blue-700 border-blue-300';
    default:
      return 'bg-gray-100 text-gray-700 border-gray-300';
  }
}
const Sy = h.memo(function ({ profile: t, className: r = '' }) {
    const n = t.name.charAt(0).toUpperCase(),
      a = _y(t.role),
      i = ky(t.role);
    return s.jsxs('section', {
      className: `rounded-2xl border border-brand-100 bg-white p-4 shadow-sm ${r}`,
      children: [
        s.jsxs('div', {
          className: 'flex items-center gap-3.5',
          children: [
            s.jsx('div', {
              className:
                'flex size-14 shrink-0 items-center justify-center rounded-full bg-gradient-to-br from-brand-50 to-white text-xl font-black text-brand-700 ring-1 ring-brand-100',
              'aria-hidden': 'true',
              children: n,
            }),
            s.jsxs('div', {
              className: 'min-w-0 flex-1',
              children: [
                s.jsx('h3', {
                  className: 'truncate text-lg font-black text-gray-900',
                  children: t.name,
                }),
                s.jsxs('p', {
                  className: 'flex items-center gap-2 text-sm text-gray-500',
                  children: [
                    s.jsx('span', {
                      className: 'truncate',
                      children: P.FEED.PROFILE.FROM(t.communityName || '我的社區'),
                    }),
                    s.jsxs('span', {
                      className: `inline-flex items-center rounded px-1.5 py-0.5 text-[10px] font-bold ${i}`,
                      children: ['👑 ', a],
                    }),
                  ],
                }),
              ],
            }),
          ],
        }),
        s.jsxs('div', {
          className: 'mt-4 flex flex-wrap gap-2',
          children: [
            s.jsxs('span', {
              className:
                'inline-flex items-center rounded-full border border-emerald-200 bg-gradient-to-b from-emerald-50 to-emerald-100 px-2.5 py-1 text-xs font-bold text-emerald-700',
              children: ['📅 ', Gn.STATS_DAYS, ' ', t.stats.days, ' 天'],
            }),
            s.jsxs('span', {
              className:
                'inline-flex items-center rounded-full border border-emerald-200 bg-gradient-to-b from-emerald-50 to-emerald-100 px-2.5 py-1 text-xs font-bold text-emerald-700',
              children: ['❤️ ', Gn.STATS_LIKED, ' ', t.stats.liked],
            }),
            s.jsxs('span', {
              className:
                'inline-flex items-center rounded-full border border-emerald-200 bg-gradient-to-b from-emerald-50 to-emerald-100 px-2.5 py-1 text-xs font-bold text-emerald-700',
              children: ['✍️ ', Gn.STATS_CONTRIB, ' ', t.stats.contributions, ' 篇'],
            }),
          ],
        }),
        t.communityId &&
          s.jsx('div', {
            className: 'mt-4 flex justify-end',
            children: s.jsxs('a', {
              href: `${ve.COMMUNITY_WALL(t.communityId)}?from=consumer`,
              className:
                'inline-flex items-center gap-1 rounded-full border border-blue-200 bg-blue-50 px-3 py-1.5 text-xs font-bold text-brand-700 transition-all hover:bg-blue-100 hover:shadow-sm active:scale-95',
              children: [P.FEED.PROFILE.VIEW_WALL, s.jsx(yl, { size: 14 })],
            }),
          }),
      ],
    });
  }),
  Hn = P.FEED.TX_BANNER;
function Ey(e) {
  switch (e) {
    case 'negotiation':
      return '斡旋階段';
    case 'contract':
      return '簽約階段';
    case 'loan':
      return '貸款階段';
    case 'closing':
      return '交屋階段';
    default:
      return '進行中';
  }
}
const Ty = h.memo(function ({ transaction: t, className: r = '' }) {
    if (!t.hasActive) return null;
    const n = Ey(t.stage);
    return s.jsx('div', {
      className: `mx-auto max-w-[1120px] px-4 ${r}`,
      children: s.jsxs('div', {
        className:
          'flex items-center gap-3 rounded-xl border border-cyan-300 bg-gradient-to-r from-cyan-50 to-cyan-100 p-3 shadow-sm',
        role: 'region',
        'aria-label': Hn.TITLE,
        children: [
          s.jsx('div', {
            className:
              'flex size-10 shrink-0 items-center justify-center rounded-lg bg-white text-xl shadow-sm',
            children: s.jsx(Qe, { className: 'size-5 text-cyan-600' }),
          }),
          s.jsxs('div', {
            className: 'min-w-0 flex-1',
            children: [
              s.jsx('p', {
                className: 'text-sm font-bold text-cyan-800',
                children: Hn.TITLE,
              }),
              s.jsxs('p', {
                className: 'truncate text-xs text-cyan-700',
                children: [
                  t.propertyName || '物件',
                  s.jsx('span', { className: 'mx-1', children: '·' }),
                  n,
                ],
              }),
            ],
          }),
          s.jsxs('a', {
            href: ve.ASSURE,
            className:
              'inline-flex shrink-0 items-center gap-1 rounded-full bg-cyan-600 px-3 py-1.5 text-xs font-bold text-white shadow-sm transition-all hover:bg-cyan-700 active:scale-95',
            children: [Hn.ENTER_BTN, s.jsx(It, { size: 14 })],
          }),
        ],
      }),
    });
  }),
  st = P.FEED.SIDEBAR,
  Iy = [
    {
      id: 'my-community',
      label: '我的社區牆',
      icon: s.jsx(Qe, { size: 16 }),
      href: '#my-community',
    },
    {
      id: 'explore',
      label: '探索其他社區',
      icon: s.jsx(tn, { size: 16 }),
      href: '#explore',
    },
    {
      id: 'fav',
      label: '我的收藏',
      icon: s.jsx(jn, { size: 16 }),
      href: '#fav',
    },
    {
      id: 'history',
      label: '瀏覽紀錄',
      icon: s.jsx(hr, { size: 16 }),
      href: '#history',
    },
  ];
function vr({ title: e, children: t }) {
  return s.jsxs('div', {
    className: 'rounded-xl border border-brand-100 bg-white p-3.5 shadow-sm',
    children: [
      s.jsx('h4', {
        className: 'mb-2.5 text-sm font-bold text-brand-700',
        children: e,
      }),
      t,
    ],
  });
}
function Cy({ activeNav: e }) {
  return s.jsx('nav', {
    className: 'flex flex-col gap-1',
    children: Iy.map((t) => {
      const r = e === t.id;
      return s.jsxs(
        'a',
        {
          href: t.href,
          className: `flex items-center gap-2 rounded-lg px-3 py-2 text-sm font-semibold transition-all ${r ? 'bg-gradient-to-r from-brand-700 to-brand-600 text-white shadow-sm' : 'text-gray-700 hover:bg-brand-50'}`,
          children: [t.icon, s.jsx('span', { children: t.label })],
        },
        t.id
      );
    }),
  });
}
function Ay({ posts: e }) {
  if (!e || e.length === 0)
    return s.jsx(vr, {
      title: `📊 ${st.HOT_TITLE}`,
      children: s.jsx('p', {
        className: 'text-sm text-gray-500',
        children: st.HOT_EMPTY,
      }),
    });
  const t = e.length,
    r = new Set(e.map((n) => n.communityName)).size;
  return s.jsx(vr, {
    title: `📊 ${st.HOT_TITLE}`,
    children: s.jsxs('p', {
      className: 'text-sm leading-relaxed text-gray-600',
      children: [
        st.HOT_NEW_POSTS,
        ' ',
        s.jsx('span', { className: 'font-bold text-brand-700', children: t }),
        ' ',
        st.HOT_POSTS_UNIT,
        s.jsx('br', {}),
        st.HOT_ACTIVE_COMMUNITIES,
        ' ',
        s.jsx('span', { className: 'font-bold text-brand-700', children: r }),
        ' ',
        st.HOT_COMMUNITIES_UNIT,
      ],
    }),
  });
}
function Ly({ items: e }) {
  return !e || e.length === 0
    ? s.jsx(vr, {
        title: `🏠 ${st.SALE_TITLE}`,
        children: s.jsx('p', {
          className: 'text-sm text-gray-500',
          children: st.SALE_EMPTY,
        }),
      })
    : s.jsx(vr, {
        title: `🏠 ${st.SALE_TITLE}`,
        children: s.jsxs('p', {
          className: 'text-sm leading-relaxed text-gray-600',
          children: [
            st.SALE_PREFIX,
            ' ',
            s.jsx('span', {
              className: 'font-bold text-brand-700',
              children: e.length,
            }),
            ' ',
            st.SALE_SUFFIX,
            s.jsx('br', {}),
            s.jsxs('a', {
              href: '#sale-all',
              className: 'inline-flex items-center gap-0.5 text-xs text-brand-600 hover:underline',
              children: [st.VIEW_ALL, s.jsx(It, { size: 12 })],
            }),
          ],
        }),
      });
}
const Oy = h.memo(function ({ data: t, activeNav: r = 'my-community', className: n = '' }) {
    return s.jsxs('aside', {
      className: `sticky top-[72px] hidden w-[280px] shrink-0 flex-col gap-3 self-start lg:flex ${n}`,
      children: [
        s.jsx(vr, {
          title: `🧭 ${st.NAV_TITLE}`,
          children: s.jsx(Cy, { activeNav: r }),
        }),
        s.jsx(Ay, { posts: t == null ? void 0 : t.hotPosts }),
        s.jsx(Ly, { items: t == null ? void 0 : t.saleItems }),
      ],
    });
  }),
  Ry = 5 * 1024 * 1024,
  My = ['image/jpeg', 'image/png', 'image/webp'];
function Jc({ onSubmit: e, disabled: t, userInitial: r }) {
  const [n, a] = h.useState(''),
    [i, o] = h.useState(!1),
    [l, c] = h.useState(!1),
    [d, m] = h.useState([]),
    [u, x] = h.useState([]),
    f = h.useRef(null);
  h.useEffect(
    () => () => {
      u.forEach((p) => URL.revokeObjectURL(p));
    },
    [u]
  );
  const g = (p) => {
      if (p.target.files && p.target.files.length > 0) {
        const S = Array.from(p.target.files).filter((k) =>
          My.includes(k.type)
            ? k.size > Ry
              ? (W.error(`檔案過大 (超過 5MB): ${k.name}`), !1)
              : !0
            : (W.error(`檔案格式不支援: ${k.name}`), !1)
        );
        if (S.length === 0) return;
        if (d.length + S.length > 4) {
          W.error('最多只能上傳 4 張圖片');
          return;
        }
        const N = S.map((k) => URL.createObjectURL(k));
        (x((k) => [...k, ...N]), m((k) => [...k, ...S]));
      }
    },
    b = (p) => {
      const E = u[p];
      (E && URL.revokeObjectURL(E),
        x((S) => S.filter((N, k) => k !== p)),
        m((S) => S.filter((N, k) => k !== p)));
    },
    y = async () => {
      if (!((!n.trim() && d.length === 0) || l)) {
        c(!0);
        try {
          const p = n.trim();
          (d.length > 0 ? await e(p, d) : await e(p),
            a(''),
            m([]),
            o(!1),
            f.current && (f.current.value = ''),
            W.success(P.COMPOSER.SUCCESS));
        } catch (p) {
          (console.error('Failed to create post', p), W.error(P.COMPOSER.ERROR_TITLE));
        } finally {
          c(!1);
        }
      }
    };
  return s.jsx('div', {
    className: `rounded-2xl border bg-white p-3 shadow-sm transition-all ${i ? 'border-brand-200 shadow-md' : 'border-brand-100'}`,
    children: s.jsxs('div', {
      className: 'flex items-start gap-2.5',
      children: [
        s.jsx('div', {
          className:
            'flex size-9 shrink-0 items-center justify-center rounded-full bg-brand-50 text-sm font-bold text-brand-700 ring-1 ring-brand-100',
          children: r,
        }),
        s.jsxs('div', {
          className: 'flex-1 space-y-3',
          children: [
            s.jsx('textarea', {
              value: n,
              onChange: (p) => a(p.target.value),
              onFocus: () => o(!0),
              placeholder: P.COMPOSER.PLACEHOLDER_FEED,
              disabled: t,
              className:
                'focus:ring-brand-200 min-h-[40px] w-full resize-none rounded-xl border-0 bg-brand-50 px-3 py-2 text-sm leading-relaxed text-gray-800 outline-none transition-all placeholder:text-gray-400 focus:bg-white focus:ring-2',
              rows: i ? 3 : 1,
            }),
            u.length > 0 &&
              s.jsx('div', {
                className: 'flex flex-wrap gap-2',
                children: u.map((p, E) =>
                  s.jsxs(
                    'div',
                    {
                      className:
                        'relative size-16 overflow-hidden rounded-lg border border-gray-200',
                      children: [
                        s.jsx('img', {
                          src: p,
                          alt: 'Preview',
                          className: 'size-full object-cover',
                        }),
                        s.jsx('button', {
                          type: 'button',
                          onClick: () => b(E),
                          className:
                            'absolute right-0.5 top-0.5 rounded-full bg-black/50 p-0.5 text-white hover:bg-black/70',
                          children: s.jsx(is, { size: 12 }),
                        }),
                      ],
                    },
                    p
                  )
                ),
              }),
            i &&
              s.jsxs('div', {
                className: 'flex items-center justify-between pt-1',
                children: [
                  s.jsxs('div', {
                    className: 'flex gap-2',
                    children: [
                      s.jsxs('button', {
                        type: 'button',
                        onClick: () => {
                          var p;
                          return (p = f.current) == null ? void 0 : p.click();
                        },
                        className:
                          'flex items-center gap-1.5 rounded-full bg-gray-50 px-3 py-1.5 text-xs font-medium text-gray-600 hover:bg-gray-100',
                        disabled: t || l,
                        children: [s.jsx(Kd, { size: 14 }), s.jsx('span', { children: '圖片' })],
                      }),
                      s.jsx('input', {
                        type: 'file',
                        ref: f,
                        className: 'hidden',
                        accept: 'image/*',
                        multiple: !0,
                        onChange: g,
                      }),
                    ],
                  }),
                  s.jsx('button', {
                    type: 'button',
                    onClick: y,
                    disabled: t || l || (!n.trim() && d.length === 0),
                    className:
                      'rounded-full bg-brand-700 px-4 py-2 text-xs font-bold text-white shadow-sm transition-all hover:bg-brand-600 active:scale-95 disabled:cursor-not-allowed disabled:opacity-50',
                    children: l ? P.COMPOSER.SUBMITTING : P.COMPOSER.SUBMIT,
                  }),
                ],
              }),
          ],
        }),
        !i &&
          s.jsx('button', {
            type: 'button',
            onClick: y,
            disabled: t || l || !n.trim(),
            className:
              'shrink-0 rounded-full bg-brand-700 px-4 py-2 text-xs font-bold text-white shadow-sm transition-all hover:bg-brand-600 active:scale-95 disabled:cursor-not-allowed disabled:opacity-50',
            children: l ? P.COMPOSER.SUBMITTING : P.COMPOSER.SUBMIT,
          }),
      ],
    }),
  });
}
class Py extends h.Component {
  constructor() {
    (super(...arguments), (this.state = { hasError: !1 }));
  }
  static getDerivedStateFromError(t) {
    return { hasError: !0 };
  }
  componentDidCatch(t, r) {
    console.error('Uncaught error:', t, r);
  }
  render() {
    return this.state.hasError
      ? s.jsxs('div', {
          className: 'p-4 text-center',
          children: [
            s.jsx('h2', {
              className: 'text-xl font-bold text-red-600',
              children: 'Something went wrong',
            }),
            s.jsx('button', {
              className: 'mt-4 rounded bg-brand-600 px-4 py-2 text-white',
              onClick: () => this.setState({ hasError: !1 }),
              children: 'Try again',
            }),
          ],
        })
      : this.props.children;
  }
}
function Xa({ useMock: e, onToggle: t, disabled: r = !1 }) {
  const n = () => {
    r || t();
  };
  return s.jsx('button', {
    onClick: n,
    disabled: r,
    'aria-disabled': r,
    title: r ? '僅限內部測試時才可切換 Mock 模式' : void 0,
    className: `fixed bottom-5 left-5 z-[1000] flex items-center gap-1.5 rounded-xl bg-gradient-to-br from-[#1a1a2e] to-[#16213e] px-4 py-2.5 text-xs font-bold text-white shadow-[0_4px_20px_rgba(0,0,0,0.3)] ${r ? 'cursor-not-allowed opacity-60' : 'hover:brightness-110'}`,
    'aria-label': e ? '切換到 API 資料' : '切換到 Mock 資料',
    children: e ? '🧪 Mock 資料' : '🌐 API 資料',
  });
}
const Sa = 'mock',
  ei = 'mh_mock_mode',
  ti = (e) => {
    if (e == null) return null;
    const t = e.trim().toLowerCase();
    return ['true', '1', 'yes', 'on'].includes(t)
      ? !0
      : ['false', '0', 'no', 'off'].includes(t)
        ? !1
        : null;
  },
  zy = () => {
    if (typeof window > 'u') return null;
    const e = new URLSearchParams(window.location.search);
    return ti(e.get(Sa));
  },
  Dy = () => {
    if (typeof window > 'u' || !window.localStorage) return null;
    try {
      return ti(window.localStorage.getItem(ei));
    } catch {
      return null;
    }
  },
  Fy = (e) => {
    if (!(typeof window > 'u' || !window.localStorage))
      try {
        window.localStorage.setItem(ei, String(e));
      } catch {}
  },
  $y = (e) => {
    if (!(typeof window > 'u'))
      try {
        const t = new URL(window.location.href);
        (e ? t.searchParams.set(Sa, 'true') : t.searchParams.delete(Sa),
          window.history.replaceState(null, '', t.toString()));
      } catch {}
  },
  Bs = {
    isMockEnabled() {
      const e = zy();
      if (e !== null) return e;
      const t = Dy();
      return t !== null ? t : !1;
    },
    setMock(e, t) {
      return (
        (t == null ? void 0 : t.persist) !== !1 && Fy(e),
        (t == null ? void 0 : t.updateUrl) !== !1 && $y(e),
        e
      );
    },
    subscribe(e) {
      if (typeof window > 'u') return () => {};
      const t = (r) => {
        if (r.storageArea !== window.localStorage || r.key !== ei) return;
        const n = ti(r.newValue);
        n !== null && e(n);
      };
      return (
        window.addEventListener('storage', t),
        () => window.removeEventListener('storage', t)
      );
    },
  },
  Xc = {
    'test-uuid': '惠宇上晴',
    'community-2': '遠雄中央公園',
    'community-3': '國泰建設',
  };
function ed(e, t = '我的社區') {
  return e ? (Xc[e] ?? t) : t;
}
function So(e) {
  return e ? e in Xc : !1;
}
const Vt = {
    COMMUNITY_NAME: '惠宇上晴',
    PRICE_UNIT: '萬',
    TITLE_12F: '惠宇上晴 12F',
    TITLE_8F: '惠宇上晴 8F',
    STAGE: 'negotiation',
  },
  Eo = { days: 128, liked: 73, contributions: 15 },
  td = [
    {
      id: '1',
      title: Vt.TITLE_12F,
      price: 1280,
      priceUnit: Vt.PRICE_UNIT,
      communityName: Vt.COMMUNITY_NAME,
    },
    {
      id: '2',
      title: Vt.TITLE_8F,
      price: 1150,
      priceUnit: Vt.PRICE_UNIT,
      communityName: Vt.COMMUNITY_NAME,
    },
  ],
  Uy = { hasActive: !0, propertyName: Vt.TITLE_12F, stage: Vt.STAGE },
  sd = (e) => new Date(Date.now() - e * 60 * 1e3).toISOString(),
  rd = (e) => sd(e * 60),
  ms = (e) => sd(e * 24 * 60),
  He = {
    HUIYU: { id: P.FEED.DEFAULT_COMMUNITY_ID, name: '惠宇上晴' },
    FARGLORY: { id: 'community-2', name: '遠雄中央公園' },
    CATHAY: { id: 'community-3', name: '國泰建設' },
  },
  Se = {
    CHEN_MS: { name: '陳小姐', floor: '12F', type: 'resident' },
    LI_MR: { name: '李先生', floor: '8F', type: 'resident' },
    WANG_MS: { name: '王太太', floor: '5F', type: 'resident' },
    ZHANG_MR: { name: '張先生' },
    YOU_AGENT: { name: '游杰倫', type: 'agent' },
    LIN_AGENT: { name: '林經理', type: 'agent' },
  },
  By = (e) => [
    {
      id: `c-${e}-1`,
      postId: e,
      author: Se.WANG_MS.name,
      role: 'resident',
      content: '真的嗎？我也想參加團購！',
      time: new Date(Date.now() - 1 * 60 * 60 * 1e3).toISOString(),
      likes: 2,
    },
    {
      id: `c-${e}-2`,
      postId: e,
      author: Se.LI_MR.name,
      role: 'resident',
      content: '+1',
      time: new Date(Date.now() - 30 * 60 * 1e3).toISOString(),
      likes: 0,
    },
  ],
  Gy = [
    {
      id: 1001,
      author: Se.CHEN_MS.name,
      floor: Se.CHEN_MS.floor,
      type: Se.CHEN_MS.type,
      time: rd(2),
      title: '有人要團購掃地機嗎？🤖',
      content: '這款 iRobot 打折，滿 5 台有團購價～',
      images: [{ src: 'https://picsum.photos/id/1/800/600', alt: '團購說明圖片' }],
      likes: 31,
      comments: 2,
      communityId: He.HUIYU.id,
      communityName: He.HUIYU.name,
      commentList: By(1001),
    },
    {
      id: 1002,
      author: Se.YOU_AGENT.name,
      type: Se.YOU_AGENT.type,
      time: ms(1),
      title: '🏡 惠宇上晴 12F｜雙陽台視野戶',
      content: '客廳光線很好，上週屋主剛降價 50 萬，有興趣可私訊。',
      images: [
        { src: 'https://picsum.photos/id/13/800/600', alt: '寬敞明亮的客廳' },
        { src: 'https://picsum.photos/id/15/800/600', alt: '陽台視野' },
        { src: 'https://picsum.photos/id/29/800/600', alt: '乾淨衛浴' },
      ],
      views: 89,
      likes: 0,
      comments: 0,
      communityId: He.HUIYU.id,
      communityName: He.HUIYU.name,
      commentList: [],
    },
    {
      id: 1003,
      author: Se.LI_MR.name,
      floor: Se.LI_MR.floor,
      type: Se.LI_MR.type,
      time: ms(3),
      title: '停車位交流 🚗',
      content: '我有 B2-128 想與 B1 交換，方便接送小孩',
      likes: 12,
      comments: 1,
      communityId: He.FARGLORY.id,
      communityName: He.FARGLORY.name,
      commentList: [
        {
          id: 'c-1003-1',
          postId: 1003,
          author: Se.ZHANG_MR.name,
          role: 'member',
          content: '我有興趣，私訊您',
          time: ms(2),
          likes: 1,
        },
      ],
    },
    {
      id: 1004,
      author: Se.WANG_MS.name,
      floor: Se.WANG_MS.floor,
      type: Se.WANG_MS.type,
      time: ms(7),
      title: '推薦水電師傅',
      content: '上次找的師傅很專業，價格公道，需要的鄰居私訊我',
      likes: 25,
      comments: 0,
      communityId: He.CATHAY.id,
      communityName: He.CATHAY.name,
      commentList: [],
    },
    {
      id: 1005,
      author: Se.LIN_AGENT.name,
      type: Se.LIN_AGENT.type,
      time: ms(8),
      title: '🏡 惠宇上晴 8F｜三房車位',
      content: '屋況極新，前屋主自住保養好',
      images: [
        { src: 'https://picsum.photos/id/59/800/600', alt: '溫馨臥室' },
        { src: 'https://picsum.photos/id/60/800/600', alt: '功能齊全的廚房' },
      ],
      views: 156,
      likes: 0,
      comments: 0,
      communityId: He.HUIYU.id,
      communityName: He.HUIYU.name,
      commentList: [],
    },
  ],
  Hy = {
    grade: 'S',
    score: 92,
    growth: 15,
    tags: ['回覆迅速', '市場觀點獨到', '親和力高'],
  },
  Wy = {
    score: 2560,
    days: 128,
    liked: 73,
    views: 1250,
    replies: 45,
    contacts: 8,
  },
  Vy = [
    {
      id: 't1',
      type: 'reply',
      content: '回覆陳小姐關於「惠宇上晴」的詢問',
      isDone: !1,
      time: '10:00',
    },
    {
      id: 't2',
      type: 'contact',
      content: '聯繫李先生安排看房',
      isDone: !1,
      time: '14:30',
    },
    {
      id: 't3',
      type: 'system',
      content: '更新個人簡介以提升信任度',
      isDone: !0,
      time: 'Yesterday',
    },
  ],
  Zy = [
    {
      id: 2101,
      author: Se.YOU_AGENT.name,
      type: Se.YOU_AGENT.type,
      time: rd(1),
      title: '🏡 惠宇上晴 12F｜雙陽台視野戶',
      content:
        '客廳光線很好，上週屋主剛降價 50 萬，有興趣可私訊。AI 體檢：屋況良好｜低公設比 31%｜社區評分 4.6★',
      views: 89,
      likes: 5,
      comments: 2,
      communityId: He.HUIYU.id,
      communityName: He.HUIYU.name,
      commentList: [],
    },
    {
      id: 2102,
      author: Se.LIN_AGENT.name,
      type: Se.LIN_AGENT.type,
      time: ms(2),
      title: '🏡 惠宇上晴 8F｜三房車位',
      content: '屋況極新，前屋主自住保養好。適合首購族或小家庭。',
      views: 156,
      likes: 3,
      comments: 1,
      communityId: He.HUIYU.id,
      communityName: He.HUIYU.name,
      commentList: [],
    },
    {
      id: 2103,
      author: Se.CHEN_MS.name,
      floor: Se.CHEN_MS.floor,
      type: Se.CHEN_MS.type,
      time: ms(3),
      title: '有人要團購掃地機嗎？🤖',
      content: '這款 iRobot 打折，滿 5 台有團購價～',
      likes: 31,
      comments: 14,
      communityId: He.HUIYU.id,
      communityName: He.HUIYU.name,
      commentList: [],
    },
  ],
  Lr = (e) =>
    typeof structuredClone == 'function' ? structuredClone(e) : JSON.parse(JSON.stringify(e)),
  Yy = () => Lr(Gy),
  qy = () => Lr(Zy),
  Ky = () => Lr(Hy),
  Qy = () => Lr(Wy),
  Jy = () => Lr(Vy),
  nd = (e) => ({
    hotPosts: [...e]
      .sort((n, a) => (a.likes || 0) - (n.likes || 0))
      .slice(0, 3)
      .map((n) => ({
        id: n.id,
        title: n.title,
        communityName: n.communityName || '未知社區',
        likes: n.likes || 0,
      })),
    saleItems: td,
  }),
  ad = () => {
    const e = Yy();
    return { posts: e, totalPosts: e.length, sidebarData: nd(e) };
  },
  Xy = () => {
    const e = qy();
    return { posts: e, totalPosts: e.length, sidebarData: nd(e) };
  },
  Je = {
    VIEW_PRIVATE_WALL: 'view:private_wall',
    POST_PRIVATE_WALL: 'post:private_wall',
    VIEW_AGENT_STATS: 'view:agent_stats',
    MANAGE_CLIENTS: 'manage:clients',
    MANAGE_COMMUNITY: 'manage:community',
  },
  To = {
    guest: [],
    member: [],
    resident: [Je.VIEW_PRIVATE_WALL, Je.POST_PRIVATE_WALL],
    official: [Je.VIEW_PRIVATE_WALL, Je.POST_PRIVATE_WALL],
    agent: [Je.VIEW_PRIVATE_WALL, Je.VIEW_AGENT_STATS, Je.MANAGE_CLIENTS],
    admin: [
      Je.VIEW_PRIVATE_WALL,
      Je.POST_PRIVATE_WALL,
      Je.VIEW_AGENT_STATS,
      Je.MANAGE_COMMUNITY,
      Je.MANAGE_CLIENTS,
    ],
  };
function id() {
  const { role: e, isAuthenticated: t, loading: r } = Ct(),
    n = h.useMemo(
      () =>
        !t || !e
          ? new Set()
          : ((c) => typeof c == 'string' && Object.keys(To).includes(c))(e)
            ? new Set(To[e])
            : new Set(),
      [t, e]
    ),
    a = h.useCallback((l) => n.has(l), [n]),
    i = h.useCallback((l) => l.some((c) => n.has(c)), [n]),
    o = h.useCallback((l) => l.every((c) => n.has(c)), [n]);
  return {
    hasPermission: a,
    hasAnyPermission: i,
    hasAllPermissions: o,
    role: e,
    isAuthenticated: t,
    isLoading: r,
    permissions: n,
  };
}
const ev = {
    async uploadImage(e, t = 'community-images', r = 'posts') {
      if (!e.type.startsWith('image/')) throw new Error('僅支援圖片上傳');
      const n = 5 * 1024 * 1024;
      if (e.size > n) throw new Error('圖片大小不能超過 5MB');
      const a = e.name.split('.').pop(),
        i = `${on()}.${a}`,
        o = r ? `${r}/${i}` : i,
        { data: l, error: c } = await de.storage
          .from(t)
          .upload(o, e, { cacheControl: '3600', upsert: !1 });
      if (c) throw (console.error('[UploadService] Upload failed:', c), c);
      const {
        data: { publicUrl: d },
      } = de.storage.from(t).getPublicUrl(o);
      return { url: d, path: o };
    },
    async uploadFiles(e, t = 'community-images', r = 'posts') {
      return Promise.all(e.map((n) => this.uploadImage(n, t, r)));
    },
  },
  tv = P.FEED,
  od = 'feed-mock-data-v1',
  sv = 3,
  Mt = (e) => ({
    hotPosts: [...e]
      .sort((r, n) => (n.likes || 0) - (r.likes || 0))
      .slice(0, sv)
      .map((r) => ({
        id: r.id,
        title: r.title,
        communityName: r.communityName || tv.DEFAULT_COMMUNITY_LABEL,
        likes: r.likes || 0,
      })),
    saleItems: td,
  }),
  rv = {
    posts: [],
    totalPosts: 0,
    sidebarData: { hotPosts: [], saleItems: [] },
  },
  nv = () => ad(),
  av = 5 * 60 * 1e3,
  Ea = new Map(),
  iv = (e) => Date.now() - e.timestamp < av,
  ov = (e) => {
    const t = new Map(),
      r = [];
    for (const n of e) {
      const a = Ea.get(n);
      a && iv(a) ? t.set(n, a.profile) : (r.push(n), a && Ea.delete(n));
    }
    return { cached: t, uncached: r };
  },
  lv = (e) => {
    const t = Date.now();
    for (const r of e) Ea.set(r.id, { profile: r, timestamp: t });
  },
  cv = (e, t) => {
    const r = t ? e.posts.filter((n) => n.communityId === t) : e.posts;
    return { posts: r, totalPosts: r.length, sidebarData: Mt(r) };
  },
  dv = (e) => (e ? (e.length > 40 ? `${e.slice(0, 40)}...` : e) : '（無標題）'),
  ld = () => {
    try {
      return typeof window < 'u' && typeof window.localStorage < 'u';
    } catch {
      return !1;
    }
  },
  Io = (e) => {
    if (!ld()) return e;
    try {
      const t = window.localStorage.getItem(od);
      if (!t) return e;
      const r = JSON.parse(t),
        n = r.posts ?? e.posts;
      return {
        posts: n,
        totalPosts: r.totalPosts ?? e.totalPosts,
        sidebarData: Mt(n),
      };
    } catch (t) {
      return (console.error('[useFeedData] Failed to load mock state', t), e);
    }
  },
  uv = (e) => {
    if (ld())
      try {
        window.localStorage.setItem(od, JSON.stringify(e));
      } catch (t) {
        console.error('[useFeedData] Failed to persist mock state', t);
      }
  },
  mv = async (e) => {
    if (!e.length) return new Map();
    const { cached: t, uncached: r } = ov(e);
    if (r.length === 0) return t;
    const { data: n, error: a } = await de
      .from('profiles')
      .select('id, name, floor, role')
      .in('id', r);
    if (a) return (console.error('[useFeedData] Fetch profiles failed', a), t);
    const i = (n ?? []).map((l) => l);
    lv(i);
    const o = new Map(t);
    for (const l of i) o.set(l.id, l);
    return o;
  },
  hv = async (e) => {
    const t = Array.from(new Set(e.map((a) => a.author_id).filter((a) => !!a))),
      r = await mv(t),
      n = e.map((a) => {
        const i = a.author_id ? r.get(a.author_id) : void 0,
          o = a.liked_by ?? [],
          l =
            (i == null ? void 0 : i.role) === 'agent'
              ? 'agent'
              : (i == null ? void 0 : i.role) === 'resident'
                ? 'resident'
                : 'member',
          c = {
            id: a.id,
            author: (i == null ? void 0 : i.name) ?? '住戶',
            type: l,
            time: a.created_at ?? new Date().toISOString(),
            title: dv(a.content),
            content: a.content,
            likes: a.likes_count ?? o.length ?? 0,
            comments: a.comments_count ?? 0,
            pinned: a.is_pinned ?? !1,
            communityId: a.community_id,
            communityName: ed(a.community_id),
            liked_by: o,
            private: a.visibility === 'private',
          };
        return i != null && i.floor ? { ...c, floor: i.floor } : c;
      });
    return { posts: n, totalPosts: n.length, sidebarData: Mt(n) };
  },
  fv = (e, t, r) => ({
    id: Date.now(),
    author: '測試用戶',
    type: 'resident',
    time: new Date().toISOString(),
    title: e.substring(0, 20) + (e.length > 20 ? '...' : ''),
    content: e,
    likes: 0,
    comments: 0,
    pinned: !1,
    communityId: t,
    communityName: r,
    commentList: [],
  });
function cd(e = {}) {
  const { user: t, role: r, isAuthenticated: n } = Ct(),
    { communityId: a, initialMockData: i, persistMockState: o = !0 } = e,
    { hasPermission: l } = id(),
    c = l(Je.VIEW_PRIVATE_WALL),
    d = i ?? nv(),
    [m, u] = h.useState(() => Bs.isMockEnabled());
  h.useEffect(() => Bs.subscribe(u), []);
  const x = t == null ? void 0 : t.id,
    [f, g] = h.useState(() => {
      const R = o ? Io(d) : d,
        ee = R.posts.filter(($) => !($.private && !c));
      return { ...R, posts: ee, totalPosts: ee.length, sidebarData: Mt(ee) };
    }),
    b = h.useRef(!1),
    [y, p] = h.useState(() => new Set()),
    E = h.useRef(!1);
  (h.useEffect(() => {
    m || (p(new Set()), (E.current = !1));
  }, [m]),
    h.useEffect(() => {
      if (!o || !m) return;
      if (!b.current) {
        b.current = !0;
        return;
      }
      const R = Io(d),
        ee = R.posts.filter(($) => !($.private && !c));
      g({ ...R, posts: ee, totalPosts: ee.length, sidebarData: Mt(ee) });
    }, [m, o, d, c]),
    h.useEffect(() => {
      !o || !m || uv(f);
    }, [f, o, m]));
  const [S, N] = h.useState(null),
    [k, T] = h.useState(!1),
    [C, w] = h.useState(null),
    G = h.useRef(null),
    [j, _] = h.useState(() => new Set()),
    D = h.useCallback(async () => {
      if (!m) {
        (T(!0), w(null));
        try {
          const R = de
            .from('community_posts')
            .select(
              'id, community_id, author_id, content, visibility, likes_count, comments_count, liked_by, is_pinned, created_at, post_type'
            )
            .order('is_pinned', { ascending: !1 })
            .order('created_at', { ascending: !1 })
            .limit(50);
          (a && R.eq('community_id', a), c || R.eq('visibility', 'public'));
          const { data: ee, error: $ } = await R;
          if ($) throw $;
          const J = await hv(ee ?? []),
            Y = J.posts.filter((U) => !(U.private && !c)),
            oe = { ...J, posts: Y, totalPosts: Y.length, sidebarData: Mt(Y) };
          if ((N(oe), (G.current = oe), x)) {
            const U = new Set();
            ((ee ?? []).forEach((q) => {
              (q.liked_by ?? []).includes(x) && U.add(q.id);
            }),
              _(U));
          }
        } catch (R) {
          const ee = R instanceof Error ? R : new Error('載入信息流失敗');
          w(ee);
        } finally {
          T(!1);
        }
      }
    }, [m, a, x, c]);
  h.useEffect(() => {
    m || D();
  }, [m, D]);
  const V = h.useMemo(() => {
      if (m) return cv(f, a);
      if (S) return ((G.current = S), S);
      const R = G.current ?? rv;
      return c ? R : { ...R, posts: R.posts.filter((ee) => !ee.private) };
    }, [m, S, f, a, c]),
    se = h.useMemo(() => r ?? 'guest', [r]);
  h.useEffect(() => {
    if (!m || !x || E.current) return;
    E.current = !0;
    const R = new Set();
    (f.posts.forEach((ee) => {
      var $;
      ($ = ee.liked_by) != null && $.includes(x) && R.add(ee.id);
    }),
      p(R));
  }, [m, x, f]);
  const I = h.useCallback(() => {
      if (x) return x;
      const R = 'mock_user_id';
      let ee = localStorage.getItem(R);
      return (
        ee ||
          ((ee = `mock-user-${Date.now()}-${Math.random().toString(36).slice(2, 8)}`),
          localStorage.setItem(R, ee)),
        ee
      );
    }, [x]),
    A = h.useCallback((R) => (m ? y.has(R) : j.has(R)), [m, y, j]),
    z = h.useCallback(async () => {
      if (m) {
        g((R) => ({ ...R }));
        return;
      }
      await D();
    }, [m, D]),
    O = h.useCallback(
      async (R) => {
        if (!m && !n) throw new Error('請先登入後再按讚');
        if (m) {
          const U = I(),
            q = y.has(R);
          (g((ue) => ({
            ...ue,
            posts: ue.posts.map((B) => {
              if (B.id !== R) return B;
              const ie = B.likes ?? 0,
                fe = B.liked_by ?? [];
              return {
                ...B,
                likes: q ? Math.max(0, ie - 1) : ie + 1,
                liked_by: q ? fe.filter((At) => At !== U) : [...fe, U],
              };
            }),
          })),
            p((ue) => {
              const B = new Set(ue);
              return (B.has(R) ? B.delete(R) : B.add(R), B);
            }));
          return;
        }
        const ee = x;
        if (!ee) throw new Error('缺少使用者身份');
        const $ = String(R),
          J = j.has(R),
          Y = S,
          oe = new Set(j);
        (N(
          (U) =>
            U && {
              ...U,
              posts: U.posts.map((q) => {
                if (q.id !== R) return q;
                const ue = q.likes ?? 0,
                  B = q.liked_by ?? [],
                  ie = J ? B.filter((fe) => fe !== ee) : [...B, ee];
                return {
                  ...q,
                  likes: J ? Math.max(0, ue - 1) : ue + 1,
                  liked_by: ie,
                };
              }),
            }
        ),
          _((U) => {
            const q = new Set(U);
            return (q.has(R) ? q.delete(R) : q.add(R), q);
          }));
        try {
          const { data: U, error: q } = await de.rpc('toggle_like', {
            post_id: $,
          });
          if (q) throw q;
          N(
            (ue) =>
              ue && {
                ...ue,
                posts: ue.posts.map((B) => {
                  if (B.id !== R) return B;
                  const ie =
                      typeof (U == null ? void 0 : U.likes_count) == 'number'
                        ? U.likes_count
                        : (B.likes ?? 0),
                    fe = B.liked_by ?? [],
                    At =
                      U && 'liked' in U
                        ? U.liked
                          ? [...new Set([...fe, ee])]
                          : fe.filter((ls) => ls !== ee)
                        : fe;
                  return { ...B, likes: ie, liked_by: At };
                }),
              }
          );
        } catch (U) {
          throw (N(Y), _(oe), U instanceof Error ? U : new Error('按讚失敗，請稍後再試'));
        }
      },
      [m, y, j, S, I, n, x]
    ),
    re = h.useCallback(
      async (R, ee, $) => {
        var ue;
        if (!m && !n) throw new Error('請先登入後再發文');
        const J = ee ?? e.communityId;
        J &&
          !So(J) &&
          console.warn('[useFeedData] Invalid communityId provided, fallback to undefined');
        const Y = J && So(J) ? J : void 0;
        if (!m && !Y) throw new Error('請先選擇社區後再發文');
        const oe = ed(Y);
        if (m) {
          const B = fv(R, Y, oe);
          ($ &&
            $.length > 0 &&
            (B.images = $.map((ie, fe) => ({
              src: `https://picsum.photos/seed/${Date.now() + fe}/400/300`,
              alt: 'Mock Image',
            }))),
            g((ie) => ({
              ...ie,
              posts: [B, ...ie.posts],
              totalPosts: ie.totalPosts + 1,
              sidebarData: Mt([B, ...ie.posts]),
            })));
          return;
        }
        const U = -Date.now(),
          q = {
            id: U,
            author:
              ((ue = t == null ? void 0 : t.user_metadata) == null ? void 0 : ue.name) ||
              (t == null ? void 0 : t.email) ||
              '我',
            type: ['agent', 'resident', 'official'].includes(r || '') ? r : 'member',
            time: new Date().toISOString(),
            title: R.substring(0, 20),
            content: R,
            likes: 0,
            comments: 0,
            pinned: !1,
            communityId: Y,
            communityName: oe,
            commentList: [],
            ...($ && $.length > 0
              ? {
                  images: $.map((B) => ({
                    src: URL.createObjectURL(B),
                    alt: B.name,
                  })),
                }
              : {}),
          };
        N(
          (B) =>
            B && {
              ...B,
              posts: [q, ...B.posts],
              totalPosts: B.totalPosts + 1,
              sidebarData: Mt([q, ...B.posts]),
            }
        );
        try {
          let B = [];
          $ &&
            $.length > 0 &&
            (B = (await ev.uploadFiles($)).map((At) => ({
              src: At.url,
              alt: 'Post Image',
            })));
          const { error: ie } = await de.from('community_posts').insert({
            content: R,
            community_id: Y,
            author_id: x,
            post_type: 'general',
            images: B,
          });
          if (ie) throw ie;
          await D();
        } catch (B) {
          throw (
            console.error('[useFeedData] Create post failed', B),
            N(
              (ie) =>
                ie && {
                  ...ie,
                  posts: ie.posts.filter((fe) => fe.id !== U),
                  totalPosts: ie.totalPosts - 1,
                  sidebarData: Mt(ie.posts.filter((fe) => fe.id !== U)),
                }
            ),
            B
          );
        }
      },
      [m, n, e.communityId, t, r, x, D]
    ),
    ae = h.useCallback(
      async (R, ee) => {
        var oe;
        if (!m && !n) throw new Error('請先登入後再留言');
        const J = {
          id: m ? Date.now() : -Date.now(),
          postId: R,
          author:
            ((oe = t == null ? void 0 : t.user_metadata) == null ? void 0 : oe.name) || '測試用戶',
          role: ['agent', 'resident', 'official'].includes(r || '') ? r : 'member',
          content: ee,
          time: new Date().toISOString(),
          likes: 0,
          isLiked: !1,
        };
        if (m) {
          g((U) => ({
            ...U,
            posts: U.posts.map((q) => {
              if (q.id !== R) return q;
              const ue = [...(q.commentList || []), J];
              return { ...q, comments: ue.length, commentList: ue };
            }),
          }));
          return;
        }
        const Y = S;
        N(
          (U) =>
            U && {
              ...U,
              posts: U.posts.map((q) => {
                if (q.id !== R) return q;
                const ue = [...(q.commentList || []), J];
                return { ...q, comments: ue.length, commentList: ue };
              }),
            }
        );
        try {
          T(!0);
          const { error: U } = await de.from('community_comments').insert({
            post_id: R,
            community_id: e.communityId,
            user_id: x,
            content: ee,
          });
          if (U) throw U;
          await D();
        } catch (U) {
          throw (N(Y), w(U), U);
        } finally {
          T(!1);
        }
      },
      [m, n, t, r, x, e.communityId, S, D]
    );
  return {
    data: V,
    useMock: m,
    setUseMock: u,
    isLoading: m ? !1 : k,
    error: m ? null : C,
    refresh: z,
    toggleLike: O,
    createPost: re,
    addComment: ae,
    viewerRole: se,
    isAuthenticated: n,
    isLiked: A,
  };
}
const pv = ad(),
  Ue = P.FEED;
function xv(e, t) {
  const { user: r, isAuthenticated: n, role: a, loading: i } = Ct(),
    {
      data: o,
      useMock: l,
      setUseMock: c,
      isLoading: d,
      error: m,
      refresh: u,
      toggleLike: x,
      createPost: f,
      addComment: g,
      isLiked: b,
    } = cd({ initialMockData: pv }),
    y = t || (e == null ? void 0 : e.startsWith('demo-')),
    p = n || y;
  (h.useEffect(() => {
    t !== void 0 && c(t);
  }, [t, c]),
    h.useEffect(() => {
      document.title = P.FEED.PAGE_TITLE;
    }, []));
  const E = h.useMemo(() => {
      var _, D;
      return p
        ? n && r
          ? {
              id: r.id,
              name:
                ((_ = r.user_metadata) == null ? void 0 : _.name) ||
                ((D = r.email) == null ? void 0 : D.split('@')[0]) ||
                Ue.DEFAULT_USER,
              role: a || 'member',
              stats: Eo,
              communityId: Ue.DEFAULT_COMMUNITY_ID,
              communityName: Ue.DEFAULT_COMMUNITY_NAME,
            }
          : y
            ? {
                id: 'demo-user',
                name: Ue.DEFAULT_USER,
                role: e === 'demo-agent' ? 'agent' : 'member',
                stats: Eo,
                communityId: Ue.DEFAULT_COMMUNITY_ID,
                communityName: Ue.DEFAULT_COMMUNITY_NAME,
              }
            : null
        : null;
    }, [n, r, a, y, e, p]),
    [S] = h.useState(() => {
      try {
        return localStorage.getItem('mai_active_tx') === 'true' ? Uy : { hasActive: !1 };
      } catch {
        return { hasActive: !1 };
      }
    }),
    N = h.useMemo(() => o.sidebarData, [o.sidebarData]),
    k = h.useCallback(
      async (_) => {
        if (!p) {
          W.error(Ue.NOTIFY.LOGIN_REQUIRED, Ue.NOTIFY.LOGIN_REQUIRED_LIKE);
          return;
        }
        try {
          await x(_);
        } catch {
          W.error(Ue.NOTIFY.LIKE_FAILED, Ue.NOTIFY.LIKE_FAILED_DESC);
        }
      },
      [x, p]
    ),
    T = h.useCallback(
      async (_, D) => {
        if (!p) {
          W.error(Ue.NOTIFY.LOGIN_REQUIRED, Ue.NOTIFY.LOGIN_REQUIRED_POST);
          return;
        }
        const V = (E == null ? void 0 : E.communityId) || 'mock-community';
        try {
          D && D.length > 0 ? await f(_, V, D) : await f(_, V);
        } catch (se) {
          throw se;
        }
      },
      [f, p, E]
    ),
    C = h.useCallback((_) => {}, []),
    w = h.useCallback(
      async (_, D) => {
        if (!p) {
          W.error(Ue.NOTIFY.LOGIN_REQUIRED, Ue.NOTIFY.LOGIN_REQUIRED_POST);
          return;
        }
        try {
          (await g(_, D), W.success(Ue.POST.COMMENT_SUCCESS.TITLE, Ue.POST.COMMENT_SUCCESS.DESC));
        } catch {
          W.error('留言失敗', '請稍後再試');
        }
      },
      [p, g]
    ),
    G = h.useCallback(async (_) => {
      var se;
      const D = `${window.location.origin}${window.location.pathname}?post=${_}`,
        V = {
          title: 'MaiHouses 社區動態',
          text: '來看看這則有趣的社區貼文！',
          url: D,
        };
      if (navigator.share && navigator.canShare(V)) {
        try {
          await navigator.share(V);
        } catch (I) {
          I.name !== 'AbortError' && W.error('分享失敗', '請稍後再試');
        }
        return;
      }
      if (!((se = navigator == null ? void 0 : navigator.clipboard) != null && se.writeText)) {
        W.info('分享功能暫未支援', '請在瀏覽器中操作');
        return;
      }
      navigator.clipboard
        .writeText(D)
        .then(() => {
          W.success('連結已複製', '您可以將連結分享給朋友');
        })
        .catch(() => {
          W.error('複製失敗', '請手動複製網址');
        });
    }, []),
    j = (E == null ? void 0 : E.name.charAt(0).toUpperCase()) || 'U';
  return {
    authLoading: i,
    activeTransaction: S,
    userProfile: E,
    userInitial: j,
    isAuthenticated: p,
    isLoading: d,
    error: m,
    data: o,
    sidebarData: N,
    useMock: l,
    setUseMock: c,
    refresh: u,
    isLiked: b,
    handleLike: k,
    handleCreatePost: T,
    handleReply: C,
    handleComment: w,
    handleShare: G,
  };
}
function gv() {
  return s.jsxs('div', {
    className:
      'flex h-40 w-full flex-col items-center justify-center space-y-3 rounded-lg bg-gray-50 p-6',
    children: [
      s.jsx('div', {
        className: 'border-brand-200 size-8 animate-spin rounded-full border-4 border-t-brand-600',
      }),
      s.jsx('span', {
        className: 'text-sm font-medium text-gray-500',
        children: P.WALL_STATES.LOADING_LABEL,
      }),
    ],
  });
}
function bv({ permission: e, children: t, fallback: r = null }) {
  const { hasPermission: n, isLoading: a } = id();
  return a
    ? s.jsx(gv, {})
    : n(e)
      ? s.jsx(s.Fragment, { children: t })
      : s.jsx(s.Fragment, { children: r });
}
const yv = h.memo(function () {
  const { isAuthenticated: t } = Ct(),
    r = () => {
      t
        ? W.info(P.COMMUNITY.NOTIFY_VERIFY_REQUIRED, P.COMMUNITY.NOTIFY_VERIFY_REQUIRED_DESC)
        : (W.info(P.COMMUNITY.NOTIFY_LOGIN_TITLE, P.COMMUNITY.NOTIFY_LOGIN_DESC),
          (window.location.href = ve.AUTH));
    };
  return s.jsxs('div', {
    className:
      'relative min-h-[400px] overflow-hidden rounded-xl border border-gray-100 bg-gray-50 p-6',
    role: 'alert',
    'aria-live': 'polite',
    'aria-labelledby': 'lock-title',
    'aria-describedby': 'lock-desc',
    children: [
      s.jsx('div', {
        className:
          'pointer-events-none absolute inset-0 z-0 select-none bg-white/50 p-6 opacity-40 blur-md',
        'aria-hidden': 'true',
        children: [1, 2, 3].map((n) =>
          s.jsxs(
            'div',
            {
              className: 'mb-4 space-y-3 rounded-lg bg-gray-100 p-4 opacity-60 shadow-sm',
              children: [
                s.jsxs('div', {
                  className: 'flex items-center gap-2',
                  children: [
                    s.jsx('div', {
                      className: 'size-10 rounded-full bg-gray-300',
                    }),
                    s.jsx('div', { className: 'h-4 w-24 rounded bg-gray-300' }),
                  ],
                }),
                s.jsx('div', { className: 'h-4 w-3/4 rounded bg-gray-300' }),
                s.jsx('div', { className: 'h-4 w-1/2 rounded bg-gray-300' }),
              ],
            },
            n
          )
        ),
      }),
      s.jsxs('div', {
        className:
          'absolute inset-0 z-10 flex flex-col items-center justify-center bg-gradient-to-b from-transparent via-white/80 to-white p-6 text-center',
        children: [
          s.jsx('div', {
            className:
              'animate-bounce-subtle mb-4 rounded-full bg-white p-4 shadow-xl ring-1 ring-gray-100',
            children: s.jsx(Ra, {
              className: 'size-8 text-brand-600',
              'aria-hidden': 'true',
            }),
          }),
          s.jsx('h3', {
            id: 'lock-title',
            className: 'mb-2 text-xl font-bold text-gray-900 drop-shadow-sm',
            children: P.COMMUNITY.LOCKED_TITLE,
          }),
          s.jsx('p', {
            id: 'lock-desc',
            className: 'mb-6 max-w-xs text-sm font-medium text-gray-600',
            children: t ? P.COMMUNITY.LOCKED_DESC_USER : P.COMMUNITY.LOCKED_DESC_GUEST,
          }),
          s.jsx('button', {
            onClick: r,
            className:
              'rounded-full bg-brand-600 px-8 py-3 text-base font-bold text-white shadow-lg transition-all hover:scale-105 hover:bg-brand-700 focus:outline-none focus:ring-4 focus:ring-brand-500/30 active:scale-95',
            'aria-label': t ? P.COMMUNITY.BTN_UNLOCK_USER : P.COMMUNITY.BTN_UNLOCK_GUEST,
            children: t ? P.COMMUNITY.BTN_UNLOCK_USER : P.COMMUNITY.BTN_UNLOCK_GUEST,
          }),
        ],
      }),
    ],
  });
});
function vv() {
  const { isAuthenticated: e } = Ct();
  return { count: h.useMemo(() => 0, [e]), isLoading: !1 };
}
const sr = P.FEED;
function Co() {
  return s.jsx('div', {
    className: 'animate-pulse space-y-3',
    children: [1, 2, 3].map((e) =>
      s.jsxs(
        'div',
        {
          className: 'rounded-2xl border border-brand-100 bg-white p-4',
          children: [
            s.jsxs('div', {
              className: 'flex items-center gap-3 border-b border-gray-50 pb-3',
              children: [
                s.jsx('div', { className: 'size-10 rounded-full bg-gray-200' }),
                s.jsxs('div', {
                  className: 'flex-1 space-y-2',
                  children: [
                    s.jsx('div', { className: 'h-4 w-24 rounded bg-gray-200' }),
                    s.jsx('div', { className: 'h-3 w-32 rounded bg-gray-200' }),
                  ],
                }),
              ],
            }),
            s.jsxs('div', {
              className: 'space-y-2 pt-3',
              children: [
                s.jsx('div', { className: 'h-4 w-full rounded bg-gray-200' }),
                s.jsx('div', { className: 'h-4 w-3/4 rounded bg-gray-200' }),
              ],
            }),
          ],
        },
        e
      )
    ),
  });
}
function Ao() {
  return s.jsxs('div', {
    className:
      'flex flex-col items-center justify-center rounded-2xl border border-brand-100 bg-white px-6 py-12 text-center shadow-sm',
    children: [
      s.jsx('div', { className: 'mb-3 text-4xl', children: '📭' }),
      s.jsx('h3', {
        className: 'mb-1 text-base font-bold text-gray-900',
        children: sr.EMPTY.TITLE,
      }),
      s.jsx('p', {
        className: 'text-sm text-gray-500',
        children: sr.EMPTY.DESC,
      }),
    ],
  });
}
function jv({ message: e, onRetry: t }) {
  return s.jsxs('div', {
    className:
      'flex flex-col items-center justify-center rounded-2xl border border-red-100 bg-red-50 px-6 py-12 text-center shadow-sm',
    children: [
      s.jsx('div', { className: 'mb-3 text-4xl', children: '😢' }),
      s.jsx('h3', {
        className: 'mb-1 text-base font-bold text-red-700',
        children: sr.ERROR.LOAD_FAILED,
      }),
      s.jsx('p', { className: 'mb-4 text-sm text-red-600', children: e }),
      s.jsx('button', {
        type: 'button',
        onClick: t,
        className:
          'rounded-lg bg-brand-700 px-4 py-2 text-sm font-bold text-white shadow-sm hover:bg-brand-600',
        children: sr.ERROR.RETRY,
      }),
    ],
  });
}
function wv({ userId: e, forceMock: t }) {
  const {
      authLoading: r,
      activeTransaction: n,
      userProfile: a,
      userInitial: i,
      isAuthenticated: o,
      isLoading: l,
      error: c,
      data: d,
      useMock: m,
      setUseMock: u,
      refresh: x,
      isLiked: f,
      handleLike: g,
      handleCreatePost: b,
      handleReply: y,
      handleComment: p,
      handleShare: E,
    } = xv(e, t),
    { count: S } = vv();
  h.useEffect(() => {
    const w = () => {
      window.location.hash === '#profile' && window.scrollTo({ top: 0, behavior: 'smooth' });
    };
    (w(), window.addEventListener('hashchange', w));
    const j = new URLSearchParams(window.location.search).get('post');
    if (j) {
      const _ = (D = 0) => {
        const V = document.getElementById(`post-${j}`);
        V
          ? (V.scrollIntoView({ behavior: 'smooth', block: 'center' }),
            V.classList.add('ring-2', 'ring-brand-500', 'ring-offset-2'),
            setTimeout(() => V.classList.remove('ring-2', 'ring-brand-500', 'ring-offset-2'), 2e3))
          : D < 10 && setTimeout(() => _(D + 1), 500);
      };
      setTimeout(() => _(), 500);
    }
    return () => window.removeEventListener('hashchange', w);
  }, [d.posts]);
  const N = (w) => {},
    [k, T] = h.useState('public'),
    C = d.posts.filter((w) => (k === 'private' ? w.private : !w.private));
  return r
    ? s.jsxs('div', {
        className: 'min-h-screen bg-gradient-to-b from-brand-50 to-brand-100/50',
        children: [
          s.jsx(fs, { mode: 'consumer' }),
          s.jsx('div', {
            className: 'mx-auto max-w-[960px] p-4',
            children: s.jsx(Co, {}),
          }),
        ],
      })
    : s.jsxs('div', {
        className: 'min-h-screen bg-gray-50 pb-20 md:pb-0',
        children: [
          s.jsx(fs, {
            mode: 'consumer',
            notificationCount: S,
            onSearch: N,
            className: 'sticky top-0 z-30',
          }),
          n.hasActive && s.jsx(Ty, { transaction: n, className: 'mt-2' }),
          s.jsxs('div', {
            className:
              'mx-auto flex max-w-[960px] gap-5 p-4 pb-[calc(80px+env(safe-area-inset-bottom,20px))] lg:pb-4',
            children: [
              s.jsxs('main', {
                className: 'flex max-w-[560px] flex-1 flex-col gap-3',
                children: [
                  a && s.jsx(Sy, { profile: a }),
                  o &&
                    s.jsx(Jc, {
                      onSubmit: (w, G) => (G && G.length > 0 ? b(w, G) : b(w)),
                      disabled: l,
                      userInitial: i,
                    }),
                  s.jsxs('div', {
                    className: 'flex rounded-lg bg-white p-1 shadow-sm',
                    children: [
                      s.jsx('button', {
                        onClick: () => T('public'),
                        className: `flex-1 rounded-md py-2 text-sm font-bold transition-all ${k === 'public' ? 'bg-brand-50 text-brand-700 shadow-sm' : 'text-gray-500 hover:bg-gray-50 hover:text-gray-700'}`,
                        children: sr.TABS.PUBLIC,
                      }),
                      s.jsx('button', {
                        onClick: () => T('private'),
                        className: `flex-1 rounded-md py-2 text-sm font-bold transition-all ${k === 'private' ? 'bg-brand-50 text-brand-700 shadow-sm' : 'text-gray-500 hover:bg-gray-50 hover:text-gray-700'}`,
                        children: sr.TABS.PRIVATE,
                      }),
                    ],
                  }),
                  l
                    ? s.jsx(Co, {})
                    : c
                      ? s.jsx(jv, { message: c.message, onRetry: x })
                      : s.jsx(s.Fragment, {
                          children:
                            k === 'private'
                              ? s.jsx(bv, {
                                  permission: Je.VIEW_PRIVATE_WALL,
                                  fallback: s.jsx(yv, {}),
                                  children:
                                    C.length === 0
                                      ? s.jsx(Ao, {})
                                      : s.jsx('div', {
                                          className: 'space-y-3',
                                          children: C.map((w) =>
                                            s.jsx(
                                              ka,
                                              {
                                                post: w,
                                                isLiked: f(w.id),
                                                onLike: g,
                                                onReply: y,
                                                onComment: p,
                                                onShare: E,
                                              },
                                              w.id
                                            )
                                          ),
                                        }),
                                })
                              : C.length === 0
                                ? s.jsx(Ao, {})
                                : s.jsx('div', {
                                    className: 'space-y-3',
                                    children: C.map((w) =>
                                      s.jsx(
                                        'div',
                                        {
                                          id: `post-${w.id}`,
                                          className: 'space-y-3',
                                          children: s.jsx(ka, {
                                            post: w,
                                            isLiked: f(w.id),
                                            onLike: g,
                                            onReply: y,
                                            onComment: p,
                                            onShare: E,
                                          }),
                                        },
                                        w.id
                                      )
                                    ),
                                  }),
                        }),
                ],
              }),
              s.jsxs('aside', {
                className: 'hidden w-[380px] lg:block',
                children: [
                  s.jsx(Oy, { data: d.sidebarData }),
                  s.jsx('div', {
                    className: 'mt-4 flex justify-center',
                    children: s.jsx(Xa, { useMock: m, onToggle: () => u(!m) }),
                  }),
                ],
              }),
            ],
          }),
        ],
      });
}
function Nv(e) {
  return s.jsx(Py, { children: s.jsx(wv, { ...e }) });
}
const _v = h.memo(function ({ profile: t, stats: r, className: n = '' }) {
    const a = t.name.charAt(0).toUpperCase();
    return (
      t.communityName || P.FEED.DEFAULT_COMMUNITY_NAME,
      s.jsxs('section', {
        className: `flex flex-col gap-3.5 rounded-2xl border border-[#e6edf7] bg-white p-4 shadow-[0_4px_14px_rgba(0,51,102,0.04)] ${n}`,
        children: [
          s.jsxs('div', {
            className: 'flex items-center gap-3.5',
            children: [
              s.jsx('div', {
                className:
                  'flex size-[60px] items-center justify-center rounded-full border border-[#e6edf7] bg-gradient-to-br from-[#eef3ff] to-white text-[22px] font-black text-[#00385a]',
                children: a,
              }),
              s.jsxs('div', {
                className: 'flex-1',
                children: [
                  s.jsx('h3', {
                    className: 'm-0 mb-1 text-[18px] font-black text-[#0b214a]',
                    children: t.name,
                  }),
                  s.jsxs('p', {
                    className: 'm-0 flex items-center gap-1 text-[13px] text-[#6c7b91]',
                    children: [
                      P.AGENT.PROFILE.FROM_STORE,
                      ' |',
                      s.jsx('span', {
                        className:
                          'inline-flex items-center rounded-md border border-[#fde047] bg-[#fef9c3] px-2 py-[3px] align-middle text-[11px] font-extrabold text-[#854d0e]',
                        children: P.AGENT.PROFILE.BADGE_GOLD,
                      }),
                      s.jsx('span', {
                        className:
                          'ml-1 inline-flex items-center rounded-md border border-[#fde047] bg-[#fef9c3] px-2 py-[3px] align-middle text-[11px] font-extrabold text-[#854d0e]',
                        children: P.AGENT.PROFILE.BADGE_VERIFIED,
                      }),
                    ],
                  }),
                ],
              }),
            ],
          }),
          s.jsxs('div', {
            className: 'flex flex-wrap gap-2',
            children: [
              s.jsxs('span', {
                className:
                  'inline-flex items-center rounded-full border border-[#cbead4] bg-gradient-to-b from-[#f3fff8] to-[#e8faef] px-2.5 py-[5px] text-[12px] font-bold text-[#0e8d52]',
                children: [P.AGENT.PROFILE.STATS_SCORE, ' ', r.score.toLocaleString()],
              }),
              s.jsxs('span', {
                className:
                  'inline-flex items-center rounded-full border border-[#cbead4] bg-gradient-to-b from-[#f3fff8] to-[#e8faef] px-2.5 py-[5px] text-[12px] font-bold text-[#0e8d52]',
                children: [P.AGENT.PROFILE.STATS_DAYS, ' ', r.days, ' 天'],
              }),
              s.jsxs('span', {
                className:
                  'inline-flex items-center rounded-full border border-[#cbead4] bg-gradient-to-b from-[#f3fff8] to-[#e8faef] px-2.5 py-[5px] text-[12px] font-bold text-[#0e8d52]',
                children: [P.AGENT.PROFILE.STATS_LIKED, ' ', r.liked],
              }),
            ],
          }),
          s.jsxs('div', {
            className: 'flex flex-wrap justify-start gap-2.5',
            children: [
              s.jsx(We, {
                to: ve.UAG,
                className:
                  'inline-flex items-center justify-center gap-1.5 rounded-full border-none bg-gradient-to-br from-[#00385a] to-[#005282] px-4 py-2.5 text-[13px] font-bold text-white no-underline opacity-100 transition-all hover:opacity-100',
                children: P.AGENT.PROFILE.LINK_WORKBENCH,
              }),
              s.jsx(We, {
                to: `/community/${t.communityId || 'test-uuid'}/wall`,
                className:
                  'ml-auto inline-flex items-center justify-center gap-1.5 rounded-full border border-solid border-[#bfdbfe] bg-[#eff6ff] px-4 py-2.5 text-[13px] font-bold text-[#00385a] no-underline opacity-100 transition-all max-[400px]:ml-0 max-[400px]:w-full',
                children: P.AGENT.PROFILE.LINK_WALL,
              }),
            ],
          }),
        ],
      })
    );
  }),
  kv = ({ stats: e, todos: t, hotPosts: r = [], className: n = '' }) =>
    s.jsxs('aside', {
      className: `sticky top-[70px] hidden w-[280px] shrink-0 flex-col gap-3 self-start md:flex ${n}`,
      children: [
        s.jsxs('div', {
          className:
            'rounded-[14px] border border-[#e6edf7] bg-white p-[14px] shadow-[0_4px_14px_rgba(0,51,102,0.04)]',
          children: [
            s.jsx('h4', {
              className: 'm-0 mb-2.5 text-[14px] font-bold text-[#00385a]',
              children: P.AGENT.SIDEBAR.NAV_TITLE,
            }),
            s.jsxs('div', {
              className: 'flex flex-col gap-1.5',
              children: [
                s.jsx(We, {
                  to: ve.UAG,
                  className:
                    'flex items-center gap-2 rounded-[10px] bg-gradient-to-br from-[#00385a] to-[#005282] p-2.5 text-[13px] font-semibold text-white no-underline',
                  children: P.AGENT.SIDEBAR.LINK_UAG,
                }),
                s.jsx(We, {
                  to: `${ve.UAG}#stats`,
                  className:
                    'flex items-center gap-2 rounded-[10px] p-2.5 text-[13px] font-semibold text-[#0b214a] no-underline transition-colors hover:bg-[#f0f7ff]',
                  children: P.AGENT.SIDEBAR.LINK_STATS,
                }),
                s.jsx(We, {
                  to: ve.ASSURE,
                  className:
                    'flex items-center gap-2 rounded-[10px] p-2.5 text-[13px] font-semibold text-[#0b214a] no-underline transition-colors hover:bg-[#f0f7ff]',
                  children: P.AGENT.SIDEBAR.LINK_TRUST,
                }),
                s.jsxs(We, {
                  to: '/community/test-uuid/wall',
                  className:
                    'relative flex items-center gap-2 rounded-[10px] p-2.5 text-[13px] font-semibold text-[#0b214a] no-underline transition-colors hover:bg-[#f0f7ff]',
                  children: [
                    P.AGENT.SIDEBAR.LINK_WALL,
                    s.jsx('span', {
                      className: 'absolute right-2 top-3 size-2 rounded-full bg-red-500',
                    }),
                  ],
                }),
              ],
            }),
          ],
        }),
        s.jsxs('div', {
          className:
            'rounded-[14px] border border-[#e6edf7] bg-white p-[14px] shadow-[0_4px_14px_rgba(0,51,102,0.04)]',
          children: [
            s.jsx('h4', {
              className: 'm-0 mb-2.5 text-[14px] font-bold text-[#00385a]',
              children: P.AGENT.SIDEBAR.PERF_TITLE,
            }),
            s.jsxs('p', {
              className: 'm-0 text-[13px] leading-[1.8] text-[#6c7b91]',
              children: [
                P.AGENT.SIDEBAR.PERF_DEAL_COUNT_PREFIX,
                ' ',
                s.jsx('b', { className: 'text-[#00385a]', children: '2' }),
                ' ',
                P.AGENT.SIDEBAR.PERF_DEAL_COUNT_UNIT,
                s.jsx('br', {}),
                P.AGENT.SIDEBAR.PERF_AMOUNT_PREFIX,
                ' ',
                s.jsx('b', {
                  className: 'text-[#00385a]',
                  children: '$3,280萬',
                }),
                s.jsx('br', {}),
                P.AGENT.SIDEBAR.PERF_CLIENTS_PREFIX,
                ' ',
                s.jsx('b', { className: 'text-[#00385a]', children: '18' }),
                ' ',
                P.AGENT.SIDEBAR.PERF_CLIENTS_UNIT,
              ],
            }),
          ],
        }),
        s.jsxs('div', {
          className:
            'rounded-[14px] border border-[#e6edf7] bg-white p-[14px] shadow-[0_4px_14px_rgba(0,51,102,0.04)]',
          children: [
            s.jsxs('div', {
              className: 'mb-2.5 flex items-center justify-between',
              children: [
                s.jsx('h4', {
                  className: 'm-0 text-[14px] font-bold text-[#00385a]',
                  children: P.AGENT.SIDEBAR.TODO_TITLE,
                }),
                t.length > 0 &&
                  s.jsx('span', {
                    className:
                      'rounded-full bg-red-100 px-1.5 py-0.5 text-[10px] font-bold text-red-600',
                    children: t.length,
                  }),
              ],
            }),
            s.jsxs('div', {
              className: 'flex flex-col gap-2',
              children: [
                t.map((a) =>
                  s.jsxs(
                    'div',
                    {
                      className:
                        'flex gap-1.5 align-baseline text-[13px] leading-tight text-[#6c7b91]',
                      children: [
                        s.jsx('span', {
                          className: 'shrink-0',
                          children: a.type === 'contact' ? '📞' : '🔔',
                        }),
                        s.jsx('span', { children: a.content }),
                      ],
                    },
                    a.id
                  )
                ),
                t.length === 0 &&
                  s.jsx('span', {
                    className: 'text-xs text-gray-400',
                    children: P.AGENT.SIDEBAR.TODO_EMPTY,
                  }),
              ],
            }),
          ],
        }),
        r.length > 0 &&
          s.jsxs('div', {
            className:
              'rounded-[14px] border border-[#e6edf7] bg-white p-[14px] shadow-[0_4px_14px_rgba(0,51,102,0.04)]',
            children: [
              s.jsx('h4', {
                className: 'm-0 mb-2.5 text-[14px] font-bold text-[#00385a]',
                children: P.FEED.SIDEBAR.HOT_TITLE,
              }),
              s.jsx('ul', {
                className: 'm-0 flex list-none flex-col gap-3 p-0',
                children: r.map((a) =>
                  s.jsxs(
                    'li',
                    {
                      className: 'text-[13px] leading-tight',
                      children: [
                        s.jsx(We, {
                          to: `/post/${a.id}`,
                          className:
                            'mb-0.5 line-clamp-2 block font-medium text-[#0b214a] no-underline hover:text-[#005282]',
                          children: a.title,
                        }),
                        s.jsxs('span', {
                          className: 'flex items-center gap-1 text-[11px] text-[#94a3b8]',
                          children: [a.communityName, ' · 👍 ', a.likes],
                        }),
                      ],
                    },
                    a.id
                  )
                ),
              }),
            ],
          }),
      ],
    }),
  Sv = ({ data: e, className: t = '' }) =>
    s.jsxs('article', {
      className: `animate-in fade-in slide-in-from-bottom-4 flex flex-col gap-3 rounded-2xl border border-[#e6edf7] bg-white p-4 shadow-[0_4px_14px_rgba(12,34,80,0.04)] duration-500 ${t}`,
      children: [
        s.jsxs('div', {
          className: 'flex items-center gap-3 border-b border-[#f1f5f9] pb-2.5',
          children: [
            s.jsx('div', {
              className:
                'flex size-10 items-center justify-center rounded-full border border-[#e6edf7] bg-[#faefe5] font-black text-[#92400e]',
              children: '客',
            }),
            s.jsxs('div', {
              className: 'flex-1 leading-[1.3]',
              children: [
                s.jsx('b', {
                  className: 'block text-[15px] text-[#0f172a]',
                  children: P.AGENT.UAG.TITLE,
                }),
                s.jsx('div', {
                  className: 'text-[12px] text-[#6c7b91]',
                  children: 'UAG 精準獲客 · 即時',
                }),
              ],
            }),
          ],
        }),
        s.jsx('div', {
          className: 'pt-1',
          children: s.jsxs('div', {
            className: 'grid grid-cols-3 gap-2',
            children: [
              s.jsxs('div', {
                className:
                  'flex h-[34px] items-center justify-center rounded-full border border-[#cbead4] bg-[#e8faef] text-[14px] font-semibold text-[#107a39]',
                children: ['S ', e.grade === 'S' ? '2' : '0'],
              }),
              s.jsxs('div', {
                className:
                  'flex h-[34px] items-center justify-center rounded-full border border-[#cbead4] bg-[#e8faef] text-[14px] font-semibold text-[#107a39]',
                children: ['A ', e.grade === 'S' ? '1' : '0'],
              }),
              s.jsx('div', {
                className:
                  'flex h-[34px] items-center justify-center rounded-full border border-[#e6edf7] text-[14px] font-semibold text-[#64748b]',
                children: 'B 0',
              }),
              s.jsx('div', {
                className:
                  'flex h-[34px] items-center justify-center rounded-full border border-[#e6edf7] text-[14px] font-semibold text-[#64748b]',
                children: '未回覆 1',
              }),
              s.jsx('div', {
                className:
                  'flex h-[34px] items-center justify-center rounded-full border border-[#e6edf7] text-[14px] font-semibold text-[#64748b]',
                children: '逾時 0',
              }),
              s.jsxs('div', {
                className:
                  'flex h-[34px] items-center justify-center rounded-full border border-[#e6edf7] text-[14px] font-semibold text-[#64748b]',
                children: ['近7日新增 ', e.growth],
              }),
            ],
          }),
        }),
        s.jsx('div', {
          className: 'mt-2.5 flex justify-end',
          children: s.jsx(We, {
            to: ve.UAG,
            className:
              'rounded-xl border-none bg-[#00385a] px-3 py-2 text-[14px] font-bold text-white no-underline transition-colors hover:bg-[#002840]',
            children: P.AGENT.UAG.LINK_WORKBENCH,
          }),
        }),
      ],
    });
function Ev(e, t) {
  const r = h.useMemo(() => Xy(), []),
    n = cd({ persistMockState: !0, initialMockData: r }),
    a = h.useMemo(() => Ky(), []),
    i = h.useMemo(() => Qy(), []),
    o = h.useMemo(() => Jy(), []),
    { addComment: l } = n,
    c = h.useCallback(
      async (d, m) => {
        try {
          (typeof l == 'function' && (await l(d, m)), W.success('留言成功', '您的留言已發佈'));
        } catch {
          W.error('留言失敗', '請稍後再試');
        }
      },
      [l]
    );
  return {
    ...n,
    uagSummary: a,
    performanceStats: i,
    todoList: o,
    handleComment: c,
  };
}
function Tv({ userId: e, forceMock: t }) {
  var y;
  const {
      data: r,
      uagSummary: n,
      performanceStats: a,
      todoList: i,
      viewerRole: o,
      createPost: l,
      toggleLike: c,
      isLiked: d,
      handleComment: m,
      useMock: u,
      setUseMock: x,
    } = Ev(),
    { user: f } = Ct(),
    g = h.useMemo(() => {
      var p;
      return {
        id: (f == null ? void 0 : f.id) || 'demo-agent',
        name: ((p = f == null ? void 0 : f.user_metadata) == null ? void 0 : p.name) || '游杰倫',
        role: o || 'agent',
        communityId: P.FEED.DEFAULT_COMMUNITY_ID,
        communityName: P.FEED.DEFAULT_COMMUNITY_NAME,
        email: (f == null ? void 0 : f.email) || 'agent@maihouses.com',
        stats: { days: a.days, liked: a.liked, contributions: a.replies },
      };
    }, [f, o, a]),
    b = async (p, E) => {
      await l(p, g.communityId, E);
    };
  return s.jsxs('div', {
    className: 'min-h-screen bg-[#f6f9ff]',
    children: [
      s.jsx(fs, { mode: 'agent', title: P.FEED.PAGE_TITLE }),
      s.jsxs('div', {
        className: 'mx-auto flex max-w-[960px] gap-5 p-2.5 pb-24 md:pb-5',
        children: [
          s.jsxs('main', {
            className: 'mx-auto flex w-full max-w-[560px] flex-1 flex-col gap-3 pb-20 md:pb-0',
            children: [
              s.jsx(_v, { profile: g, stats: a }),
              s.jsx(Jc, {
                userInitial: g.name.charAt(0).toUpperCase(),
                onSubmit: b,
              }),
              s.jsx(Sv, { data: n }),
              s.jsxs('article', {
                className:
                  'animate-in fade-in slide-in-from-bottom-4 flex flex-col gap-3 rounded-2xl border border-[#e6edf7] bg-white p-4 shadow-[0_4px_14px_rgba(12,34,80,0.04)] duration-500',
                children: [
                  s.jsxs('div', {
                    className: 'flex items-center gap-3 border-b border-[#f1f5f9] pb-2.5',
                    children: [
                      s.jsx('div', {
                        className:
                          'flex size-10 items-center justify-center rounded-full border border-[#e6edf7] bg-[#eef3ff] font-black text-[#173a7c]',
                        children: '安',
                      }),
                      s.jsxs('div', {
                        className: 'flex-1 leading-[1.3]',
                        children: [
                          s.jsx('b', {
                            className: 'block text-[15px] text-[#0f172a]',
                            children: P.AGENT.TRUST.TITLE,
                          }),
                          s.jsx('div', {
                            className: 'text-[12px] text-[#6c7b91]',
                            children: '帶看完成 · 惠宇上晴 12F A2 · 剛剛',
                          }),
                        ],
                      }),
                    ],
                  }),
                  s.jsxs('div', {
                    className: 'pt-1',
                    children: [
                      s.jsx('p', {
                        className: 'm-0 mb-2.5 leading-[1.6]',
                        children: P.AGENT.TRUST.DESC_1,
                      }),
                      s.jsx('p', {
                        className: 'm-0 mb-2.5 leading-[1.6]',
                        children: P.AGENT.TRUST.DESC_2,
                      }),
                      s.jsxs('div', {
                        className: 'flex flex-wrap gap-1.5',
                        children: [
                          s.jsx('span', {
                            className:
                              'rounded-full border border-[#cbead4] bg-[#e8faef] px-2 py-0.5 text-[12px] text-[#107a39]',
                            children: P.AGENT.TRUST.TAG_COMPLETED,
                          }),
                          s.jsx('span', {
                            className:
                              'rounded-full border border-[#e6edf7] bg-white px-2 py-0.5 text-[12px]',
                            children: P.AGENT.TRUST.TAG_CERT,
                          }),
                          s.jsx('span', {
                            className:
                              'rounded-full border border-[#e6edf7] bg-white px-2 py-0.5 text-[12px]',
                            children: P.AGENT.TRUST.TAG_PRIVATE,
                          }),
                        ],
                      }),
                    ],
                  }),
                  s.jsxs('div', {
                    className: 'flex gap-2',
                    children: [
                      s.jsx('button', {
                        className:
                          'flex-1 rounded-lg border border-[#e6edf7] bg-white px-3 py-2 text-sm font-extrabold',
                        children: P.AGENT.TRUST.BTN_LIKE,
                      }),
                      s.jsx('button', {
                        className:
                          'flex-1 rounded-lg border border-[#e6edf7] bg-white px-3 py-2 text-sm font-extrabold',
                        children: P.AGENT.TRUST.BTN_REPLY,
                      }),
                      s.jsx('button', {
                        className:
                          'flex-1 rounded-lg border border-[#1749d7] bg-[#1749d7] px-3 py-2 text-sm font-extrabold text-white',
                        children: P.AGENT.TRUST.BTN_DETAIL,
                      }),
                    ],
                  }),
                ],
              }),
              r.posts.map((p) =>
                s.jsx(
                  ka,
                  {
                    post: p,
                    isLiked: d(p.id),
                    onLike: () => c(p.id),
                    onComment: m,
                    className: 'animate-in fade-in slide-in-from-bottom-4 duration-500',
                  },
                  p.id
                )
              ),
            ],
          }),
          s.jsx(kv, {
            stats: a,
            todos: i,
            hotPosts: ((y = r.sidebarData) == null ? void 0 : y.hotPosts) || [],
          }),
        ],
      }),
      s.jsx(Xa, { useMock: u, onToggle: () => x(!u) }),
    ],
  });
}
function Iv({ currentRole: e, onToggle: t, className: r = '' }) {
  const n = e === 'agent';
  return s.jsxs('button', {
    onClick: t,
    className: `fixed bottom-24 right-4 z-[9999] flex items-center gap-2 rounded-full px-4 py-3 font-bold text-white shadow-lg transition-all active:scale-95 ${n ? 'bg-gradient-to-r from-amber-500 to-amber-600 shadow-amber-200' : 'shadow-brand-200 bg-gradient-to-r from-brand-500 to-brand-600'} ${r}`,
    title: n ? P.AGENT.OOS.SWITCH_TO_CONSUMER : P.AGENT.OOS.SWITCH_TO_AGENT,
    children: [
      n ? s.jsx(jl, { size: 20 }) : s.jsx(Qd, { size: 20 }),
      s.jsx('span', {
        children: n ? P.AGENT.ROLE.AGENT : P.AGENT.ROLE.CONSUMER,
      }),
    ],
  });
}
const Cv = ['demo-001', 'demo-consumer', 'demo-agent'];
function Av() {
  const { userId: e } = Er(),
    [t] = Tr(),
    [r, n] = h.useState('member'),
    [a, i] = h.useState(null),
    [o, l] = h.useState(!0),
    c = t.get('mock'),
    d = e ? Cv.includes(e) : !1,
    m = c === 'true' || d;
  h.useEffect(() => {
    if (!e) {
      l(!1);
      return;
    }
    if (d) {
      (n(e === 'demo-agent' ? 'agent' : 'member'), l(!1));
      return;
    }
    (async () => {
      try {
        const { data: g, error: b } = await de.from('profiles').select('role').eq('id', e).single();
        if (b) throw b;
        n((g == null ? void 0 : g.role) || 'member');
      } catch (g) {
        (console.error('[Feed] Failed to fetch role:', g), n('member'));
      } finally {
        l(!1);
      }
    })();
  }, [e, d]);
  const u = a || r,
    x = () => {
      i(u === 'agent' ? 'member' : 'agent');
    };
  return o
    ? s.jsx('div', {
        className: 'flex min-h-screen items-center justify-center bg-brand-50',
        children: s.jsx('div', {
          className: 'text-sm text-gray-500',
          children: '載入中...',
        }),
      })
    : e
      ? s.jsxs(s.Fragment, {
          children: [
            u === 'agent'
              ? s.jsx(Tv, { userId: e, forceMock: m })
              : s.jsx(Nv, { userId: e, forceMock: m }),
            m && s.jsx(Iv, { currentRole: u, onToggle: x }),
          ],
        })
      : s.jsx('div', {
          className: 'flex min-h-screen items-center justify-center bg-brand-50',
          children: s.jsx('div', {
            className: 'text-sm text-red-500',
            children: '缺少用戶 ID',
          }),
        });
}
function Or(e) {
  const t = e === 'guest',
    r = e === 'member',
    n = e === 'resident',
    a = e === 'agent';
  return {
    isGuest: t,
    isMember: r,
    isResident: n,
    isAgent: a,
    isLoggedIn: !t,
    canSeeAllReviews: !t,
    canSeeAllPosts: !t,
    canAccessPrivate: n || a,
    canPostPublic: n || a,
    canPostPrivate: n,
    canAskQuestion: !t,
    canAnswer: n || a,
    showExpertBadge: a,
  };
}
const Lv = 2,
  Ov = 3,
  Rv = 2;
function si(e, t, r = Lv) {
  return h.useMemo(() => {
    if (t) return { visible: e, hiddenCount: 0, nextHidden: null };
    const n = e.slice(0, r),
      a = Math.max(0, e.length - r),
      i = a > 0 ? (e[r] ?? null) : null;
    return { visible: n, hiddenCount: a, nextHidden: i };
  }, [e, t, r]);
}
function ri({
  children: e,
  hiddenCount: t,
  countLabel: r,
  benefits: n = ['查看完整內容', '新回答通知'],
  ctaText: a = '免費註冊 / 登入',
  onCtaClick: i,
  showCta: o = !0,
  visible: l = !0,
}) {
  if (t <= 0) return null;
  const c = !l;
  return s.jsxs('div', {
    className: `relative transition-opacity duration-200 ${c ? 'pointer-events-none opacity-0' : 'opacity-100'}`,
    'aria-hidden': c,
    children: [
      s.jsx('div', {
        className: 'pointer-events-none select-none blur-sm',
        'aria-hidden': 'true',
        children: e,
      }),
      s.jsxs('div', {
        className:
          'absolute inset-0 flex flex-col items-center justify-center rounded-[14px] bg-white/85 p-5 text-center',
        children: [
          s.jsxs('h4', {
            className: 'mb-1 text-sm font-extrabold text-brand-700',
            children: ['🔒 還有 ', t, ' ', r],
          }),
          s.jsx('p', {
            className: 'mb-2.5 text-xs text-ink-600',
            children: n.map((d, m) => s.jsxs('span', { children: [m > 0 && '　', '✓ ', d] }, m)),
          }),
          o &&
            s.jsx('button', {
              onClick: i,
              className:
                'rounded-full bg-gradient-to-br from-brand to-brand-600 px-6 py-2.5 text-[13px] font-bold text-white transition-transform hover:scale-[1.02]',
              children: a,
            }),
        ],
      }),
    ],
  });
}
function Lo({ entry: e }) {
  const t = e.type === 'pro',
    r = e.visits > 0,
    n = e.deals > 0;
  return s.jsxs('div', {
    className:
      'rounded-[14px] border border-border-light bg-white p-3.5 transition-all hover:border-brand/15 hover:shadow-[0_2px_8px_rgba(0,56,90,0.04)]',
    children: [
      s.jsxs('div', {
        className: 'mb-2.5 flex items-center gap-2.5',
        children: [
          s.jsx('div', {
            className:
              'flex size-[38px] items-center justify-center rounded-full border-2 border-brand bg-gradient-to-br from-brand-100/50 to-white text-sm font-extrabold text-brand',
            'aria-hidden': 'true',
            children: e.author.charAt(0),
          }),
          s.jsxs('div', {
            className: 'flex-1',
            children: [
              s.jsxs('div', {
                className: 'text-[13px] font-bold text-ink-900',
                children: [e.author, e.company ? `｜${e.company}` : ''],
              }),
              (r || n) &&
                s.jsxs('div', {
                  className: 'text-[11px] text-ink-600',
                  children: [
                    r && `帶看 ${e.visits} 次`,
                    r && n && ' · ',
                    n && `成交 ${e.deals} 戶`,
                  ],
                }),
            ],
          }),
        ],
      }),
      s.jsxs('div', {
        className: `flex items-start gap-2.5 rounded-[10px] p-2 text-[13px] leading-relaxed ${t ? 'bg-gradient-to-br from-brand-50 to-brand-100/50' : 'bg-gradient-to-br from-brand-100/30 to-brand-100'}`,
        children: [
          s.jsx('span', {
            className: 'flex size-6 shrink-0 items-center justify-center text-base',
            'aria-hidden': 'true',
            children: t ? '✅' : '⚖️',
          }),
          s.jsx('span', { className: 'flex-1 text-ink-900', children: e.text }),
        ],
      }),
    ],
  });
}
function Mv({ viewerRole: e, reviews: t, onUnlock: r }) {
  const n = Array.isArray(t) ? t : ((t == null ? void 0 : t.items) ?? []),
    a = Or(e),
    i = h.useMemo(() => {
      const d = [];
      return (
        n.forEach((m) => {
          (m.pros.forEach((x, f) => {
            x &&
              d.push({
                id: `${m.id}-pro-${f}`,
                type: 'pro',
                text: x,
                author: m.author,
                company: m.company,
                visits: m.visits,
                deals: m.deals,
              });
          }),
            (Array.isArray(m.cons) ? m.cons : [m.cons]).forEach((x, f) => {
              x &&
                d.push({
                  id: `${m.id}-con-${f}`,
                  type: 'con',
                  text: x,
                  author: m.author,
                  company: m.company,
                  visits: m.visits,
                  deals: m.deals,
                });
            }));
        }),
        d
      );
    }, [n]),
    { visible: o, hiddenCount: l, nextHidden: c } = si(i, a.canSeeAllReviews);
  return s.jsxs('section', {
    className:
      'bg-white/98 overflow-hidden rounded-[18px] border border-border-light shadow-[0_2px_12px_rgba(0,51,102,0.04)]',
    'aria-labelledby': 'reviews-heading',
    children: [
      s.jsxs('div', {
        className:
          'from-brand/8 to-brand-600/4 flex items-center justify-between border-b border-brand/5 bg-gradient-to-br px-4 py-3.5',
        children: [
          s.jsxs('div', {
            children: [
              s.jsx('h2', {
                id: 'reviews-heading',
                className: 'flex items-center gap-1.5 text-[15px] font-extrabold text-brand-700',
                children: '⭐ 社區評價',
              }),
              s.jsx('p', {
                className: 'mt-0.5 text-[11px] text-ink-600',
                children: '來自最真實的評價',
              }),
            ],
          }),
          s.jsxs('span', {
            className:
              'bg-brand/8 flex items-center gap-1 rounded-full border border-brand-600 px-2.5 py-1 text-[10px] font-bold text-brand',
            children: [n.length, ' 則評價'],
          }),
        ],
      }),
      s.jsxs('div', {
        className: 'flex flex-col gap-2.5 p-3.5',
        children: [
          o.map((d) => s.jsx(Lo, { entry: d }, d.id)),
          s.jsx(ri, {
            visible: l > 0 && !!c,
            hiddenCount: l,
            countLabel: '則評價',
            benefits: ['查看全部評價', '新回答通知'],
            ...(r ? { onCtaClick: r } : {}),
            children: c && s.jsx(Lo, { entry: c }),
          }),
        ],
      }),
    ],
  });
}
function Pv(e, t, r = {}) {
  const { leading: n = !0, trailing: a = !1 } = r,
    i = h.useRef(0),
    o = h.useRef(null),
    l = h.useRef(null),
    c = h.useRef(e);
  return (
    h.useEffect(() => {
      c.current = e;
    }, [e]),
    h.useEffect(
      () => () => {
        o.current && clearTimeout(o.current);
      },
      []
    ),
    h.useCallback(
      (...m) => {
        const u = Date.now();
        l.current = m;
        const x = () => {
            l.current && (c.current(...l.current), (i.current = Date.now()), (l.current = null));
          },
          f = t - (u - i.current);
        if (f <= 0) {
          (o.current && (clearTimeout(o.current), (o.current = null)),
            n
              ? x()
              : a &&
                (o.current = setTimeout(() => {
                  ((o.current = null), x());
                }, t)));
          return;
        }
        a &&
          !o.current &&
          (o.current = setTimeout(() => {
            ((o.current = null), x());
          }, f));
      },
      [t, n, a]
    )
  );
}
function zv({
  onSubmit: e,
  onSuccess: t,
  onError: r,
  initialVisibility: n = 'public',
  minLength: a = 5,
  maxLength: i = 500,
}) {
  const [o, l] = h.useState(''),
    [c, d] = h.useState(n),
    [m, u] = h.useState(void 0),
    [x, f] = h.useState([]),
    [g, b] = h.useState(!1),
    [y, p] = h.useState(null);
  h.useEffect(() => {
    d(n);
  }, [n]);
  const E = h.useCallback(() => {
      (l(''), d(n), u(void 0), f([]), p(null), b(!1));
    }, [n]),
    S = h.useCallback(() => {
      const k = o.trim();
      return k.length < a
        ? P.VALIDATION.MIN_LENGTH(a)
        : k.length > i
          ? P.VALIDATION.MAX_LENGTH(i)
          : null;
    }, [o, a, i]),
    N = h.useCallback(async () => {
      const k = S();
      if (k) {
        p(k);
        return;
      }
      (b(!0), p(null));
      try {
        (await e({
          content: o.trim(),
          visibility: c,
          communityId: m,
          images: x,
        }),
          t == null || t(),
          E());
      } catch (T) {
        const C = T instanceof Error ? T.message : P.VALIDATION.SUBMIT_ERROR;
        (p(C), r == null || r(T instanceof Error ? T : new Error(C)));
      } finally {
        b(!1);
      }
    }, [o, c, m, x, e, t, r, E, S]);
  return {
    content: o,
    setContent: l,
    visibility: c,
    setVisibility: d,
    communityId: m,
    setCommunityId: u,
    images: x,
    setImages: f,
    isSubmitting: g,
    error: y,
    submit: N,
    reset: E,
    validate: S,
    isValid: !S(),
    charCount: o.trim().length,
    minLength: a,
    maxLength: i,
  };
}
function Dv(e, t) {
  h.useEffect(() => {
    if (!e) return;
    const r = document.body.style.overflow;
    document.body.style.overflow = 'hidden';
    const n =
        t != null && t.inertTargetId
          ? document.getElementById(t.inertTargetId)
          : document.getElementById('root'),
      a = (n == null ? void 0 : n.getAttribute('aria-hidden')) ?? null,
      i = (n == null ? void 0 : n.hasAttribute('inert')) ?? !1;
    return (
      n && (n.setAttribute('aria-hidden', 'true'), n.setAttribute('inert', 'true')),
      () => {
        ((document.body.style.overflow = r),
          n &&
            (a === null ? n.removeAttribute('aria-hidden') : n.setAttribute('aria-hidden', a),
            i || n.removeAttribute('inert')));
      }
    );
  }, [e, t == null ? void 0 : t.inertTargetId]);
}
function dd({ children: e, isActive: t, initialFocusRef: r }) {
  const n = h.useRef(null),
    a = h.useRef(null);
  return (
    h.useEffect(() => {
      if (t) {
        if (((a.current = document.activeElement), r != null && r.current)) r.current.focus();
        else if (n.current) {
          const i = n.current.querySelectorAll(
            'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'
          );
          i.length > 0 && i[0].focus();
        }
      } else a.current && a.current.focus();
    }, [t, r]),
    h.useEffect(() => {
      if (!t) return;
      const i = (o) => {
        if (o.key !== 'Tab') return;
        const l = n.current;
        if (!l) return;
        const c = l.querySelectorAll(
            'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'
          ),
          d = c[0],
          m = Array.from(c).at(-1);
        o.shiftKey
          ? document.activeElement === d && (o.preventDefault(), m.focus())
          : document.activeElement === m && (o.preventDefault(), d.focus());
      };
      return (
        document.addEventListener('keydown', i),
        () => document.removeEventListener('keydown', i)
      );
    }, [t]),
    s.jsx('div', { ref: n, children: e })
  );
}
const Fv = h.memo(function ({ isOpen: t, onClose: r }) {
    const n = h.useCallback(() => {
      r();
    }, [r]);
    return t
      ? s.jsx(dd, {
          isActive: t,
          children: s.jsx('div', {
            className:
              'fixed inset-0 z-modal flex items-center justify-center bg-black/50 p-4 backdrop-blur-sm',
            role: 'dialog',
            'aria-modal': 'true',
            'aria-labelledby': 'login-title',
            children: s.jsxs('div', {
              className: 'w-full max-w-md rounded-2xl bg-white p-6 text-center shadow-xl',
              children: [
                s.jsx('h3', {
                  id: 'login-title',
                  className: 'mb-2 text-xl font-bold text-gray-900',
                  children: P.COMPOSER.LOGIN_TITLE,
                }),
                s.jsx('p', {
                  className: 'mb-6 text-gray-600',
                  children: P.COMPOSER.LOGIN_DESC,
                }),
                s.jsxs('div', {
                  className: 'flex justify-center gap-4',
                  children: [
                    s.jsx('button', {
                      type: 'button',
                      onClick: n,
                      className:
                        'rounded-lg px-4 py-2 text-gray-600 transition-colors hover:bg-gray-100',
                      children: P.COMPOSER.CANCEL,
                    }),
                    s.jsx('a', {
                      href: ve.AUTH,
                      className:
                        'rounded-lg bg-brand-600 px-4 py-2 text-white transition-colors hover:bg-brand-700',
                      children: P.COMPOSER.GO_LOGIN,
                    }),
                  ],
                }),
              ],
            }),
          }),
        })
      : null;
  }),
  $v = 50;
function Uv({
  isOpen: e,
  onClose: t,
  onSubmit: r,
  mode: n,
  initialVisibility: a = 'public',
  placeholder: i,
}) {
  const { isAuthenticated: o } = Ct(),
    l = h.useRef(null),
    c = h.useRef(null),
    {
      content: d,
      setContent: m,
      visibility: u,
      setVisibility: x,
      isSubmitting: f,
      error: g,
      submit: b,
      reset: y,
      isValid: p,
      charCount: E,
      maxLength: S,
      minLength: N,
    } = zv({
      onSubmit: r,
      onSuccess: () => {
        (W.success(P.COMPOSER.SUCCESS), t());
      },
      onError: (C) => {
        W.error(P.COMPOSER.ERROR_TITLE, C.message);
      },
      initialVisibility: a,
    });
  if (
    (Dv(e, { inertTargetId: 'root' }),
    h.useEffect(() => {
      l.current &&
        ((l.current.style.height = 'auto'),
        (l.current.style.height = l.current.scrollHeight + 'px'));
    }, [d, e]),
    h.useEffect(() => {
      e || y();
    }, [e, y]),
    h.useEffect(() => {
      const C = (w) => {
        (w.key === 'Escape' && !f && t(),
          (w.ctrlKey || w.metaKey) && w.key === 'Enter' && p && !f && b());
      };
      return (
        e && window.addEventListener('keydown', C),
        () => window.removeEventListener('keydown', C)
      );
    }, [e, t, f, p, b]),
    h.useEffect(() => {
      e &&
        l.current &&
        setTimeout(() => {
          var C;
          (C = l.current) == null || C.focus();
        }, $v);
    }, [e]),
    !e)
  )
    return null;
  if (!o) return s.jsx(Fv, { isOpen: e, onClose: t });
  const k = u === 'private',
    T =
      i ||
      (n === 'community'
        ? k
          ? P.COMPOSER.PLACEHOLDER_COMMUNITY_PRIVATE
          : P.COMPOSER.PLACEHOLDER_COMMUNITY_PUBLIC
        : P.COMPOSER.PLACEHOLDER_FEED);
  return s.jsx(dd, {
    isActive: e,
    initialFocusRef: l,
    children: s.jsxs('div', {
      className: 'fixed inset-0 z-modal flex items-center justify-center p-4',
      children: [
        s.jsx('button', {
          type: 'button',
          className:
            'absolute inset-0 size-full cursor-default border-0 bg-black/50 backdrop-blur-sm',
          onClick: () => !f && t(),
          'aria-label': P.COMPOSER.CLOSE,
          tabIndex: -1,
        }),
        s.jsxs('div', {
          ref: c,
          role: 'dialog',
          'aria-modal': 'true',
          'aria-labelledby': 'composer-title',
          className:
            'relative z-10 flex max-h-[90dvh] w-full max-w-lg flex-col rounded-2xl bg-white shadow-2xl',
          children: [
            s.jsxs('div', {
              className: 'flex items-center justify-between border-b border-gray-100 px-4 py-3',
              children: [
                s.jsx('h2', {
                  id: 'composer-title',
                  className: 'flex items-center gap-2 text-lg font-bold text-gray-800',
                  children:
                    n === 'community' && k ? P.COMPOSER.TITLE_PRIVATE : P.COMPOSER.TITLE_PUBLIC,
                }),
                s.jsx('button', {
                  onClick: t,
                  disabled: f,
                  'aria-label': P.COMPOSER.CLOSE,
                  className:
                    'rounded-full p-2 text-gray-400 transition-colors hover:bg-gray-100 hover:text-gray-600 disabled:opacity-50',
                  children: P.COMPOSER.CLOSE_ICON,
                }),
              ],
            }),
            s.jsxs('div', {
              className: 'flex-1 overflow-y-auto p-4',
              children: [
                n === 'community' &&
                  s.jsxs('div', {
                    className: 'mb-4 flex gap-2',
                    children: [
                      s.jsx('button', {
                        type: 'button',
                        onClick: () => x('public'),
                        className: `flex-1 rounded-lg border px-3 py-2 text-sm font-medium transition-colors ${u === 'public' ? 'border-brand-200 bg-brand-50 text-brand-700' : 'border-gray-200 bg-white text-gray-600 hover:bg-gray-50'}`,
                        children: P.COMPOSER.VISIBILITY_PUBLIC,
                      }),
                      s.jsx('button', {
                        type: 'button',
                        onClick: () => x('private'),
                        className: `flex-1 rounded-lg border px-3 py-2 text-sm font-medium transition-colors ${u === 'private' ? 'border-amber-200 bg-amber-50 text-amber-700' : 'border-gray-200 bg-white text-gray-600 hover:bg-gray-50'}`,
                        children: P.COMPOSER.VISIBILITY_PRIVATE,
                      }),
                    ],
                  }),
                s.jsx('textarea', {
                  ref: l,
                  value: d,
                  onChange: (C) => m(C.target.value),
                  placeholder: T,
                  className:
                    'min-h-[150px] w-full resize-none text-base text-gray-800 placeholder:text-gray-400 focus:outline-none',
                  disabled: f,
                  minLength: N,
                  maxLength: S,
                  'aria-describedby': 'composer-counter',
                }),
                s.jsx('div', {
                  className: 'mt-4',
                  children: s.jsx('button', {
                    type: 'button',
                    onClick: () => W.dev(P.COMPOSER.UPLOAD_IMAGE_DEV),
                    className:
                      'inline-flex items-center gap-2 rounded-lg px-3 py-2 text-sm font-medium text-gray-500 transition-colors hover:bg-gray-50 hover:text-brand-600',
                    children: P.COMPOSER.UPLOAD_IMAGE,
                  }),
                }),
                g &&
                  s.jsx('div', {
                    className: 'mt-3 rounded-lg bg-red-50 p-3 text-sm text-red-600',
                    role: 'alert',
                    children: g,
                  }),
              ],
            }),
            s.jsxs('div', {
              className:
                'flex items-center justify-between rounded-b-2xl border-t border-gray-100 bg-gray-50 px-4 py-3',
              children: [
                s.jsxs('span', {
                  id: 'composer-counter',
                  className: `text-xs ${E > S ? 'text-red-500' : 'text-gray-400'}`,
                  children: [E, ' / ', S],
                }),
                s.jsxs('div', {
                  className: 'flex gap-3',
                  children: [
                    s.jsx('button', {
                      type: 'button',
                      onClick: t,
                      disabled: f,
                      className:
                        'rounded-lg px-4 py-2 font-medium text-gray-600 transition-colors hover:bg-gray-200 disabled:opacity-50',
                      children: P.COMPOSER.CANCEL,
                    }),
                    s.jsx('button', {
                      type: 'button',
                      onClick: b,
                      disabled: !p || f,
                      className:
                        'rounded-lg bg-brand-600 px-6 py-2 font-bold text-white shadow-sm transition-colors hover:bg-brand-700 hover:shadow disabled:cursor-not-allowed disabled:opacity-50',
                      children: f ? P.COMPOSER.SUBMITTING : P.COMPOSER.SUBMIT,
                    }),
                  ],
                }),
              ],
            }),
          ],
        }),
      ],
    }),
  });
}
const zs = new Intl.RelativeTimeFormat('zh-TW', { numeric: 'auto' }),
  xn = 60 * 1e3,
  Ta = 60 * xn,
  jr = 24 * Ta,
  Oo = 7 * jr,
  Ro = 30 * jr,
  Mo = 365 * jr,
  Bv = (e) => {
    if (e instanceof Date) return Number.isNaN(e.getTime()) ? null : e;
    if (typeof e == 'number') {
      const r = new Date(e);
      return Number.isNaN(r.getTime()) ? null : r;
    }
    const t = new Date(e);
    return Number.isNaN(t.getTime()) ? null : t;
  };
function ud(e) {
  const t = Bv(e);
  if (!t) return typeof e == 'string' && e.trim() ? e : '剛剛';
  const r = Date.now() - t.getTime();
  if (r < 0) return t.toLocaleDateString('zh-TW');
  if (r < xn) return '剛剛';
  if (r < Ta) {
    const a = Math.round(r / xn);
    return zs.format(-a, 'minute');
  }
  if (r < jr) {
    const a = Math.round(r / Ta);
    return zs.format(-a, 'hour');
  }
  if (r < Oo) {
    const a = Math.round(r / jr);
    return zs.format(-a, 'day');
  }
  if (r < Ro) {
    const a = Math.round(r / Oo);
    return zs.format(-a, 'week');
  }
  if (r < Mo) {
    const a = Math.round(r / Ro);
    return zs.format(-a, 'month');
  }
  const n = Math.round(r / Mo);
  return zs.format(-n, 'year');
}
function ft(e) {
  const t = Date.now() - e * xn;
  return new Date(t).toISOString();
}
const { COMMUNITY: he } = P;
function Gv({ post: e }) {
  const t = e.type === 'agent',
    r = e.type === 'official';
  return t
    ? s.jsx('span', {
        className: 'rounded bg-brand-100 px-1.5 py-0.5 text-[9px] font-bold text-brand-600',
        children: he.AGENT_BADGE,
      })
    : r
      ? s.jsx('span', {
          className: 'rounded bg-brand-50 px-1.5 py-0.5 text-[9px] font-bold text-brand',
          children: he.OFFICIAL_BADGE,
        })
      : e.floor
        ? s.jsxs('span', {
            className: 'rounded bg-brand-100 px-1.5 py-0.5 text-[9px] font-bold text-brand',
            children: [e.floor, he.RESIDENT_BADGE_SUFFIX],
          })
        : null;
}
function Wn({ post: e, onLike: t }) {
  const [r, n] = h.useState(!1),
    a = h.useRef(!0),
    i = e.type === 'agent',
    o = ud(e.time),
    l =
      e.likes !== void 0
        ? s.jsxs('span', {
            className: 'flex items-center gap-1',
            children: [
              s.jsx('span', {
                role: 'img',
                'aria-label': '愛心',
                children: '❤️',
              }),
              ' ',
              e.likes,
            ],
          })
        : e.views !== void 0
          ? s.jsxs('span', {
              className: 'flex items-center gap-1',
              children: [
                s.jsx('span', {
                  role: 'img',
                  'aria-label': '觀看數',
                  children: '👁️',
                }),
                ' ',
                e.views,
              ],
            })
          : null,
    c =
      e.comments !== void 0
        ? s.jsxs('span', {
            className: 'flex items-center gap-1',
            children: [
              s.jsx('span', {
                role: 'img',
                'aria-label': '留言數',
                children: '💬',
              }),
              ' ',
              e.comments,
            ],
          })
        : null;
  h.useEffect(
    () => (
      (a.current = !0),
      () => {
        a.current = !1;
      }
    ),
    []
  );
  const d = Pv(
    async () => {
      if (!(!t || r)) {
        n(!0);
        try {
          await t(e.id);
        } catch (m) {
          (console.error('Failed to toggle like', m), W.error('按讚失敗', '請稍後重試'));
        } finally {
          a.current && n(!1);
        }
      }
    },
    1e3,
    { trailing: !0 }
  );
  return s.jsxs('article', {
    className:
      'flex gap-2.5 rounded-[14px] border border-border-light bg-white p-3 transition-all hover:border-brand-600 hover:shadow-[0_2px_8px_rgba(0,56,90,0.06)]',
    children: [
      s.jsx('div', {
        className: `flex size-10 shrink-0 items-center justify-center rounded-full border-2 bg-gradient-to-br from-brand-100/50 to-white text-base font-extrabold ${i ? 'border-brand-light text-brand-600' : 'border-brand text-brand'}`,
        'aria-hidden': 'true',
        children: e.author.charAt(0),
      }),
      s.jsxs('div', {
        className: 'flex flex-1 flex-col gap-1.5',
        children: [
          s.jsxs('div', {
            className: 'flex flex-wrap items-center gap-2',
            children: [
              s.jsx('span', {
                className: 'text-[13px] font-bold text-ink-900',
                children: e.author,
              }),
              s.jsx(Gv, { post: e }),
              s.jsx('span', {
                className: 'text-[11px] text-ink-600',
                children: o,
              }),
            ],
          }),
          s.jsxs('div', {
            className: 'text-[13px] leading-relaxed text-ink-900',
            children: [s.jsx('b', { children: e.title }), s.jsx('br', {}), e.content],
          }),
          s.jsxs('div', {
            className: 'flex gap-3 text-[11px] text-ink-600',
            children: [
              l,
              c,
              e.private &&
                s.jsxs('span', {
                  className: 'flex items-center gap-1',
                  children: [
                    s.jsx('span', {
                      role: 'img',
                      'aria-label': '鎖頭',
                      children: '🔒',
                    }),
                    ' ',
                    he.PRIVATE_POST_LABEL,
                  ],
                }),
            ],
          }),
          s.jsx('div', {
            className: 'mt-1 flex gap-2',
            children: i
              ? s.jsxs('button', {
                  className:
                    'bg-brand/6 hover:bg-brand/12 flex items-center gap-1 rounded-lg border border-brand/10 px-2.5 py-1.5 text-[11px] font-semibold text-brand transition-all',
                  'aria-label': he.BTN_MSG_AGENT,
                  children: [
                    s.jsx('span', {
                      role: 'img',
                      'aria-label': '信封',
                      children: '📩',
                    }),
                    ' ',
                    he.BTN_MSG_AGENT,
                  ],
                })
              : s.jsxs(s.Fragment, {
                  children: [
                    s.jsx('button', {
                      className:
                        'bg-brand/6 hover:bg-brand/12 flex items-center gap-1 rounded-lg border border-brand/10 px-2.5 py-1.5 text-[11px] font-semibold text-brand transition-all disabled:cursor-not-allowed disabled:opacity-60',
                      onClick: d,
                      'aria-label': '按讚這則貼文',
                      'aria-busy': r,
                      disabled: r,
                      children: r
                        ? s.jsxs(s.Fragment, {
                            children: [
                              s.jsx('span', {
                                role: 'img',
                                'aria-label': '沙漏',
                                children: '⏳',
                              }),
                              ' ',
                              he.BTN_LIKING,
                            ],
                          })
                        : s.jsxs(s.Fragment, {
                            children: [
                              s.jsx('span', {
                                role: 'img',
                                'aria-label': '愛心',
                                children: '❤️',
                              }),
                              ' ',
                              he.BTN_LIKE,
                            ],
                          }),
                    }),
                    s.jsxs('button', {
                      className:
                        'bg-brand/6 flex cursor-not-allowed items-center gap-1 rounded-lg border border-brand/10 px-2.5 py-1.5 text-[11px] font-semibold text-brand/50 opacity-60 transition-all',
                      'aria-label': he.BTN_REPLY_ARIA,
                      title: he.BTN_REPLY_TOOLTIP,
                      disabled: !0,
                      children: [
                        s.jsx('span', {
                          role: 'img',
                          'aria-label': '對話框',
                          children: '💬',
                        }),
                        ' ',
                        he.BTN_REPLY,
                      ],
                    }),
                  ],
                }),
          }),
        ],
      }),
    ],
  });
}
function Hv({
  viewerRole: e,
  currentTab: t,
  onTabChange: r,
  publicPosts: n,
  privatePosts: a,
  onLike: i,
  onCreatePost: o,
  onUnlock: l,
}) {
  const c = Or(e),
    d = c.isGuest,
    m = h.useId(),
    u = `${m}-public`,
    x = `${m}-private`,
    f = `${m}-panel`,
    g = h.useRef({ public: null, private: null }),
    [b, y] = h.useState(!1),
    [p, E] = h.useState('public'),
    S = (_) => {
      if (d) {
        W.error(he.NOTIFY_LOGIN_TITLE, he.NOTIFY_LOGIN_DESC);
        return;
      }
      if (_ === 'public' && !c.canPostPublic) {
        W.error(he.NOTIFY_PERM_ERROR, he.NOTIFY_PERM_CHECK);
        return;
      }
      if (_ === 'private' && !c.canPostPrivate) {
        W.error(he.NOTIFY_PRIVATE_ONLY);
        return;
      }
      (E(_), y(!0));
    },
    { visible: N, hiddenCount: k, nextHidden: T } = si(n, c.canSeeAllPosts),
    C = h.useCallback((_) => {
      var D;
      (D = g.current[_]) == null || D.focus();
    }, []),
    w = h.useMemo(
      () => (c.canAccessPrivate ? ['public', 'private'] : ['public']),
      [c.canAccessPrivate]
    ),
    G = () => {
      if (!c.canAccessPrivate) {
        W.error(
          c.isGuest ? he.NOTIFY_PRIVATE_ACCESS_DENIED : he.NOTIFY_VERIFY_REQUIRED,
          c.isGuest
            ? `🔐 ${he.NOTIFY_PRIVATE_ACCESS_DENIED_DESC}`
            : `🏠 ${he.NOTIFY_VERIFY_REQUIRED_DESC}`
        );
        return;
      }
      r('private');
    },
    j = h.useCallback(
      (_, D) => {
        if (!['ArrowLeft', 'ArrowRight', 'Home', 'End'].includes(_.key)) return;
        _.preventDefault();
        const V = w.at(-1);
        if (_.key === 'Home') {
          (C('public'), t !== 'public' && r('public'));
          return;
        }
        if (_.key === 'End') {
          V && V !== t ? (C(V), r(V)) : V && C(V);
          return;
        }
        const se = w.indexOf(D);
        if (se === -1) return;
        const I = _.key === 'ArrowLeft' ? -1 : 1,
          A = (se + I + w.length) % w.length,
          z = w[A];
        if (z) {
          if (z === 'private' && !c.canAccessPrivate) {
            (C('public'), r('public'));
            return;
          }
          (C(z), r(z));
        }
      },
      [w, t, C, r, c.canAccessPrivate]
    );
  return s.jsxs('section', {
    id: 'public-wall',
    className:
      'bg-white/98 scroll-mt-20 overflow-hidden rounded-[18px] border border-border-light shadow-[0_2px_12px_rgba(0,51,102,0.04)]',
    'aria-labelledby': 'posts-heading',
    children: [
      s.jsx('div', {
        className:
          'from-brand/3 to-brand-600/1 flex items-center justify-between border-b border-brand/5 bg-gradient-to-br px-4 py-3.5',
        children: s.jsxs('h2', {
          id: 'posts-heading',
          className: 'flex items-center gap-1.5 text-[15px] font-extrabold text-brand-700',
          children: [
            s.jsx('span', {
              role: 'img',
              'aria-label': '火焰',
              children: '🔥',
            }),
            ' ',
            he.SECTION_TITLE,
          ],
        }),
      }),
      s.jsxs('div', {
        className: 'flex flex-wrap gap-1.5 px-3.5 pb-3.5 pt-2',
        role: 'tablist',
        'aria-label': '社區牆分類',
        children: [
          s.jsx('button', {
            role: 'tab',
            id: u,
            ref: (_) => {
              g.current.public = _;
            },
            'aria-selected': t === 'public',
            'aria-controls': f,
            onClick: () => r('public'),
            onKeyDown: (_) => j(_, 'public'),
            tabIndex: t === 'public' ? 0 : -1,
            className: `rounded-full border px-3.5 py-1.5 text-xs font-semibold transition-all ${t === 'public' ? 'border-brand-600 bg-brand/10 font-bold text-brand' : 'hover:bg-brand/8 border-transparent bg-brand-100/80 text-ink-600 hover:text-brand'}`,
            children: he.TAB_PUBLIC,
          }),
          s.jsxs('button', {
            role: 'tab',
            id: x,
            ref: (_) => {
              g.current.private = _;
            },
            'aria-selected': t === 'private',
            'aria-controls': f,
            'aria-disabled': !c.canAccessPrivate,
            onClick: G,
            onKeyDown: (_) => j(_, 'private'),
            tabIndex: c.canAccessPrivate && t === 'private' ? 0 : -1,
            className: `rounded-full border px-3.5 py-1.5 text-xs font-semibold transition-all ${t === 'private' ? 'border-brand-600 bg-brand/10 font-bold text-brand' : 'hover:bg-brand/8 border-transparent bg-brand-100/80 text-ink-600 hover:text-brand'} ${c.canAccessPrivate ? '' : 'opacity-60'}`,
            children: [
              he.TAB_PRIVATE,
              ' ',
              !c.canAccessPrivate &&
                s.jsx('span', {
                  role: 'img',
                  'aria-label': '鎖頭',
                  children: '🔒',
                }),
            ],
          }),
        ],
      }),
      s.jsx('div', {
        id: f,
        role: 'tabpanel',
        'aria-labelledby': t === 'public' ? u : x,
        tabIndex: 0,
        className: 'flex flex-col gap-2.5 px-3.5 pb-3.5',
        children:
          t === 'public'
            ? s.jsxs(s.Fragment, {
                children: [
                  N.map((_) => s.jsx(Wn, { post: _, ...(i ? { onLike: i } : {}) }, _.id)),
                  s.jsx(ri, {
                    visible: k > 0 && !!T,
                    hiddenCount: k,
                    countLabel: he.LOCKED_OVERLAY_COUNT_LABEL,
                    benefits: [he.LOCKED_OVERLAY_BENEFIT_1, he.LOCKED_OVERLAY_BENEFIT_2],
                    showCta: !0,
                    ...(l ? { onCtaClick: l } : {}),
                    children: T && s.jsx(Wn, { post: T }),
                  }),
                  c.canPostPublic &&
                    s.jsx('div', {
                      className:
                        'bg-brand/3 flex justify-center rounded-[14px] border border-dashed border-border-light p-5',
                      children: s.jsxs('button', {
                        onClick: () => S('public'),
                        className:
                          'bg-brand/6 hover:bg-brand/12 flex w-full items-center justify-center gap-1 rounded-lg border border-brand/10 px-2.5 py-1.5 text-[11px] font-semibold text-brand',
                        children: [
                          s.jsx('span', {
                            role: 'img',
                            'aria-label': '鉛筆',
                            children: '✏️',
                          }),
                          ' ',
                          he.BTN_POST_PUBLIC,
                        ],
                      }),
                    }),
                ],
              })
            : c.canAccessPrivate
              ? s.jsxs(s.Fragment, {
                  children: [
                    a.map((_) => s.jsx(Wn, { post: _, ...(i ? { onLike: i } : {}) }, _.id)),
                    c.canPostPrivate
                      ? s.jsx('div', {
                          className:
                            'bg-brand/3 flex justify-center rounded-[14px] border border-dashed border-border-light p-5',
                          children: s.jsxs('button', {
                            onClick: () => S('private'),
                            className:
                              'bg-brand/6 hover:bg-brand/12 flex w-full items-center justify-center gap-1 rounded-lg border border-brand/10 px-2.5 py-1.5 text-[11px] font-semibold text-brand',
                            children: [
                              s.jsx('span', {
                                role: 'img',
                                'aria-label': '鉛筆',
                                children: '✏️',
                              }),
                              ' ',
                              he.BTN_POST_PRIVATE,
                            ],
                          }),
                        })
                      : s.jsxs('p', {
                          className: 'py-3 text-center text-[11px] text-ink-600',
                          children: ['💡 ', he.MSG_AGENT_VIEW_ONLY],
                        }),
                  ],
                })
              : s.jsxs('div', {
                  className:
                    'bg-brand/3 flex flex-col items-center justify-center rounded-[14px] px-5 py-10 text-center',
                  children: [
                    s.jsx('div', {
                      className: 'mb-3 text-5xl opacity-50',
                      'aria-hidden': 'true',
                      children: '🔐',
                    }),
                    s.jsx('h4', {
                      className: 'mb-1.5 text-sm font-bold text-brand-700',
                      children: he.LOCKED_TITLE,
                    }),
                    s.jsx('p', {
                      className: 'mb-4 text-xs text-ink-600',
                      children: c.isGuest ? he.LOCKED_DESC_GUEST : he.LOCKED_DESC_USER,
                    }),
                    s.jsx('button', {
                      onClick: l,
                      className: 'rounded-full bg-brand px-5 py-2.5 text-xs font-bold text-white',
                      children: c.isGuest ? he.BTN_UNLOCK_GUEST : he.BTN_UNLOCK_USER,
                    }),
                  ],
                }),
      }),
      s.jsx(Uv, {
        isOpen: b,
        onClose: () => y(!1),
        onSubmit: async (_) => {
          if (d) {
            W.error(he.NOTIFY_LOGIN_TITLE, he.NOTIFY_LOGIN_DESC);
            return;
          }
          o && (await o(_.content, _.visibility));
        },
        mode: 'community',
        initialVisibility: p,
      }),
    ],
  });
}
function Vn({
  q: e,
  perm: t,
  isUnanswered: r = !1,
  onAnswer: n,
  isAnswering: a,
  onUnlock: i,
  hideUnlockButton: o = !1,
}) {
  const l = ud(e.time);
  return s.jsxs('article', {
    className: `rounded-[12px] border p-3 transition-all hover:border-brand/15 ${r ? 'border-brand-light/30 bg-gradient-to-br from-brand-50 to-brand-100/30' : 'border-border-light bg-white'}`,
    children: [
      s.jsxs('div', {
        className: 'mb-1.5 text-[13px] font-bold leading-snug text-brand-700',
        children: ['Q: ', e.question],
      }),
      s.jsxs('div', {
        className: 'mb-2 flex flex-wrap items-center gap-1.5 text-[11px] text-ink-600',
        children: [
          s.jsx('span', { children: '👤 準住戶' }),
          s.jsxs('span', { children: ['· ', l] }),
          r
            ? s.jsx('span', {
                className: 'font-bold text-brand-light',
                children: '· 等待回答中',
              })
            : s.jsxs('span', { children: ['· ', e.answersCount, ' 則回覆'] }),
        ],
      }),
      r
        ? s.jsx('div', {
            className: 'bg-brand/2 mt-2 rounded-[10px] p-4 text-center text-[13px] text-ink-600',
            children: '🙋 還沒有人回答，成為第一個回答的人！',
          })
        : s.jsxs('div', {
            className: 'flex flex-col gap-1.5 border-l-[3px] border-border-light pl-3',
            children: [
              e.answers.map((c, d) =>
                s.jsxs(
                  'div',
                  {
                    className: 'py-1.5 text-[12px] leading-relaxed',
                    children: [
                      s.jsxs('div', {
                        className: 'mb-1 flex flex-wrap items-center gap-1',
                        children: [
                          s.jsx('span', {
                            className: `rounded px-2 py-0.5 text-[10px] font-bold ${c.type === 'agent' ? 'bg-brand-100 text-brand-600' : c.type === 'official' ? 'bg-brand-50 text-brand' : 'bg-brand-100 text-brand'}`,
                            children:
                              c.type === 'agent'
                                ? '🏢 認證房仲'
                                : c.type === 'official'
                                  ? `📋 ${c.author}`
                                  : `🏠 ${c.author}`,
                          }),
                          c.expert &&
                            s.jsx('span', {
                              className:
                                'rounded bg-brand-100 px-2 py-0.5 text-[10px] font-bold text-brand-600',
                              children: '⭐ 專家回答',
                            }),
                        ],
                      }),
                      c.content,
                    ],
                  },
                  d
                )
              ),
              !o &&
                e.hasMoreAnswers &&
                e.totalAnswers &&
                s.jsxs('div', {
                  className:
                    'mt-2 rounded-lg border border-brand/10 bg-gradient-to-r from-brand-50 to-brand-100/50 p-3 text-center',
                  children: [
                    s.jsxs('p', {
                      className: 'mb-2 text-[13px] text-ink-700',
                      children: [
                        '🔒 還有 ',
                        s.jsx('span', {
                          className: 'font-bold text-brand',
                          children: e.totalAnswers - e.answers.length,
                        }),
                        ' 則回答',
                      ],
                    }),
                    s.jsx('button', {
                      type: 'button',
                      onClick: i,
                      className:
                        'rounded-lg bg-brand px-4 py-2 text-[12px] font-bold text-white shadow-sm transition-all hover:bg-brand-dark hover:shadow-md',
                      children: '免費註冊 / 登入 解鎖全部',
                    }),
                  ],
                }),
            ],
          }),
      t.canAnswer &&
        s.jsx('div', {
          className: 'mt-2',
          children: s.jsx('button', {
            type: 'button',
            className: `flex w-full items-center justify-center gap-1 rounded-lg border px-2.5 py-1.5 text-[11px] font-semibold transition-all ${r ? 'border-brand-light/30 bg-brand-light/10 text-brand-600' : 'bg-brand/6 border-brand/10 text-brand'} hover:bg-brand/12`,
            onClick: () => (n == null ? void 0 : n(e)),
            disabled: a,
            'aria-busy': a,
            'aria-label': r ? '搶先回答這個問題' : '回答這個問題',
            children: a
              ? '⏳ 傳送中…'
              : `💬 ${r ? '搶先回答' : '我來回答'}${t.isAgent ? '（專家）' : ''}`,
          }),
        }),
    ],
  });
}
function Wv({
  viewerRole: e,
  questions: t,
  onAskQuestion: r,
  onAnswerQuestion: n,
  feedbackDurationMs: a = 5e3,
  onUnlock: i,
}) {
  const o = Array.isArray(t) ? t : (t == null ? void 0 : t.items) || [],
    l = Or(e),
    [c, d] = h.useState(!1),
    [m, u] = h.useState(''),
    [x, f] = h.useState(!1),
    [g, b] = h.useState(''),
    [y, p] = h.useState(null),
    [E, S] = h.useState(null),
    [N, k] = h.useState(''),
    [T, C] = h.useState(''),
    [w, G] = h.useState(''),
    j = h.useRef(null),
    _ = h.useRef(null),
    D = h.useRef(null),
    V = h.useRef(null),
    se = h.useRef(null),
    I = h.useRef(null),
    A = o.filter((X) => (X.totalAnswers ?? X.answersCount ?? X.answers.length) > 0),
    z = o.filter((X) => (X.totalAnswers ?? X.answersCount ?? X.answers.length) === 0),
    { visible: O, hiddenCount: re, nextHidden: ae } = si(A, l.isLoggedIn),
    R = A.length - O.length,
    ee = !l.isLoggedIn,
    $ = !!i && (ee || re > 0 || R > 0),
    J = 10,
    Y = 5,
    oe = () => {
      (u(''), k(''));
    },
    U = () => {
      (b(''), C(''), p(null));
    },
    q = () => {
      I.current = document.activeElement;
    },
    ue = () => {
      if (!l.canAskQuestion) {
        if (i) {
          i();
          return;
        }
        G('⚠️ 請登入後再發問。');
        return;
      }
      (q(), oe(), d(!0));
    },
    B = (X) => {
      if (!l.canAnswer) {
        if (i) {
          i();
          return;
        }
        G('⚠️ 只有住戶或房仲可以回答問題。');
        return;
      }
      (q(), U(), p(X), f(!0));
    },
    ie = () => (c ? j.current : x ? _.current : null),
    fe = (X) =>
      X
        ? Array.from(
            X.querySelectorAll('a[href], button, textarea, input, select, [tabindex]')
          ).filter((ke) => {
            const ye = ke.getAttribute('tabindex'),
              Ve = typeof ye == 'string' ? Number(ye) : void 0,
              Ie = ke.hasAttribute('disabled') || ke.getAttribute('aria-disabled') === 'true',
              Nt = ke.hasAttribute('aria-hidden'),
              Ln = typeof Ve == 'number' && Ve < 0;
            return !Ie && !Nt && !Ln;
          })
        : [],
    At = () => {
      const X = [
        document.querySelector('main'),
        document.querySelector('[data-app-root]'),
        document.getElementById('root'),
        document.body,
      ];
      for (const ge of X)
        if (ge instanceof HTMLElement) {
          const ke = ge.getAttribute('tabindex');
          ((ge.dataset.prevTabindex = ke ?? ''),
            (ge.tabIndex = -1),
            ge.focus(),
            setTimeout(() => {
              const ye = ge.dataset.prevTabindex;
              (ye === ''
                ? ge.removeAttribute('tabindex')
                : ye !== void 0 && (ge.tabIndex = Number(ye)),
                delete ge.dataset.prevTabindex);
            }, 0));
          return;
        }
    },
    ls = (X) => {
      if (X.key !== 'Tab') return;
      const ge = ie();
      if (!ge) return;
      const ke = fe(ge);
      if (!ke.length) {
        const Nt = ge.getAttribute('tabindex');
        ((ge.dataset.prevTabindex = Nt ?? ''), (ge.tabIndex = -1), ge.focus(), X.preventDefault());
        return;
      }
      const [ye] = ke,
        Ve = ke.at(-1),
        Ie = document.activeElement;
      if (!Ie || !ge.contains(Ie)) {
        (ye == null || ye.focus(), X.preventDefault());
        return;
      }
      (!X.shiftKey && Ie === Ve && (ye == null || ye.focus(), X.preventDefault()),
        X.shiftKey && Ie === ye && (Ve == null || Ve.focus(), X.preventDefault()));
    };
  (h.useEffect(() => {
    const X = ie();
    if (!X) {
      document.body.style.overflow = '';
      return;
    }
    document.body.style.overflow = 'hidden';
    const ge = (ye) => {
        (ye.key === 'Escape' &&
          E !== 'ask' &&
          E !== 'answer' &&
          (c && (d(!1), oe()), x && (f(!1), U())),
          ls(ye));
      },
      ke = (ye) => {
        var Ve;
        X.contains(ye.target) ||
          ((Ve = fe(X)[0]) == null || Ve.focus(), ye.preventDefault(), ye.stopPropagation());
      };
    return (
      document.addEventListener('keydown', ge),
      document.addEventListener('focusin', ke),
      () => {
        if (
          ((document.body.style.overflow = ''),
          document.removeEventListener('keydown', ge),
          document.removeEventListener('focusin', ke),
          X && X.dataset.prevTabindex !== void 0)
        ) {
          const Ve = X.dataset.prevTabindex;
          (Ve === '' ? X.removeAttribute('tabindex') : (X.tabIndex = Number(Ve)),
            delete X.dataset.prevTabindex);
        }
        const ye = I.current;
        (ye && document.body.contains(ye) ? ye.focus() : At(), (I.current = null));
      }
    );
  }, [c, x, E]),
    h.useEffect(
      () =>
        w
          ? (se.current && clearTimeout(se.current),
            (se.current = window.setTimeout(() => {
              G('');
            }, a)),
            () => {
              se.current && (clearTimeout(se.current), (se.current = null));
            })
          : () => {},
      [w, a]
    ),
    h.useEffect(() => {
      c &&
        requestAnimationFrame(() => {
          var X;
          (X = D.current) == null || X.focus();
        });
    }, [c]),
    h.useEffect(() => {
      x &&
        requestAnimationFrame(() => {
          var X;
          (X = V.current) == null || X.focus();
        });
    }, [x]));
  const An = async () => {
      const X = m.trim();
      if (X.length < J) {
        k(`請至少輸入 ${J} 個字，描述你的問題。`);
        return;
      }
      if (!r) {
        k('目前無法送出問題，請稍後再試。');
        return;
      }
      (S('ask'), k(''));
      try {
        (await r(X), d(!1), oe(), G('✅ 問題已送出，住戶將收到通知。'));
      } catch (ge) {
        (console.error('Failed to submit question', ge), k('送出失敗，請稍後再試。'));
      } finally {
        S(null);
      }
    },
    Rr = async () => {
      const X = g.trim();
      if (!y) {
        C('找不到問題，請重新選擇。');
        return;
      }
      if (X.length < Y) {
        C(`請至少輸入 ${Y} 個字，提供有用的資訊。`);
        return;
      }
      if (!n) {
        C('目前無法送出回答，請稍後再試。');
        return;
      }
      (S('answer'), C(''));
      try {
        (await n(String(y.id), X), f(!1), U(), G('✅ 回答已送出，感謝你的協助。'));
      } catch (ge) {
        (console.error('Failed to submit answer', ge), C('送出失敗，請稍後再試。'));
      } finally {
        S(null);
      }
    };
  return s.jsxs('section', {
    className:
      'bg-white/98 scroll-mt-20 overflow-hidden rounded-[18px] border border-border-light shadow-[0_2px_12px_rgba(0,51,102,0.04)]',
    'aria-labelledby': 'qa-heading',
    id: 'qa-section',
    children: [
      s.jsx('div', {
        className:
          'from-brand/3 to-brand-600/1 flex items-center justify-between border-b border-brand/5 bg-gradient-to-br px-4 py-3.5',
        children: s.jsxs('div', {
          children: [
            s.jsxs('h2', {
              id: 'qa-heading',
              className: 'flex items-center gap-1.5 text-[15px] font-extrabold text-brand-700',
              children: [
                '🙋 準住戶問答',
                z.length > 0 &&
                  s.jsxs('span', {
                    className:
                      'ml-1.5 rounded-full bg-brand-100 px-2 py-0.5 text-xs font-bold text-brand-600',
                    children: [z.length, ' 題待回答'],
                  }),
              ],
            }),
            s.jsx('p', {
              className: 'mt-0.5 text-[11px] text-ink-600',
              children: '買房前，先問問鄰居怎麼說',
            }),
          ],
        }),
      }),
      s.jsxs('div', {
        className: 'flex flex-col gap-2.5 p-3.5 pb-12',
        children: [
          O.map((X) =>
            s.jsx(
              Vn,
              {
                q: X,
                perm: l,
                onAnswer: B,
                isAnswering: E === 'answer' && (y == null ? void 0 : y.id) === X.id,
                ...(i && { onUnlock: i }),
              },
              X.id
            )
          ),
          s.jsx(ri, {
            visible: re > 0 && !!ae,
            hiddenCount: re,
            countLabel: '則問答',
            benefits: ['查看完整問答', '新回答通知'],
            ...(i ? { onCtaClick: i } : {}),
            children:
              ae &&
              s.jsx(Vn, {
                q: ae,
                perm: l,
                onAnswer: B,
                isAnswering: E === 'answer' && (y == null ? void 0 : y.id) === ae.id,
                hideUnlockButton: !0,
              }),
          }),
          s.jsxs('div', {
            className: 'bg-brand/3 rounded-[14px] border border-dashed border-border-light p-3.5',
            children: [
              s.jsxs('div', {
                className: 'space-y-2',
                children: [
                  s.jsx('div', {
                    className: 'text-[12px] font-semibold text-brand-700',
                    children: '還沒人回答的問題',
                  }),
                  z.length > 0
                    ? z.map((X) =>
                        s.jsx(
                          Vn,
                          {
                            q: X,
                            perm: l,
                            isUnanswered: !0,
                            onAnswer: B,
                            isAnswering: E === 'answer' && (y == null ? void 0 : y.id) === X.id,
                            ...(i && { onUnlock: i }),
                          },
                          X.id
                        )
                      )
                    : s.jsx('div', {
                        className:
                          'rounded-[10px] border border-dashed border-border-light bg-white/80 p-3 text-center text-[12px] text-ink-600',
                        children: '目前沒有待回答的問題，登入後可解鎖更多或發問。',
                      }),
                ],
              }),
              s.jsxs('div', {
                className: 'mt-3 flex flex-col gap-1',
                children: [
                  s.jsx('div', {
                    className: 'text-sm font-bold text-ink-600',
                    children: '💬 你也有問題想問？',
                  }),
                  s.jsx('p', {
                    className: 'text-xs text-ink-600',
                    children: '問題會通知該社區住戶，通常 24 小時內會有回覆',
                  }),
                  s.jsx('button', {
                    type: 'button',
                    onClick: ue,
                    className:
                      'bg-brand/6 hover:bg-brand/12 flex w-full items-center justify-center gap-1 rounded-lg border border-brand/10 px-2.5 py-1.5 text-[11px] font-semibold text-brand transition',
                    children: l.canAskQuestion ? '我想問問題' : '登入後發問',
                  }),
                ],
              }),
            ],
          }),
          $ &&
            s.jsxs('div', {
              className: 'bg-brand/4 rounded-[12px] border border-brand/10 p-3 text-center',
              children: [
                s.jsx('div', {
                  className: 'text-sm font-bold text-brand-700',
                  children: '免費註冊 / 登入',
                }),
                s.jsx('p', {
                  className: 'mt-1 text-[12px] text-ink-600',
                  children:
                    R > 0 ? `還有 ${R} 則問答可解鎖，追蹤最新回覆` : '解鎖更多問答、追蹤最新回覆',
                }),
                s.jsx('button', {
                  type: 'button',
                  onClick: i,
                  className:
                    'mt-2 w-full rounded-lg bg-brand px-3 py-2 text-[12px] font-semibold text-white shadow-sm transition hover:bg-brand-dark',
                  children: '立即解鎖',
                }),
              ],
            }),
          w &&
            s.jsx('p', {
              className: 'text-center text-[11px] text-brand-600',
              role: 'status',
              'aria-live': 'polite',
              children: w,
            }),
        ],
      }),
      c &&
        s.jsx('div', {
          className: 'fixed inset-0 z-[60] flex items-center justify-center bg-black/40 px-4',
          children: s.jsxs('div', {
            ref: j,
            role: 'dialog',
            'aria-modal': 'true',
            'aria-labelledby': 'ask-modal-title',
            className: 'w-full max-w-md rounded-2xl bg-white p-5 shadow-2xl',
            children: [
              s.jsxs('div', {
                className: 'mb-3 flex items-center justify-between',
                children: [
                  s.jsxs('div', {
                    children: [
                      s.jsx('h3', {
                        id: 'ask-modal-title',
                        className: 'text-base font-bold text-ink-700',
                        children: '提出你的問題',
                      }),
                      s.jsx('p', {
                        className: 'text-ink-500 text-xs',
                        children: '請描述情境，方便住戶提供建議',
                      }),
                    ],
                  }),
                  s.jsx('button', {
                    type: 'button',
                    className: 'text-sm text-ink-400 transition hover:text-ink-700',
                    onClick: () => {
                      E !== 'ask' && (d(!1), oe());
                    },
                    'aria-label': '關閉發問視窗',
                    children: '✕',
                  }),
                ],
              }),
              s.jsxs('div', {
                className: 'space-y-3',
                children: [
                  s.jsx('label', {
                    className: 'block text-xs font-semibold text-ink-600',
                    htmlFor: 'qa-ask-textarea',
                    children: '問題內容',
                  }),
                  s.jsx('textarea', {
                    ref: D,
                    id: 'qa-ask-textarea',
                    className:
                      'bg-ink-50/40 h-28 w-full rounded-xl border border-border-light p-3 text-sm outline-none focus:border-brand',
                    placeholder: '例：晚上車流聲音大嗎？管理費包含哪些服務？',
                    value: m,
                    onChange: (X) => u(X.target.value),
                    maxLength: 500,
                    disabled: E === 'ask',
                  }),
                  N &&
                    s.jsx('p', {
                      className: 'text-error-500 text-xs',
                      role: 'alert',
                      children: N,
                    }),
                  s.jsxs('div', {
                    className: 'flex items-center justify-between text-[11px] text-ink-400',
                    children: [
                      s.jsxs('span', { children: ['至少 ', J, ' 個字'] }),
                      s.jsxs('span', { children: [m.length, '/500'] }),
                    ],
                  }),
                  s.jsx('button', {
                    type: 'button',
                    onClick: An,
                    disabled: E === 'ask',
                    className: `w-full rounded-xl bg-brand px-4 py-2 text-sm font-semibold text-white transition ${E === 'ask' ? 'opacity-70' : 'hover:bg-brand-600'}`,
                    children: E === 'ask' ? '送出中…' : '送出問題',
                  }),
                ],
              }),
            ],
          }),
        }),
      x &&
        y &&
        s.jsx('div', {
          className: 'fixed inset-0 z-[60] flex items-center justify-center bg-black/40 px-4',
          children: s.jsxs('div', {
            ref: _,
            role: 'dialog',
            'aria-modal': 'true',
            'aria-labelledby': 'answer-modal-title',
            className: 'w-full max-w-md rounded-2xl bg-white p-5 shadow-2xl',
            children: [
              s.jsxs('div', {
                className: 'mb-3 flex items-center justify-between',
                children: [
                  s.jsxs('div', {
                    children: [
                      s.jsx('h3', {
                        id: 'answer-modal-title',
                        className: 'text-base font-bold text-ink-700',
                        children: '回答問題',
                      }),
                      s.jsx('p', {
                        className: 'text-ink-500 text-xs',
                        children: y.question,
                      }),
                    ],
                  }),
                  s.jsx('button', {
                    type: 'button',
                    className: 'text-sm text-ink-400 transition hover:text-ink-700',
                    onClick: () => {
                      E !== 'answer' && (f(!1), U());
                    },
                    'aria-label': '關閉回答視窗',
                    children: '✕',
                  }),
                ],
              }),
              s.jsxs('div', {
                className: 'space-y-3',
                children: [
                  s.jsx('label', {
                    className: 'block text-xs font-semibold text-ink-600',
                    htmlFor: 'qa-answer-textarea',
                    children: '回答內容',
                  }),
                  s.jsx('textarea', {
                    ref: V,
                    id: 'qa-answer-textarea',
                    className:
                      'bg-ink-50/40 h-32 w-full rounded-xl border border-border-light p-3 text-sm outline-none focus:border-brand',
                    placeholder: '提供實際經驗、噪音狀況、交通建議等',
                    value: g,
                    onChange: (X) => b(X.target.value),
                    maxLength: 800,
                    disabled: E === 'answer',
                  }),
                  T &&
                    s.jsx('p', {
                      className: 'text-error-500 text-xs',
                      role: 'alert',
                      children: T,
                    }),
                  s.jsxs('div', {
                    className: 'flex items-center justify-between text-[11px] text-ink-400',
                    children: [
                      s.jsxs('span', { children: ['至少 ', Y, ' 個字'] }),
                      s.jsxs('span', { children: [g.length, '/800'] }),
                    ],
                  }),
                  s.jsx('button', {
                    type: 'button',
                    onClick: Rr,
                    disabled: E === 'answer',
                    className: `w-full rounded-xl bg-brand px-4 py-2 text-sm font-semibold text-white transition ${E === 'answer' ? 'opacity-70' : 'hover:bg-brand-600'}`,
                    children: E === 'answer' ? '送出中…' : '送出回答',
                  }),
                ],
              }),
            ],
          }),
        }),
    ],
  });
}
function Zr(e, t = '') {
  return e == null ? '-' : `${e}${t}`;
}
function Vv({ info: e, questions: t, posts: r }) {
  const n = h.useMemo(() => (Array.isArray(t) ? t : (t == null ? void 0 : t.items) || []), [t]),
    a = h.useMemo(() => n.slice(0, Ov), [n]),
    i = h.useMemo(
      () =>
        [...r]
          .sort((o, l) => {
            const c = (o.likes || 0) + (o.views || 0) * 0.1;
            return (l.likes || 0) + (l.views || 0) * 0.1 - c;
          })
          .slice(0, Rv),
      [r]
    );
  return s.jsxs('aside', {
    className:
      'hidden w-[280px] shrink-0 flex-col gap-3 self-start lg:sticky lg:top-[70px] lg:flex',
    children: [
      s.jsxs('div', {
        className:
          'rounded-[14px] border border-[var(--line)] bg-white p-3.5 shadow-[0_4px_14px_rgba(0,51,102,0.04)]',
        children: [
          s.jsx('h4', {
            className:
              'mb-2.5 flex items-center gap-1.5 text-sm font-extrabold text-[var(--brand)]',
            children: '📊 社區數據',
          }),
          s.jsx('div', {
            className: 'mt-2.5 grid grid-cols-2 gap-2',
            children: [
              [Zr(e.members), '已加入成員'],
              [Zr(e.avgRating), '平均評分'],
              [Zr(e.monthlyInteractions), '本月互動'],
              [Zr(e.forSale), '待售物件'],
            ].map(([o, l]) =>
              s.jsxs(
                'div',
                {
                  className:
                    'rounded-[10px] bg-gradient-to-br from-[#f8faff] to-[#f0f5ff] p-3 text-center',
                  children: [
                    s.jsx('div', {
                      className: 'text-xl font-black text-[var(--brand)]',
                      children: o,
                    }),
                    s.jsx('div', {
                      className: 'mt-0.5 text-[11px] text-[var(--text-secondary)]',
                      children: l,
                    }),
                  ],
                },
                l
              )
            ),
          }),
        ],
      }),
      s.jsxs('nav', {
        className:
          'rounded-[14px] border border-[var(--line)] bg-white p-3.5 shadow-[0_4px_14px_rgba(0,51,102,0.04)]',
        'aria-label': '快速連結',
        children: [
          s.jsx('h4', {
            className:
              'mb-2.5 flex items-center gap-1.5 text-sm font-extrabold text-[var(--brand)]',
            children: '🔗 快速連結',
          }),
          s.jsx('div', {
            className: 'flex flex-col gap-1',
            children: ['🏠 查看此社區物件', '📊 與其他社區比較', '🔔 追蹤此社區'].map((o) =>
              s.jsx(
                'button',
                {
                  type: 'button',
                  className:
                    'flex w-full items-center gap-2 rounded-[10px] px-3 py-2.5 text-left text-[13px] font-semibold text-[var(--text-primary)] transition-all hover:bg-[#f0f7ff]',
                  children: o,
                },
                o
              )
            ),
          }),
        ],
      }),
      s.jsxs('div', {
        className:
          'rounded-[14px] border border-[var(--line)] bg-white p-3.5 shadow-[0_4px_14px_rgba(0,51,102,0.04)]',
        children: [
          s.jsx('h4', {
            className:
              'mb-2.5 flex items-center gap-1.5 text-sm font-extrabold text-[var(--brand)]',
            children: '❓ 最新問答',
          }),
          s.jsx('div', {
            className: 'flex flex-col gap-1',
            children: a.map((o) =>
              s.jsxs(
                'a',
                {
                  href: '#qa-section',
                  className:
                    'flex items-start gap-2 rounded-[10px] px-3 py-2.5 text-[13px] font-semibold text-[var(--text-primary)] no-underline transition-all hover:bg-[#f0f7ff]',
                  children: [
                    s.jsx('span', {
                      className: 'shrink-0',
                      'aria-hidden': 'true',
                      children: '💬',
                    }),
                    s.jsx('span', {
                      className: 'truncate',
                      children:
                        o.question.length > 18 ? o.question.substring(0, 18) + '...' : o.question,
                    }),
                  ],
                },
                o.id
              )
            ),
          }),
          s.jsx('a', {
            href: '#qa-section',
            className: 'mt-2 block text-center text-xs text-[var(--brand-light)] no-underline',
            children: '查看全部問答 →',
          }),
        ],
      }),
      s.jsxs('div', {
        className:
          'rounded-[14px] border border-[var(--line)] bg-white p-3.5 shadow-[0_4px_14px_rgba(0,51,102,0.04)]',
        children: [
          s.jsx('h4', {
            className:
              'mb-2.5 flex items-center gap-1.5 text-sm font-extrabold text-[var(--brand)]',
            children: '🔥 熱門貼文',
          }),
          s.jsx('div', {
            className: 'flex flex-col gap-1',
            children: i.map((o) =>
              s.jsxs(
                'a',
                {
                  href: '#public-wall',
                  className:
                    'flex items-start gap-2 rounded-[10px] px-3 py-2.5 text-[13px] font-semibold text-[var(--text-primary)] no-underline transition-all hover:bg-[#f0f7ff]',
                  children: [
                    s.jsxs('span', {
                      className: 'shrink-0',
                      'aria-hidden': 'true',
                      children: ['❤️ ', o.likes],
                    }),
                    s.jsx('span', {
                      className: 'truncate',
                      children: o.title.length > 15 ? o.title.substring(0, 15) + '...' : o.title,
                    }),
                  ],
                },
                o.id
              )
            ),
          }),
          s.jsx('a', {
            href: '#public-wall',
            className: 'mt-2 block text-center text-xs text-[var(--brand-light)] no-underline',
            children: '查看全部貼文 →',
          }),
        ],
      }),
      s.jsxs('div', {
        className:
          'rounded-[14px] border border-[var(--line)] bg-gradient-to-br from-[#f0f7ff] to-[#e8f4ff] p-3.5 text-center shadow-[0_4px_14px_rgba(0,51,102,0.04)]',
        children: [
          s.jsxs('svg', {
            className: 'mx-auto mb-2 h-24 w-20 text-[#00385a]',
            viewBox: '0 0 200 240',
            'aria-hidden': 'true',
            children: [
              s.jsx('path', {
                d: 'M 85 40 L 85 15 L 100 30 L 115 15 L 115 40',
                stroke: 'currentColor',
                strokeWidth: '5',
                fill: 'none',
                strokeLinecap: 'round',
                strokeLinejoin: 'round',
              }),
              s.jsx('path', {
                d: 'M 40 80 L 100 40 L 160 80',
                stroke: 'currentColor',
                strokeWidth: '6',
                fill: 'none',
                strokeLinecap: 'round',
                strokeLinejoin: 'round',
              }),
              s.jsx('rect', {
                x: '55',
                y: '80',
                width: '90',
                height: '100',
                stroke: 'currentColor',
                strokeWidth: '6',
                fill: 'none',
                strokeLinecap: 'round',
                strokeLinejoin: 'round',
              }),
              s.jsx('path', {
                d: 'M 78 110 Q 85 105 92 110',
                stroke: 'currentColor',
                strokeWidth: '4',
                fill: 'none',
                strokeLinecap: 'round',
              }),
              s.jsx('path', {
                d: 'M 108 110 Q 115 105 122 110',
                stroke: 'currentColor',
                strokeWidth: '4',
                fill: 'none',
                strokeLinecap: 'round',
              }),
              s.jsx('circle', {
                cx: '85',
                cy: '125',
                r: '4',
                stroke: 'currentColor',
                strokeWidth: '3',
                fill: 'none',
              }),
              s.jsx('circle', {
                cx: '115',
                cy: '125',
                r: '4',
                stroke: 'currentColor',
                strokeWidth: '3',
                fill: 'none',
              }),
              s.jsx('path', {
                d: 'M 90 145 Q 100 155 110 145',
                stroke: 'currentColor',
                strokeWidth: '3',
                fill: 'none',
                strokeLinecap: 'round',
              }),
              s.jsx('path', {
                d: 'M 55 130 L 25 110',
                stroke: 'currentColor',
                strokeWidth: '5',
                fill: 'none',
                strokeLinecap: 'round',
              }),
              s.jsx('path', {
                className: 'origin-[85%_60%] animate-[wave_2.5s_ease-in-out_infinite]',
                d: 'M 145 130 L 175 100',
                stroke: 'currentColor',
                strokeWidth: '5',
                fill: 'none',
                strokeLinecap: 'round',
              }),
              s.jsx('circle', {
                className: 'origin-[85%_60%] animate-[wave_2.5s_ease-in-out_infinite]',
                cx: '180',
                cy: '95',
                r: '6',
                stroke: 'currentColor',
                strokeWidth: '3',
                fill: 'none',
              }),
              s.jsx('path', {
                d: 'M 85 180 L 85 210 L 75 210',
                stroke: 'currentColor',
                strokeWidth: '5',
                fill: 'none',
                strokeLinecap: 'round',
                strokeLinejoin: 'round',
              }),
              s.jsx('path', {
                d: 'M 115 180 L 115 210 L 125 210',
                stroke: 'currentColor',
                strokeWidth: '5',
                fill: 'none',
                strokeLinecap: 'round',
                strokeLinejoin: 'round',
              }),
            ],
          }),
          s.jsx('p', {
            className: 'mb-2.5 text-[13px] font-bold text-[var(--brand)]',
            children: '有問題？問問鄰居！',
          }),
          s.jsx('a', {
            href: '#qa-section',
            className:
              'inline-block rounded-full bg-[var(--brand)] px-4 py-2 text-xs font-bold text-white no-underline',
            children: '前往問答區 →',
          }),
        ],
      }),
    ],
  });
}
const Po = {
    guest: '訪客模式',
    member: '會員模式',
    resident: '住戶模式',
    agent: '房仲模式',
    official: '官方模式',
    admin: '管理員',
  },
  zo = {
    guest: '👤 訪客（未登入）',
    member: '👥 一般會員',
    resident: '🏠 已驗證住戶',
    agent: '🏢 認證房仲',
    official: '⚖️ 官方代表',
    admin: '🔑 系統管理員',
  };
function Zv({ role: e, onRoleChange: t }) {
  const [r, n] = h.useState(!1);
  return s.jsxs('div', {
    className: 'fixed bottom-5 right-5 z-[1000]',
    children: [
      s.jsxs('button', {
        onClick: () => n(!r),
        className:
          'flex items-center gap-1.5 rounded-xl bg-gradient-to-br from-[#1a1a2e] to-[#16213e] px-4 py-2.5 text-xs font-bold text-white shadow-[0_4px_20px_rgba(0,0,0,0.3)]',
        'aria-expanded': r,
        'aria-haspopup': 'listbox',
        'aria-label': `目前身份：${Po[e]}，點擊切換`,
        children: ['🕶️ ', s.jsx('span', { children: Po[e] }), ' ▾'],
      }),
      r &&
        s.jsx('div', {
          className:
            'absolute bottom-[50px] right-0 min-w-[180px] rounded-xl border border-[var(--border)] bg-white p-2 shadow-[0_8px_30px_rgba(0,0,0,0.15)]',
          role: 'listbox',
          'aria-label': '選擇身份',
          children: Object.keys(zo).map((a) =>
            s.jsx(
              'button',
              {
                role: 'option',
                'aria-selected': e === a,
                onClick: () => {
                  (t(a), n(!1));
                },
                className: `block w-full rounded-lg px-3 py-2.5 text-left text-xs ${e === a ? 'bg-[rgba(0,56,90,0.1)] font-bold text-[var(--primary)]' : 'text-[var(--text-primary)] hover:bg-[#f6f9ff]'}`,
                children: zo[a],
              },
              a
            )
          ),
        }),
    ],
  });
}
function Yv({ viewerRole: e }) {
  const t = Or(e);
  if (t.canAccessPrivate) return null;
  t.isGuest;
  const r = t.isMember;
  return s.jsxs('div', {
    className:
      'fixed inset-x-0 bottom-0 z-overlay flex items-center justify-center gap-3 border-t border-[var(--border)] bg-[rgba(255,255,255,0.95)] px-4 py-3 backdrop-blur-md',
    children: [
      s.jsx('p', {
        className: 'text-xs text-[var(--text-secondary)]',
        children: r ? '🏠 驗證住戶身份，解鎖私密牆' : '🔓 登入解鎖完整評價 + 更多功能',
      }),
      s.jsx('button', {
        onClick: () => (window.location.href = '/maihouses/auth.html'),
        className:
          'rounded-full bg-gradient-to-br from-[var(--primary)] to-[#005282] px-5 py-2.5 text-[13px] font-bold text-white shadow-lg transition-transform hover:scale-105 active:scale-95',
        children: r ? '驗證住戶' : '免費註冊',
      }),
    ],
  });
}
function Zn() {
  return s.jsxs('div', {
    className: 'flex animate-pulse gap-2.5 rounded-[14px] border border-border-light bg-white p-3',
    children: [
      s.jsx('div', { className: 'size-10 shrink-0 rounded-full bg-gray-200' }),
      s.jsxs('div', {
        className: 'flex flex-1 flex-col gap-2',
        children: [
          s.jsxs('div', {
            className: 'flex items-center gap-2',
            children: [
              s.jsx('div', { className: 'h-4 w-16 rounded bg-gray-200' }),
              s.jsx('div', { className: 'h-3 w-12 rounded bg-gray-200' }),
            ],
          }),
          s.jsx('div', { className: 'h-4 w-3/4 rounded bg-gray-200' }),
          s.jsx('div', { className: 'h-12 w-full rounded bg-gray-200' }),
          s.jsxs('div', {
            className: 'flex gap-2',
            children: [
              s.jsx('div', { className: 'h-3 w-10 rounded bg-gray-200' }),
              s.jsx('div', { className: 'h-3 w-10 rounded bg-gray-200' }),
            ],
          }),
        ],
      }),
    ],
  });
}
function Do() {
  return s.jsxs('div', {
    role: 'status',
    'aria-live': 'polite',
    'aria-busy': 'true',
    'aria-label': '社區牆載入中',
    className: 'flex flex-col gap-3',
    children: [
      s.jsx('span', {
        className: 'sr-only',
        children: '正在載入社區牆內容，請稍候...',
      }),
      s.jsxs('div', {
        className: 'bg-white/98 overflow-hidden rounded-[18px] border border-border-light p-4',
        children: [
          s.jsxs('div', {
            className: 'mb-3 flex items-center gap-2',
            children: [
              s.jsx('div', {
                className: 'h-5 w-24 animate-pulse rounded bg-gray-200',
              }),
              s.jsx('div', {
                className: 'h-4 w-16 animate-pulse rounded bg-gray-200',
              }),
            ],
          }),
          s.jsxs('div', {
            className: 'flex flex-col gap-2',
            children: [
              s.jsx('div', {
                className: 'h-24 w-full animate-pulse rounded-[14px] bg-gray-100',
              }),
              s.jsx('div', {
                className: 'h-24 w-full animate-pulse rounded-[14px] bg-gray-100',
              }),
            ],
          }),
        ],
      }),
      s.jsxs('div', {
        className: 'bg-white/98 overflow-hidden rounded-[18px] border border-border-light p-4',
        children: [
          s.jsx('div', {
            className: 'mb-3 flex items-center gap-2',
            children: s.jsx('div', {
              className: 'h-5 w-24 animate-pulse rounded bg-gray-200',
            }),
          }),
          s.jsxs('div', {
            className: 'flex flex-col gap-2',
            children: [s.jsx(Zn, {}), s.jsx(Zn, {}), s.jsx(Zn, {})],
          }),
        ],
      }),
    ],
  });
}
const qv = (e) => {
    const t = [e.message];
    let r = e.cause;
    for (; r instanceof Error; ) (t.push(r.message), (r = r.cause));
    return t.join(' ').toLowerCase();
  },
  Kv = (e) => {
    const t = qv(e);
    return t.includes('401') || t.includes('403') || t.includes('unauthorized')
      ? {
          category: 'permission',
          title: '需要登入',
          message: '請先登入後再查看社區牆內容',
          actionText: '前往登入',
          actionHref: '/auth',
        }
      : t.includes('404') || t.includes('not found')
        ? {
            category: 'notFound',
            title: '找不到社區牆',
            message: '此社區不存在或已被移除',
            actionText: '回到首頁',
            actionHref: '/maihouses/',
          }
        : t.includes('network') || t.includes('fetch') || t.includes('timeout')
          ? {
              category: 'network',
              title: '連線異常',
              message: '目前無法連接到伺服器，請稍後重試',
              actionText: '重新載入',
              onAction: () => window.location.reload(),
            }
          : {
              category: 'runtime',
              title: '載入失敗',
              message: e.message || '發生未預期的錯誤，我們正在處理中',
              actionText: '重試',
            };
  };
class Qv extends F.Component {
  constructor(t) {
    (super(t),
      (this.resetErrorBoundary = () => {
        this.setState({
          hasError: !1,
          error: null,
          errorInfo: null,
          errorId: null,
        });
      }),
      (this.copyErrorToClipboard = () => {
        if (!this.state.error) return;
        const { error: r, errorInfo: n, errorId: a } = this.state,
          i = [
            `Message: ${r.message}`,
            `Stack: ${r.stack ?? 'N/A'}`,
            `Component Stack: ${(n == null ? void 0 : n.componentStack) ?? 'N/A'}`,
            `URL: ${typeof window < 'u' ? window.location.href : 'N/A'}`,
            `Timestamp: ${new Date().toISOString()}`,
            a ? `Error ID: ${a}` : null,
          ].filter(Boolean).join(`
`);
        navigator != null &&
          navigator.clipboard &&
          navigator.clipboard.writeText(i).catch(() => {
            console.warn('[WallErrorBoundary] Failed to copy error details');
          });
      }),
      (this.state = {
        hasError: !1,
        error: null,
        errorInfo: null,
        errorId: null,
      }));
  }
  static getDerivedStateFromError(t) {
    return { hasError: !0, error: t };
  }
  componentDidCatch(t, r) {
    var n, a;
    (this.setState({ errorInfo: r }),
      typeof window < 'u' &&
        fetch('/api/log-error', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            error: { message: t.message, stack: t.stack, name: t.name },
            componentStack: r.componentStack,
            url: window.location.href,
            userAgent: navigator.userAgent,
            timestamp: new Date().toISOString(),
          }),
        }).catch((i) => {
          console.error('[WallErrorBoundary] Failed to report error', i);
        }),
      (a = (n = this.props).onError) == null || a.call(n, t, r));
  }
  render() {
    if (this.state.hasError && this.state.error) {
      if (this.props.fallback) return this.props.fallback;
      const t = Kv(this.state.error);
      return s.jsx('div', {
        className:
          'flex min-h-screen items-center justify-center bg-gradient-to-b from-bg-base to-bg-soft px-4',
        children: s.jsxs('div', {
          className:
            'border-error-200 max-w-md rounded-2xl border bg-white p-8 text-center shadow-xl',
          children: [
            s.jsxs('div', {
              className: 'mb-4 text-5xl',
              children: [
                t.category === 'network' && '📡',
                t.category === 'permission' && '🔒',
                t.category === 'notFound' && '🔍',
                t.category === 'runtime' && '💥',
                t.category === 'unknown' && '⚠️',
              ],
            }),
            s.jsx('h2', {
              className: 'mb-2 text-xl font-bold text-ink-900',
              children: t.title,
            }),
            s.jsx('p', {
              className: 'mb-6 text-sm text-ink-600',
              children: t.message,
            }),
            s.jsxs('div', {
              className: 'flex flex-col gap-2 sm:flex-row sm:justify-center',
              children: [
                t.onAction &&
                  s.jsx('button', {
                    onClick: t.onAction ?? this.resetErrorBoundary,
                    className:
                      'rounded-lg border border-brand/40 px-4 py-2 text-sm font-semibold text-brand transition hover:bg-brand/10',
                    children: t.actionText,
                  }),
                t.actionHref &&
                  s.jsx('a', {
                    href: t.actionHref,
                    className:
                      'inline-flex items-center justify-center rounded-lg bg-brand px-4 py-2 text-sm font-semibold text-white shadow hover:bg-brand-600',
                    children: t.actionText,
                  }),
                !t.onAction &&
                  !t.actionHref &&
                  s.jsx('button', {
                    onClick: this.resetErrorBoundary,
                    className:
                      'rounded-lg border border-brand/40 px-4 py-2 text-sm font-semibold text-brand transition hover:bg-brand/10',
                    children: '🔄 重試',
                  }),
              ],
            }),
            !1,
          ],
        }),
      });
    }
    return this.props.children;
  }
}
const Jv = '94ec9b8',
  Xv = '2025-12-19T10:02:48.125Z',
  e1 = (() => {
    const e = new Date(Xv);
    return Number.isNaN(e.getTime()) ? null : e;
  })(),
  md = e1 ?? new Date(),
  t1 = (e) =>
    new Intl.DateTimeFormat('zh-TW', {
      dateStyle: 'short',
      timeStyle: 'medium',
      hour12: !1,
      timeZone: 'Asia/Taipei',
    }).format(e),
  hd = Jv;
md.toISOString();
const fd = t1(md),
  s1 = `v${hd}·KC1`,
  Fo = `版本 ${hd}（Key Capsules SSOT v1）· 建置 ${fd}`,
  $o =
    'inline-flex items-center gap-2 rounded-full border border-ink/10 bg-white/90 px-4 py-2 text-[11px] font-medium text-ink-600 shadow-md backdrop-blur';
function Uo({ variant: e = 'floating', className: t = '' }) {
  const r = s.jsxs(s.Fragment, {
    children: [
      s.jsx('span', {
        className: 'text-[10px] uppercase tracking-wider text-ink-400',
        children: '版本',
      }),
      s.jsx('span', {
        className: 'font-mono text-sm text-ink-900',
        'aria-label': 'build-version',
        children: s1,
      }),
      s.jsx('span', {
        className: 'text-ink-500 text-[10px]',
        'aria-label': 'build-time',
        children: fd,
      }),
    ],
  });
  return e === 'inline'
    ? s.jsx('div', { className: `${$o} ${t}`, title: Fo, children: r })
    : s.jsx('div', {
        className: `${$o} pointer-events-auto fixed bottom-5 right-5 z-40 ${t}`,
        title: Fo,
        children: r,
      });
}
const yt = {
  all: ['communityWall'],
  wall: (e, t) => [...yt.all, 'wall', e, t],
  posts: (e, t) => [...yt.all, 'posts', e, t],
};
function r1(e, t = {}) {
  const {
      includePrivate: r = !1,
      staleTime: n = 5 * 60 * 1e3,
      refetchOnWindowFocus: a = !0,
      enabled: i = !0,
      currentUserId: o,
    } = t,
    l = Sn(),
    [c, d] = h.useState(!1),
    m = !!o,
    u = o ?? '',
    {
      data: x,
      isLoading: f,
      isFetching: g,
      error: b,
      refetch: y,
    } = $a({
      queryKey: yt.wall(e || '', r),
      queryFn: () => Sp(e, { includePrivate: r }),
      enabled: i && !!e,
      staleTime: n,
      refetchOnWindowFocus: a,
      retry: (j, _) => {
        const D = _ == null ? void 0 : _.status;
        return D && [400, 401, 403, 404].includes(D) ? !1 : j < 1;
      },
      retryDelay: 1e3,
    }),
    p = h.useCallback(async () => {
      e && (await y());
    }, [e, y]),
    E = dr({
      mutationFn: Tp,
      onMutate: async (j) => {
        if (!m) return { previousData: void 0 };
        (d(!0), await l.cancelQueries({ queryKey: yt.wall(e || '', r) }));
        const _ = l.getQueryData(yt.wall(e || '', r));
        if (_) {
          const D = (V) =>
            V.map((se) => {
              if (se.id !== j) return se;
              const I = se.liked_by.includes(u);
              return {
                ...se,
                likes_count: I ? Math.max(0, se.likes_count - 1) : se.likes_count + 1,
                liked_by: I ? se.liked_by.filter((A) => A !== u) : [...se.liked_by, u],
              };
            });
          l.setQueryData(yt.wall(e || '', r), {
            ..._,
            posts: {
              ..._.posts,
              public: D(_.posts.public),
              private: D(_.posts.private),
            },
          });
        }
        return { previousData: _ };
      },
      onError: (j, _, D) => {
        D != null && D.previousData && l.setQueryData(yt.wall(e || '', r), D.previousData);
      },
      onSettled: () => {
        (d(!1), l.invalidateQueries({ queryKey: yt.wall(e || '', r) }));
      },
    }),
    S = dr({
      mutationFn: ({ content: j, visibility: _ }) => Ep(e, j, _),
      onSuccess: () => {
        l.invalidateQueries({ queryKey: yt.wall(e || '', r) });
      },
    }),
    N = dr({
      mutationFn: (j) => Ip(e, j),
      onSuccess: () => {
        l.invalidateQueries({ queryKey: yt.wall(e || '', r) });
      },
    }),
    k = dr({
      mutationFn: ({ questionId: j, content: _ }) => Cp(j, _),
      onSuccess: () => {
        l.invalidateQueries({ queryKey: yt.wall(e || '', r) });
      },
    }),
    T = h.useCallback(
      async (j) => {
        await E.mutateAsync(j);
      },
      [E]
    ),
    C = h.useCallback(
      async (j, _ = 'public') => {
        if (!e) throw new Error('缺少社區 ID');
        await S.mutateAsync({ content: j, visibility: _ });
      },
      [e, S]
    ),
    w = h.useCallback(
      async (j) => {
        if (!e) throw new Error('缺少社區 ID');
        await N.mutateAsync(j);
      },
      [e, N]
    ),
    G = h.useCallback(
      async (j, _) => {
        await k.mutateAsync({ questionId: j, content: _ });
      },
      [k]
    );
  return {
    data: x,
    isLoading: f,
    isFetching: g,
    error: b,
    refresh: p,
    toggleLike: T,
    createPost: C,
    askQuestion: w,
    answerQuestion: G,
    isOptimisticUpdating: c,
  };
}
const Bo = [
    {
      id: 1,
      author: '陳小姐',
      floor: '12F',
      type: 'resident',
      time: ft(120),
      title: '有人要團購掃地機嗎？🤖',
      content: '這款 iRobot 打折，滿 5 台有團購價～',
      likes: 31,
      comments: 14,
    },
    {
      id: 2,
      author: '游杰倫',
      type: 'agent',
      time: ft(1440),
      title: '🏡 惠宇上晴 12F｜雙陽台視野戶',
      content: '客廳光線很好，上週屋主剛降價 50 萬，有興趣可私訊。',
      views: 89,
      likes: 0,
      comments: 5,
    },
    {
      id: 3,
      author: '李先生',
      floor: '8F',
      type: 'resident',
      time: ft(3 * 24 * 60),
      title: '停車位交流 🚗',
      content: '我有 B2-128 想與 B1 交換，方便接送小孩',
      likes: 12,
      comments: 8,
    },
    {
      id: 4,
      author: '王太太',
      floor: '5F',
      type: 'resident',
      time: ft(7 * 24 * 60),
      title: '推薦水電師傅',
      content: '上次找的師傅很專業，價格公道，需要的鄰居私訊我',
      likes: 25,
      comments: 6,
    },
    {
      id: 5,
      author: '林經理',
      type: 'agent',
      time: ft(8 * 24 * 60),
      title: '🏡 惠宇上晴 8F｜三房車位',
      content: '屋況極新，前屋主自住保養好',
      views: 156,
      likes: 0,
      comments: 12,
    },
  ],
  Go = [
    {
      id: 101,
      author: '管委會',
      type: 'official',
      time: ft(3 * 24 * 60),
      title: '📢 年度消防演練通知',
      content: '12/15（日）上午 10:00 將進行全社區消防演練，届時警報器會響，請勿驚慌。',
      pinned: !0,
      likes: 0,
      comments: 0,
    },
    {
      id: 102,
      author: '15F 住戶',
      floor: '15F',
      type: 'resident',
      time: ft(8 * 24 * 60),
      title: '管理費調漲討論',
      content: '想問大家覺得管理費調漲合理嗎？從 2,800 調到 3,200，漲幅有點大...',
      likes: 0,
      comments: 28,
      private: !0,
    },
    {
      id: 103,
      author: '3F 住戶',
      floor: '3F',
      type: 'resident',
      time: ft(14 * 24 * 60),
      title: '頂樓漏水問題',
      content: '最近下雨頂樓好像有漏水，管委會有要處理嗎？',
      likes: 0,
      comments: 15,
      private: !0,
    },
  ],
  Ho = [
    {
      id: 1,
      author: '游杰倫',
      company: '21世紀',
      visits: 12,
      deals: 3,
      pros: ['公設維護得乾淨，假日草皮有人整理', '反映停車動線，管委會一週內就公告改善'],
      cons: '面向大馬路低樓層車聲明顯，喜靜者選中高樓層',
    },
    {
      id: 2,
      author: '林美玲',
      company: '信義房屋',
      visits: 8,
      deals: 2,
      pros: ['頂樓排水設計不錯，颱風天也沒有積水問題', '中庭花園維護用心，住戶反應都很正面'],
      cons: '垃圾車時間稍晚，家裡偶爾會有下水道味',
    },
    {
      id: 3,
      author: '陳志明',
      company: '永慶房屋',
      visits: 6,
      deals: 1,
      pros: ['管理員服務態度很好，代收包裹很方便', '社區有健身房，設備維護不錯'],
      cons: '電梯尖峰時段要等比較久',
    },
    {
      id: 4,
      author: '黃小華',
      company: '住商不動產',
      visits: 10,
      deals: 2,
      pros: ['學區不錯，走路到國小只要5分鐘', '附近生活機能完善'],
      cons: '部分戶型採光稍弱',
    },
    {
      id: 5,
      author: '張大明',
      company: '台灣房屋',
      visits: 5,
      deals: 1,
      pros: ['建商口碑好，用料實在', '公設比合理，實坪數划算'],
      cons: '車道坡度較陡，新手要小心',
    },
  ],
  Wo = [
    {
      id: 1,
      question: '請問社區停車位好停嗎？會不會常客滿？',
      time: ft(2 * 24 * 60),
      answersCount: 2,
      answers: [
        {
          author: '12F 住戶',
          type: 'resident',
          content: 'B2 比較容易有位，B1 要碰運氣。',
        },
        {
          author: '游杰倫',
          type: 'agent',
          content: '這社區車位配比是 1:1.2，算充裕的。',
          expert: !0,
        },
      ],
    },
    {
      id: 2,
      question: '晚上會不會很吵？我看物件時是白天',
      time: ft(5 * 24 * 60),
      answersCount: 2,
      answers: [
        {
          author: '3F 住戶',
          type: 'resident',
          content: '面大馬路那側確實有車聲，但習慣就好。內側安靜很多。',
        },
        {
          author: '10F 住戶',
          type: 'resident',
          content: '我住內側，晚上很安靜，睡眠品質不錯。',
        },
      ],
    },
    {
      id: 3,
      question: '管理費多少？有包含哪些服務？',
      time: ft(7 * 24 * 60),
      answersCount: 1,
      answers: [
        {
          author: '管委會',
          type: 'official',
          content: '目前每坪 85 元，含 24 小時保全、公設維護、垃圾代收。',
        },
      ],
    },
    {
      id: 4,
      question: '社區有健身房嗎？設備新不新？',
      time: ft(3 * 24 * 60),
      answersCount: 0,
      answers: [],
    },
  ],
  n1 = {
    communityInfo: {
      name: '惠宇上晴',
      year: 2018,
      units: 280,
      managementFee: 85,
      builder: '惠宇建設',
      members: 88,
      avgRating: 4.2,
      monthlyInteractions: 156,
      forSale: 23,
    },
    posts: {
      public: Bo,
      private: Go,
      publicTotal: Bo.length,
      privateTotal: Go.length,
    },
    reviews: { items: Ho, total: Ho.length },
    questions: { items: Wo, total: Wo.length },
  },
  a1 = (e, t) => ({
    id: Date.now(),
    author: '測試用戶',
    type: 'resident',
    time: new Date().toISOString(),
    title: e.substring(0, 20) + (e.length > 20 ? '...' : ''),
    content: e,
    likes: 0,
    comments: 0,
    pinned: !1,
    private: t === 'private',
  }),
  i1 = (e) => ({
    id: Date.now(),
    question: e,
    time: new Date().toISOString(),
    answersCount: 0,
    answers: [],
  }),
  o1 = (e) => ({
    author: '測試用戶',
    type: 'resident',
    content: e,
    expert: !1,
  }),
  l1 = ['房仲公司', '未知公司', 'N/A', '無', '-'],
  c1 = { resident: '用戶', member: '會員', agent: '房仲', official: '官方' };
function d1(e) {
  return e === 'agent'
    ? 'agent'
    : e === 'official'
      ? 'official'
      : e === 'member'
        ? 'member'
        : 'resident';
}
function u1(e) {
  return e ? (e.length >= 6 ? e.slice(0, 6) : e) : '';
}
function m1(e, t) {
  const r = c1[e],
    n = u1(t);
  return n ? `${r}-${n}` : r;
}
function ni(e, t) {
  var o, l;
  const r = d1(t == null ? void 0 : t.role),
    n = m1(r, e),
    a = ((o = t == null ? void 0 : t.name) == null ? void 0 : o.trim()) || n,
    i = (l = t == null ? void 0 : t.floor) == null ? void 0 : l.trim();
  return { name: a, role: r, ...(i ? { floor: i } : {}) };
}
function gn(e) {
  return e
    .map((t, r) => ({ post: t, index: r }))
    .sort((t, r) => {
      const n = (r.post.pinned ? 1 : 0) - (t.post.pinned ? 1 : 0);
      return n !== 0 ? n : t.index - r.index;
    })
    .map(({ post: t }) => t);
}
function pd(e) {
  const t = new Date(e);
  if (Number.isNaN(t.getTime())) return '剛剛';
  const n = new Date().getTime() - t.getTime(),
    a = Math.floor(n / 6e4),
    i = Math.floor(a / 60),
    o = Math.floor(i / 24),
    l = Math.floor(o / 7);
  return n < 0
    ? t.toLocaleDateString('zh-TW')
    : a < 1
      ? '剛剛'
      : a < 60
        ? `${a}分鐘前`
        : i < 24
          ? `${i}小時前`
          : o < 7
            ? `${o}天前`
            : l < 4
              ? `${l}週前`
              : t.toLocaleDateString('zh-TW');
}
function Vo(e) {
  const t = ni(e.author_id, e.author);
  return {
    id: e.id,
    author: t.name,
    ...(t.floor ? { floor: t.floor } : {}),
    type: t.role,
    time: pd(e.created_at),
    title: e.content.substring(0, 20) + (e.content.length > 20 ? '...' : ''),
    content: e.content,
    likes: e.likes_count,
    comments: e.comments_count ?? 0,
    pinned: e.is_pinned ?? !1,
    private: e.visibility === 'private',
    liked_by: e.liked_by,
  };
}
function h1(e) {
  var i, o, l, c, d;
  const t = e.agent,
    r = ((i = t == null ? void 0 : t.company) == null ? void 0 : i.trim()) ?? '',
    n = ni(e.author_id, {
      name: (t == null ? void 0 : t.name) ?? null,
      role: 'agent',
    }),
    a = l1.includes(r) ? '' : r;
  return {
    id: e.id,
    author: n.name,
    company: a,
    visits: ((o = t == null ? void 0 : t.stats) == null ? void 0 : o.visits) ?? 0,
    deals: ((l = t == null ? void 0 : t.stats) == null ? void 0 : l.deals) ?? 0,
    pros: ((c = e.content) == null ? void 0 : c.pros) ?? [],
    cons: ((d = e.content) == null ? void 0 : d.cons) ?? '',
  };
}
function f1(e) {
  const t = e.answers ?? [];
  return {
    id: e.id,
    question: e.question,
    time: pd(e.created_at),
    answersCount: t.length,
    answers: t.map((r) => {
      const n = ni(r.author_id, r.author);
      return {
        author: n.name,
        type: n.role,
        content: r.content,
        expert: r.is_expert,
      };
    }),
    hasMoreAnswers: e.hasMoreAnswers ?? !1,
    totalAnswers: e.totalAnswers ?? e.answers_count ?? t.length,
  };
}
function p1(e) {
  var m, u, x, f, g, b, y, p;
  const t = ((m = e.posts) == null ? void 0 : m.public) ?? [],
    r = ((u = e.posts) == null ? void 0 : u.private) ?? [],
    n = ((x = e.reviews) == null ? void 0 : x.items) ?? [],
    a = ((f = e.questions) == null ? void 0 : f.items) ?? [],
    i = t.map(Vo),
    o = r.map(Vo),
    l = gn(i),
    c = gn(o);
  return {
    communityInfo: e.communityInfo
      ? {
          name: e.communityInfo.name ?? '未知社區',
          year: e.communityInfo.year ?? null,
          units: e.communityInfo.units ?? null,
          managementFee: e.communityInfo.managementFee ?? null,
          builder: e.communityInfo.builder ?? null,
          members: e.communityInfo.members ?? null,
          avgRating: e.communityInfo.avgRating ?? null,
          monthlyInteractions: e.communityInfo.monthlyInteractions ?? null,
          forSale: e.communityInfo.forSale ?? null,
        }
      : {
          name: '未知社區',
          year: null,
          units: null,
          managementFee: null,
          builder: null,
          members: null,
          avgRating: null,
          monthlyInteractions: null,
          forSale: null,
        },
    posts: {
      public: l,
      private: c,
      publicTotal: ((g = e.posts) == null ? void 0 : g.publicTotal) ?? 0,
      privateTotal: ((b = e.posts) == null ? void 0 : b.privateTotal) ?? 0,
    },
    reviews: {
      items: n.map(h1),
      total: ((y = e.reviews) == null ? void 0 : y.total) ?? 0,
    },
    questions: {
      items: a.map(f1),
      total: ((p = e.questions) == null ? void 0 : p.total) ?? 0,
    },
  };
}
const xd = 'community-wall-mock-data-v1',
  x1 = 250,
  Zo = {
    communityInfo: {
      name: '載入中...',
      year: null,
      units: null,
      managementFee: null,
      builder: null,
      members: null,
      avgRating: null,
      monthlyInteractions: null,
      forSale: null,
    },
    posts: { public: [], private: [], publicTotal: 0, privateTotal: 0 },
    reviews: { items: [], total: 0 },
    questions: { items: [], total: 0 },
  },
  g1 = (e) => new Promise((t) => setTimeout(t, e)),
  gd = () => {
    try {
      return typeof window < 'u' && typeof window.localStorage < 'u';
    } catch {
      return !1;
    }
  },
  b1 = (e, t) => {
    var r, n, a, i;
    return t
      ? {
          ...e,
          ...t,
          communityInfo: { ...e.communityInfo, ...(t.communityInfo ?? {}) },
          posts: {
            public: ((r = t.posts) == null ? void 0 : r.public) ?? e.posts.public,
            private: ((n = t.posts) == null ? void 0 : n.private) ?? e.posts.private,
            publicTotal: ((a = t.posts) == null ? void 0 : a.publicTotal) ?? e.posts.publicTotal,
            privateTotal: ((i = t.posts) == null ? void 0 : i.privateTotal) ?? e.posts.privateTotal,
          },
          reviews: t.reviews ?? e.reviews,
          questions: t.questions ?? e.questions,
        }
      : e;
  },
  y1 = (e) => {
    if (!gd()) return e;
    try {
      const t = window.localStorage.getItem(xd);
      if (!t) return e;
      const r = JSON.parse(t);
      return b1(e, r);
    } catch (t) {
      return (console.error('Failed to load community wall mock state', t), e);
    }
  },
  v1 = (e) => {
    if (gd())
      try {
        window.localStorage.setItem(xd, JSON.stringify(e));
      } catch (t) {
        console.error('Failed to persist community wall mock state', t);
      }
  },
  j1 = ['guest', 'member', 'resident', 'agent'],
  w1 = (e, t) => (typeof e == 'string' && j1.includes(e) ? e : t ? 'member' : 'guest');
function N1(e, t = {}) {
  const { includePrivate: r = !1, initialMockData: n = n1, persistMockState: a = !0 } = t,
    [i, o] = h.useState(() => Bs.isMockEnabled());
  h.useEffect(() => Bs.subscribe(o), []);
  const [l, c] = h.useState(void 0);
  h.useEffect(() => {
    let A = !0;
    (async () => {
      try {
        const {
          data: { user: re },
        } = await de.auth.getUser();
        A && re != null && re.id && c(re.id);
      } catch {}
    })();
    const {
      data: { subscription: O },
    } = de.auth.onAuthStateChange((re, ae) => {
      var R;
      A && c((R = ae == null ? void 0 : ae.user) == null ? void 0 : R.id);
    });
    return () => {
      ((A = !1), O.unsubscribe());
    };
  }, []);
  const [d, m] = h.useState(() => (a ? y1(n) : n)),
    [u, x] = h.useState(() => new Set()),
    f = !!l;
  h.useEffect(() => {
    !a || !i || v1(d);
  }, [d, a, i]);
  const {
      data: g,
      isLoading: b,
      error: y,
      refresh: p,
      toggleLike: E,
      createPost: S,
      askQuestion: N,
      answerQuestion: k,
    } = r1(e, { enabled: !i, includePrivate: r, currentUserId: l }),
    T = h.useMemo(() => {
      var A;
      if (i)
        return {
          ...d,
          posts: {
            ...d.posts,
            public: gn(d.posts.public),
            private: gn(d.posts.private),
          },
        };
      if (g) {
        const z = p1(g),
          O =
            (A = z.communityInfo) != null && A.name
              ? z.communityInfo
              : { ...Zo.communityInfo, name: '尚無社區資料' };
        return { ...z, communityInfo: O };
      }
      return Zo;
    }, [i, d, g]),
    C = h.useCallback(async () => {
      if (i) {
        m((A) => ({ ...A }));
        return;
      }
      await p();
    }, [i, p]),
    w = h.useMemo(
      () => (i ? (f ? 'member' : 'guest') : w1(g == null ? void 0 : g.viewerRole, f)),
      [i, g == null ? void 0 : g.viewerRole, f]
    ),
    G = w !== 'guest',
    j = h.useCallback(() => {
      if (l) return l;
      const A = 'mock_user_id';
      let z = localStorage.getItem(A);
      return (
        z ||
          ((z = `mock-user-${Date.now()}-${Math.random().toString(36).slice(2, 8)}`),
          localStorage.setItem(A, z)),
        z
      );
    }, [l]),
    _ = h.useCallback(
      async (A) => {
        if (i) {
          await g1(x1);
          const z = j(),
            O = u.has(A);
          (m((re) => {
            const ae = (R) =>
              R.map((ee) => {
                if (ee.id !== A) return ee;
                const $ = ee.likes ?? 0,
                  J = ee.liked_by ?? [];
                return {
                  ...ee,
                  likes: O ? Math.max(0, $ - 1) : $ + 1,
                  liked_by: O ? J.filter((Y) => Y !== z) : [...J, z],
                };
              });
            return {
              ...re,
              posts: {
                ...re.posts,
                public: ae(re.posts.public),
                private: ae(re.posts.private),
              },
            };
          }),
            x((re) => {
              const ae = new Set(re);
              return (ae.has(A) ? ae.delete(A) : ae.add(A), ae);
            }));
          return;
        }
        await E(String(A));
      },
      [i, E, u, j]
    ),
    D = h.useCallback(
      async (A, z = 'public') => {
        if (i) {
          const O = a1(A, z);
          m((re) => {
            const ae = z === 'private' ? 'private' : 'public',
              R = z === 'private' ? 'privateTotal' : 'publicTotal';
            return {
              ...re,
              posts: {
                ...re.posts,
                [ae]: [O, ...re.posts[ae]],
                [R]: re.posts[R] + 1,
              },
            };
          });
          return;
        }
        await S(A, z);
      },
      [i, S]
    ),
    V = h.useCallback(
      async (A) => {
        if (i) {
          const z = i1(A);
          m((O) => ({
            ...O,
            questions: {
              ...O.questions,
              items: [z, ...O.questions.items],
              total: O.questions.total + 1,
            },
          }));
          return;
        }
        await N(A);
      },
      [i, N]
    ),
    se = h.useCallback(
      async (A, z) => {
        if (i) {
          m((O) => ({
            ...O,
            questions: {
              ...O.questions,
              items: O.questions.items.map((re) => {
                if (re.id.toString() !== A) return re;
                const ae = o1(z);
                return {
                  ...re,
                  answers: [...re.answers, ae],
                  answersCount: re.answersCount + 1,
                };
              }),
            },
          }));
          return;
        }
        await k(A, z);
      },
      [i, k]
    ),
    I = h.useCallback((A) => {
      const z = Bs.setMock(A);
      (o(z), x(new Set()));
    }, []);
  return {
    data: T,
    useMock: i,
    setUseMock: I,
    isLoading: !i && b,
    error: i ? null : y,
    refresh: C,
    toggleLike: _,
    createPost: D,
    askQuestion: V,
    answerQuestion: se,
    viewerRole: w,
    isAuthenticated: G,
  };
}
const _1 = ''.trim().toLowerCase(),
  k1 = _1 !== 'false';
function S1() {
  const e = Er(),
    [t, r] = Tr();
  yn();
  const n = e.id,
    a = h.useRef(t);
  h.useEffect(() => {
    a.current = t;
  }, [t]);
  const i = h.useMemo(() => 'guest', []),
    [o, l] = h.useState(i),
    [c, d] = h.useState('public'),
    [m, u] = h.useState(!1),
    { isAuthenticated: x, role: f, loading: g, error: b } = Ct(),
    y = h.useMemo(() => (g ? 'guest' : x ? f : 'guest'), [f, x, o, g]),
    p = h.useMemo(() => Or(y), [y]),
    E = k1,
    {
      data: S,
      useMock: N,
      setUseMock: k,
      isLoading: T,
      error: C,
      refresh: w,
      toggleLike: G,
      createPost: j,
      askQuestion: _,
      answerQuestion: D,
      viewerRole: V,
    } = N1(n ?? '', { includePrivate: p.canAccessPrivate }),
    se = E || N,
    I = N,
    A = !se && !N;
  (h.useEffect(() => {
    b && W.error('登入狀態異常', b.message);
  }, [b]),
    h.useEffect(() => {
      N || (V && V !== o && l(V));
    }, [V, o, N]));
  const z = h.useCallback(() => {
      const B = Bs.setMock(!0);
      k(B);
    }, [k]),
    O = h.useCallback(
      (B) => {
        I && l(B);
      },
      [I, r]
    );
  (h.useEffect(() => {}, [o, t, l]),
    h.useEffect(() => {
      if (typeof window > 'u') return;
      const B = (ie) => {
        ie.storageArea !== window.localStorage || ie.newValue;
      };
      return (
        window.addEventListener('storage', B),
        () => window.removeEventListener('storage', B)
      );
    }, [o, l]),
    h.useCallback(() => {
      window.location.href = ve.AUTH;
    }, []));
  const re = h.useCallback(
    (B) => {
      (B === 'private' && !p.canAccessPrivate) || d(B);
    },
    [p.canAccessPrivate]
  );
  h.useEffect(() => {
    c === 'private' && !p.canAccessPrivate && d('public');
  }, [c, p.canAccessPrivate]);
  const ae = h.useCallback(
      async (B) => {
        if (!x) {
          W.error('請先登入', '登入後才能按讚');
          return;
        }
        try {
          await G(B);
        } catch (ie) {
          (console.error('Failed to toggle like', ie), W.error('按讚失敗', '請稍後再試'));
        }
      },
      [G, x]
    ),
    R = h.useCallback((B) => {
      (console.log('Unlock post:', B), W.info('功能開發中', '解鎖功能即將上線'));
    }, []),
    ee = h.useCallback(
      async (B, ie = 'public') => {
        try {
          await j(B, ie);
        } catch (fe) {
          (console.error('Failed to create post', fe), W.error('發文失敗', '請稍後再試'));
        }
      },
      [j]
    ),
    $ = h.useCallback(
      async (B) => {
        try {
          await _(B);
        } catch (ie) {
          throw (
            console.error('Failed to submit question', ie),
            W.error('提問失敗', '請稍後再試'),
            ie
          );
        }
      },
      [_]
    ),
    J = h.useCallback(
      async (B, ie) => {
        try {
          await D(B, ie);
        } catch (fe) {
          throw (
            console.error('Failed to submit answer', fe),
            W.error('回答失敗', '請稍後再試'),
            fe
          );
        }
      },
      [D]
    ),
    Y = h.useCallback(async () => {
      if (!m) {
        u(!0);
        try {
          await w();
        } catch (B) {
          console.error('Failed to refresh community wall', B);
        } finally {
          u(!1);
        }
      }
    }, [m, w]);
  if (!n)
    return s.jsx('div', {
      className:
        'flex min-h-screen items-center justify-center bg-gradient-to-b from-[var(--bg-base)] to-[var(--bg-alt)]',
      children: s.jsxs('div', {
        className:
          'rounded-2xl border border-brand/10 bg-white px-8 py-10 text-center shadow-[0_10px_30px_rgba(0,34,73,0.08)]',
        children: [
          s.jsx('div', { className: 'mb-3 text-4xl', children: '🧭' }),
          s.jsx('p', {
            className: 'mb-4 text-base font-semibold text-ink-900',
            children: '找不到指定的社區牆',
          }),
          s.jsx('p', {
            className: 'mb-6 text-sm text-ink-600',
            children: '請確認網址是否正確，或回到首頁重新選擇社區。',
          }),
          s.jsx('a', {
            href: ve.HOME,
            className:
              'inline-flex items-center justify-center rounded-full bg-brand px-5 py-2.5 text-sm font-bold text-white shadow hover:bg-brand-600',
            children: '回到首頁',
          }),
        ],
      }),
    });
  if (g)
    return s.jsxs('div', {
      className: 'min-h-screen bg-gradient-to-b from-[var(--bg-base)] to-[var(--bg-alt)]',
      children: [
        s.jsx(fs, { mode: 'community', title: '載入中...' }),
        s.jsx('div', {
          className: 'mx-auto max-w-[960px] p-2.5',
          children: s.jsx(Do, {}),
        }),
      ],
    });
  if (b)
    return s.jsxs('div', {
      className: 'min-h-screen bg-gradient-to-b from-[var(--bg-base)] to-[var(--bg-alt)]',
      children: [
        s.jsx(fs, { mode: 'community', title: '登入異常' }),
        s.jsx('div', {
          className: 'mx-auto max-w-[960px] p-4',
          children: s.jsxs('div', {
            className: 'rounded-2xl border border-red-200 bg-red-50 p-6 text-center shadow-sm',
            children: [
              s.jsx('p', {
                className: 'text-lg font-semibold text-red-700',
                children: '登入狀態異常',
              }),
              s.jsx('p', {
                className: 'mt-2 text-sm text-red-600',
                children: b.message,
              }),
              s.jsx('button', {
                type: 'button',
                onClick: () => window.location.reload(),
                className:
                  'mt-4 inline-flex items-center justify-center rounded-lg bg-brand px-4 py-2 text-sm font-bold text-white hover:bg-brand-700',
                children: '重新載入',
              }),
            ],
          }),
        }),
      ],
    });
  if (T)
    return s.jsxs('div', {
      className: 'min-h-screen bg-gradient-to-b from-[var(--bg-base)] to-[var(--bg-alt)]',
      children: [
        s.jsx(fs, { mode: 'community', title: '載入中...' }),
        s.jsx('div', {
          className: 'mx-auto max-w-[960px] p-2.5',
          children: s.jsx(Do, {}),
        }),
      ],
    });
  if (C) {
    const B = C.message || '',
      ie = B.includes('401') || B.includes('403') || B.includes('權限');
    return s.jsxs('div', {
      className:
        'flex min-h-screen items-center justify-center bg-gradient-to-b from-bg-base to-bg-soft',
      children: [
        s.jsxs('div', {
          className: 'text-center',
          children: [
            s.jsx('div', {
              className: 'mb-2 text-2xl',
              children: ie ? '🔐' : '😢',
            }),
            s.jsx('div', {
              className: 'mb-2 text-sm text-ink-600',
              children: ie ? '請先登入' : '載入失敗，請稍後再試',
            }),
            ie
              ? s.jsx('button', {
                  onClick: () => (window.location.href = '/auth'),
                  className: 'rounded-lg bg-brand px-4 py-2 text-sm text-white',
                  children: '前往登入',
                })
              : s.jsxs('div', {
                  className: 'flex flex-col gap-2 sm:flex-row sm:justify-center',
                  children: [
                    s.jsx('button', {
                      onClick: Y,
                      disabled: m,
                      'aria-busy': m,
                      className: `rounded-lg border border-brand/40 px-4 py-2 text-sm font-semibold transition hover:bg-brand/10 ${m ? 'cursor-not-allowed text-brand/60' : 'text-brand'}`,
                      children: m ? '⏳ 重新整理中…' : '🔄 重新整理',
                    }),
                    s.jsx('button', {
                      onClick: z,
                      className:
                        'rounded-lg bg-[#1a1a2e] px-4 py-2 text-sm font-semibold text-white shadow hover:brightness-110',
                      children: '🧪 改用示範資料',
                    }),
                  ],
                }),
          ],
        }),
        s.jsx(Uo, {}),
      ],
    });
  }
  const { communityInfo: oe, posts: U, reviews: q, questions: ue } = S;
  return s.jsxs('div', {
    className: 'min-h-screen bg-gradient-to-b from-[var(--bg-base)] to-[var(--bg-alt)]',
    children: [
      s.jsx(fs, { mode: 'community', title: oe.name }),
      s.jsxs('div', {
        className:
          'mx-auto flex max-w-[960px] gap-5 p-2.5 pb-[calc(80px+env(safe-area-inset-bottom,20px))] lg:p-2.5',
        children: [
          s.jsxs('main', {
            className: 'flex max-w-[600px] flex-1 animate-[fadeInUp_0.5s_ease-out] flex-col gap-3',
            children: [
              s.jsx(Mv, { viewerRole: y, reviews: q, onUnlock: R }),
              s.jsx(Hv, {
                viewerRole: y,
                currentTab: c,
                onTabChange: re,
                publicPosts: U.public,
                privatePosts: U.private,
                onLike: ae,
                onCreatePost: ee,
                onUnlock: R,
              }),
              s.jsx(Wv, {
                viewerRole: y,
                questions: ue,
                onAskQuestion: $,
                onAnswerQuestion: J,
                onUnlock: R,
              }),
            ],
          }),
          s.jsx(Vv, { info: oe, questions: ue, posts: U.public }),
        ],
      }),
      s.jsx(Yv, { viewerRole: y }),
      (E || N) && s.jsx(Xa, { useMock: N, onToggle: () => k(!N), disabled: A }),
      N && s.jsx(Zv, { role: o, onRoleChange: O }),
      s.jsx(Uo, {}),
      s.jsx('style', {
        children: `
        @keyframes fadeInUp {
          from { opacity: 0; transform: translateY(8px); }
          to { opacity: 1; transform: translateY(0); }
        }
        @keyframes wave {
          0%, 100% { transform: rotate(0deg); }
          20% { transform: rotate(-25deg); }
          40% { transform: rotate(10deg); }
          60% { transform: rotate(-20deg); }
          80% { transform: rotate(5deg); }
        }
      `,
      }),
    ],
  });
}
function E1() {
  return s.jsx(Qv, { children: s.jsx(S1, {}) });
}
function T1() {
  return s.jsxs('section', {
    className:
      'mx-auto mt-8 max-w-container rounded-[var(--r-lg)] bg-white p-6 shadow-[var(--shadow-card)]',
    children: [
      s.jsx('h1', { className: 'text-xl font-semibold', children: '推薦社區' }),
      s.jsx('p', {
        className: 'mt-2 text-sm text-[var(--text-secondary)]',
        children: '依據您的偏好，為您推薦可能喜歡的社區。',
      }),
    ],
  });
}
function I1(e, t, r) {
  const n = t / 12 / 100,
    a = r * 12;
  return n === 0 ? e / a : (e * n) / (1 - Math.pow(1 + n, -a));
}
const C1 = () => {
    const [e, t] = h.useState(1500),
      [r, n] = h.useState(30),
      [a, i] = h.useState(2.25),
      [o, l] = h.useState(20),
      [c, d] = h.useState(''),
      m = h.useMemo(() => Math.max(0, e * (1 - r / 100)), [e, r]),
      u = h.useMemo(() => Math.round(I1(m * 1e4, a, o)), [m, a, o]),
      x = 3e3,
      f = h.useMemo(
        () => (typeof c != 'number' || c <= 0 ? null : Math.round(((u + x) / c) * 100)),
        [c, u]
      ),
      g = () => {
        const y =
          `概算（僅供參考）：
總價${e}萬，頭期${r}% → 貸款約${m.toFixed(0)}萬；${o}年利率${a}% → 月付約 ${u} 元；管理費約 ${x} 元。` +
          (f !== null
            ? `
月負擔率約 ${f}%（含管理費）。`
            : '');
        navigator.clipboard.writeText(y).then(() => rt(nt.BudgetCopy, {}));
      },
      b =
        f === null
          ? '這個數字僅供參考，別給自己太大壓力。'
          : f >= 50
            ? '負擔率偏高了，先別急著決定；我們可以討論更有彈性的做法。'
            : f >= 35
              ? '負擔率有點高，可再看看地點/年限的權衡。'
              : '看起來在可接受範圍內，但仍建議保留彈性。';
    return s.jsxs('div', {
      style: {
        border: '1px solid #eee',
        borderRadius: 12,
        padding: 12,
        background: '#fff',
      },
      children: [
        s.jsx('div', {
          style: { fontWeight: 600, marginBottom: 8 },
          children: '預算規劃（Lite）',
        }),
        s.jsxs('div', {
          style: {
            display: 'grid',
            gridTemplateColumns: 'repeat(5,1fr)',
            gap: 8,
          },
          children: [
            s.jsxs('label', {
              children: [
                '總價(萬)',
                s.jsx('input', {
                  type: 'number',
                  value: e,
                  onChange: (y) => t(Number(y.target.value)),
                  style: {
                    width: '100%',
                    padding: 6,
                    borderRadius: 8,
                    border: '1px solid #ddd',
                  },
                }),
              ],
            }),
            s.jsxs('label', {
              children: [
                '頭期(%)',
                s.jsx('input', {
                  type: 'number',
                  value: r,
                  onChange: (y) => n(Number(y.target.value)),
                  style: {
                    width: '100%',
                    padding: 6,
                    borderRadius: 8,
                    border: '1px solid #ddd',
                  },
                }),
              ],
            }),
            s.jsxs('label', {
              children: [
                '利率(%)',
                s.jsx('input', {
                  type: 'number',
                  value: a,
                  onChange: (y) => i(Number(y.target.value)),
                  style: {
                    width: '100%',
                    padding: 6,
                    borderRadius: 8,
                    border: '1px solid #ddd',
                  },
                }),
              ],
            }),
            s.jsxs('label', {
              children: [
                '年限',
                s.jsx('input', {
                  type: 'number',
                  value: o,
                  onChange: (y) => l(Number(y.target.value)),
                  style: {
                    width: '100%',
                    padding: 6,
                    borderRadius: 8,
                    border: '1px solid #ddd',
                  },
                }),
              ],
            }),
            s.jsxs('label', {
              children: [
                '月收入(可選)',
                s.jsx('input', {
                  type: 'number',
                  value: typeof c == 'number' ? c : '',
                  onChange: (y) => {
                    const p = Number(y.target.value);
                    d(Number.isFinite(p) ? p : '');
                  },
                  style: {
                    width: '100%',
                    padding: 6,
                    borderRadius: 8,
                    border: '1px solid #ddd',
                  },
                }),
              ],
            }),
          ],
        }),
        s.jsxs('div', {
          style: { marginTop: 10, fontSize: 14, color: '#0a2246' },
          children: [
            '概算（僅供參考）：月付約 ',
            s.jsx('b', { children: u.toLocaleString() }),
            ' 元；貸款本金約 ',
            s.jsx('b', { children: m.toFixed(0) }),
            ' 萬。',
            f !== null &&
              s.jsxs(s.Fragment, {
                children: [
                  '　｜　月負擔率約 ',
                  s.jsxs('b', { children: [f, '%'] }),
                  '（含管理費）',
                ],
              }),
          ],
        }),
        s.jsx('div', {
          style: { marginTop: 8, color: '#6b7280' },
          children: b,
        }),
        s.jsx('button', {
          onClick: g,
          style: {
            marginTop: 8,
            padding: '6px 10px',
            borderRadius: 8,
            border: '1px solid #1749D7',
            background: '#fff',
            color: '#1749D7',
          },
          children: '複製概算模板',
        }),
      ],
    });
  },
  A1 = ({ onAdopt: e }) => {
    const [t, r] = h.useState(''),
      [n, a] = h.useState('agent'),
      [i, o] = h.useState('detail'),
      [l, c] = h.useState(null),
      [d, m] = h.useState(null),
      [u, x] = h.useState(!1),
      [f, g] = h.useState(!1),
      b = async () => {
        const p = t.trim();
        if (p) {
          x(!0);
          try {
            const S = (await Xh(p, { audience: n, intent: i }))
                .split(/\n+/)
                .map((T) => T.trim())
                .filter(Boolean),
              N = S.find((T) => /^V1/.test(T)) || '',
              k = S.find((T) => /^V2/.test(T)) || '';
            (c(N.replace(/^V1[:：]\s?/, '')),
              m(k.replace(/^V2[:：]\s?/, '')),
              rt(nt.RewriteGen, { audience: n, intent: i }));
          } finally {
            x(!1);
          }
        }
      },
      y = (p) => {
        (e == null || e(p),
          g(!0),
          rt(nt.RewriteAdopt, { audience: n, intent: i }),
          setTimeout(() => g(!1), 2500));
      };
    return s.jsxs('div', {
      style: {
        border: '1px solid #eee',
        borderRadius: 12,
        padding: 12,
        background: '#fff',
      },
      children: [
        s.jsx('div', {
          style: { fontWeight: 600, marginBottom: 6 },
          children: '禮貌改寫小幫手',
        }),
        s.jsxs('div', {
          style: { display: 'flex', gap: 8, flexWrap: 'wrap', marginBottom: 8 },
          children: [
            s.jsxs('label', {
              children: [
                '對象',
                s.jsxs('select', {
                  value: n,
                  onChange: (p) => a(p.target.value),
                  style: {
                    marginLeft: 6,
                    padding: 6,
                    borderRadius: 8,
                    border: '1px solid #ddd',
                  },
                  children: [
                    s.jsx('option', { value: 'agent', children: '仲介' }),
                    s.jsx('option', { value: 'owner', children: '屋主' }),
                  ],
                }),
              ],
            }),
            s.jsxs('label', {
              children: [
                '目的',
                s.jsxs('select', {
                  value: i,
                  onChange: (p) => o(p.target.value),
                  style: {
                    marginLeft: 6,
                    padding: 6,
                    borderRadius: 8,
                    border: '1px solid #ddd',
                  },
                  children: [
                    s.jsx('option', { value: 'detail', children: '詢問細節' }),
                    s.jsx('option', { value: 'view', children: '預約看房' }),
                    s.jsx('option', { value: 'pet', children: '可否養寵物' }),
                    s.jsx('option', { value: 'price', children: '價格/議價' }),
                  ],
                }),
              ],
            }),
          ],
        }),
        s.jsx('textarea', {
          rows: 3,
          placeholder: '貼上你想發的訊息（我會根據對象/目的幫你潤飾）',
          value: t,
          onChange: (p) => r(p.target.value),
          style: {
            width: '100%',
            padding: 8,
            borderRadius: 8,
            border: '1px solid #ddd',
          },
        }),
        s.jsx('div', {
          style: { display: 'flex', gap: 8, marginTop: 8 },
          children: s.jsx('button', {
            onClick: b,
            disabled: u,
            style: {
              padding: '8px 12px',
              borderRadius: 8,
              background: '#1749D7',
              color: '#fff',
              border: '1px solid #1749D7',
            },
            children: u ? '生成中…' : '禮貌改寫',
          }),
        }),
        (l || d) &&
          s.jsxs('div', {
            style: { marginTop: 10, display: 'grid', gap: 8 },
            children: [
              l &&
                s.jsxs('div', {
                  style: {
                    border: '1px solid #E6ECFF',
                    borderRadius: 8,
                    padding: 8,
                  },
                  children: [
                    s.jsx('div', {
                      style: {
                        fontSize: 12,
                        color: '#6b7280',
                        marginBottom: 4,
                      },
                      children: '版本一',
                    }),
                    s.jsx('div', { style: { marginBottom: 6 }, children: l }),
                    s.jsx('button', {
                      onClick: () => y(l),
                      style: {
                        padding: '6px 10px',
                        borderRadius: 8,
                        border: '1px solid #1749D7',
                        background: '#fff',
                        color: '#1749D7',
                      },
                      children: '採用（複製/送出）',
                    }),
                  ],
                }),
              d &&
                s.jsxs('div', {
                  style: {
                    border: '1px solid #E6ECFF',
                    borderRadius: 8,
                    padding: 8,
                  },
                  children: [
                    s.jsx('div', {
                      style: {
                        fontSize: 12,
                        color: '#6b7280',
                        marginBottom: 4,
                      },
                      children: '版本二',
                    }),
                    s.jsx('div', { style: { marginBottom: 6 }, children: d }),
                    s.jsx('button', {
                      onClick: () => y(d),
                      style: {
                        padding: '6px 10px',
                        borderRadius: 8,
                        border: '1px solid #1749D7',
                        background: '#fff',
                        color: '#1749D7',
                      },
                      children: '採用（複製/送出）',
                    }),
                  ],
                }),
              f &&
                s.jsx('div', {
                  style: { color: '#16a34a' },
                  children: '已準備好訊息，祝溝通順利 🤞',
                }),
            ],
          }),
      ],
    });
  },
  bd = 'mai-notes-v1';
function L1() {
  try {
    const e = localStorage.getItem(bd);
    return e ? JSON.parse(e) : [];
  } catch {
    return [];
  }
}
function O1(e) {
  localStorage.setItem(bd, JSON.stringify(e));
}
function Ia(e, t) {
  const r = L1(),
    n = {
      id: Math.random().toString(36).slice(2),
      createdAt: Date.now(),
      note: e,
      ...(t && { echo: t }),
    };
  return (r.unshift(n), O1(r), n);
}
const R1 = () => {
  const [e, t] = h.useState(''),
    [r, n] = h.useState(null),
    [a, i] = h.useState(!1),
    [o, l] = h.useState(!1),
    c = async () => {
      const d = e.trim();
      if (d) {
        i(!0);
        try {
          const m = await ef(d);
          (n(m), Ia(d, m), rt(nt.NoteSaved, {}));
        } catch {
          Ia(d);
        } finally {
          i(!1);
        }
      }
    };
  return s.jsxs('div', {
    style: {
      border: '1px solid #eee',
      borderRadius: 12,
      padding: 12,
      background: '#fff',
    },
    children: [
      s.jsx('div', {
        style: { fontWeight: 600, marginBottom: 6 },
        children: '收藏備註（感受）',
      }),
      s.jsx('textarea', {
        rows: 3,
        placeholder: '寫下這間帶給你的感覺…',
        value: e,
        onChange: (d) => t(d.target.value),
        onFocus: () => l(!0),
        onBlur: () => l(!1),
        style: {
          width: '100%',
          padding: 8,
          borderRadius: 8,
          border: '1px solid #ddd',
        },
      }),
      o &&
        s.jsx('div', {
          style: { fontSize: 12, color: '#6b7280', marginTop: 4 },
          children: '慢慢寫，我在。',
        }),
      s.jsxs('div', {
        style: { display: 'flex', gap: 8, marginTop: 8 },
        children: [
          s.jsx('button', {
            onClick: c,
            disabled: a,
            style: {
              padding: '8px 12px',
              borderRadius: 8,
              background: '#1749D7',
              color: '#fff',
              border: '1px solid #1749D7',
            },
            children: a ? '生成中…' : '存入便條（含回聲）',
          }),
          r &&
            s.jsxs('span', {
              style: { color: '#6b7280' },
              children: ['AI 回聲：', r],
            }),
        ],
      }),
    ],
  });
};
function M1(e) {
  const t = e
    .split(
      `
`
    )
    .find((n) => n.trim().startsWith('#tags'));
  return t
    ? t
        .replace(/^#tags\s*[:：]\s*/i, '')
        .split(',')
        .map((n) => n.trim())
        .filter(Boolean)
        .slice(0, 5)
    : [];
}
const P1 = () => {
    const [e, t] = h.useState(''),
      [r, n] = h.useState(''),
      [a, i] = h.useState(''),
      [o, l] = h.useState(null),
      [c, d] = h.useState(!1),
      m = async () => {
        d(!0);
        try {
          const x = await sf(e, r, a);
          l(x);
          const f = M1(x);
          (f.length && Um(f), rt(nt.DebriefGen, { tags: f }));
        } finally {
          d(!1);
        }
      },
      u = () => {
        const x = `【看屋小結】
喜歡：${e}
困擾：${r}
下一步：${a}
---
${o ?? ''}`;
        (Ia(x), rt(nt.DebriefSave, {}));
      };
    return s.jsxs('div', {
      style: {
        border: '1px solid #eee',
        borderRadius: 12,
        padding: 12,
        background: '#fff',
      },
      children: [
        s.jsx('div', {
          style: { fontWeight: 600, marginBottom: 6 },
          children: '看屋後三問（Mini Debrief）',
        }),
        s.jsxs('div', {
          style: { display: 'grid', gap: 8 },
          children: [
            s.jsx('input', {
              value: e,
              onChange: (x) => t(x.target.value),
              placeholder: '第一直覺如何？（例：採光很好）',
              style: { padding: 8, borderRadius: 8, border: '1px solid #ddd' },
            }),
            s.jsx('input', {
              value: r,
              onChange: (x) => n(x.target.value),
              placeholder: '哪裡卡卡的？（例：廚房太小）',
              style: { padding: 8, borderRadius: 8, border: '1px solid #ddd' },
            }),
            s.jsx('input', {
              value: a,
              onChange: (x) => i(x.target.value),
              placeholder: '下一步想做什麼？（例：再看一間對比）',
              style: { padding: 8, borderRadius: 8, border: '1px solid #ddd' },
            }),
          ],
        }),
        s.jsxs('div', {
          style: { display: 'flex', gap: 8, marginTop: 8 },
          children: [
            s.jsx('button', {
              onClick: m,
              disabled: c,
              style: {
                padding: '8px 12px',
                borderRadius: 8,
                background: '#1749D7',
                color: '#fff',
                border: '1px solid #1749D7',
              },
              children: c ? '整理中…' : '生成 Must/Nice/Avoid + #tags',
            }),
            o &&
              s.jsx('button', {
                onClick: u,
                style: {
                  padding: '8px 12px',
                  borderRadius: 8,
                  border: '1px solid #1749D7',
                  background: '#fff',
                  color: '#1749D7',
                },
                children: '存到便條',
              }),
          ],
        }),
        o &&
          s.jsx('div', {
            style: { marginTop: 10, whiteSpace: 'pre-wrap', color: '#0a2246' },
            children: o,
          }),
      ],
    });
  },
  z1 = ['持分', '使用分區', '公設比', '地上權', '都更', '容積率'],
  Yo = ({ text: e }) => {
    const [t, r] = h.useState(!1),
      [n, a] = h.useState(''),
      [i, o] = h.useState(!1),
      l = async () => {
        if (!n) {
          o(!0);
          try {
            const d = await tf(e);
            (a(d), rt(nt.ELI5Open, { term: e }));
          } finally {
            o(!1);
          }
        }
      };
    h.useEffect(() => {
      const m = `mai-eli5-suggest-${new Date().toISOString().slice(0, 10)}`;
      z1.some((x) => e.includes(x)) &&
        !localStorage.getItem(m) &&
        (localStorage.setItem(m, '1'), r(!0), l());
    }, []);
    const c = async () => {
      const d = !t;
      (r(d), d && (await l()));
    };
    return s.jsxs('span', {
      style: {
        display: 'inline-flex',
        alignItems: 'center',
        position: 'relative',
      },
      children: [
        s.jsx('button', {
          'aria-label': '白話解釋',
          onClick: c,
          style: {
            marginLeft: 6,
            width: 18,
            height: 18,
            borderRadius: 999,
            border: '1px solid #C9D5FF',
            background: '#F5F8FF',
            color: '#1749D7',
            fontSize: 12,
            cursor: 'pointer',
          },
          children: '?',
        }),
        t &&
          s.jsxs('div', {
            style: {
              position: 'absolute',
              top: '120%',
              left: 0,
              background: '#fff',
              border: '1px solid #E6ECFF',
              borderRadius: 8,
              padding: 10,
              width: 280,
              boxShadow: '0 10px 24px rgba(0,0,0,0.08)',
              zIndex: 50,
            },
            children: [
              s.jsx('div', {
                style: { fontSize: 12, color: '#6b7280', marginBottom: 6 },
                children: '白話解釋（僅供參考，非法律意見）',
              }),
              s.jsx('div', {
                style: { whiteSpace: 'pre-wrap' },
                children: i ? '生成中…' : n,
              }),
            ],
          }),
      ],
    });
  };
function D1() {
  return s.jsxs('section', {
    className:
      'mx-auto mt-8 max-w-container space-y-6 rounded-[var(--r-lg)] bg-white p-6 shadow-[var(--shadow-card)]',
    children: [
      s.jsx('h1', { className: 'text-xl font-semibold', children: '物件詳情' }),
      s.jsx('p', {
        className: 'mt-2 text-sm text-[var(--text-secondary)]',
        children: '示意頁。',
      }),
      s.jsxs('div', {
        className: 'rounded-lg border border-gray-200 bg-gray-50 p-4',
        children: [
          s.jsx('h2', {
            className: 'mb-3 text-lg font-medium',
            children: '房貸負擔試算',
          }),
          s.jsx(C1, {}),
        ],
      }),
      s.jsxs('div', {
        className: 'rounded-lg border border-gray-200 bg-gray-50 p-4',
        children: [
          s.jsx('h2', {
            className: 'mb-3 text-lg font-medium',
            children: '禮貌改寫訊息',
          }),
          s.jsx(A1, {}),
        ],
      }),
      s.jsxs('div', {
        className: 'rounded-lg border border-gray-200 bg-gray-50 p-4',
        children: [
          s.jsx('h2', {
            className: 'mb-3 text-lg font-medium',
            children: '看房筆記',
          }),
          s.jsx(R1, {}),
        ],
      }),
      s.jsxs('div', {
        className: 'rounded-lg border border-gray-200 bg-gray-50 p-4',
        children: [
          s.jsx('h2', {
            className: 'mb-3 text-lg font-medium',
            children: '看房心得',
          }),
          s.jsx(P1, {}),
        ],
      }),
      s.jsxs('div', {
        className: 'rounded-lg border border-gray-200 bg-gray-50 p-4',
        children: [
          s.jsx('h2', {
            className: 'mb-3 text-lg font-medium',
            children: '專有名詞解釋',
          }),
          s.jsxs('p', {
            className: 'text-sm text-gray-600',
            children: [
              '這個物件的',
              s.jsx(Yo, { text: '容積率' }),
              ' 和',
              s.jsx(Yo, { text: '建蔽率' }),
              ' 都符合法規標準。',
            ],
          }),
        ],
      }),
    ],
  });
}
const F1 = { 5: 30 * 1e3 },
  Ca = (e) => ({
    id: e,
    currentStep: 1,
    isPaid: !1,
    steps: {
      1: {
        name: '已電聯',
        agentStatus: 'pending',
        buyerStatus: 'pending',
        data: {},
        locked: !1,
      },
      2: {
        name: '已帶看',
        agentStatus: 'pending',
        buyerStatus: 'pending',
        locked: !1,
        data: { risks: { water: !1, wall: !1, structure: !1, other: !1 } },
      },
      3: {
        name: '已出價',
        agentStatus: 'pending',
        buyerStatus: 'pending',
        data: {},
        locked: !1,
      },
      4: {
        name: '已斡旋',
        agentStatus: 'pending',
        buyerStatus: 'pending',
        data: {},
        locked: !1,
      },
      5: {
        name: '已成交',
        agentStatus: 'pending',
        buyerStatus: 'pending',
        locked: !1,
        paymentStatus: 'pending',
        paymentDeadline: null,
        data: {},
      },
      6: {
        name: '已交屋',
        agentStatus: 'pending',
        buyerStatus: 'pending',
        locked: !1,
        checklist: [],
        data: {},
      },
    },
    supplements: [],
  }),
  qo = (e) => {
    if (typeof window > 'u') return Ca(e);
    const t = sessionStorage.getItem(`mock_tx_${e}`);
    return t ? JSON.parse(t) : Ca(e);
  },
  Ko = (e) => {
    typeof window < 'u' && sessionStorage.setItem(`mock_tx_${e.id}`, JSON.stringify(e));
  },
  Yr = {
    fetchData: async (e) => qo(e),
    dispatch: async (e, t, r, n) => {
      var l, c, d;
      await new Promise((m) => setTimeout(m, 600));
      const a = qo(t),
        i = JSON.parse(JSON.stringify(a)),
        o = parseInt(n.step || i.currentStep);
      try {
        switch (e) {
          case 'submit':
            if (r !== 'agent') throw new Error('權限不足');
            i.steps[o] &&
              ((i.steps[o].data = { ...i.steps[o].data, ...n.data }),
              (i.steps[o].agentStatus = 'submitted'));
            break;
          case 'confirm':
            if (r !== 'buyer') throw new Error('權限不足');
            if (
              (i.steps[o] &&
                ((i.steps[o].buyerStatus = 'confirmed'),
                n.note &&
                  (i.steps[o].data = {
                    ...i.steps[o].data,
                    buyerNote: n.note,
                  })),
              o === 5)
            )
              i.steps[5] &&
                ((i.steps[5].paymentStatus = 'initiated'),
                (i.steps[5].paymentDeadline = Date.now() + (F1[5] || 3e4)));
            else if (o === 6) {
              if (
                !((c = (l = i.steps[6]) == null ? void 0 : l.checklist) == null
                  ? void 0
                  : c.every((f) => f.checked))
              )
                throw new Error('檢查項目未完成');
              i.steps[6] && (i.steps[6].locked = !0);
            } else (i.steps[o] && (i.steps[o].locked = !0), (i.currentStep += 1));
            break;
          case 'payment':
            if (r !== 'agent') throw new Error('權限不足');
            if (((d = i.steps[5]) == null ? void 0 : d.paymentStatus) !== 'initiated')
              throw new Error('非付款狀態');
            ((i.isPaid = !0),
              i.steps[5] && ((i.steps[5].paymentStatus = 'completed'), (i.steps[5].locked = !0)),
              (i.currentStep = 6),
              i.steps[6] &&
                (i.steps[6].checklist = [
                  {
                    id: 'utilities',
                    label: '🚰 水電瓦斯功能正常',
                    checked: !1,
                  },
                  { id: 'security', label: '🪟 門窗鎖具開關正常', checked: !1 },
                  { id: 'keys', label: '🔑 鑰匙門禁卡點交', checked: !1 },
                  {
                    id: 'condition',
                    label: '🧱 房屋現況確認 (漏水/壁癌等)',
                    checked: !1,
                  },
                ]));
            break;
          case 'checklist':
            const m = i.steps[6];
            if (m && m.checklist) {
              const x = m.checklist.find((f) => f.id === n.itemId);
              x && (x.checked = n.checked);
            }
            break;
          case 'supplement':
            i.supplements.push({
              role: r,
              content: n.content,
              timestamp: Date.now(),
            });
            break;
          case 'reset':
            const u = Ca(t);
            return (Ko(u), { success: !0, tx: u });
        }
        return (Ko(i), { success: !0, tx: i });
      } catch (m) {
        return { success: !1, error: m.message };
      }
    },
  },
  Yn = {
    fetchData: async (e, t) => {
      try {
        const r = await fetch(`/api/trust/status?id=${e}`);
        if (r.ok) return await r.json();
        if (r.status === 401 || r.status === 403) throw new Error('UNAUTHORIZED');
        return null;
      } catch (r) {
        if (r.message === 'UNAUTHORIZED') throw r;
        return (console.error(r), null);
      }
    },
    dispatch: async (e, t, r, n) => {
      try {
        const a = await fetch(`/api/trust/${e}?id=${t}`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(n),
        });
        if (a.status === 401 || a.status === 403) return { success: !1, error: 'UNAUTHORIZED' };
        const i = await a.json();
        return i.error ? { success: !1, error: i.error } : { success: !0, tx: i.state || i };
      } catch (a) {
        return { success: !1, error: a.message };
      }
    },
  };
function $1() {
  const [e, t] = h.useState(!1),
    [r, n] = h.useState(''),
    [a, i] = h.useState('agent'),
    [o, l] = h.useState(null),
    [c, d] = h.useState(!0),
    [m, u] = h.useState(!1),
    [x, f] = h.useState('--:--:--'),
    [g, b] = h.useState(!1);
  h.useEffect(() => {
    if (typeof window > 'u') return;
    (async () => {
      const N = window.location.hash;
      if (N.includes('token=')) {
        const k = N.split('token=')[1];
        window.history.replaceState(null, '', window.location.pathname);
        try {
          await fetch('/api/trust/session', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ token: k }),
          });
        } catch (T) {
          (console.error('Session exchange failed', T), W.error('無效的連結或憑證'));
        }
      }
      try {
        const k = await fetch('/api/trust/me');
        if (k.ok) {
          const T = await k.json();
          (i(T.role), n(T.caseId), t(!1), b(!1), await p(T.caseId));
        } else d(!1);
      } catch (k) {
        (console.error(k), d(!1));
      }
    })();
  }, []);
  const y = h.useCallback(async () => {
      (t(!0), b(!1));
      const S = 'MOCK-DEMO-01';
      (n(S), i('agent'));
      const N = await Yr.fetchData(S);
      (l(N), W.success('已進入演示模式 (資料僅暫存於瀏覽器)'));
    }, []),
    p = h.useCallback(
      async (S) => {
        const N = S || r;
        if (N && !(g && !e)) {
          d(!0);
          try {
            let k;
            (e ? (k = await Yr.fetchData(N)) : (k = await Yn.fetchData(N, '')), k && (l(k), b(!1)));
          } catch (k) {
            (console.error(k),
              k.message === 'UNAUTHORIZED' && (b(!0), W.error('連線逾時，請重新登入')));
          } finally {
            d(!1);
          }
        }
      },
      [e, r, g]
    );
  (h.useEffect(() => {
    if (!e && r && !g) {
      const S = setInterval(() => p(), 5e3);
      return () => clearInterval(S);
    }
  }, [r, e, p, g]),
    h.useEffect(() => {
      const S = setInterval(() => {
        var N, k;
        if (
          ((k = (N = o == null ? void 0 : o.steps) == null ? void 0 : N[5]) == null
            ? void 0
            : k.paymentStatus) === 'initiated' &&
          o.steps[5].paymentDeadline
        ) {
          const T = o.steps[5].paymentDeadline - Date.now();
          if (T <= 0) (f('已逾期'), e || p());
          else {
            const C = Math.floor(T / 36e5),
              w = Math.floor((T % 36e5) / 6e4),
              G = Math.floor((T % 6e4) / 1e3);
            f(`${C}:${w.toString().padStart(2, '0')}:${G.toString().padStart(2, '0')}`);
          }
        }
      }, 1e3);
      return () => clearInterval(S);
    }, [o, e, p]));
  const E = h.useCallback(
    async (S, N = {}) => {
      if (!m) {
        u(!0);
        try {
          const k = e ? Yr : Yn;
          let T;
          return (
            e ? (T = await Yr.dispatch(S, r, a, N)) : (T = await Yn.dispatch(S, r, '', N)),
            T.success
              ? (T.tx && l(T.tx), await p(), W.success('成功'), !0)
              : (T.error === 'UNAUTHORIZED'
                  ? (b(!0), W.error('連線逾時，請重新登入'))
                  : W.error(T.error || '操作失敗'),
                !1)
          );
        } catch (k) {
          return (console.error(k), W.error('發生未預期的錯誤'), !1);
        } finally {
          u(!1);
        }
      }
    },
    [e, r, a, p, m]
  );
  return {
    isMock: e,
    caseId: r,
    setCaseId: n,
    role: a,
    setRole: i,
    setToken: () => {},
    token: '',
    tx: o,
    setTx: l,
    loading: c,
    isBusy: m,
    timeLeft: x,
    startMockMode: y,
    dispatchAction: E,
    fetchData: p,
  };
}
function Qo() {
  gl();
  const {
      isMock: e,
      caseId: t,
      role: r,
      setRole: n,
      tx: a,
      loading: i,
      isBusy: o,
      timeLeft: l,
      startMockMode: c,
      dispatchAction: d,
    } = $1(),
    [m, u] = h.useState(''),
    [x, f] = h.useState('');
  typeof window < 'u' &&
    (window.location.hostname === 'localhost' || window.location.hostname.includes('127.0.0.1'));
  const g = async (C, w = {}) => {
      (await d(C, w)) && (u(''), f(''));
    },
    b = (C) => g('submit', { step: C, data: { note: m } }),
    y = (C) => g('confirm', { step: C, note: m }),
    p = () => {
      confirm('確認模擬付款？') && g('payment');
    },
    E = (C, w) => {
      r === 'buyer' && g('checklist', { itemId: C, checked: w });
    },
    S = () => g('supplement', { content: x }),
    N = () => {
      confirm('重置所有進度？') && g('reset');
    },
    k = () => {
      n(r === 'agent' ? 'buyer' : 'agent');
    };
  if (!a && !i)
    return s.jsx('div', {
      className:
        'flex min-h-screen flex-col items-center justify-center bg-slate-100 p-4 font-sans',
      children: s.jsxs('div', {
        className: 'w-full max-w-sm rounded-2xl bg-white p-8 text-center shadow-xl',
        children: [
          s.jsx('div', {
            className:
              'mx-auto mb-4 flex size-16 items-center justify-center rounded-full bg-blue-100 text-blue-600',
            children: s.jsx(Jn, { size: 32 }),
          }),
          s.jsx('h2', {
            className: 'mb-2 text-xl font-bold text-gray-800',
            children: '安心留痕 Trust Room',
          }),
          s.jsx('p', {
            className: 'mb-6 text-sm text-gray-500',
            children: '目前未檢測到有效的登入憑證 (Token)。您可以進入演示模式來測試功能。',
          }),
          s.jsxs('button', {
            onClick: c,
            className:
              'flex w-full items-center justify-center gap-2 rounded-xl bg-blue-600 py-3 font-bold text-white shadow-lg transition hover:bg-blue-700',
            children: [s.jsx(Jn, { size: 18 }), '啟動演示模式 (Demo Mode)'],
          }),
          s.jsx('p', {
            className: 'mt-4 text-xs text-gray-400',
            children: '此模式下資料不會保存到資料庫。',
          }),
        ],
      }),
    });
  if (!a)
    return s.jsx('div', {
      className: 'p-8 text-center',
      children: '載入中...',
    });
  const T = (C) => {
    switch (C) {
      case '1':
        return s.jsx(ns, { size: 14 });
      case '2':
        return s.jsx(su, { size: 14 });
      case '3':
        return s.jsx(bl, { size: 14 });
      case '4':
        return s.jsx(vl, { size: 14 });
      case '5':
        return s.jsx(tu, { size: 14 });
      case '6':
        return s.jsx(Qe, { size: 14 });
      default:
        return s.jsx(eu, { size: 14 });
    }
  };
  return s.jsxs('div', {
    className:
      'relative mx-auto min-h-screen max-w-md bg-white pb-24 font-sans text-gray-800 shadow-2xl',
    children: [
      s.jsxs('header', {
        className: `${e ? 'bg-indigo-900' : 'bg-slate-900'} sticky top-0 z-overlay flex items-center justify-between p-4 text-white shadow-lg transition-colors`,
        children: [
          s.jsxs('div', {
            children: [
              s.jsxs('h1', {
                className: 'flex items-center gap-2 text-lg font-bold tracking-wide',
                children: [
                  'MaiHouses ',
                  s.jsx('span', {
                    className: `rounded px-1 text-xs ${e ? 'bg-yellow-500 text-black' : 'bg-blue-600'}`,
                    children: e ? 'DEMO' : 'V10',
                  }),
                ],
              }),
              s.jsxs('div', {
                className: 'flex items-center gap-2 text-[10px] text-gray-400',
                children: [
                  s.jsxs('span', { children: ['案號: ', t] }),
                  i &&
                    s.jsx('span', {
                      className: 'animate-pulse',
                      children: '●',
                    }),
                ],
              }),
            ],
          }),
          s.jsxs('div', {
            className: 'flex gap-2',
            children: [
              s.jsx('button', {
                onClick: N,
                className:
                  'flex size-8 items-center justify-center rounded bg-white/10 transition hover:bg-white/20',
                children: s.jsx(Jd, { size: 14 }),
              }),
              s.jsxs('button', {
                onClick: k,
                className: `flex items-center gap-1 rounded-md border border-white/20 px-3 py-1 text-xs font-bold transition ${r === 'agent' ? 'bg-blue-600' : 'bg-green-600'}`,
                children: [
                  r === 'agent' ? s.jsx(Xd, { size: 12 }) : s.jsx(Qn, { size: 12 }),
                  r === 'agent' ? '房仲' : '買方',
                ],
              }),
            ],
          }),
        ],
      }),
      s.jsxs('div', {
        className: 'sticky top-[60px] z-40 border-b bg-slate-50 p-4',
        children: [
          s.jsxs('div', {
            className: 'mb-2 flex items-center justify-between',
            children: [
              s.jsxs('span', {
                className: 'text-xs font-bold text-slate-700',
                children: ['進度 ', a.currentStep, '/6'],
              }),
              a.isPaid &&
                s.jsx('span', {
                  className:
                    'rounded-full bg-green-100 px-2 py-0.5 text-xs font-bold text-green-800',
                  children: '已履約',
                }),
            ],
          }),
          s.jsx('div', {
            className: 'h-2 w-full overflow-hidden rounded-full bg-gray-200',
            children: s.jsx('div', {
              className: 'h-2 rounded-full bg-blue-600 transition-all duration-700',
              style: { width: `${(a.currentStep / 6) * 100}%` },
            }),
          }),
        ],
      }),
      s.jsxs('div', {
        className: 'space-y-0 p-4',
        children: [
          Object.entries(a.steps).map(([C, w]) => {
            var se;
            const G = parseInt(C),
              j = G === a.currentStep,
              _ = G < a.currentStep,
              D = G > a.currentStep;
            let V = 'bg-gray-300 border-gray-300';
            return (
              _ || w.locked
                ? (V = 'bg-green-500 border-green-500')
                : j && (V = 'bg-blue-600 border-blue-600'),
              s.jsxs(
                'div',
                {
                  className: `relative py-3 pl-14 ${D ? 'opacity-50 grayscale' : ''}`,
                  children: [
                    s.jsx('div', {
                      className: `absolute left-0 top-3 z-10 flex size-10 items-center justify-center rounded-full border-4 border-white text-white shadow-sm transition-colors ${V}`,
                      children: T(C),
                    }),
                    C !== '6' &&
                      s.jsx('div', {
                        className:
                          'absolute bottom-[-20px] left-[24px] top-[50px] z-0 w-[2px] bg-gray-200',
                      }),
                    s.jsxs('div', {
                      className: `rounded-xl border bg-white p-4 shadow-sm transition-all ${j ? 'border-blue-500 ring-2 ring-blue-50' : 'border-gray-200'}`,
                      children: [
                        s.jsxs('div', {
                          className: 'mb-3 flex items-start justify-between',
                          children: [
                            s.jsxs('h3', {
                              className: 'flex items-center gap-2 font-bold text-gray-800',
                              children: [
                                w.name,
                                C === '5' &&
                                  w.paymentStatus === 'initiated' &&
                                  !w.locked &&
                                  s.jsx('span', {
                                    className:
                                      'animate-pulse rounded bg-orange-50 px-2 text-[10px] text-orange-500',
                                    children: '付款中',
                                  }),
                                C === '5' &&
                                  w.paymentStatus === 'expired' &&
                                  s.jsx('span', {
                                    className: 'rounded bg-red-50 px-2 text-[10px] text-red-500',
                                    children: '逾期',
                                  }),
                              ],
                            }),
                            w.locked &&
                              s.jsx(Ra, {
                                size: 14,
                                className: 'text-green-600',
                              }),
                          ],
                        }),
                        C === '2' &&
                          w.data.note &&
                          s.jsxs('div', {
                            className: 'mb-3 rounded border border-gray-100 bg-gray-50 p-3',
                            children: [
                              s.jsx('p', {
                                className: 'mb-2 border-b pb-1 text-xs font-bold text-gray-500',
                                children: '📢 房仲帶看紀錄',
                              }),
                              s.jsx('div', {
                                className: 'whitespace-pre-wrap text-sm',
                                children: w.data.note,
                              }),
                            ],
                          }),
                        C === '5' &&
                          w.paymentStatus === 'initiated' &&
                          !w.locked &&
                          s.jsxs('div', {
                            className:
                              'mb-4 rounded-lg border border-orange-200 bg-orange-50 p-4 text-center',
                            children: [
                              s.jsx('div', {
                                className: 'mb-1 font-mono text-2xl font-bold text-orange-600',
                                children: l,
                              }),
                              s.jsx('div', {
                                className: 'mb-3 text-xs text-orange-400',
                                children: '付款截止',
                              }),
                              r === 'agent'
                                ? s.jsx('button', {
                                    onClick: p,
                                    disabled: o || l === '已逾期',
                                    className: `w-full rounded py-2 font-bold text-white shadow ${l === '已逾期' ? 'cursor-not-allowed bg-gray-400' : 'bg-gradient-to-r from-orange-500 to-red-500 hover:shadow-lg'}`,
                                    children:
                                      l === '已逾期'
                                        ? '付款已截止'
                                        : o
                                          ? '處理中...'
                                          : '房仲代付 NT$ 2,000',
                                  })
                                : s.jsx('div', {
                                    className: 'text-xs text-gray-400',
                                    children: '等待房仲付款...',
                                  }),
                            ],
                          }),
                        C === '6' &&
                          !w.locked &&
                          a.isPaid &&
                          s.jsxs('div', {
                            className: 'mt-2 space-y-2',
                            children: [
                              (se = w.checklist) == null
                                ? void 0
                                : se.map((I) =>
                                    s.jsxs(
                                      'div',
                                      {
                                        onClick: () => E(I.id, !I.checked),
                                        className: `flex cursor-pointer items-center rounded border p-4 transition ${I.checked ? 'border-indigo-200 bg-indigo-50' : 'hover:bg-gray-50'}`,
                                        children: [
                                          s.jsx('div', {
                                            className: `flex size-5 items-center justify-center rounded border bg-white ${I.checked ? 'border-indigo-600 bg-indigo-600' : ''}`,
                                            children:
                                              I.checked &&
                                              s.jsx(wt, {
                                                size: 12,
                                                className: 'text-white',
                                              }),
                                          }),
                                          s.jsx('span', {
                                            className: `ml-3 text-sm ${I.checked ? 'font-bold text-indigo-800' : ''}`,
                                            children: I.label,
                                          }),
                                        ],
                                      },
                                      I.id
                                    )
                                  ),
                              s.jsx('button', {
                                onClick: () => y('6'),
                                className:
                                  'mt-2 w-full rounded bg-indigo-600 py-2 font-bold text-white',
                                children: '完成交屋',
                              }),
                            ],
                          }),
                        !w.locked &&
                          j &&
                          C !== '5' &&
                          C !== '6' &&
                          s.jsxs('div', {
                            children: [
                              r === 'agent' &&
                                (w.agentStatus === 'pending'
                                  ? s.jsxs('div', {
                                      children: [
                                        s.jsx('textarea', {
                                          value: m,
                                          onChange: (I) => u(I.target.value),
                                          className:
                                            'mb-2 w-full rounded border p-2 text-sm outline-none ring-blue-200 focus:ring-2',
                                          placeholder: '輸入紀錄...',
                                        }),
                                        s.jsx('button', {
                                          onClick: () => b(C),
                                          disabled: o,
                                          className:
                                            'w-full rounded bg-slate-800 py-2 text-sm text-white',
                                          children: o ? '...' : '送出',
                                        }),
                                      ],
                                    })
                                  : s.jsx('div', {
                                      className:
                                        'rounded bg-gray-50 py-2 text-center text-xs text-gray-400',
                                      children: '等待買方確認...',
                                    })),
                              r === 'buyer' &&
                                (w.agentStatus === 'submitted'
                                  ? s.jsxs('div', {
                                      children: [
                                        s.jsx('p', {
                                          className: 'mb-2 text-xs text-gray-500',
                                          children: '房仲已提交，請核對：',
                                        }),
                                        s.jsx('div', {
                                          className:
                                            'mb-2 whitespace-pre-wrap rounded border bg-gray-50 p-2 text-sm',
                                          children: w.data.note || '（已提交表單）',
                                        }),
                                        s.jsx('textarea', {
                                          value: m,
                                          onChange: (I) => u(I.target.value),
                                          className:
                                            'mb-2 w-full rounded border p-2 text-sm outline-none ring-green-200 focus:ring-2',
                                          placeholder: '留言給房仲 (選填)...',
                                        }),
                                        s.jsx('button', {
                                          onClick: () => y(C),
                                          disabled: o,
                                          className:
                                            'w-full rounded bg-green-600 py-2 text-sm text-white',
                                          children: o ? '...' : '確認無誤並送出',
                                        }),
                                      ],
                                    })
                                  : s.jsx('div', {
                                      className: 'py-2 text-center text-xs text-gray-400',
                                      children: '等待房仲提交...',
                                    })),
                            ],
                          }),
                        w.data.buyerNote &&
                          s.jsxs('div', {
                            className:
                              'mt-2 rounded border border-green-100 bg-green-50 p-2 text-xs',
                            children: [
                              s.jsx('span', {
                                className: 'font-bold text-green-700',
                                children: '買方留言：',
                              }),
                              ' ',
                              w.data.buyerNote,
                            ],
                          }),
                        C === '5' &&
                          !w.locked &&
                          w.paymentStatus === 'pending' &&
                          s.jsxs('div', {
                            children: [
                              r === 'agent' &&
                                w.agentStatus === 'pending' &&
                                s.jsx('button', {
                                  onClick: () => b('5'),
                                  className: 'w-full rounded bg-slate-800 py-2 text-white',
                                  children: '上傳合約並送出',
                                }),
                              r === 'buyer' &&
                                w.agentStatus === 'submitted' &&
                                s.jsx('button', {
                                  onClick: () => y('5'),
                                  className: 'w-full rounded bg-green-600 py-2 text-white',
                                  children: '確認合約 (將啟動付款)',
                                }),
                            ],
                          }),
                        a.supplements.length > 0 &&
                          s.jsx('div', {
                            className: 'mt-4 border-t border-dashed pt-4',
                            children: a.supplements.map((I, A) =>
                              s.jsxs(
                                'div',
                                {
                                  className:
                                    'mb-1 flex gap-2 rounded border border-gray-100 bg-gray-50 p-2 text-xs',
                                  children: [
                                    s.jsx('span', {
                                      className: 'font-bold',
                                      children: I.role === 'agent' ? '👨‍💼' : '👤',
                                    }),
                                    s.jsx('span', {
                                      className: 'flex-1',
                                      children: I.content,
                                    }),
                                  ],
                                },
                                A
                              )
                            ),
                          }),
                      ],
                    }),
                  ],
                },
                C
              )
            );
          }),
          s.jsxs('div', {
            className: 'mt-8 rounded-xl border bg-white p-4 shadow-sm',
            children: [
              s.jsx('h4', {
                className: 'mb-2 text-xs font-bold text-gray-500',
                children: '📝 新增補充紀錄 (修正/勘誤)',
              }),
              s.jsx('p', {
                className: 'mb-2 text-[10px] text-gray-400',
                children: '若之前的留言有誤，請在此新增補充說明。已送出的內容無法修改。',
              }),
              s.jsxs('div', {
                className: 'flex gap-2',
                children: [
                  s.jsx('input', {
                    value: x,
                    onChange: (C) => f(C.target.value),
                    className: 'flex-1 rounded border px-3 py-2 text-sm',
                    placeholder: '輸入備註...',
                  }),
                  s.jsx('button', {
                    onClick: S,
                    disabled: !x,
                    className: 'rounded bg-gray-800 px-4 text-sm text-white',
                    children: '送出',
                  }),
                ],
              }),
            ],
          }),
        ],
      }),
    ],
  });
}
function U1() {
  return s.jsx('main', {
    className: 'mx-auto max-w-container p-4 md:p-6',
    children: s.jsx(vc, {}),
  });
}
let dt = class extends h.Component {
  constructor() {
    (super(...arguments), (this.state = { hasError: !1 }));
  }
  static getDerivedStateFromError() {
    return { hasError: !0 };
  }
  componentDidCatch(t) {
    console.error(t);
    try {
      Ga('error_boundary', '*', String(t.message || t));
    } catch {}
  }
  render() {
    return this.state.hasError
      ? s.jsx('div', {
          className:
            'rounded-[var(--r-lg)] bg-white p-4 text-[var(--danger)] shadow-[var(--shadow-card)]',
          children: '區塊錯誤，請重試。',
        })
      : this.props.children;
  }
};
const B1 = h.createContext(null),
  G1 = ({ children: e }) => {
    const [t, r] = h.useState(() => localStorage.getItem('mai-mood-v1') || 'neutral'),
      n = h.useCallback((i) => {
        (r(i), localStorage.setItem('mai-mood-v1', i), Bm(i), rt(nt.MoodPick, { mood: i }));
      }, []),
      a = h.useMemo(
        () => ({
          mood: t,
          setMood: n,
          tone: t === 'stress' ? 'soothe' : t === 'rest' ? 'warm' : 'light',
          throttleLevel: t === 'stress' ? 2 : t === 'rest' ? 1 : 0,
        }),
        [t, n]
      );
    return s.jsx(B1.Provider, { value: a, children: e });
  };
function H1() {
  const [e, t] = h.useState(() =>
      typeof window > 'u' ? !1 : !localStorage.getItem('cookie-consent')
    ),
    r = () => {
      (localStorage.setItem('cookie-consent', 'true'), t(!1));
    };
  return e
    ? s.jsx('div', {
        className: 'fixed inset-x-0 bottom-0 z-overlay bg-gray-900 p-4 text-white shadow-lg md:p-6',
        children: s.jsxs('div', {
          className:
            'mx-auto flex max-w-6xl flex-col items-center justify-between gap-4 md:flex-row',
          children: [
            s.jsx('div', {
              className: 'text-sm text-gray-300',
              children:
                '我們使用 Cookie 來改善您的瀏覽體驗並提供個人化內容。繼續瀏覽即表示您同意我們的隱私權政策。',
            }),
            s.jsx('div', {
              className: 'flex gap-3',
              children: s.jsx('button', {
                onClick: r,
                className:
                  'rounded-full bg-brand px-6 py-2 text-sm font-medium text-white transition-colors hover:bg-blue-600',
                children: '我同意',
              }),
            }),
          ],
        }),
      })
    : null;
}
const W1 = h.createContext(null),
  qn = { didCatch: !1, error: null };
class V1 extends h.Component {
  constructor(t) {
    (super(t), (this.resetErrorBoundary = this.resetErrorBoundary.bind(this)), (this.state = qn));
  }
  static getDerivedStateFromError(t) {
    return { didCatch: !0, error: t };
  }
  resetErrorBoundary() {
    const { error: t } = this.state;
    if (t !== null) {
      for (var r, n, a = arguments.length, i = new Array(a), o = 0; o < a; o++) i[o] = arguments[o];
      ((r = (n = this.props).onReset) === null ||
        r === void 0 ||
        r.call(n, { args: i, reason: 'imperative-api' }),
        this.setState(qn));
    }
  }
  componentDidCatch(t, r) {
    var n, a;
    (n = (a = this.props).onError) === null || n === void 0 || n.call(a, t, r);
  }
  componentDidUpdate(t, r) {
    const { didCatch: n } = this.state,
      { resetKeys: a } = this.props;
    if (n && r.error !== null && Z1(t.resetKeys, a)) {
      var i, o;
      ((i = (o = this.props).onReset) === null ||
        i === void 0 ||
        i.call(o, { next: a, prev: t.resetKeys, reason: 'keys' }),
        this.setState(qn));
    }
  }
  render() {
    const { children: t, fallbackRender: r, FallbackComponent: n, fallback: a } = this.props,
      { didCatch: i, error: o } = this.state;
    let l = t;
    if (i) {
      const c = { error: o, resetErrorBoundary: this.resetErrorBoundary };
      if (typeof r == 'function') l = r(c);
      else if (n) l = h.createElement(n, c);
      else if (a !== void 0) l = a;
      else throw o;
    }
    return h.createElement(
      W1.Provider,
      {
        value: {
          didCatch: i,
          error: o,
          resetErrorBoundary: this.resetErrorBoundary,
        },
      },
      l
    );
  }
}
function Z1() {
  let e = arguments.length > 0 && arguments[0] !== void 0 ? arguments[0] : [],
    t = arguments.length > 1 && arguments[1] !== void 0 ? arguments[1] : [];
  return e.length !== t.length || e.some((r, n) => !Object.is(r, t[n]));
}
const Y1 = '_primary_10s9u_154',
  q1 = '_float_10s9u_1',
  K1 = '_pulse_10s9u_1',
  Q1 = '_selected_10s9u_210',
  J1 = '_urgent_10s9u_288',
  X1 = '_shimmer_10s9u_1',
  M = {
    'uag-page': '_uag-page_10s9u_26',
    'uag-header': '_uag-header_10s9u_51',
    'uag-header-inner': '_uag-header-inner_10s9u_58',
    'uag-logo': '_uag-logo_10s9u_63',
    'uag-logo-badge': '_uag-logo-badge_10s9u_64',
    'uag-container': '_uag-container_10s9u_70',
    'uag-grid': '_uag-grid_10s9u_71',
    'k-span-2': '_k-span-2_10s9u_74',
    'k-span-3': '_k-span-3_10s9u_75',
    'k-span-4': '_k-span-4_10s9u_76',
    'k-span-6': '_k-span-6_10s9u_77',
    'uag-breadcrumb': '_uag-breadcrumb_10s9u_87',
    'uag-badge--pro': '_uag-badge--pro_10s9u_101',
    'uag-card': '_uag-card_10s9u_108',
    'uag-card-header': '_uag-card-header_10s9u_122',
    'uag-card-title': '_uag-card-title_10s9u_123',
    'uag-card-sub': '_uag-card-sub_10s9u_128',
    'uag-actions': '_uag-actions_10s9u_133',
    'uag-btn': '_uag-btn_10s9u_144',
    primary: Y1,
    'uag-badge': '_uag-badge_10s9u_101',
    'uag-badge--s': '_uag-badge--s_10s9u_169',
    'uag-badge--a': '_uag-badge--a_10s9u_170',
    'uag-cluster': '_uag-cluster_10s9u_173',
    'uag-bubble': '_uag-bubble_10s9u_199',
    float: q1,
    pulse: K1,
    selected: Q1,
    'uag-bubble-grade': '_uag-bubble-grade_10s9u_222',
    'uag-bubble-label': '_uag-bubble-label_10s9u_227',
    'uag-action-panel': '_uag-action-panel_10s9u_240',
    'ap-head': '_ap-head_10s9u_247',
    'ap-body': '_ap-body_10s9u_253',
    'ap-stats-group': '_ap-stats-group_10s9u_262',
    'ai-box': '_ai-box_10s9u_263',
    'action-zone': '_action-zone_10s9u_264',
    'ap-stat': '_ap-stat_10s9u_262',
    urgent: J1,
    'btn-attack': '_btn-attack_10s9u_295',
    shimmer: X1,
    'monitor-table': '_monitor-table_10s9u_335',
    'progress-bg': '_progress-bg_10s9u_358',
    'progress-fill': '_progress-fill_10s9u_359',
    't-countdown': '_t-countdown_10s9u_360',
    'listing-item': '_listing-item_10s9u_363',
    'l-thumb': '_l-thumb_10s9u_369',
    'l-title': '_l-title_10s9u_370',
    'l-tags': '_l-tags_10s9u_371',
    'l-tag': '_l-tag_10s9u_371',
    'l-kpi': '_l-kpi_10s9u_373',
    'feed-post': '_feed-post_10s9u_382',
    'fp-title': '_fp-title_10s9u_384',
    'fp-meta': '_fp-meta_10s9u_385',
    'fp-body': '_fp-body_10s9u_386',
    'mai-card': '_mai-card_10s9u_389',
    'mai-head': '_mai-head_10s9u_403',
    'mai-tag': '_mai-tag_10s9u_408',
    'mai-title': '_mai-title_10s9u_409',
    'mai-sub': '_mai-sub_10s9u_410',
    'mai-body': '_mai-body_10s9u_411',
    'mai-left': '_mai-left_10s9u_412',
    'mai-price': '_mai-price_10s9u_413',
    'mai-price-label': '_mai-price-label_10s9u_414',
    'mai-price-value': '_mai-price-value_10s9u_415',
    'mai-price-unit': '_mai-price-unit_10s9u_416',
    'mai-stats': '_mai-stats_10s9u_417',
    'mai-right': '_mai-right_10s9u_420',
    'mai-thumb': '_mai-thumb_10s9u_421',
    'mai-mini': '_mai-mini_10s9u_422',
    'mai-actions': '_mai-actions_10s9u_424',
    'mai-btn': '_mai-btn_10s9u_425',
    'flow-stage': '_flow-stage_10s9u_445',
    'uag-footer-bar': '_uag-footer-bar_10s9u_448',
  },
  ej = Ja(['S', 'A', 'B', 'C', 'F']),
  tj = Ja(['new', 'purchased']),
  sj = Is({
    id: Ne(),
    name: Ne(),
    grade: ej,
    intent: De(),
    prop: Ne(),
    visit: De(),
    price: De(),
    status: tj,
    purchased_at: Yc([Ne(), De(), Bb()]).optional(),
    purchased_by: Ne().nullable().optional(),
    transaction_hash: Ne().nullable().optional(),
    ai: Ne(),
    remaining_hours: De().nullable().optional(),
    x: De().optional(),
    y: De().optional(),
    created_at: Ne().optional(),
  }).passthrough(),
  yd = sj.extend({ remainingHours: De().optional() }),
  vd = Is({
    title: Ne(),
    tags: Us(Ne()).optional().nullable(),
    view_count: De().optional(),
    click_count: De().optional(),
    fav_count: De().optional(),
    thumb_color: Ne().optional(),
    view: De().optional(),
    click: De().optional(),
    fav: De().optional(),
    thumbColor: Ne().optional(),
  }).passthrough(),
  jd = Is({
    title: Ne(),
    meta: Ne(),
    body: Ne(),
    created_at: Ne().optional(),
  }).passthrough(),
  wd = Is({ points: De(), quota: Is({ s: De(), a: De() }) });
Is({ user: wd, leads: Us(yd), listings: Us(vd), feed: Us(jd) });
const Jo = { TABLET: 1024 },
  ai = { S: 120, A: 72, B: 336, C: 336, F: 336 },
  rj = (e, t) => {
    if (!e) return 0;
    const r = ai[t] || 336,
      n = new Date(e).getTime(),
      a = (Date.now() - n) / (1e3 * 60 * 60);
    return Math.max(0, Math.min(r, r - a));
  },
  nj = (e, t, r, n) => {
    const a = { points: e.points, quota: { s: e.quota_s, a: e.quota_a } },
      i = wd.safeParse(a);
    if (!i.success)
      throw (
        console.error('Critical: User Data Validation Failed', i.error),
        new Error('Failed to load user profile')
      );
    const o = t
        .map((d) => {
          let m = d.remaining_hours != null ? Number(d.remaining_hours) : null;
          return (
            m == null &&
              d.purchased_at &&
              d.status === 'purchased' &&
              (m = rj(d.purchased_at, d.grade)),
            {
              ...d,
              grade: d.grade,
              status: d.status,
              ...(m != null ? { remainingHours: m } : {}),
            }
          );
        })
        .filter((d) => {
          const m = yd.safeParse(d);
          return m.success
            ? !0
            : (console.warn(`Skipping invalid lead (${d.id}):`, m.error.flatten()), !1);
        }),
      l = r
        .map((d) => ({
          ...d,
          title: d.title,
          tags: d.tags ?? [],
          view: d.view_count ?? 0,
          click: d.click_count ?? 0,
          fav: d.fav_count ?? 0,
          thumbColor: d.thumb_color ?? '#e5e7eb',
        }))
        .filter((d) => {
          const m = vd.safeParse(d);
          return m.success
            ? !0
            : (console.warn('Skipping invalid listing:', m.error.flatten()), !1);
        }),
      c = n.filter((d) => {
        const m = jd.safeParse(d);
        return m.success
          ? !0
          : (console.warn('Skipping invalid feed post:', m.error.flatten()), !1);
      });
    return { user: i.data, leads: o, listings: l, feed: c };
  };
class bn {
  static async fetchAppData(t) {
    const [r, n, a, i] = await Promise.all([
      de.from('users').select('points, quota_s, quota_a').single(),
      de.from('leads').select('*'),
      de.from('listings').select('*').eq('agent_id', t),
      de.from('feed').select('*').order('created_at', { ascending: !1 }).limit(5),
    ]);
    if (r.error) throw r.error;
    if (n.error) throw n.error;
    if (a.error) throw a.error;
    if (i.error) throw i.error;
    return nj(r.data, n.data, a.data, i.data);
  }
  static async fetchPropertyViewStats(t) {
    try {
      const { data: r, error: n } = await de.rpc('get_agent_property_stats', {
        p_agent_id: t,
      });
      return n
        ? (console.warn('PropertyViewStats RPC error, using fallback:', n),
          await bn.fetchPropertyViewStatsFallback(t))
        : r || [];
    } catch (r) {
      return (console.error('fetchPropertyViewStats error:', r), []);
    }
  }
  static async fetchPropertyViewStatsFallback(t) {
    const { data: r, error: n } = await de.from('properties').select('public_id').eq('agent_id', t);
    if (n || !(r != null && r.length)) return [];
    const a = r.map((d) => d.public_id),
      { data: i, error: o } = await de
        .from('uag_events')
        .select('property_id, session_id, duration, actions')
        .in('property_id', a);
    if (o || !i) return [];
    const l = new Map();
    for (const d of i) {
      const m = d.property_id;
      l.has(m) ||
        l.set(m, {
          property_id: m,
          view_count: 0,
          unique_sessions: 0,
          total_duration: 0,
          line_clicks: 0,
          call_clicks: 0,
        });
      const u = l.get(m);
      (u.view_count++, (u.total_duration += d.duration || 0));
      const x = d.actions;
      (x != null && x.click_line && u.line_clicks++, x != null && x.click_call && u.call_clicks++);
    }
    const c = new Map();
    for (const d of i)
      (c.has(d.property_id) || c.set(d.property_id, new Set()),
        c.get(d.property_id).add(d.session_id));
    for (const [d, m] of c) {
      const u = l.get(d);
      u && (u.unique_sessions = m.size);
    }
    return Array.from(l.values());
  }
  static async purchaseLead(t, r, n, a) {
    const { error: i } = await de.rpc('purchase_lead', {
      p_user_id: t,
      p_lead_id: r,
      p_cost: n,
      p_grade: a,
    });
    if (i) throw i;
  }
}
const aj = {
    user: { points: 1280, quota: { s: 2, a: 3 } },
    leads: [
      {
        id: 'S-5566',
        name: '買家 S-5566',
        grade: 'S',
        intent: 98,
        prop: '捷運宅',
        visit: 15,
        price: 20,
        status: 'purchased',
        purchased_at: Date.now() - 2 * 36e5,
        ai: 'S 級熱度拉滿，請優先處理。',
        remainingHours: 118,
      },
      {
        id: 'S-9011',
        name: '買家 S-9011',
        grade: 'S',
        intent: 93,
        prop: '高樓景觀宅',
        visit: 11,
        price: 20,
        status: 'purchased',
        purchased_at: Date.now() - 6 * 36e5,
        ai: '已連續三天造訪同社區。',
        remainingHours: 114,
      },
      {
        id: 'A-7788',
        name: '買家 A-7788',
        grade: 'A',
        intent: 79,
        prop: '學區房',
        visit: 6,
        price: 10,
        status: 'purchased',
        purchased_at: Date.now() - 20 * 36e5,
        ai: 'A 級學區需求穩定。',
        remainingHours: 52,
      },
      {
        id: 'A-6600',
        name: '買家 A-6600',
        grade: 'A',
        intent: 74,
        prop: '預售捷運宅',
        visit: 5,
        price: 10,
        status: 'purchased',
        purchased_at: Date.now() - 10 * 36e5,
        ai: '適合搭配預售案一次推薦。',
        remainingHours: 62,
      },
      {
        id: 'B218',
        name: '買家 B218',
        grade: 'S',
        intent: 92,
        prop: '捷運共構 3 房',
        visit: 7,
        price: 20,
        status: 'new',
        ai: '🔥 強烈建議立即發送訊息！',
        x: 25,
        y: 25,
      },
      {
        id: 'A103',
        name: '買家 A103',
        grade: 'S',
        intent: 88,
        prop: '惠宇上晴 12F',
        visit: 12,
        price: 20,
        status: 'new',
        ai: '建議立即發送獨家邀約！',
        x: 15,
        y: 45,
      },
      {
        id: 'S901',
        name: '買家 S901',
        grade: 'S',
        intent: 94,
        prop: '高樓景觀宅',
        visit: 9,
        price: 20,
        status: 'new',
        ai: '重複詢問同一社區，請發送簡訊跟進。',
        x: 40,
        y: 32,
      },
      {
        id: 'S880',
        name: '買家 S880',
        grade: 'S',
        intent: 90,
        prop: '預售捷運宅',
        visit: 8,
        price: 20,
        status: 'new',
        ai: '對捷運沿線有強烈偏好。',
        x: 60,
        y: 40,
      },
      {
        id: 'C055',
        name: '買家 C055',
        grade: 'A',
        intent: 75,
        prop: '南屯學區宅',
        visit: 4,
        price: 10,
        status: 'new',
        ai: 'A 級學區需求明確。',
        x: 60,
        y: 20,
      },
      {
        id: 'A230',
        name: '買家 A230',
        grade: 'A',
        intent: 71,
        prop: '次高樓層 3 房',
        visit: 3,
        price: 10,
        status: 'new',
        ai: '已追蹤兩個以上相似物件。',
        x: 70,
        y: 30,
      },
      {
        id: 'A550',
        name: '買家 A550',
        grade: 'A',
        intent: 69,
        prop: '公園首排',
        visit: 3,
        price: 10,
        status: 'new',
        ai: '假日時段瀏覽頻繁。',
        x: 50,
        y: 15,
      },
      {
        id: 'D330',
        name: '買家 D330',
        grade: 'B',
        intent: 62,
        prop: '捷運生活圈',
        visit: 3,
        price: 3,
        status: 'new',
        ai: '建議發送訊息提供車位資訊。',
        x: 40,
        y: 60,
      },
      {
        id: 'B778',
        name: '買家 B778',
        grade: 'B',
        intent: 58,
        prop: '小坪數投資宅',
        visit: 2,
        price: 3,
        status: 'new',
        ai: '屬於投資族群，可搭配多案推薦。',
        x: 30,
        y: 70,
      },
      {
        id: 'C021',
        name: '買家 C021',
        grade: 'C',
        intent: 48,
        prop: '老屋翻新',
        visit: 2,
        price: 1,
        status: 'new',
        ai: '對低總價物件有興趣。',
        x: 75,
        y: 55,
      },
      {
        id: 'C990',
        name: '買家 C990',
        grade: 'C',
        intent: 42,
        prop: '套房',
        visit: 1,
        price: 1,
        status: 'new',
        ai: '瀏覽時間短，建議先以訊息觸及。',
        x: 82,
        y: 65,
      },
      {
        id: 'H009',
        name: '買家 H009',
        grade: 'F',
        intent: 28,
        prop: '小坪數',
        visit: 1,
        price: 0.5,
        status: 'new',
        ai: '潛在客戶。',
        x: 70,
        y: 75,
      },
      {
        id: 'F778',
        name: '買家 F778',
        grade: 'F',
        intent: 22,
        prop: '套房出租',
        visit: 1,
        price: 0.5,
        status: 'new',
        ai: '互動較少，可作為備選追蹤。',
        x: 55,
        y: 80,
      },
    ],
    listings: [
      {
        title: '惠宇上晴｜12/15F 視野戶・雙平車',
        tags: ['南屯區', '近捷運', '雙平車'],
        view: 1284,
        click: 214,
        fav: 37,
        thumbColor: '#eef2ff',
      },
      {
        title: '捷運共構 3 房｜視野棟距佳',
        tags: ['捷運共構', '次高樓層'],
        view: 986,
        click: 163,
        fav: 22,
        thumbColor: '#f0fdf4',
      },
      {
        title: '南屯捷運宅｜3房・高樓層',
        tags: ['近學區', '雙衛浴'],
        view: 846,
        click: 128,
        fav: 15,
        thumbColor: '#fff7ed',
      },
    ],
    feed: [
      {
        title: '成交故事｜12F 視野戶為什麼受歡迎',
        meta: '來自：社區牆・成交故事',
        body: '買方看重的是採光、棟距與公設使用率。',
      },
      {
        title: '住戶心得｜公設使用率與噪音表現',
        meta: '本週一・互動 41',
        body: '晚間 9 點後社區安靜。',
      },
    ],
  },
  Xo = (e, t) =>
    e.grade === 'S' && t.quota.s <= 0
      ? { valid: !1, error: 'S 級配額已用完' }
      : e.grade === 'A' && t.quota.a <= 0
        ? { valid: !1, error: 'A 級配額已用完' }
        : { valid: !0 };
function ij() {
  if (typeof window > 'u') return !0;
  const t = new URLSearchParams(window.location.search).get('mode');
  if (t === 'mock' || t === 'live') return (localStorage.setItem('uag_mode', t), t === 'mock');
  const r = localStorage.getItem('uag_mode');
  return r === 'mock' || r === 'live' ? r === 'mock' : !0;
}
function oj() {
  var u, x;
  const { session: e } = Ct(),
    [t, r] = h.useState(ij),
    n = Sn(),
    a = () => {
      {
        W.error('生產環境無法切換模式');
        return;
      }
    },
    {
      data: i,
      isLoading: o,
      error: l,
      refetch: c,
    } = $a({
      queryKey: ['uagData', t, (u = e == null ? void 0 : e.user) == null ? void 0 : u.id],
      queryFn: async () => {
        var f;
        if (t) return aj;
        if (!((f = e == null ? void 0 : e.user) != null && f.id))
          throw new Error('Not authenticated');
        return bn.fetchAppData(e.user.id);
      },
      enabled: t || !!((x = e == null ? void 0 : e.user) != null && x.id),
      staleTime: 1e3 * 10,
      refetchInterval: t ? !1 : 3e4,
    }),
    d = dr({
      mutationFn: async ({ leadId: f, cost: g, grade: b }) => {
        var y;
        if (t) {
          await new Promise((p) => setTimeout(p, 500));
          return;
        }
        if (!((y = e == null ? void 0 : e.user) != null && y.id))
          throw new Error('Not authenticated');
        await bn.purchaseLead(e.user.id, f, g, b);
      },
      onMutate: async ({ leadId: f, cost: g, grade: b }) => {
        var p, E;
        await n.cancelQueries({ queryKey: ['uagData'] });
        const y = n.getQueryData([
          'uagData',
          t,
          (p = e == null ? void 0 : e.user) == null ? void 0 : p.id,
        ]);
        if (y) {
          const S = y.leads.find((k) => k.id === f);
          if (S) {
            const { valid: k, error: T } = Xo(S, y.user);
            if (!k) throw (W.error(T || '配額不足'), new Error(T || '配額不足 (Optimistic Check)'));
          }
          const N = {
            ...y,
            user: {
              ...y.user,
              points: y.user.points - g,
              quota: {
                ...y.user.quota,
                s: b === 'S' ? y.user.quota.s - 1 : y.user.quota.s,
                a: b === 'A' ? y.user.quota.a - 1 : y.user.quota.a,
              },
            },
            leads: y.leads.map((k) =>
              k.id === f ? { ...k, status: 'purchased', remainingHours: ai[b] || 48 } : k
            ),
          };
          n.setQueryData(
            ['uagData', t, (E = e == null ? void 0 : e.user) == null ? void 0 : E.id],
            N
          );
        }
        return { previousData: y };
      },
      onError: (f, g, b) => {
        var y;
        (b != null &&
          b.previousData &&
          n.setQueryData(
            ['uagData', t, (y = e == null ? void 0 : e.user) == null ? void 0 : y.id],
            b.previousData
          ),
          W.error(`購買失敗: ${f instanceof Error ? f.message : 'Unknown error'}`));
      },
      onSettled: () => {
        n.invalidateQueries({ queryKey: ['uagData'] });
      },
    });
  return {
    data: i,
    isLoading: o,
    error: l,
    buyLead: async (f) => {
      if (!i || d.isPending) return;
      const g = i.leads.find((E) => E.id === f);
      if (!g) {
        W.error('客戶不存在');
        return;
      }
      if (g.status !== 'new') {
        W.error('此客戶已被購買');
        return;
      }
      const { valid: b, error: y } = Xo(g, i.user);
      if (!b) {
        W.error(y || '配額不足');
        return;
      }
      const p = g.price || 10;
      if (i.user.points < p) {
        W.error('點數不足');
        return;
      }
      d.mutate(
        { leadId: f, cost: p, grade: g.grade },
        {
          onSuccess: () => {
            W.success('購買成功');
          },
        }
      );
    },
    isBuying: d.isPending,
    useMock: t,
    toggleMode: a,
    refetch: c,
  };
}
function lj(e, t) {
  let r;
  return (...n) => {
    (clearTimeout(r), (r = setTimeout(() => e(...n), t)));
  };
}
function cj() {
  const [e, t] = h.useState({
    width: typeof window < 'u' ? window.innerWidth : 0,
    height: typeof window < 'u' ? window.innerHeight : 0,
  });
  return (
    h.useEffect(() => {
      if (typeof window > 'u') return;
      const r = lj(() => {
        t({ width: window.innerWidth, height: window.innerHeight });
      }, 150);
      return (window.addEventListener('resize', r), () => window.removeEventListener('resize', r));
    }, []),
    e
  );
}
function dj() {
  const [e, t] = h.useState(null),
    { width: r } = cj(),
    n = r <= Jo.TABLET,
    a = h.useMemo(() => (!e || (e.selectedOnMobile && !n) ? null : e.lead), [e, n]),
    i = h.useCallback((l) => {
      const c = window.innerWidth <= Jo.TABLET;
      (t({ lead: l, selectedOnMobile: c }),
        requestAnimationFrame(() => {
          var d;
          c &&
            ((d = document.getElementById('action-panel-container')) == null ||
              d.scrollIntoView({ behavior: 'smooth', block: 'center' }));
        }));
    }, []),
    o = h.useCallback(() => t(null), []);
  return { selectedLead: a, selectLead: i, close: o };
}
const uj = () =>
    s.jsx('header', {
      className: M['uag-header'],
      children: s.jsxs('div', {
        className: M['uag-header-inner'],
        children: [
          s.jsxs('div', {
            className: M['uag-logo'],
            children: [
              s.jsx('div', { className: M['uag-logo-badge'], children: '邁' }),
              s.jsx('span', { children: '邁房子廣告後台' }),
            ],
          }),
          s.jsxs('div', {
            className: M['uag-breadcrumb'],
            children: [
              s.jsx('span', { children: '游杰倫 21世紀不動產河南店' }),
              s.jsx('span', {
                className: `${M['uag-badge']} ${M['uag-badge--pro']}`,
                children: '專業版 PRO',
              }),
            ],
          }),
        ],
      }),
    }),
  mj = ({ user: e, useMock: t, toggleMode: r }) =>
    s.jsxs('div', {
      className: M['uag-footer-bar'],
      children: [
        s.jsxs('div', {
          style: {
            marginRight: 'auto',
            fontSize: '12px',
            color: 'var(--ink-300)',
          },
          children: [
            '系統模式：',
            s.jsx('strong', {
              style: { color: t ? '#f59e0b' : '#16a34a' },
              children: t ? 'Local Mock' : 'Live API',
            }),
            s.jsx('button', {
              onClick: r,
              style: {
                marginLeft: '10px',
                fontSize: '10px',
                cursor: 'pointer',
                border: '1px solid #ccc',
                padding: '2px 6px',
                borderRadius: '4px',
              },
              children: '切換模式',
            }),
          ],
        }),
        s.jsx('button', { className: M['uag-btn'], children: '方案設定' }),
        s.jsx('button', {
          className: `${M['uag-btn']} ${M.primary}`,
          children: '加值點數',
        }),
        s.jsxs('span', {
          className: M['uag-badge'],
          style: {
            fontSize: '14px',
            background: '#fff8dc',
            color: '#92400e',
            borderColor: '#fcd34d',
          },
          children: ['點數 ', s.jsx('span', { id: 'user-points', children: e.points })],
        }),
      ],
    }),
  hj = () =>
    s.jsxs('div', {
      className: 'p-6 text-center',
      children: [
        s.jsx('div', {
          className: 'flex animate-pulse justify-center space-x-4',
          children: s.jsxs('div', {
            className: 'max-w-md flex-1 space-y-4 py-1',
            children: [
              s.jsx('div', {
                className: 'mx-auto h-4 w-3/4 rounded bg-gray-200',
              }),
              s.jsxs('div', {
                className: 'space-y-2',
                children: [
                  s.jsx('div', { className: 'h-4 rounded bg-gray-200' }),
                  s.jsx('div', {
                    className: 'mx-auto h-4 w-5/6 rounded bg-gray-200',
                  }),
                ],
              }),
            ],
          }),
        }),
        s.jsx('div', {
          className: 'mt-4 text-gray-500',
          children: '載入中...',
        }),
      ],
    }),
  fj = ({ error: e, resetErrorBoundary: t }) =>
    s.jsxs('div', {
      role: 'alert',
      className: 'p-6 text-center text-red-600',
      children: [
        s.jsx('p', {
          className: 'mb-2 text-lg font-bold',
          children: '系統發生錯誤',
        }),
        s.jsx('pre', {
          className: 'mx-auto mb-4 max-w-lg overflow-auto rounded bg-red-50 p-4 text-sm',
          children: e.message,
        }),
        s.jsx('button', {
          onClick: t,
          className: 'rounded bg-red-600 px-4 py-2 text-white transition-colors hover:bg-red-700',
          children: '重試',
        }),
      ],
    });
function pj(e) {
  let t = 0;
  for (let r = 0; r < e.length; r++) {
    const n = e.charCodeAt(r);
    ((t = (t << 5) - t + n), (t = t & t));
  }
  return Math.abs((Math.sin(t) * 1e4) % 1);
}
function xj({ leads: e, onSelectLead: t }) {
  const r = e.filter((a) => a.status === 'new'),
    n = h.useMemo(() => {
      const a = {};
      for (const i of r) {
        const o = pj(i.id) * 3;
        a[i.id] = 5 + o + 's';
      }
      return a;
    }, [r]);
  return s.jsxs('section', {
    className: `${M['uag-card']} ${M['k-span-6']}`,
    id: 'radar-section',
    style: { minHeight: '450px' },
    children: [
      s.jsxs('div', {
        className: M['uag-card-header'],
        children: [
          s.jsxs('div', {
            children: [
              s.jsx('div', {
                className: M['uag-card-title'],
                children: 'UAG 精準導客雷達',
              }),
              s.jsx('div', {
                className: M['uag-card-sub'],
                children: 'S/A 級獨家聯絡權｜B/C/F 級點數兌換',
              }),
            ],
          }),
          s.jsx('div', { className: M['uag-actions'], style: { gap: '4px' } }),
        ],
      }),
      s.jsxs('div', {
        className: M['uag-cluster'],
        id: 'radar-container',
        children: [
          s.jsx('div', {
            style: {
              position: 'absolute',
              left: '50%',
              top: '50%',
              transform: 'translate(-50%,-50%)',
              width: '300px',
              height: '300px',
              border: '1px dashed #cbd5e1',
              borderRadius: '50%',
              pointerEvents: 'none',
            },
          }),
          s.jsx('div', {
            style: {
              position: 'absolute',
              left: '50%',
              top: '50%',
              transform: 'translate(-50%,-50%)',
              width: '150px',
              height: '150px',
              border: '1px dashed #cbd5e1',
              borderRadius: '50%',
              pointerEvents: 'none',
            },
          }),
          s.jsxs('div', {
            style: {
              position: 'absolute',
              left: '16px',
              top: '16px',
              background: 'rgba(255,255,255,0.9)',
              padding: '6px 12px',
              borderRadius: '20px',
              fontSize: '12px',
              color: '#0f172a',
              boxShadow: '0 1px 2px rgba(0,0,0,0.05)',
              border: '1px solid #e2e8f0',
              zIndex: 5,
            },
            children: [
              s.jsx('span', {
                style: {
                  width: '8px',
                  height: '8px',
                  background: '#22c55e',
                  borderRadius: '50%',
                  display: 'inline-block',
                  marginRight: '4px',
                },
              }),
              s.jsx('span', {
                style: { fontWeight: 700 },
                children: 'Live 監控中',
              }),
            ],
          }),
          r.map((a) => {
            const i = a.x != null ? a.x : 50,
              o = a.y != null ? a.y : 50,
              l =
                a.grade === 'S'
                  ? 120
                  : a.grade === 'A'
                    ? 100
                    : a.grade === 'B'
                      ? 90
                      : a.grade === 'C'
                        ? 80
                        : 60,
              c = n[a.id] ?? '6s';
            return s.jsxs(
              'div',
              {
                className: M['uag-bubble'],
                'data-grade': a.grade,
                role: 'button',
                'aria-label': `${a.name || a.id} - ${a.grade}級`,
                tabIndex: 0,
                style: {
                  '--w': l + 'px',
                  '--float': c,
                  left: i + '%',
                  top: o + '%',
                },
                onClick: () => t(a),
                onKeyDown: (d) => {
                  (d.key === 'Enter' || d.key === ' ') && t(a);
                },
                children: [
                  s.jsx('div', {
                    className: M['uag-bubble-grade'],
                    style: {
                      background: `var(--grade-${a.grade.toLowerCase()})`,
                      color: '#fff',
                    },
                    children: a.grade,
                  }),
                  s.jsxs('div', {
                    style: { textAlign: 'center', lineHeight: 1.2 },
                    children: [
                      s.jsx('div', {
                        style: { fontWeight: 800, fontSize: '14px' },
                        children: a.id,
                      }),
                      s.jsxs('div', {
                        style: { fontSize: '11px', color: '#64748b' },
                        children: [a.intent, '%'],
                      }),
                    ],
                  }),
                  s.jsx('div', {
                    className: M['uag-bubble-label'],
                    children: a.prop,
                  }),
                ],
              },
              a.id
            );
          }),
        ],
      }),
    ],
  });
}
const qr = ({ label: e, value: t, highlight: r = !1 }) =>
    s.jsxs('div', {
      className: M['ap-stat'],
      children: [
        s.jsx('span', { children: e }),
        s.jsx('b', {
          style: r ? { color: 'var(--uag-brand)' } : {},
          children: t,
        }),
      ],
    }),
  gj = h.forwardRef(({ selectedLead: e, onBuyLead: t, isProcessing: r }, n) => {
    const [a, i] = h.useState(!1),
      o = h.useRef(null),
      l = (e == null ? void 0 : e.id) ?? null;
    if ((l !== o.current && ((o.current = l), a && i(!1)), !e))
      return s.jsx('section', {
        className: M['k-span-6'],
        id: 'action-panel-container',
        ref: n,
        children: s.jsx('div', {
          className: M['uag-action-panel'],
          id: 'action-panel',
          children: s.jsx('div', {
            style: {
              height: '100%',
              minHeight: '200px',
              display: 'grid',
              placeItems: 'center',
              color: 'var(--ink-300)',
              textAlign: 'center',
              padding: '40px 20px',
            },
            children: s.jsxs('div', {
              children: [
                s.jsx('div', {
                  style: { fontSize: '40px', marginBottom: '10px' },
                  children: '👆',
                }),
                s.jsxs('div', {
                  children: ['請點擊上方雷達泡泡', s.jsx('br', {}), '查看分析與購買'],
                }),
              ],
            }),
          }),
        }),
      });
    const c = e.grade === 'S' || e.grade === 'A',
      d = () => {
        i(!0);
      },
      m = () => {
        (t(e.id), i(!1));
      },
      u = () => {
        i(!1);
      };
    return s.jsx('section', {
      className: M['k-span-6'],
      id: 'action-panel-container',
      ref: n,
      children: s.jsxs('div', {
        className: M['uag-action-panel'],
        id: 'action-panel',
        children: [
          s.jsx('div', {
            className: M['ap-head'],
            children: s.jsxs('span', {
              className: `${M['uag-badge']} ${M['uag-badge--' + e.grade.toLowerCase()]}`,
              children: [e.grade, '級｜', e.name],
            }),
          }),
          s.jsxs('div', {
            className: M['ap-body'],
            children: [
              s.jsxs('div', {
                className: M['ap-stats-group'],
                children: [
                  s.jsx(qr, { label: '關注房源', value: e.prop }),
                  s.jsx(qr, {
                    label: '意向分數',
                    value: `${e.intent}%`,
                    highlight: !0,
                  }),
                  s.jsx(qr, { label: '瀏覽次數', value: `${e.visit} 次` }),
                  s.jsx(qr, { label: '購買成本', value: `${e.price} 點` }),
                ],
              }),
              s.jsx('div', {
                className: `${M['ai-box']} ${M.urgent}`,
                children: s.jsx('div', { children: e.ai }),
              }),
              s.jsxs('div', {
                className: M['action-zone'],
                children: [
                  c &&
                    s.jsx('div', {
                      style: {
                        background: '#fff7ed',
                        color: '#ea580c',
                        fontWeight: 700,
                        fontSize: '12px',
                        textAlign: 'center',
                        padding: '6px',
                        borderRadius: '4px',
                        border: '1px solid #ffedd5',
                        marginBottom: '10px',
                      },
                      children: '✨ 此客戶包含獨家訊息聯絡權 ✨',
                    }),
                  a
                    ? s.jsxs('div', {
                        style: { display: 'flex', gap: '10px' },
                        children: [
                          s.jsx('button', {
                            className: M['btn-attack'],
                            style: { background: '#ef4444', flex: 1 },
                            onClick: m,
                            disabled: r,
                            children: r ? '處理中...' : `確定花費 ${e.price} 點?`,
                          }),
                          s.jsx('button', {
                            className: M['btn-attack'],
                            style: { background: '#94a3b8', flex: 1 },
                            onClick: u,
                            disabled: r,
                            children: '取消',
                          }),
                        ],
                      })
                    : s.jsx('button', {
                        className: M['btn-attack'],
                        onClick: d,
                        disabled: r,
                        children: r ? '處理中...' : '🚀 獲取聯絡權限 (簡訊/站內信)',
                      }),
                  s.jsxs('div', {
                    style: {
                      textAlign: 'center',
                      fontSize: '11px',
                      color: '#94a3b8',
                      marginTop: '8px',
                    },
                    children: [
                      '符合個資法規範：僅能以簡訊/站內信聯繫',
                      s.jsx('br', {}),
                      '系統將自動發送您的名片與電話給客戶',
                    ],
                  }),
                ],
              }),
            ],
          }),
        ],
      }),
    });
  }),
  bj = (e) => {
    const t = ai[e.grade] ?? 336,
      r = e.remainingHours ?? t,
      n = Math.max(0, Math.min(100, (r / t) * 100)),
      a = e.grade === 'S' || e.grade === 'A';
    let i = '';
    return (
      a ? (i = `${r.toFixed(1)} 小時`) : (i = `${(r / 24).toFixed(1)} 天`),
      { total: t, remaining: r, percent: n, isExclusive: a, timeDisplay: i }
    );
  };
function yj({ leads: e }) {
  const t = e.filter((r) => r.status === 'purchased');
  return s.jsxs('section', {
    className: `${M['uag-card']} ${M['k-span-6']}`,
    children: [
      s.jsxs('div', {
        className: M['uag-card-header'],
        children: [
          s.jsxs('div', {
            children: [
              s.jsx('div', {
                className: M['uag-card-title'],
                children: '已購客戶資產與保護監控',
              }),
              s.jsx('div', {
                className: M['uag-card-sub'],
                children: 'S 級 120hr / A 級 72hr 獨家倒數｜B/C/F 級 14 天防撞',
              }),
            ],
          }),
          s.jsx('div', {
            className: M['uag-actions'],
            children: s.jsx('button', {
              className: M['uag-btn'],
              children: '匯出報表',
            }),
          }),
        ],
      }),
      s.jsx('div', {
        style: { overflowX: 'auto' },
        children: s.jsxs('table', {
          className: M['monitor-table'],
          children: [
            s.jsx('thead', {
              children: s.jsxs('tr', {
                children: [
                  s.jsx('th', {
                    style: { width: '25%' },
                    children: '客戶等級/名稱',
                  }),
                  s.jsx('th', {
                    style: { width: '35%' },
                    children: '保護期倒數',
                  }),
                  s.jsx('th', {
                    style: { width: '20%' },
                    children: '目前狀態',
                  }),
                  s.jsx('th', { style: { width: '20%' }, children: '操作' }),
                ],
              }),
            }),
            s.jsx('tbody', {
              id: 'asset-list',
              children:
                t.length === 0
                  ? s.jsx('tr', {
                      children: s.jsx('td', {
                        colSpan: 4,
                        style: {
                          textAlign: 'center',
                          padding: '20px',
                          color: '#94a3b8',
                        },
                        children: '尚無已購資產，請從上方雷達進攻。',
                      }),
                    })
                  : t.map((r) => {
                      const { percent: n, isExclusive: a, timeDisplay: i } = bj(r),
                        o = `var(--grade-${r.grade.toLowerCase()})`,
                        l = a ? '獨家鎖定中' : '去重保護中';
                      return s.jsxs(
                        'tr',
                        {
                          children: [
                            s.jsx('td', {
                              'data-label': '客戶等級/名稱',
                              children: s.jsxs('div', {
                                style: {
                                  display: 'flex',
                                  alignItems: 'center',
                                },
                                children: [
                                  s.jsx('span', {
                                    style: {
                                      display: 'inline-grid',
                                      placeItems: 'center',
                                      width: '24px',
                                      height: '24px',
                                      borderRadius: '50%',
                                      fontSize: '11px',
                                      fontWeight: 900,
                                      color: '#fff',
                                      marginRight: '8px',
                                      background: o,
                                    },
                                    children: r.grade,
                                  }),
                                  s.jsxs('div', {
                                    children: [
                                      s.jsx('div', {
                                        style: {
                                          fontWeight: 800,
                                          color: 'var(--ink-100)',
                                        },
                                        children: r.name,
                                      }),
                                      s.jsx('div', {
                                        style: {
                                          fontSize: '11px',
                                          color: 'var(--ink-300)',
                                        },
                                        children: r.prop,
                                      }),
                                    ],
                                  }),
                                ],
                              }),
                            }),
                            s.jsxs('td', {
                              'data-label': '保護期倒數',
                              children: [
                                s.jsxs('div', {
                                  style: {
                                    fontSize: '11px',
                                    fontWeight: 700,
                                    marginBottom: '2px',
                                    display: 'flex',
                                    justifyContent: 'space-between',
                                  },
                                  children: [
                                    s.jsx('span', {
                                      style: { color: o },
                                      children: l,
                                    }),
                                    s.jsx('span', {
                                      className: M['t-countdown'],
                                      children: i,
                                    }),
                                  ],
                                }),
                                s.jsx('div', {
                                  className: M['progress-bg'],
                                  children: s.jsx('div', {
                                    className: M['progress-fill'],
                                    style: { width: `${n}%`, background: o },
                                  }),
                                }),
                              ],
                            }),
                            s.jsx('td', {
                              'data-label': '目前狀態',
                              children: s.jsx('span', {
                                className: M['uag-badge'],
                                style: {
                                  background: '#f0fdf4',
                                  color: '#16a34a',
                                  border: 'none',
                                },
                                children: '簡訊已發送',
                              }),
                            }),
                            s.jsx('td', {
                              'data-label': '操作',
                              children: s.jsx('button', {
                                className: `${M['uag-btn']} ${M.primary}`,
                                style: {
                                  padding: '4px 12px',
                                  fontSize: '12px',
                                },
                                children: '寫紀錄 / 預約',
                              }),
                            }),
                          ],
                        },
                        r.id
                      );
                    }),
            }),
          ],
        }),
      }),
    ],
  });
}
function vj({ listings: e, feed: t }) {
  return s.jsxs(s.Fragment, {
    children: [
      s.jsxs('section', {
        className: `${M['uag-card']} ${M['k-span-3']}`,
        children: [
          s.jsxs('div', {
            className: M['uag-card-header'],
            children: [
              s.jsxs('div', {
                children: [
                  s.jsx('div', {
                    className: M['uag-card-title'],
                    children: '我的房源總覽',
                  }),
                  s.jsx('div', {
                    className: M['uag-card-sub'],
                    children: '即時掌握曝光、點擊與收藏',
                  }),
                ],
              }),
              s.jsx('div', {
                className: M['uag-actions'],
                children: s.jsxs(We, {
                  to: '/property/upload',
                  className: M['uag-btn'],
                  style: {
                    display: 'inline-flex',
                    alignItems: 'center',
                    gap: '4px',
                    textDecoration: 'none',
                  },
                  children: [s.jsx(fr, { size: 14 }), '上傳房源'],
                }),
              }),
            ],
          }),
          s.jsx('div', {
            id: 'listing-container',
            children:
              e.length === 0
                ? s.jsx('div', {
                    style: {
                      padding: '12px',
                      fontSize: '13px',
                      color: '#94a3b8',
                    },
                    children: '尚無房源資料。',
                  })
                : e.map((r, n) => {
                    var a, i;
                    return s.jsx(
                      'article',
                      {
                        className: M['listing-item'],
                        children:
                          n === 0
                            ? s.jsxs(We, {
                                to: '/property/MH-100001',
                                style: {
                                  display: 'contents',
                                  textDecoration: 'none',
                                  color: 'inherit',
                                },
                                children: [
                                  s.jsx('div', {
                                    className: M['l-thumb'],
                                    style: { background: r.thumbColor },
                                  }),
                                  s.jsxs('div', {
                                    children: [
                                      s.jsx('div', {
                                        className: M['l-title'],
                                        children: r.title,
                                      }),
                                      s.jsx('div', {
                                        className: M['l-tags'],
                                        children:
                                          (a = r.tags) == null
                                            ? void 0
                                            : a.map((o, l) =>
                                                s.jsx(
                                                  'span',
                                                  {
                                                    className: M['l-tag'],
                                                    children: o,
                                                  },
                                                  l
                                                )
                                              ),
                                      }),
                                      s.jsxs('div', {
                                        className: M['l-kpi'],
                                        children: [
                                          s.jsxs('span', {
                                            children: ['曝光 ', s.jsx('b', { children: r.view })],
                                          }),
                                          s.jsxs('span', {
                                            children: ['點擊 ', s.jsx('b', { children: r.click })],
                                          }),
                                          s.jsxs('span', {
                                            children: ['收藏 ', s.jsx('b', { children: r.fav })],
                                          }),
                                        ],
                                      }),
                                    ],
                                  }),
                                ],
                              })
                            : s.jsxs(s.Fragment, {
                                children: [
                                  s.jsx('div', {
                                    className: M['l-thumb'],
                                    style: { background: r.thumbColor },
                                  }),
                                  s.jsxs('div', {
                                    children: [
                                      s.jsx('div', {
                                        className: M['l-title'],
                                        children: r.title,
                                      }),
                                      s.jsx('div', {
                                        className: M['l-tags'],
                                        children:
                                          (i = r.tags) == null
                                            ? void 0
                                            : i.map((o, l) =>
                                                s.jsx(
                                                  'span',
                                                  {
                                                    className: M['l-tag'],
                                                    children: o,
                                                  },
                                                  l
                                                )
                                              ),
                                      }),
                                      s.jsxs('div', {
                                        className: M['l-kpi'],
                                        children: [
                                          s.jsxs('span', {
                                            children: ['曝光 ', s.jsx('b', { children: r.view })],
                                          }),
                                          s.jsxs('span', {
                                            children: ['點擊 ', s.jsx('b', { children: r.click })],
                                          }),
                                          s.jsxs('span', {
                                            children: ['收藏 ', s.jsx('b', { children: r.fav })],
                                          }),
                                        ],
                                      }),
                                    ],
                                  }),
                                ],
                              }),
                      },
                      n
                    );
                  }),
          }),
        ],
      }),
      s.jsxs('section', {
        className: `${M['uag-card']} ${M['k-span-3']}`,
        children: [
          s.jsxs('div', {
            className: M['uag-card-header'],
            children: [
              s.jsxs('div', {
                children: [
                  s.jsx('div', {
                    className: M['uag-card-title'],
                    children: '社區牆＆真實口碑',
                  }),
                  s.jsx('div', {
                    className: M['uag-card-sub'],
                    children: '用真實交流建立信任',
                  }),
                ],
              }),
              s.jsx('div', {
                className: M['uag-actions'],
                children: s.jsx('button', {
                  className: M['uag-btn'],
                  children: '貼文',
                }),
              }),
            ],
          }),
          s.jsx('div', {
            id: 'feed-container',
            children:
              t.length === 0
                ? s.jsx('div', {
                    style: {
                      padding: '12px',
                      fontSize: '13px',
                      color: '#94a3b8',
                    },
                    children: '尚無社區牆互動。',
                  })
                : t.map((r, n) =>
                    s.jsxs(
                      'article',
                      {
                        className: M['feed-post'],
                        children: [
                          s.jsx('div', {
                            className: M['fp-title'],
                            children: r.title,
                          }),
                          s.jsx('div', {
                            className: M['fp-meta'],
                            children: r.meta,
                          }),
                          s.jsx('div', {
                            className: M['fp-body'],
                            children: r.body,
                          }),
                        ],
                      },
                      n
                    )
                  ),
          }),
        ],
      }),
    ],
  });
}
const jj = '_reportContainer_exvqp_4',
  wj = '_reportStep_exvqp_9',
  Nj = '_reportStepHeader_exvqp_15',
  _j = '_reportStepBadge_exvqp_27',
  kj = '_reportStepHint_exvqp_36',
  Sj = '_reportBackBtn_exvqp_42',
  Ej = '_reportImportSection_exvqp_62',
  Tj = '_reportImportBtn_exvqp_66',
  Ij = '_reportDivider_exvqp_97',
  Cj = '_reportListings_exvqp_114',
  Aj = '_reportListingItem_exvqp_122',
  Lj = '_reportListingThumb_exvqp_140',
  Oj = '_reportListingInfo_exvqp_152',
  Rj = '_reportListingTitle_exvqp_157',
  Mj = '_reportListingMeta_exvqp_166',
  Pj = '_reportListingArrow_exvqp_180',
  zj = '_reportSelectedProperty_exvqp_186',
  Dj = '_reportStyles_exvqp_199',
  Fj = '_reportStyleItem_exvqp_205',
  $j = '_selected_exvqp_222',
  Uj = '_reportStyleIcon_exvqp_227',
  Bj = '_reportStyleInfo_exvqp_231',
  Gj = '_reportStyleTitle_exvqp_235',
  Hj = '_reportStyleDesc_exvqp_241',
  Wj = '_reportStyleCheck_exvqp_247',
  Vj = '_reportHighlights_exvqp_252',
  Zj = '_reportHighlightItem_exvqp_260',
  Yj = '_reportHighlightIcon_exvqp_282',
  qj = '_reportHighlightInfo_exvqp_286',
  Kj = '_reportHighlightTitle_exvqp_290',
  Qj = '_reportHighlightDesc_exvqp_296',
  Jj = '_reportHighlightCheck_exvqp_302',
  Xj = '_reportHighlightUnchecked_exvqp_306',
  ew = '_reportStepFooter_exvqp_318',
  tw = '_reportNextBtn_exvqp_328',
  sw = '_reportPhoneFrame_exvqp_349',
  rw = '_reportPhoneNotch_exvqp_360',
  nw = '_reportPhoneContent_exvqp_372',
  aw = '_reportPreviewHero_exvqp_381',
  iw = '_reportPreviewHeroImg_exvqp_390',
  ow = '_reportPreviewHeroOverlay_exvqp_394',
  lw = '_reportPreviewPrice_exvqp_404',
  cw = '_reportPreviewTitle_exvqp_409',
  dw = '_reportPreviewSpecs_exvqp_415',
  uw = '_reportPreviewMortgage_exvqp_432',
  mw = '_reportPreviewMortgageLabel_exvqp_438',
  hw = '_reportPreviewMortgageValue_exvqp_443',
  fw = '_reportPreviewHighlights_exvqp_449',
  pw = '_reportPreviewHighlight_exvqp_449',
  xw = '_reportPreviewAgent_exvqp_477',
  gw = '_reportPreviewAgentAvatar_exvqp_486',
  bw = '_reportPreviewAgentInfo_exvqp_497',
  yw = '_reportGenerateBtn_exvqp_512',
  vw = '_reportSuccess_exvqp_541',
  jw = '_reportSuccessIcon_exvqp_546',
  ww = '_reportUrlBox_exvqp_557',
  Nw = '_reportUrlInput_exvqp_565',
  _w = '_reportUrlCopy_exvqp_575',
  kw = '_reportShareButtons_exvqp_592',
  Sw = '_reportShareBtnPrimary_exvqp_599',
  Ew = '_reportShareBtnLine_exvqp_600',
  Tw = '_reportPreviewLink_exvqp_634',
  Iw = '_reportResetBtn_exvqp_656',
  H = {
    reportContainer: jj,
    reportStep: wj,
    reportStepHeader: Nj,
    reportStepBadge: _j,
    reportStepHint: kj,
    reportBackBtn: Sj,
    reportImportSection: Ej,
    reportImportBtn: Tj,
    reportDivider: Ij,
    reportListings: Cj,
    reportListingItem: Aj,
    reportListingThumb: Lj,
    reportListingInfo: Oj,
    reportListingTitle: Rj,
    reportListingMeta: Mj,
    reportListingArrow: Pj,
    reportSelectedProperty: zj,
    reportStyles: Dj,
    reportStyleItem: Fj,
    selected: $j,
    reportStyleIcon: Uj,
    reportStyleInfo: Bj,
    reportStyleTitle: Gj,
    reportStyleDesc: Hj,
    reportStyleCheck: Wj,
    reportHighlights: Vj,
    reportHighlightItem: Zj,
    reportHighlightIcon: Yj,
    reportHighlightInfo: qj,
    reportHighlightTitle: Kj,
    reportHighlightDesc: Qj,
    reportHighlightCheck: Jj,
    reportHighlightUnchecked: Xj,
    reportStepFooter: ew,
    reportNextBtn: tw,
    reportPhoneFrame: sw,
    reportPhoneNotch: rw,
    reportPhoneContent: nw,
    reportPreviewHero: aw,
    reportPreviewHeroImg: iw,
    reportPreviewHeroOverlay: ow,
    reportPreviewPrice: lw,
    reportPreviewTitle: cw,
    reportPreviewSpecs: dw,
    reportPreviewMortgage: uw,
    reportPreviewMortgageLabel: mw,
    reportPreviewMortgageValue: hw,
    reportPreviewHighlights: fw,
    reportPreviewHighlight: pw,
    reportPreviewAgent: xw,
    reportPreviewAgentAvatar: gw,
    reportPreviewAgentInfo: bw,
    reportGenerateBtn: yw,
    reportSuccess: vw,
    reportSuccessIcon: jw,
    reportUrlBox: ww,
    reportUrlInput: Nw,
    reportUrlCopy: _w,
    reportShareButtons: kw,
    reportShareBtnPrimary: Sw,
    reportShareBtnLine: Ew,
    reportPreviewLink: Tw,
    reportResetBtn: Iw,
  },
  Cw = {
    id: 'demo-001',
    title: '惠宇上晴 12F｜3房2廳2衛',
    address: '台中市南屯區惠文路 168 號',
    district: '南屯區',
    price: 3288e4,
    pricePerPing: 521e3,
    size: 67.3,
    rooms: '3房2廳2衛',
    floor: '12F/15F',
    age: 5,
    direction: '朝南',
    parking: '平面車位',
    managementFee: 3500,
    community: '惠宇上晴',
    communityYear: 2019,
    communityUnits: 280,
    images: [],
    highlights: [
      {
        id: 'commute',
        icon: '🚇',
        title: '通勤便利',
        description: '距捷運站步行 5 分鐘',
        selected: !0,
      },
      {
        id: 'school',
        icon: '🎓',
        title: '優質學區',
        description: '惠文國小學區內',
        selected: !0,
      },
      {
        id: 'community',
        icon: '🏠',
        title: '社區單純',
        description: '住戶多為家庭，管理良好',
        selected: !0,
      },
      {
        id: 'view',
        icon: '🌅',
        title: '景觀優美',
        description: '高樓層無遮蔽，視野開闊',
        selected: !1,
      },
      {
        id: 'amenity',
        icon: '🛒',
        title: '生活機能',
        description: '全聯、7-11 步行 3 分鐘',
        selected: !1,
      },
      {
        id: 'parking',
        icon: '🅿️',
        title: '車位方便',
        description: '含平面車位一個',
        selected: !1,
      },
      {
        id: 'renovated',
        icon: '✨',
        title: '精裝入住',
        description: '屋主精心裝潢，可直接入住',
        selected: !1,
      },
    ],
  },
  Aw = [
    Cw,
    {
      id: 'demo-002',
      title: '冠德美麗大直｜4房2廳3衛',
      address: '台北市中山區北安路 256 號',
      district: '中山區',
      price: 88e6,
      pricePerPing: 112e4,
      size: 78.5,
      rooms: '4房2廳3衛',
      floor: '18F/22F',
      age: 3,
      direction: '朝東',
      parking: '機械車位',
      managementFee: 6800,
      community: '冠德美麗大直',
      communityYear: 2021,
      communityUnits: 156,
      images: [],
      highlights: [
        {
          id: 'commute',
          icon: '🚇',
          title: '通勤便利',
          description: '距捷運劍南路站步行 3 分鐘',
          selected: !0,
        },
        {
          id: 'view',
          icon: '🌅',
          title: '景觀優美',
          description: '高樓層遠眺 101',
          selected: !0,
        },
        {
          id: 'community',
          icon: '🏠',
          title: '頂級社區',
          description: '飯店式管理，公設完善',
          selected: !0,
        },
        {
          id: 'school',
          icon: '🎓',
          title: '明星學區',
          description: '大直國小學區內',
          selected: !1,
        },
        {
          id: 'amenity',
          icon: '🛒',
          title: '生活機能',
          description: '美麗華商圈步行 5 分鐘',
          selected: !1,
        },
        {
          id: 'parking',
          icon: '🅿️',
          title: '雙車位',
          description: '含機械車位兩個',
          selected: !1,
        },
        {
          id: 'renovated',
          icon: '✨',
          title: '豪宅規格',
          description: '全室大理石地板',
          selected: !1,
        },
      ],
    },
    {
      id: 'demo-003',
      title: '國泰天母｜2房1廳1衛',
      address: '台北市士林區天母西路 88 號',
      district: '士林區',
      price: 245e5,
      pricePerPing: 68e4,
      size: 36,
      rooms: '2房1廳1衛',
      floor: '5F/12F',
      age: 15,
      direction: '朝西',
      parking: '無',
      managementFee: 2200,
      community: '國泰天母',
      communityYear: 2009,
      communityUnits: 88,
      images: [],
      highlights: [
        {
          id: 'amenity',
          icon: '🛒',
          title: '天母商圈',
          description: 'SOGO、新光三越步行可達',
          selected: !0,
        },
        {
          id: 'school',
          icon: '🎓',
          title: '天母學區',
          description: '天母國小、天母國中學區',
          selected: !0,
        },
        {
          id: 'community',
          icon: '🏠',
          title: '純住宅區',
          description: '環境清幽，適合家庭',
          selected: !0,
        },
        {
          id: 'commute',
          icon: '🚇',
          title: '公車便利',
          description: '多線公車直達市區',
          selected: !1,
        },
        {
          id: 'view',
          icon: '🌅',
          title: '山景視野',
          description: '可遠眺陽明山',
          selected: !1,
        },
        {
          id: 'renovated',
          icon: '✨',
          title: '溫馨裝潢',
          description: '北歐風格，採光佳',
          selected: !1,
        },
        {
          id: 'parking',
          icon: '🅿️',
          title: '路邊好停',
          description: '社區周邊停車方便',
          selected: !1,
        },
      ],
    },
  ],
  Lw = [
    { id: 'simple', icon: '📋', title: '簡潔說明書', desc: '清晰的基本資訊' },
    {
      id: 'investment',
      icon: '📊',
      title: '投資分析版',
      desc: '數據導向，適合投資客',
    },
    {
      id: 'marketing',
      icon: '✨',
      title: '行銷文案版',
      desc: '故事感強，適合首購族',
    },
  ];
function Ow({ listings: e = [] }) {
  const [t, r] = h.useState(1),
    [n, a] = h.useState(null),
    [i, o] = h.useState('simple'),
    [l, c] = h.useState([]),
    [d, m] = h.useState(''),
    [u, x] = h.useState(!1),
    f = h.useRef(null),
    g = (I) => (I >= 1e8 ? `${(I / 1e8).toFixed(2)} 億` : `${(I / 1e4).toFixed(0)} 萬`),
    b = (I, A = 0.2, z = 30, O = 0.021) => {
      const re = I * (1 - A),
        ae = O / 12,
        R = z * 12,
        ee = (re * (ae * Math.pow(1 + ae, R))) / (Math.pow(1 + ae, R) - 1);
      return Math.round(ee);
    },
    y = (I) => {
      (a(I), c(I.highlights), r(2));
    },
    p = (I) => {
      (o(I), r(3));
    },
    E = (I) => {
      const A = l.filter((z) => z.selected).length;
      c((z) =>
        z.map((O) =>
          O.id === I
            ? !O.selected && A >= 3
              ? (W.error('最多只能選擇 3 個亮點'), O)
              : { ...O, selected: !O.selected }
            : O
        )
      );
    },
    S = () => {
      if (l.filter((A) => A.selected).length < 1) {
        W.error('請至少選擇 1 個亮點');
        return;
      }
      r(4);
    },
    N = async () => {
      if (!n) return;
      x(!0);
      const I = W.loading('正在生成精美報告...');
      try {
        await new Promise((O) => setTimeout(O, 1500));
        const A = `R-${Date.now().toString(36).toUpperCase()}`,
          z = `${window.location.origin}/r/${A}`;
        (m(z), r(5), W.success('報告生成成功！', void 0, { id: I }));
      } catch {
        W.error('生成失敗，請重試', void 0, { id: I });
      } finally {
        x(!1);
      }
    },
    k = async () => {
      try {
        (await navigator.clipboard.writeText(d), W.success('連結已複製！可直接貼到 LINE'));
      } catch {
        W.error('複製失敗');
      }
    },
    T = () => {
      const I = encodeURIComponent(`【${n == null ? void 0 : n.title}】

這是我幫您整理的物件報告，有空可以看看 🙂

${d}`);
      window.open(`https://line.me/R/msg/text/?${I}`, '_blank');
    },
    C = () => {
      (r(1), a(null), o('simple'), c([]), m(''));
    },
    w = () => {
      var I;
      (I = f.current) == null || I.click();
    },
    G = async (I) => {
      var O;
      if (!((O = I.target.files) == null ? void 0 : O[0])) return;
      const z = W.loading('AI 正在分析房仲頁面...');
      try {
        await new Promise((ae) => setTimeout(ae, 2e3));
        const re = {
          id: 'detected-001',
          title: '偵測結果：帝寶 18F｜豪宅規格',
          address: '台北市大安區仁愛路三段',
          district: '大安區',
          price: 188e6,
          pricePerPing: 156e4,
          size: 120.5,
          rooms: '4房3廳4衛',
          floor: '18F/24F',
          age: 10,
          direction: '朝南',
          parking: '坡道平面',
          managementFee: 15e3,
          community: '帝寶',
          communityYear: 2014,
          communityUnits: 52,
          images: [],
          highlights: [
            {
              id: 'view',
              icon: '🌅',
              title: '頂級景觀',
              description: '俯瞰仁愛路林蔭大道',
              selected: !0,
            },
            {
              id: 'community',
              icon: '🏠',
              title: '頂級豪宅',
              description: '政商名流指定社區',
              selected: !0,
            },
            {
              id: 'renovated',
              icon: '✨',
              title: '奢華裝潢',
              description: '義大利進口建材',
              selected: !0,
            },
            {
              id: 'parking',
              icon: '🅿️',
              title: '雙車位',
              description: '坡道平面車位兩個',
              selected: !1,
            },
            {
              id: 'amenity',
              icon: '🛒',
              title: '精品商圈',
              description: '信義計畫區步行可達',
              selected: !1,
            },
            {
              id: 'commute',
              icon: '🚇',
              title: '捷運便利',
              description: '距大安站步行 8 分鐘',
              selected: !1,
            },
            {
              id: 'school',
              icon: '🎓',
              title: '明星學區',
              description: '仁愛國小學區',
              selected: !1,
            },
          ],
        };
        (a(re),
          c(re.highlights),
          r(2),
          W.success('AI 分析完成！已自動帶入物件資訊', void 0, { id: z }));
      } catch {
        W.error('分析失敗', void 0, { id: z });
      }
    },
    j = () =>
      s.jsxs('div', {
        className: H.reportStep,
        children: [
          s.jsxs('div', {
            className: H.reportStepHeader,
            children: [
              s.jsx('span', { className: H.reportStepBadge, children: '1/4' }),
              s.jsx('h3', { children: '選擇物件' }),
            ],
          }),
          s.jsxs('div', {
            className: H.reportImportSection,
            children: [
              s.jsx('input', {
                type: 'file',
                ref: f,
                style: { display: 'none' },
                accept: 'image/*',
                onChange: G,
              }),
              s.jsxs('button', {
                className: H.reportImportBtn,
                onClick: w,
                children: [
                  s.jsx(wl, { size: 20 }),
                  s.jsx('span', { children: '匯入房仲頁面截圖' }),
                  s.jsx('small', { children: 'AI 自動識別物件資訊' }),
                ],
              }),
            ],
          }),
          s.jsx('div', {
            className: H.reportDivider,
            children: s.jsx('span', { children: '或從我的房源選擇' }),
          }),
          s.jsx('div', {
            className: H.reportListings,
            children: Aw.map((I) =>
              s.jsxs(
                'button',
                {
                  className: H.reportListingItem,
                  onClick: () => y(I),
                  children: [
                    s.jsx('div', {
                      className: H.reportListingThumb,
                      children: s.jsx(Qe, { size: 24 }),
                    }),
                    s.jsxs('div', {
                      className: H.reportListingInfo,
                      children: [
                        s.jsx('div', {
                          className: H.reportListingTitle,
                          children: I.title,
                        }),
                        s.jsxs('div', {
                          className: H.reportListingMeta,
                          children: [
                            s.jsxs('span', {
                              children: [s.jsx(tr, { size: 12 }), ' ', I.district],
                            }),
                            s.jsxs('span', {
                              children: [s.jsx(wn, { size: 12 }), ' ', g(I.price)],
                            }),
                          ],
                        }),
                      ],
                    }),
                    s.jsx(It, { size: 20, className: H.reportListingArrow }),
                  ],
                },
                I.id
              )
            ),
          }),
        ],
      }),
    _ = () =>
      s.jsxs('div', {
        className: H.reportStep,
        children: [
          s.jsxs('div', {
            className: H.reportStepHeader,
            children: [
              s.jsx('button', {
                className: H.reportBackBtn,
                onClick: () => r(1),
                children: s.jsx(Jr, { size: 20 }),
              }),
              s.jsx('span', { className: H.reportStepBadge, children: '2/4' }),
              s.jsx('h3', { children: '選擇報告樣式' }),
            ],
          }),
          s.jsxs('div', {
            className: H.reportSelectedProperty,
            children: [
              s.jsx(Qe, { size: 18 }),
              s.jsx('span', { children: n == null ? void 0 : n.title }),
            ],
          }),
          s.jsx('div', {
            className: H.reportStyles,
            children: Lw.map((I) =>
              s.jsxs(
                'button',
                {
                  className: `${H.reportStyleItem} ${i === I.id ? H.selected : ''}`,
                  onClick: () => p(I.id),
                  children: [
                    s.jsx('span', {
                      className: H.reportStyleIcon,
                      children: I.icon,
                    }),
                    s.jsxs('div', {
                      className: H.reportStyleInfo,
                      children: [
                        s.jsx('div', {
                          className: H.reportStyleTitle,
                          children: I.title,
                        }),
                        s.jsx('div', {
                          className: H.reportStyleDesc,
                          children: I.desc,
                        }),
                      ],
                    }),
                    i === I.id && s.jsx(ht, { size: 20, className: H.reportStyleCheck }),
                  ],
                },
                I.id
              )
            ),
          }),
        ],
      }),
    D = () =>
      s.jsxs('div', {
        className: H.reportStep,
        children: [
          s.jsxs('div', {
            className: H.reportStepHeader,
            children: [
              s.jsx('button', {
                className: H.reportBackBtn,
                onClick: () => r(2),
                children: s.jsx(Jr, { size: 20 }),
              }),
              s.jsx('span', { className: H.reportStepBadge, children: '3/4' }),
              s.jsx('h3', { children: '選擇 3 個亮點' }),
            ],
          }),
          s.jsx('p', {
            className: H.reportStepHint,
            children: '系統已為您分析此物件，請選擇最適合客戶的賣點',
          }),
          s.jsx('div', {
            className: H.reportHighlights,
            children: l.map((I) =>
              s.jsxs(
                'button',
                {
                  className: `${H.reportHighlightItem} ${I.selected ? H.selected : ''}`,
                  onClick: () => E(I.id),
                  children: [
                    s.jsx('span', {
                      className: H.reportHighlightIcon,
                      children: I.icon,
                    }),
                    s.jsxs('div', {
                      className: H.reportHighlightInfo,
                      children: [
                        s.jsx('div', {
                          className: H.reportHighlightTitle,
                          children: I.title,
                        }),
                        s.jsx('div', {
                          className: H.reportHighlightDesc,
                          children: I.description,
                        }),
                      ],
                    }),
                    s.jsx('div', {
                      className: H.reportHighlightCheck,
                      children: I.selected
                        ? s.jsx(ht, { size: 20 })
                        : s.jsx('div', {
                            className: H.reportHighlightUnchecked,
                          }),
                    }),
                  ],
                },
                I.id
              )
            ),
          }),
          s.jsxs('div', {
            className: H.reportStepFooter,
            children: [
              s.jsxs('span', {
                children: ['已選 ', l.filter((I) => I.selected).length, '/3'],
              }),
              s.jsxs('button', {
                className: H.reportNextBtn,
                onClick: S,
                children: ['下一步 ', s.jsx(It, { size: 18 })],
              }),
            ],
          }),
        ],
      }),
    V = () => {
      if (!n) return null;
      const I = l.filter((z) => z.selected),
        A = b(n.price);
      return s.jsxs('div', {
        className: H.reportStep,
        children: [
          s.jsxs('div', {
            className: H.reportStepHeader,
            children: [
              s.jsx('button', {
                className: H.reportBackBtn,
                onClick: () => r(3),
                children: s.jsx(Jr, { size: 20 }),
              }),
              s.jsx('span', { className: H.reportStepBadge, children: '4/4' }),
              s.jsx('h3', { children: '預覽報告' }),
            ],
          }),
          s.jsxs('div', {
            className: H.reportPhoneFrame,
            children: [
              s.jsx('div', { className: H.reportPhoneNotch }),
              s.jsxs('div', {
                className: H.reportPhoneContent,
                children: [
                  s.jsxs('div', {
                    className: H.reportPreviewHero,
                    children: [
                      s.jsx('div', {
                        className: H.reportPreviewHeroImg,
                        children: s.jsx(Qe, { size: 48 }),
                      }),
                      s.jsxs('div', {
                        className: H.reportPreviewHeroOverlay,
                        children: [
                          s.jsxs('div', {
                            className: H.reportPreviewPrice,
                            children: ['NT$ ', g(n.price)],
                          }),
                          s.jsx('div', {
                            className: H.reportPreviewTitle,
                            children: n.title,
                          }),
                        ],
                      }),
                    ],
                  }),
                  s.jsxs('div', {
                    className: H.reportPreviewSpecs,
                    children: [
                      s.jsxs('div', {
                        children: [s.jsx(ru, { size: 14 }), ' ', n.size, ' 坪'],
                      }),
                      s.jsxs('div', {
                        children: [s.jsx(nu, { size: 14 }), ' ', n.floor],
                      }),
                      s.jsxs('div', {
                        children: [s.jsx(as, { size: 14 }), ' ', n.age, ' 年'],
                      }),
                      s.jsxs('div', {
                        children: [s.jsx(au, { size: 14 }), ' ', n.direction],
                      }),
                    ],
                  }),
                  s.jsxs('div', {
                    className: H.reportPreviewMortgage,
                    children: [
                      s.jsx('div', {
                        className: H.reportPreviewMortgageLabel,
                        children: '貸款 8 成・30 年',
                      }),
                      s.jsxs('div', {
                        className: H.reportPreviewMortgageValue,
                        children: ['月付約 NT$ ', A.toLocaleString()],
                      }),
                    ],
                  }),
                  s.jsx('div', {
                    className: H.reportPreviewHighlights,
                    children: I.map((z) =>
                      s.jsxs(
                        'div',
                        {
                          className: H.reportPreviewHighlight,
                          children: [
                            s.jsx('span', { children: z.icon }),
                            s.jsxs('div', {
                              children: [
                                s.jsx('strong', { children: z.title }),
                                s.jsx('p', { children: z.description }),
                              ],
                            }),
                          ],
                        },
                        z.id
                      )
                    ),
                  }),
                  s.jsxs('div', {
                    className: H.reportPreviewAgent,
                    children: [
                      s.jsx('div', {
                        className: H.reportPreviewAgentAvatar,
                        children: '👤',
                      }),
                      s.jsxs('div', {
                        className: H.reportPreviewAgentInfo,
                        children: [
                          s.jsx('strong', { children: '您的專屬顧問' }),
                          s.jsx('span', { children: 'MaiHouses 邁房子' }),
                        ],
                      }),
                    ],
                  }),
                ],
              }),
            ],
          }),
          s.jsx('button', {
            className: H.reportGenerateBtn,
            onClick: N,
            disabled: u,
            children: u
              ? s.jsx(s.Fragment, { children: '⏳ 生成中...' })
              : s.jsxs(s.Fragment, {
                  children: [s.jsx(Nn, { size: 18 }), ' 生成報告'],
                }),
          }),
        ],
      });
    },
    se = () =>
      s.jsxs('div', {
        className: H.reportStep,
        children: [
          s.jsxs('div', {
            className: H.reportStepHeader,
            children: [
              s.jsx('span', { className: H.reportStepBadge, children: '✓' }),
              s.jsx('h3', { children: '報告已生成！' }),
            ],
          }),
          s.jsxs('div', {
            className: H.reportSuccess,
            children: [
              s.jsx('div', { className: H.reportSuccessIcon, children: '🎉' }),
              s.jsx('p', { children: '精美報告已準備好，快分享給客戶吧！' }),
            ],
          }),
          s.jsxs('div', {
            className: H.reportUrlBox,
            children: [
              s.jsx('input', {
                type: 'text',
                value: d,
                readOnly: !0,
                className: H.reportUrlInput,
              }),
              s.jsx('button', {
                className: H.reportUrlCopy,
                onClick: k,
                children: s.jsx(Xn, { size: 18 }),
              }),
            ],
          }),
          s.jsxs('div', {
            className: H.reportShareButtons,
            children: [
              s.jsxs('button', {
                className: H.reportShareBtnPrimary,
                onClick: k,
                children: [s.jsx(Xn, { size: 18 }), '複製連結'],
              }),
              s.jsxs('button', {
                className: H.reportShareBtnLine,
                onClick: T,
                children: [s.jsx($t, { size: 18 }), 'LINE 分享'],
              }),
            ],
          }),
          s.jsxs('button', {
            className: H.reportPreviewLink,
            onClick: () => window.open(d, '_blank'),
            children: [s.jsx(vn, { size: 16 }), '在新視窗預覽報告'],
          }),
          s.jsx('button', {
            className: H.reportResetBtn,
            onClick: C,
            children: '生成另一份報告',
          }),
        ],
      });
  return s.jsxs('section', {
    className: `${M['uag-card']} ${M['k-span-3']}`,
    children: [
      s.jsxs('div', {
        className: M['uag-card-header'],
        children: [
          s.jsxs('div', {
            children: [
              s.jsx('div', {
                className: M['uag-card-title'],
                children: '📱 手機報告生成器',
              }),
              s.jsx('div', {
                className: M['uag-card-sub'],
                children: '取代 Word 說明書・一鍵分享給客戶',
              }),
            ],
          }),
          t > 1 &&
            t < 5 &&
            s.jsxs('button', {
              className: `${M['uag-btn']} ${M.secondary}`,
              onClick: C,
              children: [s.jsx(is, { size: 14 }), ' 取消'],
            }),
        ],
      }),
      s.jsxs('div', {
        className: H.reportContainer,
        children: [t === 1 && j(), t === 2 && _(), t === 3 && D(), t === 4 && V(), t === 5 && se()],
      }),
    ],
  });
}
const el = [
    {
      id: 'TR-2024-001',
      buyerId: 'A103',
      buyerName: '買方 A103',
      propertyTitle: '惠宇上晴 12F',
      currentStep: 3,
      status: 'active',
      lastUpdate: Date.now() - 30 * 6e4,
      offerPrice: 315e5,
      events: [
        {
          id: 'e1',
          step: 1,
          stepName: 'M1 接洽',
          action: '初次接洽建立',
          actor: 'agent',
          timestamp: Date.now() - 2 * 864e5,
          hash: '9f2a...c8d1',
        },
        {
          id: 'e2',
          step: 2,
          stepName: 'M2 帶看',
          action: '帶看雙方到場',
          actor: 'buyer',
          timestamp: Date.now() - 1 * 864e5,
          hash: 'b7aa...f3e2',
          detail: 'GeoTag: 南屯社區大廳',
        },
        {
          id: 'e3',
          step: 3,
          stepName: 'M3 出價',
          action: '買方出價',
          actor: 'buyer',
          timestamp: Date.now() - 30 * 6e4,
          hash: '1a7c...92b4',
          detail: '出價 NT$31,500,000',
        },
      ],
    },
    {
      id: 'TR-2024-002',
      buyerId: 'B218',
      buyerName: '買方 B218',
      propertyTitle: '捷運共構 3房',
      currentStep: 2,
      status: 'active',
      lastUpdate: Date.now() - 2 * 36e5,
      events: [
        {
          id: 'e4',
          step: 1,
          stepName: 'M1 接洽',
          action: '初次接洽建立',
          actor: 'agent',
          timestamp: Date.now() - 3 * 864e5,
          hash: '3c5d...a7b9',
        },
        {
          id: 'e5',
          step: 2,
          stepName: 'M2 帶看',
          action: '預約帶看確認',
          actor: 'buyer',
          timestamp: Date.now() - 2 * 36e5,
          hash: 'd8e2...1f4c',
          detail: '預約 11/30 14:00',
        },
      ],
    },
    {
      id: 'TR-2024-003',
      buyerId: 'S901',
      buyerName: '買方 S901',
      propertyTitle: '高樓景觀宅',
      currentStep: 4,
      status: 'active',
      lastUpdate: Date.now() - 12 * 36e5,
      offerPrice: 288e5,
      events: [
        {
          id: 'e6',
          step: 1,
          stepName: 'M1 接洽',
          action: '初次接洽建立',
          actor: 'agent',
          timestamp: Date.now() - 7 * 864e5,
          hash: 'f1a2...b3c4',
        },
        {
          id: 'e7',
          step: 2,
          stepName: 'M2 帶看',
          action: '帶看完成',
          actor: 'buyer',
          timestamp: Date.now() - 5 * 864e5,
          hash: 'e5d6...c7f8',
        },
        {
          id: 'e8',
          step: 3,
          stepName: 'M3 出價',
          action: '議價中',
          actor: 'buyer',
          timestamp: Date.now() - 3 * 864e5,
          hash: 'a9b0...d1e2',
        },
        {
          id: 'e9',
          step: 4,
          stepName: 'M4 簽約',
          action: '合約審閱中',
          actor: 'agent',
          timestamp: Date.now() - 12 * 36e5,
          hash: 'c3d4...e5f6',
          detail: '等待買方確認',
        },
      ],
    },
  ],
  tl = [
    { key: 1, name: 'M1 接洽', icon: ns },
    { key: 2, name: 'M2 帶看', icon: sn },
    { key: 3, name: 'M3 出價', icon: wn },
    { key: 4, name: 'M4 簽約', icon: _n },
    { key: 5, name: 'M5 交屋', icon: Qe },
  ];
function Rw(e) {
  const t = new Date(e);
  return `${t.getMonth() + 1}/${t.getDate()} ${t.getHours().toString().padStart(2, '0')}:${t.getMinutes().toString().padStart(2, '0')}`;
}
function Mw(e) {
  const t = Date.now() - e;
  return t < 6e4
    ? '剛剛'
    : t < 36e5
      ? `${Math.floor(t / 6e4)} 分鐘前`
      : t < 864e5
        ? `${Math.floor(t / 36e5)} 小時前`
        : `${Math.floor(t / 864e5)} 天前`;
}
function Pw(e) {
  switch (e) {
    case 'active':
      return { text: '進行中', bg: '#dcfce7', color: '#16a34a' };
    case 'completed':
      return { text: '已完成', bg: '#dbeafe', color: '#2563eb' };
    case 'pending':
      return { text: '待處理', bg: '#fef3c7', color: '#d97706' };
    case 'expired':
      return { text: '已過期', bg: '#fee2e2', color: '#dc2626' };
  }
}
function zw() {
  const [e, t] = h.useState(!0),
    [r, n] = h.useState([]),
    [a, i] = h.useState(null),
    [o, l] = h.useState(!1),
    [c, d] = h.useState(!1),
    m = h.useCallback(async () => {
      l(!0);
      try {
        if (e) {
          (await new Promise((g) => setTimeout(g, 300)), n(el));
          const f = el[0];
          !a && f && i(f.id);
        } else {
          const f = await fetch('/api/trust/cases');
          if (f.ok) {
            const b = (await f.json()).cases || [];
            (n(b), b.length > 0 && !a && i(b[0].id));
          }
        }
      } catch (f) {
        console.error('Failed to load cases:', f);
      } finally {
        l(!1);
      }
    }, [e, a]);
  h.useEffect(() => {
    m();
  }, [m]);
  const u = r.find((f) => f.id === a),
    x = (u == null ? void 0 : u.events.slice(-3).reverse()) || [];
  return s.jsxs('section', {
    className: `${M['uag-card']} ${M['k-span-3']}`,
    children: [
      s.jsxs('div', {
        className: M['uag-card-header'],
        children: [
          s.jsxs('div', {
            children: [
              s.jsx('div', {
                className: M['uag-card-title'],
                children: '安心流程管理',
              }),
              s.jsxs('div', {
                className: M['uag-card-sub'],
                children: [
                  '五階段・交易留痕',
                  e &&
                    s.jsx('span', {
                      style: { marginLeft: 8, color: '#f59e0b', fontSize: 11 },
                      children: '● Mock',
                    }),
                ],
              }),
            ],
          }),
          s.jsxs('div', {
            className: M['uag-actions'],
            children: [
              s.jsxs('button', {
                className: M['uag-btn'],
                onClick: () => t(!e),
                title: e ? '切換到真實模式' : '切換到模擬模式',
                children: [s.jsx(Jn, { size: 14, style: { marginRight: 4 } }), e ? 'Mock' : 'Live'],
              }),
              s.jsx('button', {
                className: M['uag-btn'],
                onClick: m,
                disabled: o,
                children: s.jsx(bi, {
                  size: 14,
                  className: o ? 'animate-spin' : '',
                }),
              }),
            ],
          }),
        ],
      }),
      r.length > 0 &&
        s.jsxs('div', {
          style: { display: 'flex', gap: 8, flexWrap: 'wrap', marginBottom: 4 },
          children: [
            r.map((f) => {
              const g = f.id === a,
                b = Pw(f.status);
              return s.jsxs(
                'button',
                {
                  onClick: () => i(f.id),
                  style: {
                    padding: '8px 12px',
                    borderRadius: 8,
                    border: g ? '2px solid #1749d7' : '1px solid #e2e8f0',
                    background: g ? '#eef2ff' : '#fff',
                    cursor: 'pointer',
                    textAlign: 'left',
                    minWidth: 140,
                    transition: 'all 0.2s',
                  },
                  children: [
                    s.jsx('div', {
                      style: {
                        fontSize: 12,
                        fontWeight: 700,
                        color: g ? '#1749d7' : '#334155',
                        marginBottom: 2,
                      },
                      children: f.buyerName,
                    }),
                    s.jsx('div', {
                      style: {
                        fontSize: 11,
                        color: '#64748b',
                        marginBottom: 4,
                        whiteSpace: 'nowrap',
                        overflow: 'hidden',
                        textOverflow: 'ellipsis',
                        maxWidth: 120,
                      },
                      children: f.propertyTitle,
                    }),
                    s.jsxs('div', {
                      style: { display: 'flex', alignItems: 'center', gap: 6 },
                      children: [
                        s.jsxs('span', {
                          style: {
                            fontSize: 10,
                            padding: '2px 6px',
                            borderRadius: 4,
                            background: b.bg,
                            color: b.color,
                            fontWeight: 600,
                          },
                          children: ['M', f.currentStep],
                        }),
                        s.jsx('span', {
                          style: { fontSize: 10, color: '#94a3b8' },
                          children: Mw(f.lastUpdate),
                        }),
                      ],
                    }),
                  ],
                },
                f.id
              );
            }),
            s.jsx('button', {
              style: {
                padding: '8px 12px',
                borderRadius: 8,
                border: '1px dashed #cbd5e1',
                background: '#f8fafc',
                cursor: 'pointer',
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
                minWidth: 60,
                color: '#64748b',
              },
              onClick: () => {},
              children: s.jsx(fr, { size: 16 }),
            }),
          ],
        }),
      u &&
        s.jsx('div', {
          style: {
            display: 'flex',
            alignItems: 'center',
            gap: 0,
            marginBottom: 8,
          },
          children: tl.map((f, g) => {
            const b = f.key < u.currentStep,
              y = f.key === u.currentStep,
              p = f.icon;
            return s.jsxs(
              F.Fragment,
              {
                children: [
                  s.jsxs('div', {
                    style: { flex: 1, textAlign: 'center' },
                    children: [
                      s.jsx('div', {
                        style: {
                          width: 32,
                          height: 32,
                          borderRadius: '50%',
                          margin: '0 auto 4px',
                          display: 'flex',
                          alignItems: 'center',
                          justifyContent: 'center',
                          background: b ? '#16a34a' : y ? '#1749d7' : '#e5e7eb',
                          color: b || y ? '#fff' : '#6b7280',
                          transition: 'all 0.3s',
                        },
                        children: b ? s.jsx(wt, { size: 16 }) : s.jsx(p, { size: 14 }),
                      }),
                      s.jsx('div', {
                        style: {
                          fontSize: 11,
                          fontWeight: y ? 700 : 500,
                          color: b ? '#16a34a' : y ? '#1749d7' : '#94a3b8',
                        },
                        children: f.name,
                      }),
                    ],
                  }),
                  g < tl.length - 1 &&
                    s.jsx('div', {
                      style: {
                        flex: 0.5,
                        height: 2,
                        background: b ? '#16a34a' : '#e5e7eb',
                        marginBottom: 20,
                      },
                    }),
                ],
              },
              f.key
            );
          }),
        }),
      u &&
        s.jsxs('div', {
          style: { background: '#f8fafc', borderRadius: 8, overflow: 'hidden' },
          children: [
            s.jsxs('div', {
              style: {
                display: 'grid',
                gridTemplateColumns: '80px 1fr 80px',
                padding: '8px 12px',
                fontSize: 11,
                fontWeight: 600,
                color: '#64748b',
                background: '#f1f5f9',
                borderBottom: '1px solid #e2e8f0',
              },
              children: [
                s.jsx('div', { children: '時間' }),
                s.jsx('div', { children: '事件與參與者' }),
                s.jsx('div', { children: '留痕' }),
              ],
            }),
            x.map((f, g) => {
              const b = g === 0;
              return s.jsxs(
                'div',
                {
                  style: {
                    display: 'grid',
                    gridTemplateColumns: '80px 1fr 80px',
                    padding: '10px 12px',
                    borderBottom: g < x.length - 1 ? '1px solid #e2e8f0' : 'none',
                    background: b ? '#fefce8' : 'transparent',
                    alignItems: 'start',
                  },
                  children: [
                    s.jsx('div', {
                      style: { fontSize: 11, color: '#64748b' },
                      children: Rw(f.timestamp),
                    }),
                    s.jsxs('div', {
                      children: [
                        s.jsxs('div', {
                          style: { fontSize: 12, color: '#0f172a' },
                          children: [
                            s.jsxs('b', {
                              children: [f.stepName, ' ', f.action],
                            }),
                            s.jsxs('span', {
                              style: { color: '#64748b' },
                              children: [
                                '｜',
                                f.actor === 'agent'
                                  ? '房仲'
                                  : f.actor === 'buyer'
                                    ? '買方'
                                    : '系統',
                              ],
                            }),
                          ],
                        }),
                        f.detail &&
                          s.jsx('div', {
                            style: {
                              fontSize: 11,
                              color: '#64748b',
                              marginTop: 2,
                            },
                            children: f.detail,
                          }),
                      ],
                    }),
                    s.jsx('div', {
                      children:
                        f.hash &&
                        s.jsx('span', {
                          style: {
                            fontSize: 10,
                            padding: '3px 8px',
                            borderRadius: 4,
                            background: b ? '#fef3c7' : '#f1f5f9',
                            color: b ? '#92400e' : '#64748b',
                            border: b ? '1px solid #fcd34d' : '1px solid #e2e8f0',
                            fontFamily: 'monospace',
                          },
                          children: f.hash,
                        }),
                    }),
                  ],
                },
                f.id
              );
            }),
            u.events.length > 3 &&
              s.jsx('button', {
                onClick: () => d(!c),
                style: {
                  width: '100%',
                  padding: '8px',
                  fontSize: 11,
                  color: '#1749d7',
                  background: 'transparent',
                  border: 'none',
                  cursor: 'pointer',
                  fontWeight: 600,
                },
                children: c ? '收起' : `查看全部 ${u.events.length} 筆紀錄`,
              }),
          ],
        }),
      !u &&
        !o &&
        s.jsxs('div', {
          style: {
            textAlign: 'center',
            padding: '32px 16px',
            color: '#64748b',
          },
          children: [
            s.jsx(iu, {
              size: 32,
              style: { margin: '0 auto 8px', opacity: 0.5 },
            }),
            s.jsx('div', {
              style: { fontSize: 13, marginBottom: 8 },
              children: '目前沒有進行中的案件',
            }),
            s.jsxs('button', {
              className: `${M['uag-btn']} ${M.primary}`,
              children: [s.jsx(fr, { size: 14, style: { marginRight: 4 } }), '建立新案件'],
            }),
          ],
        }),
      o &&
        s.jsxs('div', {
          style: { textAlign: 'center', padding: '24px', color: '#64748b' },
          children: [
            s.jsx(bi, {
              size: 20,
              className: 'animate-spin',
              style: { margin: '0 auto 8px' },
            }),
            s.jsx('div', { style: { fontSize: 12 }, children: '載入中...' }),
          ],
        }),
      u &&
        s.jsxs('div', {
          style: {
            display: 'flex',
            gap: 8,
            paddingTop: 8,
            borderTop: '1px solid #e2e8f0',
          },
          children: [
            s.jsxs(We, {
              to: `/assure?case=${u.id}`,
              className: `${M['uag-btn']} ${M.primary}`,
              style: {
                flex: 1,
                textAlign: 'center',
                textDecoration: 'none',
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
                gap: 6,
              },
              children: ['進入 Trust Room', s.jsx(It, { size: 14 })],
            }),
            u.currentStep === 3 &&
              u.offerPrice &&
              s.jsxs('button', {
                className: M['uag-btn'],
                style: {
                  background: '#fef3c7',
                  borderColor: '#fcd34d',
                  color: '#92400e',
                },
                children: [s.jsx(wn, { size: 14, style: { marginRight: 4 } }), '回應出價'],
              }),
          ],
        }),
      r.length > 0 &&
        s.jsxs('div', {
          style: {
            display: 'grid',
            gridTemplateColumns: 'repeat(3, 1fr)',
            gap: 8,
            padding: '12px 0 0',
            borderTop: '1px solid #e2e8f0',
          },
          children: [
            s.jsxs('div', {
              style: { textAlign: 'center' },
              children: [
                s.jsx('div', {
                  style: { fontSize: 20, fontWeight: 700, color: '#1749d7' },
                  children: r.length,
                }),
                s.jsx('div', {
                  style: { fontSize: 11, color: '#64748b' },
                  children: '進行中案件',
                }),
              ],
            }),
            s.jsxs('div', {
              style: { textAlign: 'center' },
              children: [
                s.jsx('div', {
                  style: { fontSize: 20, fontWeight: 700, color: '#16a34a' },
                  children: r.filter((f) => f.currentStep >= 3).length,
                }),
                s.jsx('div', {
                  style: { fontSize: 11, color: '#64748b' },
                  children: '已出價',
                }),
              ],
            }),
            s.jsxs('div', {
              style: { textAlign: 'center' },
              children: [
                s.jsx('div', {
                  style: { fontSize: 20, fontWeight: 700, color: '#f59e0b' },
                  children: r.filter((f) => f.status === 'pending').length || 0,
                }),
                s.jsx('div', {
                  style: { fontSize: 11, color: '#64748b' },
                  children: '待處理',
                }),
              ],
            }),
          ],
        }),
    ],
  });
}
function Dw() {
  const { data: e, isLoading: t, buyLead: r, isBuying: n, useMock: a, toggleMode: i } = oj(),
    { selectedLead: o, selectLead: l, close: c } = dj(),
    d = h.useRef(null),
    m = async (u) => {
      !e || n || (r(u), c());
    };
  return t
    ? s.jsx(hj, {})
    : e
      ? s.jsxs('div', {
          className: M['uag-page'],
          children: [
            s.jsx(uj, {}),
            s.jsx('main', {
              className: M['uag-container'],
              children: s.jsxs('div', {
                className: M['uag-grid'],
                children: [
                  s.jsx(xj, { leads: e.leads, onSelectLead: l }),
                  s.jsx(gj, {
                    ref: d,
                    selectedLead: o,
                    onBuyLead: m,
                    isProcessing: n,
                  }),
                  s.jsx(yj, { leads: e.leads }),
                  s.jsx(vj, { listings: e.listings, feed: e.feed }),
                  s.jsx(Ow, { listings: e.listings }),
                  s.jsx(zw, {}),
                ],
              }),
            }),
            s.jsx(mj, { user: e.user, useMock: a, toggleMode: i }),
          ],
        })
      : null;
}
function Fw() {
  return s.jsx(Zu, {
    children: ({ reset: e }) =>
      s.jsx(V1, { onReset: e, FallbackComponent: fj, children: s.jsx(Dw, {}) }),
  });
}
const $w = (e) => {
    const t = Math.floor(e * 0.4),
      r = Math.floor(e * 0.3),
      n = Math.floor(e * 0.3);
    return [
      { label: '實名認證', value: t, icon: ht },
      { label: '回覆速度', value: r, icon: hr },
      { label: '成交記錄', value: n, icon: _n },
    ];
  },
  Uw = ({ isOpen: e, onClose: t, agentName: r }) => {
    const [n, a] = h.useState(null),
      [i, o] = h.useState(''),
      [l, c] = h.useState(!1),
      d = h.useMemo(() => {
        const u = [],
          x = ['日', '一', '二', '三', '四', '五', '六'];
        for (let f = 1; f <= 7; f++) {
          const g = new Date();
          g.setDate(g.getDate() + f);
          const b = `${g.getMonth() + 1}/${g.getDate()}`,
            y = x[g.getDay()] ?? '日',
            p =
              g.getDay() === 0 || g.getDay() === 6
                ? ['10:00', '11:00', '14:00', '15:00', '16:00']
                : ['14:00', '15:00', '19:00'];
          u.push({ date: b, day: y, times: p });
        }
        return u;
      }, []);
    if (!e) return null;
    const m = () => {
      !n ||
        !i ||
        (c(!0),
        setTimeout(() => {
          (t(), c(!1), a(null), o(''));
        }, 2e3));
    };
    return s.jsx('div', {
      className:
        'fixed inset-0 z-modal flex items-end justify-center bg-black/50 p-4 backdrop-blur-sm sm:items-center',
      children: s.jsxs('div', {
        className: 'max-h-[80vh] w-full max-w-md overflow-hidden rounded-2xl bg-white shadow-2xl',
        children: [
          s.jsx('div', {
            className: 'bg-gradient-to-r from-[#003366] to-[#00A8E8] p-4 text-white',
            children: s.jsxs('div', {
              className: 'flex items-center justify-between',
              children: [
                s.jsxs('div', {
                  children: [
                    s.jsx('h3', {
                      className: 'text-lg font-bold',
                      children: '預約看屋',
                    }),
                    s.jsxs('p', {
                      className: 'text-sm opacity-80',
                      children: ['選擇方便的時段，', r, ' 將為您安排'],
                    }),
                  ],
                }),
                s.jsx('button', {
                  onClick: t,
                  className: 'rounded-full p-1 transition-colors hover:bg-white/20',
                  children: s.jsx(is, { size: 20 }),
                }),
              ],
            }),
          }),
          l
            ? s.jsxs('div', {
                className: 'p-8 text-center',
                children: [
                  s.jsx('div', {
                    className:
                      'mx-auto mb-4 flex size-16 items-center justify-center rounded-full bg-green-100',
                    children: s.jsx(ht, {
                      className: 'text-green-500',
                      size: 32,
                    }),
                  }),
                  s.jsx('h4', {
                    className: 'mb-2 text-xl font-bold text-slate-800',
                    children: '預約成功！',
                  }),
                  s.jsx('p', {
                    className: 'text-slate-500',
                    children: '經紀人將盡快與您聯繫確認',
                  }),
                ],
              })
            : s.jsxs('div', {
                className: 'max-h-[60vh] overflow-y-auto p-4',
                children: [
                  s.jsx('div', {
                    className: 'mb-4 space-y-3',
                    children: d.slice(0, 4).map((u) =>
                      s.jsxs(
                        'div',
                        {
                          children: [
                            s.jsxs('div', {
                              className: 'mb-2 text-xs font-medium text-slate-500',
                              children: [u.date, ' (週', u.day, ')'],
                            }),
                            s.jsx('div', {
                              className: 'flex flex-wrap gap-2',
                              children: u.times.map((x) => {
                                const f = `${u.date}-${x}`,
                                  g = n === f;
                                return s.jsx(
                                  'button',
                                  {
                                    onClick: () => a(f),
                                    className: `rounded-lg px-3 py-1.5 text-sm font-medium transition-all ${g ? 'bg-[#003366] text-white' : 'bg-slate-100 text-slate-600 hover:bg-slate-200'}`,
                                    children: x,
                                  },
                                  f
                                );
                              }),
                            }),
                          ],
                        },
                        u.date
                      )
                    ),
                  }),
                  s.jsxs('div', {
                    className: 'mt-4',
                    children: [
                      s.jsx('label', {
                        htmlFor: 'booking-phone',
                        className: 'mb-1 block text-xs font-medium text-slate-600',
                        children: '您的手機號碼',
                      }),
                      s.jsx('input', {
                        id: 'booking-phone',
                        type: 'tel',
                        value: i,
                        onChange: (u) => o(u.target.value),
                        placeholder: '0912-345-678',
                        className:
                          'w-full rounded-xl border border-slate-200 p-3 outline-none focus:border-transparent focus:ring-2 focus:ring-[#003366]',
                      }),
                    ],
                  }),
                  s.jsxs('button', {
                    onClick: m,
                    disabled: !n || !i,
                    className: `mt-4 flex w-full items-center justify-center gap-2 rounded-xl py-3 font-bold transition-all ${n && i ? 'bg-[#003366] text-white hover:bg-[#004488]' : 'cursor-not-allowed bg-slate-100 text-slate-400'}`,
                    children: [s.jsx(as, { size: 18 }), '確認預約'],
                  }),
                ],
              }),
        ],
      }),
    });
  },
  Bw = ({ agent: e, onLineClick: t, onCallClick: r, onBookingClick: n }) => {
    const [a, i] = h.useState(!1),
      [o, l] = h.useState(!1),
      c = h.useMemo(() => e.internalCode % 10 > 3, [e.internalCode]),
      d = $w(e.trustScore),
      m = h.useMemo(
        () => ({
          responseTime: c ? '5 分鐘' : '2 小時',
          closureRate: Math.min(95, 60 + (e.trustScore % 30)),
          totalDeals: e.encouragementCount * 2 + 10,
          experience: Math.floor(e.trustScore / 25) + 1,
        }),
        [e.trustScore, e.encouragementCount, c]
      );
    return s.jsxs(s.Fragment, {
      children: [
        s.jsxs('div', {
          className: 'rounded-xl border border-slate-100 bg-white p-4 shadow-sm',
          children: [
            s.jsxs('div', {
              className: 'flex items-start gap-4',
              children: [
                s.jsxs('div', {
                  className: 'relative',
                  children: [
                    s.jsx('img', {
                      src: e.avatarUrl,
                      alt: e.name,
                      className:
                        'size-16 rounded-full border-2 border-white object-cover shadow-md',
                    }),
                    s.jsxs('div', {
                      className: `absolute -bottom-1 -right-1 ${c ? 'bg-green-500' : 'bg-slate-400'} flex items-center gap-0.5 rounded-full border border-white px-1.5 py-0.5 text-[10px] text-white`,
                      children: [
                        s.jsx('div', {
                          className: `size-1.5 rounded-full ${c ? 'animate-pulse bg-white' : 'bg-slate-300'}`,
                        }),
                        s.jsx('span', { children: c ? '在線' : '離線' }),
                      ],
                    }),
                  ],
                }),
                s.jsxs('div', {
                  className: 'min-w-0 flex-1',
                  children: [
                    s.jsx('div', {
                      className: 'flex items-start justify-between',
                      children: s.jsxs('div', {
                        children: [
                          s.jsxs('h3', {
                            className: 'flex items-center gap-2 text-lg font-bold text-slate-800',
                            children: [
                              e.name,
                              s.jsx('span', {
                                className:
                                  'rounded-full bg-slate-100 px-2 py-0.5 text-xs font-normal text-slate-500',
                                children: e.company,
                              }),
                            ],
                          }),
                          s.jsxs('div', {
                            className: 'mt-0.5 flex items-center gap-2',
                            children: [
                              s.jsxs('p', {
                                className: 'text-xs text-slate-400',
                                children: ['經紀人編號：#', e.internalCode],
                              }),
                              s.jsxs('div', {
                                className:
                                  'flex items-center gap-0.5 rounded bg-green-50 px-1.5 py-0.5 text-[10px] text-green-600',
                                children: [
                                  s.jsx(rn, { size: 10 }),
                                  s.jsx('span', { children: '已認證' }),
                                ],
                              }),
                            ],
                          }),
                        ],
                      }),
                    }),
                    s.jsxs('div', {
                      className: 'mt-3 flex items-center gap-4',
                      children: [
                        s.jsxs('div', {
                          className: 'relative flex cursor-pointer items-center gap-1.5',
                          role: 'button',
                          tabIndex: 0,
                          onMouseEnter: () => i(!0),
                          onMouseLeave: () => i(!1),
                          onFocus: () => i(!0),
                          onBlur: () => i(!1),
                          onKeyDown: (u) => {
                            (u.key === 'Enter' || u.key === ' ') && i(!a);
                          },
                          children: [
                            s.jsx('div', {
                              className:
                                'flex size-8 items-center justify-center rounded-lg bg-blue-50 text-[#003366]',
                              children: s.jsx(jn, {
                                size: 16,
                                fill: 'currentColor',
                              }),
                            }),
                            s.jsxs('div', {
                              children: [
                                s.jsx('div', {
                                  className: 'text-sm font-bold text-[#003366]',
                                  children: e.trustScore,
                                }),
                                s.jsx('div', {
                                  className: 'text-[10px] text-slate-500',
                                  children: '信任分',
                                }),
                              ],
                            }),
                            a &&
                              s.jsxs('div', {
                                className:
                                  'absolute bottom-full left-0 z-10 mb-2 w-48 rounded-lg bg-slate-800 p-3 text-xs text-white shadow-xl',
                                children: [
                                  s.jsx('div', {
                                    className: 'mb-2 font-bold',
                                    children: '信任分數構成',
                                  }),
                                  d.map((u) =>
                                    s.jsxs(
                                      'div',
                                      {
                                        className: 'flex items-center justify-between py-1',
                                        children: [
                                          s.jsxs('div', {
                                            className: 'flex items-center gap-1.5',
                                            children: [
                                              s.jsx(u.icon, {
                                                size: 12,
                                                className: 'text-green-400',
                                              }),
                                              s.jsx('span', {
                                                children: u.label,
                                              }),
                                            ],
                                          }),
                                          s.jsxs('span', {
                                            className: 'font-medium',
                                            children: ['+', u.value],
                                          }),
                                        ],
                                      },
                                      u.label
                                    )
                                  ),
                                  s.jsxs('div', {
                                    className:
                                      'mt-2 flex justify-between border-t border-slate-600 pt-2 font-bold',
                                    children: [
                                      s.jsx('span', { children: '總計' }),
                                      s.jsx('span', {
                                        className: 'text-green-400',
                                        children: e.trustScore,
                                      }),
                                    ],
                                  }),
                                  s.jsx('div', {
                                    className:
                                      'absolute left-4 top-full border-8 border-transparent border-t-slate-800',
                                  }),
                                ],
                              }),
                          ],
                        }),
                        s.jsx('div', { className: 'h-8 w-px bg-slate-100' }),
                        s.jsxs('div', {
                          className: 'flex items-center gap-1.5',
                          children: [
                            s.jsx('div', {
                              className:
                                'flex size-8 items-center justify-center rounded-lg bg-orange-50 text-orange-500',
                              children: s.jsx(ea, { size: 16 }),
                            }),
                            s.jsxs('div', {
                              children: [
                                s.jsx('div', {
                                  className: 'text-sm font-bold text-slate-800',
                                  children: e.encouragementCount,
                                }),
                                s.jsx('div', {
                                  className: 'text-[10px] text-slate-500',
                                  children: '獲得鼓勵',
                                }),
                              ],
                            }),
                          ],
                        }),
                      ],
                    }),
                    c &&
                      s.jsxs('div', {
                        className:
                          'mt-3 inline-flex items-center gap-1 rounded-lg bg-green-50 px-2 py-1 text-xs text-green-600',
                        children: [s.jsx(hr, { size: 12 }), '平均 ', m.responseTime, ' 內回覆'],
                      }),
                  ],
                }),
              ],
            }),
            s.jsxs('div', {
              className: 'mt-4 grid grid-cols-3 gap-2 border-y border-slate-100 py-3',
              children: [
                s.jsxs('div', {
                  className: 'text-center',
                  children: [
                    s.jsxs('div', {
                      className: 'text-lg font-bold text-[#003366]',
                      children: [m.closureRate, '%'],
                    }),
                    s.jsx('div', {
                      className: 'text-[10px] text-slate-500',
                      children: '成交率',
                    }),
                  ],
                }),
                s.jsxs('div', {
                  className: 'border-x border-slate-100 text-center',
                  children: [
                    s.jsx('div', {
                      className: 'text-lg font-bold text-slate-800',
                      children: m.totalDeals,
                    }),
                    s.jsx('div', {
                      className: 'text-[10px] text-slate-500',
                      children: '累積成交',
                    }),
                  ],
                }),
                s.jsxs('div', {
                  className: 'text-center',
                  children: [
                    s.jsxs('div', {
                      className: 'text-lg font-bold text-slate-800',
                      children: [m.experience, '年'],
                    }),
                    s.jsx('div', {
                      className: 'text-[10px] text-slate-500',
                      children: '服務經驗',
                    }),
                  ],
                }),
              ],
            }),
            s.jsxs('div', {
              className: 'mt-4 space-y-2 border-t border-slate-50 pt-3',
              children: [
                s.jsxs('button', {
                  onClick: t,
                  className:
                    'flex w-full items-center justify-center gap-2 rounded-lg bg-[#06C755] py-2.5 text-sm font-bold text-white shadow-sm transition-colors hover:bg-[#05B04A]',
                  children: [s.jsx($t, { size: 18 }), '加 LINE 聊聊'],
                }),
                s.jsxs('div', {
                  className: 'flex gap-2',
                  children: [
                    s.jsxs('button', {
                      onClick: () => (n ? n() : l(!0)),
                      className:
                        'flex flex-1 items-center justify-center gap-1.5 rounded-lg bg-[#003366] py-2 text-sm font-medium text-white transition-colors hover:bg-[#004488]',
                      children: [s.jsx(as, { size: 16 }), '預約看屋'],
                    }),
                    s.jsxs('button', {
                      onClick: r,
                      className:
                        'flex flex-1 items-center justify-center gap-1.5 rounded-lg border border-[#003366] bg-white py-2 text-sm font-medium text-[#003366] transition-colors hover:bg-blue-50',
                      children: [s.jsx(ns, { size: 16 }), '致電諮詢'],
                    }),
                  ],
                }),
              ],
            }),
          ],
        }),
        s.jsx(Uw, { isOpen: o, onClose: () => l(!1), agentName: e.name }),
      ],
    });
  };
async function Gw(e) {
  try {
    const { data: t, error: r } = await de.rpc('create_lead', {
      p_customer_name: e.customerName,
      p_customer_phone: e.customerPhone,
      p_customer_email: e.customerEmail || null,
      p_customer_line_id: e.customerLineId || null,
      p_agent_id: e.agentId,
      p_property_id: e.propertyId,
      p_source: e.source,
      p_budget_range: e.budgetRange || null,
      p_preferred_contact_time: e.preferredContactTime || null,
      p_needs_description: e.needsDescription || null,
    });
    return r
      ? (console.error('[LeadService] Create lead error:', r), { success: !1, error: r.message })
      : { success: !0, leadId: t };
  } catch (t) {
    const r = t instanceof Error ? t.message : '未知錯誤';
    return (console.error('[LeadService] Create lead exception:', t), { success: !1, error: r });
  }
}
const Hw = ({
    isOpen: e,
    onClose: t,
    propertyId: r,
    propertyTitle: n,
    agentId: a,
    agentName: i,
    source: o,
  }) => {
    const [l, c] = h.useState('form'),
      [d, m] = h.useState({
        name: '',
        phone: '',
        preferredChannel: 'line',
        preferredTime: '',
        budget: '',
        needs: '',
      });
    if (!e) return null;
    const u = async (b) => {
        if ((b.preventDefault(), !d.name.trim() || !d.phone.trim())) {
          W.error('請填寫姓名和電話');
          return;
        }
        c('submitting');
        try {
          const y = await Gw({
            customerName: d.name,
            customerPhone: d.phone,
            agentId: a,
            propertyId: r,
            source: o,
            ...(d.budget ? { budgetRange: d.budget } : {}),
            ...(d.preferredTime ? { preferredContactTime: d.preferredTime } : {}),
            ...(d.needs ? { needsDescription: d.needs } : {}),
          });
          y.success
            ? (c('success'),
              setTimeout(() => {
                (t(),
                  c('form'),
                  m({
                    name: '',
                    phone: '',
                    preferredChannel: 'line',
                    preferredTime: '',
                    budget: '',
                    needs: '',
                  }));
              }, 3e3))
            : (W.error('送出失敗', y.error || '請稍後再試'), c('form'));
        } catch {
          (W.error('系統錯誤，請稍後再試'), c('form'));
        }
      },
      x = [
        {
          value: 'line',
          label: 'LINE',
          icon: s.jsx($t, { size: 18, className: 'text-[#00c300]' }),
        },
        {
          value: 'phone',
          label: '電話',
          icon: s.jsx(ns, { size: 18, className: 'text-blue-600' }),
        },
        {
          value: 'message',
          label: '站內訊息',
          icon: s.jsx(ou, { size: 18, className: 'text-slate-600' }),
        },
      ],
      f = [
        '平日 09:00-12:00',
        '平日 14:00-18:00',
        '平日 19:00-21:00',
        '週末 10:00-12:00',
        '週末 14:00-18:00',
        '皆可',
      ],
      g = ['1000萬以下', '1000-2000萬', '2000-3000萬', '3000-5000萬', '5000萬以上', '尚未確定'];
    return s.jsx('div', {
      className:
        'fixed inset-0 z-modal flex items-center justify-center bg-black/50 p-4 backdrop-blur-sm',
      children: s.jsxs('div', {
        className: 'max-h-[90vh] w-full max-w-lg overflow-hidden rounded-2xl bg-white shadow-2xl',
        children: [
          s.jsxs('div', {
            className: 'bg-gradient-to-r from-[#003366] to-[#00A8E8] p-5 text-white',
            children: [
              s.jsxs('div', {
                className: 'flex items-start justify-between',
                children: [
                  s.jsxs('div', {
                    children: [
                      s.jsx('h3', {
                        className: 'text-xl font-bold',
                        children: '聯絡經紀人',
                      }),
                      s.jsxs('p', {
                        className: 'mt-1 text-sm opacity-90',
                        children: [
                          i,
                          ' 將在 ',
                          s.jsx('span', {
                            className: 'font-bold',
                            children: '10 分鐘內',
                          }),
                          ' 回覆您',
                        ],
                      }),
                    ],
                  }),
                  s.jsx('button', {
                    onClick: t,
                    className: 'rounded-full p-1.5 transition-colors hover:bg-white/20',
                    children: s.jsx(is, { size: 22 }),
                  }),
                ],
              }),
              s.jsxs('div', {
                className: 'mt-3 rounded-lg bg-white/10 px-3 py-2 text-sm',
                children: [
                  s.jsx('span', {
                    className: 'opacity-80',
                    children: '詢問物件：',
                  }),
                  s.jsx('span', { className: 'ml-1 font-medium', children: n }),
                ],
              }),
            ],
          }),
          s.jsx('div', {
            className: 'max-h-[60vh] overflow-y-auto p-5',
            children:
              l === 'success'
                ? s.jsxs('div', {
                    className: 'py-8 text-center',
                    children: [
                      s.jsx('div', {
                        className:
                          'mx-auto mb-4 flex size-16 items-center justify-center rounded-full bg-green-100',
                        children: s.jsx(ht, {
                          className: 'text-green-600',
                          size: 32,
                        }),
                      }),
                      s.jsx('h4', {
                        className: 'mb-2 text-xl font-bold text-slate-800',
                        children: '已建立安心留痕！',
                      }),
                      s.jsxs('p', {
                        className: 'mb-4 text-slate-600',
                        children: [
                          i,
                          ' 將在 ',
                          s.jsx('span', {
                            className: 'font-bold text-[#003366]',
                            children: '10 分鐘內',
                          }),
                          ' 與您聯繫',
                        ],
                      }),
                      s.jsxs('div', {
                        className: 'rounded-xl bg-blue-50 p-4 text-left text-sm',
                        children: [
                          s.jsx('p', {
                            className: 'mb-2 font-medium text-[#003366]',
                            children: '📋 您的諮詢紀錄已保存：',
                          }),
                          s.jsxs('ul', {
                            className: 'space-y-1 text-slate-600',
                            children: [
                              s.jsx('li', {
                                children: '✅ 首次聯繫時間已記錄',
                              }),
                              s.jsx('li', {
                                children: '✅ 經紀人回覆時間將被追蹤',
                              }),
                              s.jsx('li', {
                                children: '✅ 所有溝通承諾將留存備查',
                              }),
                            ],
                          }),
                        ],
                      }),
                    ],
                  })
                : l === 'submitting'
                  ? s.jsxs('div', {
                      className: 'py-12 text-center',
                      children: [
                        s.jsx(pr, {
                          className: 'mx-auto mb-4 animate-spin text-[#003366]',
                          size: 40,
                        }),
                        s.jsx('p', {
                          className: 'text-slate-600',
                          children: '建立諮詢紀錄中...',
                        }),
                      ],
                    })
                  : s.jsxs('form', {
                      onSubmit: u,
                      className: 'space-y-5',
                      children: [
                        s.jsxs('div', {
                          className: 'rounded-xl border border-amber-200 bg-amber-50 p-3',
                          children: [
                            s.jsxs('p', {
                              className:
                                'mb-2 flex items-center gap-1.5 text-sm font-bold text-amber-900',
                              children: [s.jsx(hr, { size: 14 }), '聯絡前須知'],
                            }),
                            s.jsxs('ul', {
                              className: 'space-y-1 text-xs text-amber-800',
                              children: [
                                s.jsxs('li', {
                                  className: 'flex items-center gap-1.5',
                                  children: [
                                    s.jsx(ht, {
                                      size: 12,
                                      className: 'shrink-0 text-green-600',
                                    }),
                                    '經紀人 ',
                                    i,
                                    ' 承諾 ',
                                    s.jsx('strong', { children: '10 分鐘內' }),
                                    ' 回應',
                                  ],
                                }),
                                s.jsxs('li', {
                                  className: 'flex items-center gap-1.5',
                                  children: [
                                    s.jsx(ht, {
                                      size: 12,
                                      className: 'shrink-0 text-green-600',
                                    }),
                                    '您的聯絡資訊受隱私保護，僅供本次諮詢使用',
                                  ],
                                }),
                                s.jsxs('li', {
                                  className: 'flex items-center gap-1.5',
                                  children: [
                                    s.jsx(ht, {
                                      size: 12,
                                      className: 'shrink-0 text-green-600',
                                    }),
                                    '可隨時取消後續聯絡，無任何義務',
                                  ],
                                }),
                              ],
                            }),
                          ],
                        }),
                        s.jsxs('div', {
                          className: 'grid grid-cols-2 gap-4',
                          children: [
                            s.jsxs('div', {
                              children: [
                                s.jsxs('label', {
                                  htmlFor: 'contact-name',
                                  className: 'mb-1.5 block text-sm font-medium text-slate-700',
                                  children: [
                                    '姓名 ',
                                    s.jsx('span', {
                                      className: 'text-red-500',
                                      children: '*',
                                    }),
                                  ],
                                }),
                                s.jsx('input', {
                                  id: 'contact-name',
                                  type: 'text',
                                  value: d.name,
                                  onChange: (b) => m({ ...d, name: b.target.value }),
                                  placeholder: '如何稱呼您',
                                  className:
                                    'w-full rounded-xl border border-slate-200 px-4 py-2.5 outline-none transition-all focus:border-[#003366] focus:ring-2 focus:ring-[#003366]/20',
                                  required: !0,
                                }),
                              ],
                            }),
                            s.jsxs('div', {
                              children: [
                                s.jsxs('label', {
                                  htmlFor: 'contact-phone',
                                  className: 'mb-1.5 block text-sm font-medium text-slate-700',
                                  children: [
                                    '電話 ',
                                    s.jsx('span', {
                                      className: 'text-red-500',
                                      children: '*',
                                    }),
                                  ],
                                }),
                                s.jsx('input', {
                                  id: 'contact-phone',
                                  type: 'tel',
                                  value: d.phone,
                                  onChange: (b) => m({ ...d, phone: b.target.value }),
                                  placeholder: '0912-345-678',
                                  className:
                                    'w-full rounded-xl border border-slate-200 px-4 py-2.5 outline-none transition-all focus:border-[#003366] focus:ring-2 focus:ring-[#003366]/20',
                                  required: !0,
                                }),
                              ],
                            }),
                          ],
                        }),
                        s.jsxs('div', {
                          role: 'group',
                          'aria-labelledby': 'preferred-channel-label',
                          children: [
                            s.jsx('span', {
                              id: 'preferred-channel-label',
                              className: 'mb-2 block text-sm font-medium text-slate-700',
                              children: '偏好聯絡方式',
                            }),
                            s.jsx('div', {
                              className: 'flex gap-2',
                              children: x.map((b) =>
                                s.jsxs(
                                  'button',
                                  {
                                    type: 'button',
                                    onClick: () => m({ ...d, preferredChannel: b.value }),
                                    className: `flex flex-1 items-center justify-center gap-2 rounded-xl border-2 py-2.5 transition-all ${d.preferredChannel === b.value ? 'border-[#003366] bg-blue-50 text-[#003366]' : 'border-slate-200 text-slate-600 hover:border-slate-300'}`,
                                    children: [
                                      b.icon,
                                      s.jsx('span', {
                                        className: 'text-sm font-medium',
                                        children: b.label,
                                      }),
                                    ],
                                  },
                                  b.value
                                )
                              ),
                            }),
                          ],
                        }),
                        s.jsxs('div', {
                          role: 'group',
                          'aria-labelledby': 'preferred-time-label',
                          children: [
                            s.jsxs('span', {
                              id: 'preferred-time-label',
                              className: 'mb-2 block text-sm font-medium text-slate-700',
                              children: [
                                s.jsx(hr, {
                                  size: 14,
                                  className: 'mr-1 inline',
                                }),
                                '方便聯絡時段',
                              ],
                            }),
                            s.jsx('div', {
                              className: 'grid grid-cols-3 gap-2',
                              children: f.map((b) =>
                                s.jsx(
                                  'button',
                                  {
                                    type: 'button',
                                    onClick: () => m({ ...d, preferredTime: b }),
                                    className: `rounded-lg px-3 py-2 text-xs font-medium transition-all ${d.preferredTime === b ? 'bg-[#003366] text-white' : 'bg-slate-100 text-slate-600 hover:bg-slate-200'}`,
                                    children: b,
                                  },
                                  b
                                )
                              ),
                            }),
                          ],
                        }),
                        s.jsxs('div', {
                          children: [
                            s.jsx('label', {
                              htmlFor: 'contact-budget',
                              className: 'mb-2 block text-sm font-medium text-slate-700',
                              children: '購屋預算區間',
                            }),
                            s.jsxs('select', {
                              id: 'contact-budget',
                              value: d.budget,
                              onChange: (b) => m({ ...d, budget: b.target.value }),
                              className:
                                'w-full rounded-xl border border-slate-200 bg-white px-4 py-2.5 outline-none transition-all focus:border-[#003366] focus:ring-2 focus:ring-[#003366]/20',
                              children: [
                                s.jsx('option', {
                                  value: '',
                                  children: '請選擇',
                                }),
                                g.map((b) => s.jsx('option', { value: b, children: b }, b)),
                              ],
                            }),
                          ],
                        }),
                        s.jsxs('div', {
                          children: [
                            s.jsx('label', {
                              htmlFor: 'contact-needs',
                              className: 'mb-1.5 block text-sm font-medium text-slate-700',
                              children: '其他需求或問題',
                            }),
                            s.jsx('textarea', {
                              id: 'contact-needs',
                              value: d.needs,
                              onChange: (b) => m({ ...d, needs: b.target.value }),
                              placeholder: '例如：想了解學區、需要停車位、希望近捷運...',
                              rows: 3,
                              className:
                                'w-full resize-none rounded-xl border border-slate-200 px-4 py-2.5 outline-none transition-all focus:border-[#003366] focus:ring-2 focus:ring-[#003366]/20',
                            }),
                          ],
                        }),
                        s.jsxs('div', {
                          className:
                            'flex items-start gap-3 rounded-xl border border-green-100 bg-green-50 p-3',
                          children: [
                            s.jsx('div', {
                              className:
                                'flex size-8 shrink-0 items-center justify-center rounded-full bg-green-100',
                              children: s.jsx(ht, {
                                size: 16,
                                className: 'text-green-600',
                              }),
                            }),
                            s.jsxs('div', {
                              className: 'text-xs text-green-800',
                              children: [
                                s.jsx('p', {
                                  className: 'mb-1 font-medium',
                                  children: '🛡️ 安心留痕保障',
                                }),
                                s.jsx('p', {
                                  children:
                                    '您的諮詢將被完整記錄，經紀人的每一次回覆和承諾都會留存，保障您的權益。',
                                }),
                              ],
                            }),
                          ],
                        }),
                        s.jsxs('button', {
                          type: 'submit',
                          className:
                            'flex w-full items-center justify-center gap-2 rounded-xl bg-[#003366] py-3.5 font-bold text-white shadow-lg shadow-blue-900/20 transition-colors hover:bg-[#004488]',
                          children: [s.jsx(as, { size: 18 }), '送出諮詢，建立安心留痕'],
                        }),
                      ],
                    }),
          }),
        ],
      }),
    });
  },
  Nd = [
    {
      id: 'commute',
      icon: '🚇',
      title: '通勤便利',
      subtitle: '近捷運/公車站',
      description: '步行可達大眾運輸，通勤方便',
    },
    {
      id: 'school',
      icon: '🎓',
      title: '優質學區',
      subtitle: '明星學區內',
      description: '位於優質學區，子女就學方便',
    },
    {
      id: 'community',
      icon: '🏠',
      title: '社區單純',
      subtitle: '住戶素質佳',
      description: '社區管理良好，住戶組成單純',
    },
    {
      id: 'view',
      icon: '🌅',
      title: '景觀優美',
      subtitle: '高樓層視野',
      description: '樓層高，採光佳，景觀開闊',
    },
    {
      id: 'amenity',
      icon: '🛒',
      title: '生活機能',
      subtitle: '商圈近便',
      description: '周邊生活機能完善，購物方便',
    },
    {
      id: 'parking',
      icon: '🅿️',
      title: '車位充足',
      subtitle: '含車位',
      description: '附設車位，停車無煩惱',
    },
    {
      id: 'renovated',
      icon: '✨',
      title: '精裝入住',
      subtitle: '裝潢完善',
      description: '屋況良好，可直接入住',
    },
  ],
  Ww = {
    simple: {
      id: 'simple',
      name: '簡潔說明書',
      description: '適合一般買家，清楚呈現基本資訊',
      icon: '📋',
    },
    investment: {
      id: 'investment',
      name: '投資分析版',
      description: '適合投資客，詳細呈現投報數據',
      icon: '📊',
    },
    marketing: {
      id: 'marketing',
      name: '行銷文案版',
      description: '適合首購族，故事感強的呈現',
      icon: '✨',
    },
  },
  sl = {
    id: 'demo',
    publicId: 'MH-100001',
    title: '信義區101景觀全新裝潢大三房',
    price: 3680,
    address: '台北市信義區松仁路100號',
    description: '絕佳地段，近捷運象山站，生活機能完善，採光通風佳。',
    images: [
      'https://images.unsplash.com/photo-1600607687939-ce8a6c25118c?w=800',
      'https://images.unsplash.com/photo-1600566753190-17f0baa2a6c3?w=800',
      'https://images.unsplash.com/photo-1600585154340-be6161a56a0c?w=800',
      'https://images.unsplash.com/photo-1600573472592-401b489a3cdc?w=800',
    ],
    size: 45.2,
    age: 8,
    rooms: 3,
    halls: 2,
    bathrooms: 2,
    floorCurrent: '12',
    floorTotal: 15,
    propertyType: '大樓',
    direction: '朝南',
    parking: '平面車位',
    communityName: '信義之星',
    communityYear: 2016,
    communityUnits: 420,
    managementFee: 80,
    advantage1: '採光超棒，全日照無遮蔽',
    advantage2: '管委會運作良好，公設維護佳',
    disadvantage: '西曬需加裝窗簾',
    agent: {
      id: 'agent-1',
      name: '王小明',
      avatarUrl: 'https://images.unsplash.com/photo-1560250097-0b93528c311a?w=200',
      company: '邁房子信義店',
      phone: '0912-345-678',
      lineId: '@maihouses',
      trustScore: 92,
      reviewCount: 156,
      experience: 10,
    },
  };
function Vw(e, t = 0.8, r = 30, n = 0.02) {
  const a = e * 1e4 * t,
    i = n / 12,
    o = r * 12,
    l = (a * (i * Math.pow(1 + i, o))) / (Math.pow(1 + i, o) - 1);
  return Math.round(l);
}
function Zw() {
  var y;
  const { id: e } = Er(),
    [t] = Tr(),
    [r, n] = h.useState(sl),
    [a, i] = h.useState(0),
    [o, l] = h.useState(0),
    [c, d] = h.useState(!0),
    m = t.get('aid'),
    u = t.get('src') || 'direct',
    x = ((y = t.get('h')) == null ? void 0 : y.split(',')) || ['commute', 'school', 'community'];
  h.useEffect(() => {
    const p = async () => {
        try {
          await fetch('/api/report/track', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              reportId: e,
              agentId: m,
              source: u,
              userAgent: navigator.userAgent,
            }),
          });
        } catch (S) {
          console.log('Track failed:', S);
        }
      },
      E = async () => {
        d(!0);
        try {
          (await new Promise((S) => setTimeout(S, 300)),
            n(sl),
            l(Math.floor(Math.random() * 20) + 5));
        } catch (S) {
          console.error('Load report failed:', S);
        } finally {
          d(!1);
        }
      };
    (p(), E());
  }, [e, m, u]);
  const f = Nd.filter((p) => x.includes(p.id)),
    g = Vw(r.price),
    b = async () => {
      const p = window.location.href,
        E = `${r.title} - NT$${r.price}萬`;
      if (navigator.share)
        try {
          await navigator.share({ title: E, url: p });
        } catch {
          console.log('Share cancelled');
        }
      else
        (await navigator.clipboard.writeText(p),
          W.success('連結已複製', '已複製報告連結，可直接分享'));
    };
  return c
    ? s.jsx('div', {
        className: 'flex min-h-screen items-center justify-center bg-slate-50',
        children: s.jsxs('div', {
          className: 'text-center',
          children: [
            s.jsx('div', {
              className:
                'mx-auto mb-4 size-12 animate-spin rounded-full border-4 border-blue-600 border-t-transparent',
            }),
            s.jsx('p', {
              className: 'text-slate-500',
              children: '載入報告中...',
            }),
          ],
        }),
      })
    : s.jsxs('div', {
        className: 'min-h-screen bg-slate-50',
        children: [
          s.jsx('section', {
            className: 'relative',
            children: s.jsxs('div', {
              className: 'aspect-[4/3] overflow-hidden bg-slate-200',
              children: [
                s.jsx('img', {
                  src: r.images[a],
                  alt: r.title,
                  className: 'size-full object-cover',
                }),
                r.images.length > 1 &&
                  s.jsxs(s.Fragment, {
                    children: [
                      s.jsx('button', {
                        onClick: () => i((p) => (p > 0 ? p - 1 : r.images.length - 1)),
                        className:
                          'absolute left-2 top-1/2 flex size-10 -translate-y-1/2 items-center justify-center rounded-full bg-black/30 text-white transition hover:bg-black/50',
                        children: s.jsx(Jr, { size: 24 }),
                      }),
                      s.jsx('button', {
                        onClick: () => i((p) => (p < r.images.length - 1 ? p + 1 : 0)),
                        className:
                          'absolute right-2 top-1/2 flex size-10 -translate-y-1/2 items-center justify-center rounded-full bg-black/30 text-white transition hover:bg-black/50',
                        children: s.jsx(It, { size: 24 }),
                      }),
                      s.jsx('div', {
                        className: 'absolute bottom-4 left-1/2 flex -translate-x-1/2 gap-1.5',
                        children: r.images.map((p, E) =>
                          s.jsx(
                            'button',
                            {
                              onClick: () => i(E),
                              className: `size-2 rounded-full transition ${E === a ? 'bg-white' : 'bg-white/50'}`,
                            },
                            E
                          )
                        ),
                      }),
                    ],
                  }),
                s.jsxs('div', {
                  className:
                    'absolute right-4 top-4 flex items-center gap-1.5 rounded-full bg-white/90 px-3 py-1.5 text-sm font-bold text-[#003366] backdrop-blur',
                  children: [s.jsx(Qe, { size: 14 }), '邁房子'],
                }),
              ],
            }),
          }),
          s.jsxs('section', {
            className: 'border-b border-slate-100 bg-white px-4 py-5',
            children: [
              s.jsxs('div', {
                className: 'mb-1 text-3xl font-black text-[#003366]',
                children: ['NT$ ', r.price.toLocaleString(), ' 萬'],
              }),
              s.jsx('h1', {
                className: 'mb-2 text-lg font-bold text-slate-800',
                children: r.title,
              }),
              s.jsxs('div', {
                className: 'flex items-center text-sm text-slate-500',
                children: [s.jsx(tr, { size: 14, className: 'mr-1' }), r.address],
              }),
            ],
          }),
          s.jsx('section', {
            className: 'border-b border-slate-100 bg-white p-4',
            children: s.jsxs('div', {
              className: 'grid grid-cols-3 gap-3 text-center',
              children: [
                s.jsxs('div', {
                  className: 'rounded-xl bg-slate-50 py-3',
                  children: [
                    s.jsxs('div', {
                      className: 'text-lg font-bold text-slate-800',
                      children: [r.rooms, '房', r.halls, '廳', r.bathrooms, '衛'],
                    }),
                    s.jsx('div', {
                      className: 'text-xs text-slate-500',
                      children: '格局',
                    }),
                  ],
                }),
                s.jsxs('div', {
                  className: 'rounded-xl bg-slate-50 py-3',
                  children: [
                    s.jsxs('div', {
                      className: 'text-lg font-bold text-slate-800',
                      children: [r.size, ' 坪'],
                    }),
                    s.jsx('div', {
                      className: 'text-xs text-slate-500',
                      children: '權狀坪數',
                    }),
                  ],
                }),
                s.jsxs('div', {
                  className: 'rounded-xl bg-slate-50 py-3',
                  children: [
                    s.jsxs('div', {
                      className: 'text-lg font-bold text-slate-800',
                      children: [r.age, ' 年'],
                    }),
                    s.jsx('div', {
                      className: 'text-xs text-slate-500',
                      children: '屋齡',
                    }),
                  ],
                }),
                s.jsxs('div', {
                  className: 'rounded-xl bg-slate-50 py-3',
                  children: [
                    s.jsxs('div', {
                      className: 'text-lg font-bold text-slate-800',
                      children: [r.floorCurrent, '/', r.floorTotal, 'F'],
                    }),
                    s.jsx('div', {
                      className: 'text-xs text-slate-500',
                      children: '樓層',
                    }),
                  ],
                }),
                s.jsxs('div', {
                  className: 'rounded-xl bg-slate-50 py-3',
                  children: [
                    s.jsx('div', {
                      className: 'text-lg font-bold text-slate-800',
                      children: r.direction,
                    }),
                    s.jsx('div', {
                      className: 'text-xs text-slate-500',
                      children: '座向',
                    }),
                  ],
                }),
                s.jsxs('div', {
                  className: 'rounded-xl bg-slate-50 py-3',
                  children: [
                    s.jsx('div', {
                      className: 'text-lg font-bold text-slate-800',
                      children: r.parking || '無',
                    }),
                    s.jsx('div', {
                      className: 'text-xs text-slate-500',
                      children: '車位',
                    }),
                  ],
                }),
              ],
            }),
          }),
          s.jsxs('section', {
            className: 'border-b border-slate-100 bg-white p-4',
            children: [
              s.jsx('h2', {
                className: 'mb-3 flex items-center gap-2 text-sm font-bold text-slate-800',
                children: '💰 月付試算',
              }),
              s.jsxs('div', {
                className:
                  'rounded-xl border border-blue-100 bg-gradient-to-r from-blue-50 to-cyan-50 p-4',
                children: [
                  s.jsxs('div', {
                    className: 'mb-2 flex items-center justify-between',
                    children: [
                      s.jsx('span', {
                        className: 'text-sm text-slate-600',
                        children: '貸款 8 成・30 年期',
                      }),
                      s.jsx('span', {
                        className: 'text-xs text-slate-400',
                        children: '利率 2%',
                      }),
                    ],
                  }),
                  s.jsxs('div', {
                    className: 'text-2xl font-black text-[#003366]',
                    children: ['月付約 NT$ ', g.toLocaleString()],
                  }),
                ],
              }),
            ],
          }),
          s.jsxs('section', {
            className: 'border-b border-slate-100 bg-white p-4',
            children: [
              s.jsx('h2', {
                className: 'mb-3 flex items-center gap-2 text-sm font-bold text-slate-800',
                children: '⭐ 為您精選的亮點',
              }),
              s.jsx('div', {
                className: 'space-y-3',
                children: f.map((p) =>
                  s.jsxs(
                    'div',
                    {
                      className: 'flex items-start gap-3 rounded-xl bg-slate-50 p-3',
                      children: [
                        s.jsx('span', {
                          className: 'text-2xl',
                          children: p.icon,
                        }),
                        s.jsxs('div', {
                          children: [
                            s.jsx('div', {
                              className: 'font-bold text-slate-800',
                              children: p.title,
                            }),
                            s.jsx('div', {
                              className: 'text-sm text-slate-500',
                              children: p.description,
                            }),
                          ],
                        }),
                      ],
                    },
                    p.id
                  )
                ),
              }),
            ],
          }),
          r.communityName &&
            s.jsxs('section', {
              className: 'border-b border-slate-100 bg-white p-4',
              children: [
                s.jsx('h2', {
                  className: 'mb-3 flex items-center gap-2 text-sm font-bold text-slate-800',
                  children: '🏢 社區資訊',
                }),
                s.jsxs('div', {
                  className: 'space-y-2 rounded-xl bg-slate-50 p-4',
                  children: [
                    s.jsxs('div', {
                      className: 'flex justify-between',
                      children: [
                        s.jsx('span', {
                          className: 'text-slate-500',
                          children: '社區名稱',
                        }),
                        s.jsx('span', {
                          className: 'font-medium text-slate-800',
                          children: r.communityName,
                        }),
                      ],
                    }),
                    s.jsxs('div', {
                      className: 'flex justify-between',
                      children: [
                        s.jsx('span', {
                          className: 'text-slate-500',
                          children: '完工年份',
                        }),
                        s.jsxs('span', {
                          className: 'font-medium text-slate-800',
                          children: [r.communityYear, ' 年'],
                        }),
                      ],
                    }),
                    s.jsxs('div', {
                      className: 'flex justify-between',
                      children: [
                        s.jsx('span', {
                          className: 'text-slate-500',
                          children: '總戶數',
                        }),
                        s.jsxs('span', {
                          className: 'font-medium text-slate-800',
                          children: [r.communityUnits, ' 戶'],
                        }),
                      ],
                    }),
                    s.jsxs('div', {
                      className: 'flex justify-between',
                      children: [
                        s.jsx('span', {
                          className: 'text-slate-500',
                          children: '管理費',
                        }),
                        s.jsxs('span', {
                          className: 'font-medium text-slate-800',
                          children: [r.managementFee, ' 元/坪'],
                        }),
                      ],
                    }),
                  ],
                }),
              ],
            }),
          r.images.length > 1 &&
            s.jsxs('section', {
              className: 'border-b border-slate-100 bg-white p-4',
              children: [
                s.jsx('h2', {
                  className: 'mb-3 flex items-center gap-2 text-sm font-bold text-slate-800',
                  children: '📸 更多照片',
                }),
                s.jsx('div', {
                  className: 'grid grid-cols-3 gap-2',
                  children: r.images.slice(0, 6).map((p, E) =>
                    s.jsx(
                      'button',
                      {
                        onClick: () => i(E),
                        className: 'aspect-square overflow-hidden rounded-lg bg-slate-100',
                        children: s.jsx('img', {
                          src: p,
                          alt: '',
                          className: 'size-full object-cover',
                        }),
                      },
                      E
                    )
                  ),
                }),
              ],
            }),
          s.jsxs('section', {
            className: 'border-b border-slate-100 bg-white px-4 py-5',
            children: [
              s.jsx('h2', {
                className: 'mb-4 flex items-center gap-2 text-sm font-bold text-slate-800',
                children: '👤 您的專屬顧問',
              }),
              s.jsxs('div', {
                className: 'mb-4 flex items-center gap-4',
                children: [
                  s.jsx('img', {
                    src: r.agent.avatarUrl,
                    alt: r.agent.name,
                    className: 'size-16 rounded-full border-2 border-slate-100 object-cover',
                  }),
                  s.jsxs('div', {
                    className: 'flex-1',
                    children: [
                      s.jsx('div', {
                        className: 'text-lg font-bold text-slate-800',
                        children: r.agent.name,
                      }),
                      s.jsx('div', {
                        className: 'text-sm text-slate-500',
                        children: r.agent.company,
                      }),
                      s.jsxs('div', {
                        className: 'mt-1 flex items-center gap-2',
                        children: [
                          s.jsxs('span', {
                            className: 'text-sm text-amber-500',
                            children: ['⭐ ', (r.agent.trustScore / 20).toFixed(1)],
                          }),
                          s.jsxs('span', {
                            className: 'text-xs text-slate-400',
                            children: ['(', r.agent.reviewCount, ' 則評價)'],
                          }),
                          r.agent.experience &&
                            s.jsxs('span', {
                              className: 'text-xs text-slate-400',
                              children: ['・', r.agent.experience, '年經驗'],
                            }),
                        ],
                      }),
                    ],
                  }),
                ],
              }),
              s.jsxs('div', {
                className: 'space-y-3',
                children: [
                  s.jsxs('a', {
                    href: `tel:${r.agent.phone}`,
                    className:
                      'flex w-full items-center justify-center gap-2 rounded-xl bg-[#003366] py-3.5 font-bold text-white transition hover:bg-[#002244]',
                    children: [s.jsx(ns, { size: 18 }), '立即撥打 ', r.agent.phone],
                  }),
                  s.jsxs('a', {
                    href: `https://line.me/R/ti/p/${r.agent.lineId}`,
                    className:
                      'flex w-full items-center justify-center gap-2 rounded-xl bg-[#06C755] py-3.5 font-bold text-white transition hover:bg-[#05a847]',
                    children: [s.jsx($t, { size: 18 }), 'LINE 諮詢'],
                  }),
                  s.jsxs('button', {
                    className:
                      'flex w-full items-center justify-center gap-2 rounded-xl border-2 border-slate-200 py-3.5 font-bold text-slate-700 transition hover:border-slate-300',
                    children: [s.jsx(as, { size: 18 }), '預約看屋'],
                  }),
                ],
              }),
            ],
          }),
          s.jsxs('section', {
            className: 'bg-slate-100 px-4 py-6 text-center',
            children: [
              s.jsxs('div', {
                className: 'mb-2 flex items-center justify-center gap-2 font-bold text-[#003366]',
                children: [s.jsx(Qe, { size: 18 }), 'MaiHouses 邁房子'],
              }),
              s.jsx('div', {
                className: 'mb-3 text-sm text-slate-500',
                children: '讓家，不只是地址',
              }),
              o > 0 &&
                s.jsxs('div', {
                  className: 'mb-2 text-xs text-slate-400',
                  children: ['📊 此報告已被瀏覽 ', o, ' 次'],
                }),
              s.jsxs('div', {
                className: 'text-xs text-slate-400',
                children: ['報告生成：', new Date().toLocaleDateString('zh-TW')],
              }),
              s.jsxs('button', {
                onClick: b,
                className:
                  'mt-4 inline-flex items-center gap-2 rounded-full border border-slate-200 bg-white px-4 py-2 text-sm text-slate-600 transition hover:bg-slate-50',
                children: [s.jsx(Oa, { size: 14 }), '分享此報告'],
              }),
              s.jsxs('a', {
                href: `/maihouses/property/${r.publicId}?aid=${m || ''}&src=report`,
                className:
                  'mt-3 flex items-center justify-center gap-1 text-sm text-[#003366] hover:underline',
                children: ['查看完整物件詳情', s.jsx(vn, { size: 14 })],
              }),
            ],
          }),
        ],
      });
}
function Yw({ property: e, isOpen: t, onClose: r }) {
  const [n, a] = h.useState('style'),
    [i, o] = h.useState('simple'),
    [l, c] = h.useState(['commute', 'school', 'community']),
    [d, m] = h.useState([0, 1, 2, 3]),
    [u, x] = h.useState(''),
    [f, g] = h.useState(!1),
    [b, y] = h.useState(null),
    p = h.useMemo(
      () => `這是「${e.title}」的物件報告，我幫您整理了幾個重點，有空可以看看 🙂`,
      [e.title]
    ),
    E = () => {
      const j = window.location.origin,
        _ = new URLSearchParams({
          aid: e.agent.id,
          src: 'line_share',
          h: l.join(','),
          s: i,
        });
      return `${j}/maihouses/r/${e.publicId}?${_.toString()}`;
    },
    S = (j) => {
      c((_) =>
        _.includes(j) ? _.filter((D) => D !== j) : _.length >= 3 ? [..._.slice(1), j] : [..._, j]
      );
    },
    N = (j) => {
      m((_) =>
        _.includes(j) ? _.filter((D) => D !== j) : _.length >= 5 ? [..._.slice(1), j] : [..._, j]
      );
    },
    k = async () => {
      g(!0);
      try {
        await new Promise((_) => setTimeout(_, 800));
        const j = E();
        (y(j), a('preview'));
      } catch {
        W.error('生成失敗，請稍後再試');
      } finally {
        g(!1);
      }
    },
    T = async () => {
      if (b)
        try {
          (await navigator.clipboard.writeText(b), W.success('連結已複製！'));
        } catch {
          W.error('複製失敗');
        }
    },
    C = () => {
      const j = u || p,
        _ = encodeURIComponent(b || ''),
        D = encodeURIComponent(j);
      window.open(`https://line.me/R/msg/text/?${D}%0A${_}`, '_blank');
    },
    w = async () => {
      if (!navigator.share || !b) {
        T();
        return;
      }
      try {
        await navigator.share({ title: e.title, text: u || p, url: b });
      } catch {}
    },
    G = () => {
      (a('style'), y(null), r());
    };
  return t
    ? s.jsxs('div', {
        className: 'fixed inset-0 z-modal flex items-end justify-center sm:items-center',
        children: [
          s.jsx('div', {
            className: 'absolute inset-0 bg-black/50 backdrop-blur-sm',
            onClick: G,
          }),
          s.jsxs('div', {
            className:
              'relative flex max-h-[90vh] w-full max-w-lg flex-col overflow-hidden rounded-t-3xl bg-white sm:rounded-2xl',
            children: [
              s.jsxs('div', {
                className: 'flex items-center justify-between border-b border-slate-100 px-5 py-4',
                children: [
                  s.jsx('h2', {
                    className: 'text-lg font-bold text-slate-800',
                    children: '生成物件報告',
                  }),
                  s.jsx('button', {
                    onClick: G,
                    className: 'rounded-full p-2 transition hover:bg-slate-100',
                    children: s.jsx(is, {
                      size: 20,
                      className: 'text-slate-500',
                    }),
                  }),
                ],
              }),
              s.jsx('div', {
                className: 'border-b border-slate-100 bg-slate-50 px-5 py-3',
                children: s.jsx('div', {
                  className: 'flex items-center gap-2 text-sm',
                  children: ['style', 'highlights', 'photos', 'preview'].map((j, _) =>
                    s.jsxs(
                      F.Fragment,
                      {
                        children: [
                          s.jsxs('div', {
                            className: `flex items-center gap-1.5 ${n === j ? 'font-bold text-[#003366]' : 'text-slate-400'}`,
                            children: [
                              s.jsx('div', {
                                className: `flex size-6 items-center justify-center rounded-full text-xs font-bold ${n === j ? 'bg-[#003366] text-white' : ['style', 'highlights', 'photos', 'preview'].indexOf(n) > _ ? 'bg-green-500 text-white' : 'bg-slate-200'}`,
                                children:
                                  ['style', 'highlights', 'photos', 'preview'].indexOf(n) > _
                                    ? s.jsx(wt, { size: 14 })
                                    : _ + 1,
                              }),
                              s.jsxs('span', {
                                className: 'hidden sm:inline',
                                children: [
                                  j === 'style' && '選樣式',
                                  j === 'highlights' && '選亮點',
                                  j === 'photos' && '選照片',
                                  j === 'preview' && '完成',
                                ],
                              }),
                            ],
                          }),
                          _ < 3 &&
                            s.jsx(It, {
                              size: 16,
                              className: 'text-slate-300',
                            }),
                        ],
                      },
                      j
                    )
                  ),
                }),
              }),
              s.jsxs('div', {
                className: 'flex-1 overflow-y-auto p-5',
                children: [
                  n === 'style' &&
                    s.jsxs('div', {
                      className: 'space-y-4',
                      children: [
                        s.jsx('div', {
                          className: 'mb-4 text-sm text-slate-500',
                          children: '選擇最適合這位客戶的報告樣式',
                        }),
                        Object.values(Ww).map((j) =>
                          s.jsx(
                            'button',
                            {
                              onClick: () => o(j.id),
                              className: `w-full rounded-xl border-2 p-4 text-left transition ${i === j.id ? 'border-[#003366] bg-blue-50' : 'border-slate-200 hover:border-slate-300'}`,
                              children: s.jsxs('div', {
                                className: 'flex items-start gap-3',
                                children: [
                                  s.jsx('span', {
                                    className: 'text-2xl',
                                    children: j.icon,
                                  }),
                                  s.jsxs('div', {
                                    className: 'flex-1',
                                    children: [
                                      s.jsx('div', {
                                        className: 'font-bold text-slate-800',
                                        children: j.name,
                                      }),
                                      s.jsx('div', {
                                        className: 'text-sm text-slate-500',
                                        children: j.description,
                                      }),
                                    ],
                                  }),
                                  i === j.id &&
                                    s.jsx('div', {
                                      className:
                                        'flex size-6 items-center justify-center rounded-full bg-[#003366]',
                                      children: s.jsx(wt, {
                                        size: 14,
                                        className: 'text-white',
                                      }),
                                    }),
                                ],
                              }),
                            },
                            j.id
                          )
                        ),
                      ],
                    }),
                  n === 'highlights' &&
                    s.jsxs('div', {
                      className: 'space-y-4',
                      children: [
                        s.jsxs('div', {
                          className: 'mb-4 text-sm text-slate-500',
                          children: ['選擇 3 個最能打動客戶的亮點（已選 ', l.length, '/3）'],
                        }),
                        Nd.map((j) =>
                          s.jsx(
                            'button',
                            {
                              onClick: () => S(j.id),
                              className: `w-full rounded-xl border-2 p-3 text-left transition ${l.includes(j.id) ? 'border-[#003366] bg-blue-50' : 'border-slate-200 hover:border-slate-300'}`,
                              children: s.jsxs('div', {
                                className: 'flex items-center gap-3',
                                children: [
                                  s.jsx('span', {
                                    className: 'text-xl',
                                    children: j.icon,
                                  }),
                                  s.jsxs('div', {
                                    className: 'flex-1',
                                    children: [
                                      s.jsx('div', {
                                        className: 'font-bold text-slate-800',
                                        children: j.title,
                                      }),
                                      s.jsx('div', {
                                        className: 'text-xs text-slate-500',
                                        children: j.subtitle,
                                      }),
                                    ],
                                  }),
                                  l.includes(j.id) &&
                                    s.jsx('div', {
                                      className:
                                        'flex size-6 items-center justify-center rounded-full bg-[#003366]',
                                      children: s.jsx(wt, {
                                        size: 14,
                                        className: 'text-white',
                                      }),
                                    }),
                                ],
                              }),
                            },
                            j.id
                          )
                        ),
                      ],
                    }),
                  n === 'photos' &&
                    s.jsxs('div', {
                      className: 'space-y-4',
                      children: [
                        s.jsxs('div', {
                          className: 'mb-4 text-sm text-slate-500',
                          children: ['選擇要放入報告的照片（已選 ', d.length, '/5）'],
                        }),
                        s.jsx('div', {
                          className: 'grid grid-cols-3 gap-2',
                          children: e.images.map((j, _) =>
                            s.jsxs(
                              'button',
                              {
                                onClick: () => N(_),
                                className: `relative aspect-square overflow-hidden rounded-lg border-2 transition ${d.includes(_) ? 'border-[#003366] ring-2 ring-[#003366]/20' : 'border-transparent'}`,
                                children: [
                                  s.jsx('img', {
                                    src: j,
                                    alt: '',
                                    className: 'size-full object-cover',
                                  }),
                                  d.includes(_) &&
                                    s.jsx('div', {
                                      className:
                                        'absolute right-1 top-1 flex size-5 items-center justify-center rounded-full bg-[#003366]',
                                      children: s.jsx(wt, {
                                        size: 12,
                                        className: 'text-white',
                                      }),
                                    }),
                                ],
                              },
                              _
                            )
                          ),
                        }),
                      ],
                    }),
                  n === 'preview' &&
                    b &&
                    s.jsxs('div', {
                      className: 'space-y-5',
                      children: [
                        s.jsxs('div', {
                          className: 'py-4 text-center',
                          children: [
                            s.jsx('div', {
                              className:
                                'mx-auto mb-3 flex size-16 items-center justify-center rounded-full bg-green-100',
                              children: s.jsx(wt, {
                                size: 32,
                                className: 'text-green-600',
                              }),
                            }),
                            s.jsx('h3', {
                              className: 'text-lg font-bold text-slate-800',
                              children: '報告已生成！',
                            }),
                            s.jsx('p', {
                              className: 'mt-1 text-sm text-slate-500',
                              children: '選擇分享方式發送給客戶',
                            }),
                          ],
                        }),
                        s.jsxs('div', {
                          className: 'rounded-xl bg-slate-50 p-3',
                          children: [
                            s.jsxs('div', {
                              className: 'mb-2 flex items-center gap-2 text-sm text-slate-600',
                              children: [s.jsx(lu, { size: 14 }), '報告連結'],
                            }),
                            s.jsx('div', {
                              className:
                                'break-all rounded-lg border border-slate-200 bg-white p-2 text-xs text-slate-500',
                              children: b,
                            }),
                          ],
                        }),
                        s.jsxs('div', {
                          children: [
                            s.jsx('label', {
                              htmlFor: 'share-message',
                              className: 'mb-2 block text-sm text-slate-600',
                              children: '分享訊息（可編輯）',
                            }),
                            s.jsx('textarea', {
                              id: 'share-message',
                              value: u || p,
                              onChange: (j) => x(j.target.value),
                              className:
                                'w-full resize-none rounded-xl border border-slate-200 p-3 text-sm focus:border-[#003366] focus:outline-none focus:ring-2 focus:ring-[#003366]/20',
                              rows: 3,
                            }),
                          ],
                        }),
                        s.jsxs('div', {
                          className: 'space-y-3',
                          children: [
                            s.jsxs('button', {
                              onClick: T,
                              className:
                                'flex w-full items-center justify-center gap-2 rounded-xl bg-[#003366] py-3 font-bold text-white transition hover:bg-[#002244]',
                              children: [s.jsx(Xn, { size: 18 }), '複製連結'],
                            }),
                            s.jsxs('button', {
                              onClick: C,
                              className:
                                'flex w-full items-center justify-center gap-2 rounded-xl bg-[#06C755] py-3 font-bold text-white transition hover:bg-[#05a847]',
                              children: [
                                s.jsx('svg', {
                                  viewBox: '0 0 24 24',
                                  className: 'size-5 fill-current',
                                  children: s.jsx('path', {
                                    d: 'M19.365 9.863c.349 0 .63.285.63.631 0 .345-.281.63-.63.63H17.61v1.125h1.755c.349 0 .63.283.63.63 0 .344-.281.629-.63.629h-2.386c-.345 0-.627-.285-.627-.629V8.108c0-.345.282-.63.63-.63h2.386c.346 0 .627.285.627.63 0 .349-.281.63-.63.63H17.61v1.125h1.755zm-3.855 3.016c0 .27-.174.51-.432.596-.064.021-.133.031-.199.031-.211 0-.391-.09-.51-.25l-2.443-3.317v2.94c0 .344-.279.629-.631.629-.346 0-.626-.285-.626-.629V8.108c0-.27.173-.51.43-.595.06-.023.136-.033.194-.033.195 0 .375.104.495.254l2.462 3.33V8.108c0-.345.282-.63.63-.63.345 0 .63.285.63.63v4.771zm-5.741 0c0 .344-.282.629-.631.629-.345 0-.627-.285-.627-.629V8.108c0-.345.282-.63.63-.63.346 0 .628.285.628.63v4.771zm-2.466.629H4.917c-.345 0-.63-.285-.63-.629V8.108c0-.345.285-.63.63-.63.348 0 .63.285.63.63v4.141h1.756c.348 0 .629.283.629.63 0 .344-.282.629-.629.629M24 10.314C24 4.943 18.615.572 12 .572S0 4.943 0 10.314c0 4.811 4.27 8.842 10.035 9.608.391.082.923.258 1.058.59.12.301.079.766.038 1.08l-.164 1.02c-.045.301-.24 1.186 1.049.645 1.291-.539 6.916-4.078 9.436-6.975C23.176 14.393 24 12.458 24 10.314',
                                  }),
                                }),
                                'LINE 分享',
                              ],
                            }),
                            s.jsxs('button', {
                              onClick: w,
                              className:
                                'flex w-full items-center justify-center gap-2 rounded-xl border-2 border-slate-200 py-3 font-bold text-slate-700 transition hover:border-slate-300',
                              children: [s.jsx(Oa, { size: 18 }), '其他分享方式'],
                            }),
                          ],
                        }),
                        s.jsxs('a', {
                          href: b,
                          target: '_blank',
                          rel: 'noopener noreferrer',
                          className:
                            'flex items-center justify-center gap-2 text-sm text-[#003366] hover:underline',
                          children: [s.jsx(_n, { size: 14 }), '預覽報告頁面'],
                        }),
                      ],
                    }),
                ],
              }),
              n !== 'preview' &&
                s.jsxs('div', {
                  className: 'flex gap-3 border-t border-slate-100 px-5 py-4',
                  children: [
                    n !== 'style' &&
                      s.jsx('button', {
                        onClick: () => {
                          const j = ['style', 'highlights', 'photos', 'preview'],
                            _ = j.indexOf(n);
                          if (_ > 0) {
                            const D = j[_ - 1];
                            D && a(D);
                          }
                        },
                        className:
                          'flex-1 rounded-xl border-2 border-slate-200 py-3 font-bold text-slate-700 transition hover:border-slate-300',
                        children: '上一步',
                      }),
                    s.jsx('button', {
                      onClick: () => {
                        n === 'style'
                          ? a('highlights')
                          : n === 'highlights'
                            ? a('photos')
                            : n === 'photos' && k();
                      },
                      disabled: f || (n === 'highlights' && l.length === 0),
                      className:
                        'flex flex-1 items-center justify-center gap-2 rounded-xl bg-[#003366] py-3 font-bold text-white transition hover:bg-[#002244] disabled:bg-slate-300',
                      children: f
                        ? s.jsxs(s.Fragment, {
                            children: [
                              s.jsx('div', {
                                className:
                                  'size-5 animate-spin rounded-full border-2 border-white border-t-transparent',
                              }),
                              '生成中...',
                            ],
                          })
                        : n === 'photos'
                          ? '生成報告'
                          : s.jsxs(s.Fragment, {
                              children: ['下一步', s.jsx(It, { size: 18 })],
                            }),
                    }),
                  ],
                }),
            ],
          }),
        ],
      })
    : null;
}
const qw = (e) => e.trim().replace(/\s+/g, ' '),
  Kr = (e) => typeof e == 'string' && e.trim().length > 0;
function Kw(e, t) {
  const r = (e == null ? void 0 : e.trim()) || '';
  if (r) {
    if (/高樓層|高樓/.test(r)) return '高樓層';
    if (/低樓層|低樓/.test(r)) return '低樓層';
  }
  const n = parseInt(r, 10);
  if (!isNaN(n) && typeof t == 'number' && t > 0) {
    const a = n / t;
    if (a >= 0.7) return '高樓層';
    if (a <= 0.3 && t >= 4) return '低樓層';
  }
  return null;
}
function Qw(e, t) {
  if (!t) return;
  const r = qw(t);
  r && (e.includes(r) || e.push(r));
}
function Jw(e) {
  return typeof e != 'number' || !Number.isFinite(e) || e <= 0
    ? null
    : `${Number(e).toFixed(1)} 坪`;
}
function Xw(e, t) {
  const r = typeof e == 'number' && Number.isFinite(e) && e > 0 ? e : null,
    n = typeof t == 'number' && Number.isFinite(t) && t > 0 ? t : null;
  return r ? `${r} 房${n ? ` ${n} 廳` : ''}` : null;
}
function eN(e, t) {
  const r = (e == null ? void 0 : e.trim()) || '';
  if (!r) return null;
  const n = r.replace(/^(\d+)\s*[Ff]$/, '$1'),
    a = /^\d+$/.test(n) ? `${n} 樓` : n,
    i = t && t > 0 ? `${t} 層` : null;
  return i ? `${a} / ${i}` : a;
}
function _d(e) {
  const t = [],
    r = [];
  if (
    (Kr(e.advantage1) && r.push(e.advantage1),
    Kr(e.advantage2) && r.push(e.advantage2),
    Array.isArray(e.features))
  )
    for (const n of e.features) Kr(n) && r.push(n);
  r.push(Kw(e.floorCurrent, e.floorTotal) ?? '');
  for (const n of r) {
    if (t.length >= 2) break;
    Kr(n) && Qw(t, n);
  }
  return t.slice(0, 4);
}
const tN = (e, t, r, n) => {
    const [a] = h.useState(() => Date.now()),
      i = h.useRef({
        click_photos: 0,
        click_line: 0,
        click_call: 0,
        scroll_depth: 0,
      }),
      o = h.useRef(!1),
      l = h.useRef('F'),
      c = h.useCallback(() => {
        let u = localStorage.getItem('uag_session');
        return (
          u ||
            ((u = `u_${Math.random().toString(36).substring(2, 11)}`),
            localStorage.setItem('uag_session', u)),
          u
        );
      }, []),
      d = h.useCallback(
        (u) => ({
          session_id: c(),
          agent_id: t,
          fingerprint: btoa(
            JSON.stringify({
              screen: `${screen.width}x${screen.height}`,
              timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
              language: navigator.language,
            })
          ),
          event: {
            type: u,
            property_id: e,
            district: r || 'unknown',
            duration: Math.round((Date.now() - a) / 1e3),
            actions: { ...i.current },
            focus: [],
          },
        }),
        [e, t, r, c, a]
      ),
      m = h.useCallback(
        async (u, x = !1) => {
          const f = d(u);
          if (x || u === 'page_exit') {
            const g = new Blob([JSON.stringify(f)], {
              type: 'application/json',
            });
            navigator.sendBeacon('/api/uag-track', g);
            return;
          }
          try {
            const b = await (
              await fetch('/api/uag-track', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(f),
                keepalive: !0,
              })
            ).json();
            if (b.success && b.grade) {
              const y = { S: 5, A: 4, B: 3, C: 2, F: 1 },
                p = y[b.grade] || 1,
                E = y[l.current] || 1;
              p > E && ((l.current = b.grade), b.grade === 'S' && n && n('S', b.reason));
            }
          } catch {
            const b = new Blob([JSON.stringify(f)], {
              type: 'application/json',
            });
            navigator.sendBeacon('/api/uag-track', b);
          }
        },
        [d, n]
      );
    return (
      h.useEffect(() => {
        const u = () => {
          const x = Math.round(
            ((window.scrollY + window.innerHeight) / document.body.scrollHeight) * 100
          );
          x > i.current.scroll_depth && (i.current.scroll_depth = x);
        };
        return (
          window.addEventListener('scroll', u, { passive: !0 }),
          () => window.removeEventListener('scroll', u)
        );
      }, []),
      h.useEffect(() => {
        if (!e) return;
        m('page_view', !0);
        const u = () => {
          o.current || ((o.current = !0), m('page_exit', !0));
        };
        return (
          window.addEventListener('pagehide', u),
          window.addEventListener('visibilitychange', () => {
            document.visibilityState === 'hidden' && u();
          }),
          () => {
            (window.removeEventListener('pagehide', u), u());
          }
        );
      }, [e, m]),
      {
        trackPhotoClick: () => {
          i.current.click_photos++;
        },
        trackLineClick: () => {
          ((i.current.click_line = 1), m('click_line'));
        },
        trackCallClick: () => {
          ((i.current.click_call = 1), m('click_call'));
        },
      }
    );
  },
  sN = () => {
    var D, V, se;
    const { id: e } = Er(),
      [t] = Tr(),
      [r, n] = h.useState(!1),
      a = !1,
      [i, o] = h.useState(0),
      [l, c] = h.useState(!1),
      [d, m] = h.useState('sidebar'),
      [u, x] = h.useState(!1),
      [f, g] = h.useState(''),
      [b, y] = h.useState(!1),
      [p, E] = h.useState(be),
      S = () => {
        let I = t.get('aid');
        return (
          I || (I = localStorage.getItem('uag_last_aid')),
          I && I !== 'unknown' && localStorage.setItem('uag_last_aid', I),
          I || 'unknown'
        );
      },
      N = h.useCallback((I, A) => {
        I === 'S' && (A && g(A), setTimeout(() => x(!0), 500));
      }, []),
      k = (I) => {
        const A = I.match(/[市縣](.{2,3}[區鄉鎮市])/);
        return (A == null ? void 0 : A[1]) ?? 'unknown';
      },
      T = tN(e || '', S(), k(p.address), N),
      C = (I) => {
        (m(I), c(!0), I === 'mobile_bar' ? T.trackLineClick() : T.trackCallClick());
      },
      w = h.useMemo(() => {
        var A;
        const I = ((A = p.publicId) == null ? void 0 : A.charCodeAt(3)) || 0;
        return {
          currentViewers: Math.floor(I % 5) + 2,
          weeklyBookings: Math.floor(I % 8) + 5,
          isHot: I % 3 === 0,
        };
      }, [p.publicId]),
      G = h.useMemo(
        () =>
          _d({
            advantage1: p.advantage1,
            advantage2: p.advantage2,
            features: p.features,
            floorCurrent: p.floorCurrent,
            floorTotal: p.floorTotal,
            size: p.size,
            rooms: p.rooms,
            halls: p.halls,
          }).slice(0, 4),
        [
          p.advantage1,
          p.advantage2,
          p.features,
          p.floorCurrent,
          p.floorTotal,
          p.size,
          p.rooms,
          p.halls,
        ]
      );
    h.useEffect(() => {
      (async () => {
        if (e)
          try {
            const A = await pn.getPropertyByPublicId(e);
            A && E(A);
          } catch (A) {
            console.error('Fetch error:', A);
          }
      })();
    }, [e]);
    const j =
      'https://images.unsplash.com/photo-1600607687939-ce8a6c25118c?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80';
    let _ = p.images && p.images.length > 0 && p.images[0] ? p.images[0] : j;
    return (
      _ && _.includes('picsum') && (_ = j),
      s.jsxs('div', {
        className: 'min-h-screen bg-[#f8fafc] font-sans text-slate-800',
        children: [
          s.jsxs('nav', {
            className:
              'sticky top-0 z-overlay flex h-16 items-center justify-between border-b border-slate-100 bg-white/90 px-4 shadow-sm backdrop-blur-md',
            children: [
              s.jsxs('div', {
                className: 'flex items-center gap-3',
                children: [
                  s.jsx('button', {
                    className: 'rounded-full p-2 transition-colors hover:bg-slate-100',
                    children: s.jsx(Ma, {
                      size: 20,
                      className: 'text-slate-600',
                    }),
                  }),
                  s.jsxs('div', {
                    className: 'flex items-center gap-2 text-xl font-extrabold text-[#003366]',
                    children: [
                      s.jsx('div', {
                        className:
                          'flex size-8 items-center justify-center rounded-lg bg-gradient-to-br from-[#003366] to-[#00A8E8] text-white',
                        children: s.jsx(Qe, { size: 18 }),
                      }),
                      '邁房子',
                    ],
                  }),
                ],
              }),
              s.jsxs('div', {
                className:
                  'flex items-center rounded-lg border border-slate-200 bg-slate-50 px-3 py-1.5 font-mono text-xs text-slate-500',
                children: [
                  s.jsx(cu, { size: 12, className: 'mr-1 text-gray-400' }),
                  '編號：',
                  s.jsx('span', {
                    className: 'ml-1 font-bold text-[#003366]',
                    children: p.publicId,
                  }),
                ],
              }),
            ],
          }),
          s.jsxs('main', {
            className: 'mx-auto max-w-4xl p-4 pb-24',
            children: [
              s.jsxs('div', {
                className: 'mb-4',
                children: [
                  s.jsxs('div', {
                    className:
                      'group relative aspect-video overflow-hidden rounded-2xl bg-slate-200',
                    children: [
                      s.jsx('img', {
                        src: ((D = p.images) == null ? void 0 : D[i]) || _,
                        alt: p.title,
                        onError: (I) => {
                          I.currentTarget.src !== j && (I.currentTarget.src = j);
                        },
                        className:
                          'size-full object-cover transition-transform duration-700 group-hover:scale-105',
                      }),
                      s.jsxs('div', {
                        className:
                          'absolute bottom-4 right-4 flex items-center gap-1 rounded-full bg-black/50 px-3 py-1.5 text-xs text-white backdrop-blur-md',
                        children: [
                          s.jsx(Qe, { size: 12 }),
                          s.jsxs('span', {
                            children: [
                              i + 1,
                              ' / ',
                              ((V = p.images) == null ? void 0 : V.length) || 1,
                            ],
                          }),
                        ],
                      }),
                    ],
                  }),
                  p.images &&
                    p.images.length > 1 &&
                    s.jsx('div', {
                      className: 'scrollbar-hide -mx-4 mt-3 flex gap-2 overflow-x-auto px-4 pb-2',
                      children: p.images.map((I, A) =>
                        s.jsx(
                          'button',
                          {
                            onClick: () => {
                              (o(A), T.trackPhotoClick());
                            },
                            className: `h-14 w-20 shrink-0 overflow-hidden rounded-lg border-2 transition-all ${A === i ? 'border-[#003366] ring-2 ring-[#003366]/20' : 'border-transparent opacity-70 hover:opacity-100'}`,
                            children: s.jsx('img', {
                              src: I,
                              alt: `照片 ${A + 1}`,
                              onError: (z) => {
                                z.currentTarget.src = j;
                              },
                              className: 'size-full object-cover',
                            }),
                          },
                          A
                        )
                      ),
                    }),
                ],
              }),
              s.jsx('div', {
                className: 'mb-6 lg:hidden',
                children: s.jsxs('div', {
                  className: 'rounded-2xl border border-slate-100 bg-white p-4 shadow-lg',
                  children: [
                    s.jsxs('div', {
                      className: 'flex gap-3',
                      children: [
                        s.jsxs('button', {
                          onClick: () => C('mobile_bar'),
                          className:
                            'flex flex-1 items-center justify-center gap-2 rounded-xl bg-[#003366] py-4 text-base font-bold text-white shadow-lg',
                          children: [s.jsx(ns, { size: 20 }), '立即聯絡經紀人'],
                        }),
                        s.jsx('button', {
                          onClick: () => C('mobile_bar'),
                          className:
                            'flex w-14 items-center justify-center rounded-xl bg-[#06C755] text-white shadow-lg',
                          children: s.jsx($t, { size: 22 }),
                        }),
                      ],
                    }),
                    s.jsxs('p', {
                      className: 'mt-2 text-center text-xs text-slate-500',
                      children: ['🔥 本物件 ', w.weeklyBookings, ' 組預約中，把握機會！'],
                    }),
                  ],
                }),
              }),
              s.jsxs('div', {
                className: 'grid grid-cols-1 gap-8 lg:grid-cols-3',
                children: [
                  s.jsxs('div', {
                    className: 'space-y-6 lg:col-span-2',
                    children: [
                      s.jsxs('div', {
                        children: [
                          s.jsxs('div', {
                            className: 'flex items-start justify-between gap-4',
                            children: [
                              s.jsx('h1', {
                                className: 'text-2xl font-bold leading-tight text-slate-900',
                                children: p.title,
                              }),
                              s.jsx('button', {
                                onClick: () => n(!r),
                                className: `rounded-full p-2 transition-all ${r ? 'bg-red-50 text-red-500' : 'bg-slate-50 text-slate-400 hover:bg-slate-100'}`,
                                children: s.jsx(La, {
                                  size: 24,
                                  fill: r ? 'currentColor' : 'none',
                                }),
                              }),
                            ],
                          }),
                          s.jsxs('div', {
                            className: 'mt-2 flex items-center gap-2 text-sm text-slate-500',
                            children: [s.jsx(tr, { size: 16 }), p.address],
                          }),
                          s.jsxs('div', {
                            className: 'mt-4 flex items-baseline gap-2',
                            children: [
                              s.jsx('span', {
                                className: 'text-3xl font-extrabold text-[#003366]',
                                children: p.price,
                              }),
                              s.jsx('span', {
                                className: 'text-lg font-medium text-slate-500',
                                children: '萬',
                              }),
                              s.jsx('span', {
                                className: 'ml-2 text-sm font-medium text-red-500',
                                children: '可議價',
                              }),
                            ],
                          }),
                          s.jsxs('div', {
                            className: 'mt-3 flex flex-wrap gap-2',
                            children: [
                              w.isHot &&
                                s.jsxs('div', {
                                  className:
                                    'inline-flex animate-pulse items-center gap-1 rounded-full bg-orange-50 px-2 py-1 text-xs font-medium text-orange-600',
                                  children: [s.jsx(Pn, { size: 12 }), '熱門物件'],
                                }),
                              s.jsxs('div', {
                                className:
                                  'inline-flex items-center gap-1 rounded-full bg-slate-50 px-2 py-1 text-xs text-slate-600',
                                children: [
                                  s.jsx(sn, {
                                    size: 12,
                                    className: 'text-blue-500',
                                  }),
                                  w.currentViewers,
                                  ' 人正在瀏覽',
                                ],
                              }),
                              s.jsxs('div', {
                                className:
                                  'inline-flex items-center gap-1 rounded-full bg-slate-50 px-2 py-1 text-xs text-slate-600',
                                children: [
                                  s.jsx(jl, {
                                    size: 12,
                                    className: 'text-green-500',
                                  }),
                                  '本週 ',
                                  w.weeklyBookings,
                                  ' 組預約看屋',
                                ],
                              }),
                            ],
                          }),
                        ],
                      }),
                      s.jsx('div', {
                        className: 'flex flex-wrap gap-2',
                        children: G.map((I) =>
                          s.jsx(
                            'span',
                            {
                              className:
                                'rounded-full bg-blue-50 px-3 py-1 text-xs font-medium text-[#003366]',
                              children: I,
                            },
                            I
                          )
                        ),
                      }),
                      s.jsxs('div', {
                        className:
                          'grid grid-cols-2 gap-4 rounded-2xl border border-slate-100 bg-white p-4 shadow-sm sm:grid-cols-4',
                        children: [
                          s.jsxs('div', {
                            className: 'flex flex-col',
                            children: [
                              s.jsx('span', {
                                className: 'text-xs text-slate-400',
                                children: '建案坪數',
                              }),
                              s.jsx('span', {
                                className: 'text-sm font-bold text-slate-800',
                                children: Jw(p.size ?? be.size) || '--',
                              }),
                            ],
                          }),
                          s.jsxs('div', {
                            className: 'flex flex-col',
                            children: [
                              s.jsx('span', {
                                className: 'text-xs text-slate-400',
                                children: '格局',
                              }),
                              s.jsx('span', {
                                className: 'text-sm font-bold text-slate-800',
                                children: Xw(p.rooms ?? be.rooms, p.halls ?? be.halls) || '--',
                              }),
                            ],
                          }),
                          s.jsxs('div', {
                            className: 'flex flex-col',
                            children: [
                              s.jsx('span', {
                                className: 'text-xs text-slate-400',
                                children: '樓層',
                              }),
                              s.jsx('span', {
                                className: 'text-sm font-bold text-slate-800',
                                children:
                                  eN(
                                    p.floorCurrent ?? be.floorCurrent,
                                    p.floorTotal ?? be.floorTotal
                                  ) || '--',
                              }),
                            ],
                          }),
                          s.jsxs('div', {
                            className: 'flex flex-col',
                            children: [
                              s.jsx('span', {
                                className: 'text-xs text-slate-400',
                                children: '編號',
                              }),
                              s.jsx('span', {
                                className: 'text-sm font-bold text-slate-800',
                                children: p.publicId,
                              }),
                            ],
                          }),
                        ],
                      }),
                      s.jsx('div', { className: 'h-px bg-slate-100' }),
                      s.jsxs('div', {
                        className: 'prose prose-slate max-w-none',
                        children: [
                          s.jsx('h3', {
                            className: 'mb-3 text-lg font-bold text-slate-900',
                            children: '物件特色',
                          }),
                          s.jsx('p', {
                            className: 'whitespace-pre-line leading-relaxed text-slate-600',
                            children: p.description,
                          }),
                        ],
                      }),
                      s.jsxs('div', {
                        className: 'rounded-2xl border border-slate-100 bg-white p-4 shadow-sm',
                        children: [
                          s.jsxs('div', {
                            className: 'mb-4 flex items-center justify-between',
                            children: [
                              s.jsxs('h3', {
                                className:
                                  'flex items-center gap-2 text-lg font-bold text-slate-900',
                                children: [
                                  s.jsx(jn, {
                                    size: 18,
                                    className: 'text-yellow-500',
                                    fill: 'currentColor',
                                  }),
                                  '社區評價',
                                ],
                              }),
                              s.jsx('span', {
                                className:
                                  'rounded-full bg-slate-50 px-2 py-1 text-xs text-slate-500',
                                children: '88 位住戶加入',
                              }),
                            ],
                          }),
                          s.jsxs('div', {
                            className: 'space-y-3',
                            children: [
                              s.jsxs('div', {
                                className: 'flex gap-3 rounded-xl bg-slate-50 p-3',
                                children: [
                                  s.jsx('div', {
                                    className:
                                      'flex size-10 shrink-0 items-center justify-center rounded-full bg-[#003366] text-lg font-bold text-white',
                                    children: 'J',
                                  }),
                                  s.jsxs('div', {
                                    className: 'min-w-0 flex-1',
                                    children: [
                                      s.jsxs('div', {
                                        className: 'mb-1 flex items-center gap-2',
                                        children: [
                                          s.jsx('span', {
                                            className: 'text-sm font-bold text-slate-800',
                                            children: 'J***',
                                          }),
                                          s.jsx('span', {
                                            className: 'text-xs text-slate-500',
                                            children: 'B棟住戶',
                                          }),
                                          s.jsx('span', {
                                            className: 'text-xs text-yellow-500',
                                            children: '★★★★★',
                                          }),
                                        ],
                                      }),
                                      s.jsx('p', {
                                        className: 'text-sm leading-relaxed text-slate-600',
                                        children:
                                          '公設維護得乾淨，假日草皮有人整理。之前反映停車動線，管委會一週內就公告改善。',
                                      }),
                                    ],
                                  }),
                                ],
                              }),
                              s.jsxs('div', {
                                className: 'flex gap-3 rounded-xl bg-slate-50 p-3',
                                children: [
                                  s.jsx('div', {
                                    className:
                                      'flex size-10 shrink-0 items-center justify-center rounded-full bg-[#00A8E8] text-lg font-bold text-white',
                                    children: 'W',
                                  }),
                                  s.jsxs('div', {
                                    className: 'min-w-0 flex-1',
                                    children: [
                                      s.jsxs('div', {
                                        className: 'mb-1 flex items-center gap-2',
                                        children: [
                                          s.jsx('span', {
                                            className: 'text-sm font-bold text-slate-800',
                                            children: 'W***',
                                          }),
                                          s.jsx('span', {
                                            className: 'text-xs text-slate-500',
                                            children: '12F住戶',
                                          }),
                                          s.jsx('span', {
                                            className: 'text-xs text-yellow-500',
                                            children: '★★★★☆',
                                          }),
                                        ],
                                      }),
                                      s.jsx('p', {
                                        className: 'text-sm leading-relaxed text-slate-600',
                                        children:
                                          '住起來整體舒服，但面向上路的低樓層在上下班尖峰車聲明顯，喜靜的買家可考慮中高樓層。',
                                      }),
                                    ],
                                  }),
                                ],
                              }),
                            ],
                          }),
                          s.jsxs('div', {
                            className: 'relative mt-3 overflow-hidden rounded-xl',
                            children: [
                              s.jsxs('div', {
                                className: 'flex gap-3 bg-slate-50 p-3 select-none blur-sm',
                                children: [
                                  s.jsx('div', {
                                    className:
                                      'flex size-10 shrink-0 items-center justify-center rounded-full bg-green-500 text-lg font-bold text-white',
                                    children: 'L',
                                  }),
                                  s.jsxs('div', {
                                    className: 'flex-1',
                                    children: [
                                      s.jsxs('div', {
                                        className: 'mb-1 flex items-center gap-2',
                                        children: [
                                          s.jsx('span', {
                                            className: 'text-sm font-bold text-slate-800',
                                            children: 'L***',
                                          }),
                                          s.jsx('span', {
                                            className: 'text-xs text-slate-500',
                                            children: 'C棟住戶',
                                          }),
                                          a,
                                        ],
                                      }),
                                      s.jsx('p', {
                                        className: 'text-sm text-slate-600',
                                        children: '頂樓排水設計不錯，颱風天也沒有積水問題...',
                                      }),
                                    ],
                                  }),
                                ],
                              }),
                              s.jsx('div', {
                                className:
                                  'absolute inset-0 flex items-end justify-center bg-gradient-to-b from-transparent via-white/80 to-white pb-3',
                                children: s.jsxs('button', {
                                  onClick: () => {
                                    window.location.href = '/auth.html?redirect=community';
                                  },
                                  className:
                                    'flex items-center gap-2 rounded-full bg-[#003366] px-4 py-2 text-sm font-bold text-white shadow-lg transition-colors hover:bg-[#004488]',
                                  children: [
                                    s.jsx(Ra, { size: 14 }),
                                    '註冊查看全部 6 則評價',
                                    s.jsx(It, { size: 14 }),
                                  ],
                                }),
                              }),
                            ],
                          }),
                          s.jsxs('div', {
                            className:
                              'mt-4 flex items-center justify-between border-t border-slate-100 pt-3',
                            children: [
                              s.jsx('p', {
                                className: 'text-xs text-slate-500',
                                children: '💬 加入社區牆，與現任住戶交流',
                              }),
                              s.jsxs('button', {
                                onClick: () =>
                                  (window.location.href = '/maihouses/community-wall_mvp.html'),
                                className:
                                  'flex items-center gap-1 text-xs font-bold text-[#003366] hover:underline',
                                children: ['前往社區牆', s.jsx(It, { size: 12 })],
                              }),
                            ],
                          }),
                        ],
                      }),
                    ],
                  }),
                  s.jsx('div', {
                    className: 'lg:col-span-1',
                    children: s.jsxs('div', {
                      className: 'sticky top-24 space-y-4',
                      children: [
                        s.jsx(Bw, {
                          agent: p.agent,
                          onLineClick: () => C('sidebar'),
                          onCallClick: () => C('sidebar'),
                          onBookingClick: () => C('booking'),
                        }),
                        s.jsxs('div', {
                          className: 'rounded-xl border border-blue-100 bg-blue-50 p-4',
                          children: [
                            s.jsxs('h4', {
                              className:
                                'mb-2 flex items-center gap-2 text-sm font-bold text-[#003366]',
                              children: [s.jsx(rn, { size: 16 }), '安心交易保障'],
                            }),
                            s.jsxs('ul', {
                              className: 'space-y-2',
                              children: [
                                s.jsxs('li', {
                                  className: 'flex items-center gap-2 text-xs text-slate-600',
                                  children: [
                                    s.jsx('div', {
                                      className: 'size-1 rounded-full bg-blue-400',
                                    }),
                                    '產權調查確認',
                                  ],
                                }),
                                s.jsxs('li', {
                                  className: 'flex items-center gap-2 text-xs text-slate-600',
                                  children: [
                                    s.jsx('div', {
                                      className: 'size-1 rounded-full bg-blue-400',
                                    }),
                                    '履約保證專戶',
                                  ],
                                }),
                                s.jsxs('li', {
                                  className: 'flex items-center gap-2 text-xs text-slate-600',
                                  children: [
                                    s.jsx('div', {
                                      className: 'size-1 rounded-full bg-blue-400',
                                    }),
                                    '凶宅查詢過濾',
                                  ],
                                }),
                              ],
                            }),
                          ],
                        }),
                      ],
                    }),
                  }),
                ],
              }),
            ],
          }),
          s.jsxs('button', {
            onClick: () => C('booking'),
            className:
              'fixed bottom-28 right-4 z-40 flex size-16 animate-bounce flex-col items-center justify-center rounded-full bg-orange-500 text-xs font-bold text-white shadow-2xl transition-transform hover:scale-110 hover:bg-orange-600 lg:bottom-8',
            style: { animationDuration: '2s' },
            children: [
              s.jsx(ns, { size: 22 }),
              s.jsx('span', {
                className: 'mt-0.5 text-[10px]',
                children: '30秒回電',
              }),
            ],
          }),
          s.jsxs('div', {
            className:
              'pb-safe fixed inset-x-0 bottom-0 z-overlay border-t border-slate-100 bg-white p-3 lg:hidden',
            children: [
              s.jsxs('div', {
                className: 'mb-2 flex items-center justify-center gap-4 text-[10px] text-slate-500',
                children: [
                  s.jsxs('span', {
                    className: 'flex items-center gap-1',
                    children: [s.jsx(rn, { size: 10, className: 'text-green-500' }), '認證經紀人'],
                  }),
                  s.jsxs('span', {
                    className: 'flex items-center gap-1',
                    children: [
                      s.jsx(sn, { size: 10, className: 'text-blue-500' }),
                      w.currentViewers,
                      ' 人瀏覽中',
                    ],
                  }),
                  w.isHot &&
                    s.jsxs('span', {
                      className: 'flex items-center gap-1 font-medium text-orange-500',
                      children: [s.jsx(Pn, { size: 10 }), '熱門'],
                    }),
                ],
              }),
              s.jsxs('div', {
                className: 'flex gap-2',
                children: [
                  s.jsxs('button', {
                    onClick: () => C('mobile_bar'),
                    className:
                      'flex flex-[4] items-center justify-center gap-2 rounded-xl bg-[#06C755] py-3 font-bold text-white shadow-lg shadow-green-500/20',
                    children: [s.jsx($t, { size: 20 }), '加 LINE 諮詢'],
                  }),
                  s.jsxs('button', {
                    onClick: () => C('booking'),
                    className:
                      'flex flex-[6] items-center justify-center gap-2 rounded-xl bg-[#003366] py-3 font-bold text-white shadow-lg shadow-blue-900/20',
                    children: [s.jsx(as, { size: 20 }), '預約看屋'],
                  }),
                ],
              }),
            ],
          }),
          s.jsx(Hw, {
            isOpen: l,
            onClose: () => c(!1),
            propertyId: p.publicId,
            propertyTitle: p.title,
            agentId: S(),
            agentName: ((se = p.agent) == null ? void 0 : se.name) || '專屬業務',
            source: d,
          }),
          u &&
            s.jsx('div', {
              className: 'fixed inset-0 z-[60] flex items-center justify-center bg-black/60 p-4',
              onClick: () => x(!1),
              children: s.jsxs('div', {
                className:
                  'animate-in zoom-in-95 w-full max-w-sm rounded-2xl bg-white p-6 shadow-2xl duration-300',
                onClick: (I) => I.stopPropagation(),
                children: [
                  s.jsxs('div', {
                    className: 'mb-4 text-center',
                    children: [
                      s.jsx('div', {
                        className:
                          'mx-auto mb-3 flex size-16 items-center justify-center rounded-full bg-gradient-to-br from-orange-400 to-red-500',
                        children: s.jsx(Pn, {
                          size: 32,
                          className: 'text-white',
                        }),
                      }),
                      s.jsx('h3', {
                        className: 'text-xl font-bold text-slate-800',
                        children: '發現您對此物件很有興趣！',
                      }),
                      s.jsx('p', {
                        className: 'mt-1 text-sm text-slate-500',
                        children: f || '專屬 VIP 服務為您優先安排',
                      }),
                    ],
                  }),
                  s.jsxs('div', {
                    className: 'mb-4 space-y-2 rounded-xl bg-slate-50 p-4',
                    children: [
                      s.jsxs('div', {
                        className: 'flex items-center gap-2 text-sm',
                        children: [
                          s.jsx(ht, {
                            size: 16,
                            className: 'shrink-0 text-green-500',
                          }),
                          s.jsx('span', { children: '優先安排專人帶看' }),
                        ],
                      }),
                      s.jsxs('div', {
                        className: 'flex items-center gap-2 text-sm',
                        children: [
                          s.jsx(ht, {
                            size: 16,
                            className: 'shrink-0 text-green-500',
                          }),
                          s.jsx('span', { children: '獨家議價空間資訊' }),
                        ],
                      }),
                      s.jsxs('div', {
                        className: 'flex items-center gap-2 text-sm',
                        children: [
                          s.jsx(ht, {
                            size: 16,
                            className: 'shrink-0 text-green-500',
                          }),
                          s.jsx('span', { children: '相似物件即時通知' }),
                        ],
                      }),
                    ],
                  }),
                  s.jsxs('div', {
                    className: 'space-y-2',
                    children: [
                      s.jsxs('button', {
                        onClick: () => {
                          (T.trackLineClick(), x(!1), C('mobile_bar'));
                        },
                        className:
                          'flex w-full items-center justify-center gap-2 rounded-xl bg-[#06C755] py-3 font-bold text-white shadow-lg',
                        children: [s.jsx($t, { size: 20 }), '立即加 LINE 諮詢'],
                      }),
                      s.jsxs('button', {
                        onClick: () => {
                          (T.trackCallClick(), x(!1), C('booking'));
                        },
                        className:
                          'flex w-full items-center justify-center gap-2 rounded-xl bg-[#003366] py-3 font-bold text-white',
                        children: [s.jsx(as, { size: 20 }), 'VIP 預約看屋'],
                      }),
                      s.jsx('button', {
                        onClick: () => x(!1),
                        className: 'w-full py-2 text-sm text-slate-400 hover:text-slate-600',
                        children: '稍後再說',
                      }),
                    ],
                  }),
                ],
              }),
            }),
          s.jsxs('button', {
            onClick: () => y(!0),
            className:
              'group fixed bottom-24 right-4 z-40 flex size-14 items-center justify-center rounded-full bg-gradient-to-br from-[#003366] to-[#00A8E8] text-white shadow-lg transition-all hover:scale-105 hover:shadow-xl',
            title: '生成物件報告',
            children: [
              s.jsx(_n, { size: 24 }),
              s.jsx('span', {
                className:
                  'absolute right-full mr-3 whitespace-nowrap rounded-lg bg-slate-800 px-3 py-1.5 text-sm font-medium text-white opacity-0 transition-opacity group-hover:opacity-100',
                children: '生成報告',
              }),
            ],
          }),
          s.jsx(Yw, {
            property: {
              id: p.id,
              publicId: p.publicId,
              title: p.title,
              price: p.price,
              address: p.address,
              description: p.description,
              images: p.images,
              agent: {
                id: p.agent.id,
                name: p.agent.name,
                avatarUrl: p.agent.avatarUrl,
                company: p.agent.company,
                trustScore: p.agent.trustScore,
                reviewCount: p.agent.encouragementCount,
              },
            },
            isOpen: b,
            onClose: () => y(!1),
          }),
        ],
      })
    );
  },
  rN = { id: 'NONE', name: '無', address: '透天/店面/獨棟' };
function kd({ value: e, address: t, onChange: r, className: n = '', required: a = !1 }) {
  const [i, o] = h.useState(!1),
    [l, c] = h.useState(e),
    [d, m] = h.useState([]),
    [u, x] = h.useState(!1),
    [f, g] = h.useState(null),
    b = h.useRef(null),
    y = h.useRef(null),
    p = h.useRef(0),
    E = (j) => {
      const _ = j.match(/([^市縣]+[區鄉鎮市])/);
      return (_ == null ? void 0 : _[1]) || '';
    },
    S = async (j, _) => {
      if (!j && !_) {
        m([]);
        return;
      }
      (y.current && y.current.abort(), (y.current = new AbortController()));
      const D = ++p.current;
      x(!0);
      try {
        const V = E(_),
          se = _ ? ja(_) : '';
        if (se) {
          const { data: O } = await de
            .from('communities')
            .select('id, name, address, property_count, is_verified')
            .eq('address_fingerprint', se)
            .limit(1)
            .abortSignal(y.current.signal);
          if (D !== p.current) return;
          if (O && O.length > 0) {
            (m(O), x(!1));
            return;
          }
        }
        let I = de
          .from('communities')
          .select('id, name, address, property_count, is_verified')
          .limit(8);
        (j && (I = I.ilike('name', `%${j}%`)), V && (I = I.eq('district', V)));
        const { data: A, error: z } = await I.order('property_count', {
          ascending: !1,
        }).abortSignal(y.current.signal);
        if (D !== p.current) return;
        if (z) throw z;
        m(A || []);
      } catch (V) {
        if ((V == null ? void 0 : V.name) === 'AbortError') return;
        (console.error('搜尋社區失敗:', V), m([]));
      } finally {
        D === p.current && x(!1);
      }
    };
  (h.useEffect(() => {
    const j = setTimeout(() => {
      S(l, t);
    }, 300);
    return () => clearTimeout(j);
  }, [l, t]),
    h.useEffect(
      () => () => {
        y.current && y.current.abort();
      },
      []
    ),
    h.useEffect(() => {
      const j = (_) => {
        b.current && !b.current.contains(_.target) && o(!1);
      };
      return (
        document.addEventListener('mousedown', j),
        () => document.removeEventListener('mousedown', j)
      );
    }, []));
  const N = (j) => {
      (g(j), c(j.name));
      const _ = j.id === 'NONE' ? void 0 : j.id;
      (r(j.name, _), o(!1));
    },
    k = () => {
      (g(rN), c('無'), r('無', void 0), o(!1));
    },
    T = () => {
      l.trim() && (g(null), r(l.trim(), void 0), o(!1));
    },
    w = ((j) => {
      const _ = j.trim();
      return _.length < 2
        ? { valid: !1, reason: '名稱太短' }
        : /^(透天|店面|華廈|公寓|套房|大樓|A棟|B棟|C區|[A-Z]\d*棟?)$/.test(_)
          ? { valid: !1, reason: '請輸入正式社區名稱' }
          : /^.*[路街巷弄]\d+號?$/.test(_) && !/社區|大樓|花園|莊園/.test(_)
            ? { valid: !1, reason: '這看起來是地址而非社區名' }
            : /超便宜|稀有|唯一|急售|降價|特價/.test(_)
              ? { valid: !1, reason: '請輸入正式社區名稱' }
              : /社區|大樓|花園|莊園|雅築|官邸|華廈|別墅|山莊|天廈|豪邸|期$/.test(_)
                ? { valid: !0 }
                : _.length >= 3 && /^[\u4e00-\u9fa5\d]+$/.test(_)
                  ? { valid: !0 }
                  : { valid: !1, reason: '建議填寫正式社區名稱' };
    })(l),
    G = l.trim() && !d.some((j) => j.name === l.trim()) && w.valid;
  return s.jsxs('div', {
    ref: b,
    className: `relative ${n}`,
    children: [
      s.jsxs('div', {
        className: 'relative',
        children: [
          s.jsx('div', {
            className: 'absolute left-3 top-1/2 -translate-y-1/2 text-slate-400',
            children: s.jsx(mr, { size: 16 }),
          }),
          s.jsx('input', {
            type: 'text',
            value: l,
            onChange: (j) => {
              (c(j.target.value), g(null), o(!0));
            },
            onFocus: () => o(!0),
            placeholder: '輸入或選擇社區名稱...',
            className: `
            w-full rounded-xl border bg-slate-50 px-10 py-3 text-sm outline-none
            focus:border-transparent focus:ring-2 focus:ring-[#003366]
            ${f ? 'border-green-300 bg-green-50/50' : 'border-slate-200'}
          `,
          }),
          s.jsx('div', {
            className: 'absolute right-3 top-1/2 -translate-y-1/2',
            children: u
              ? s.jsx(pr, {
                  size: 16,
                  className: 'animate-spin text-slate-400',
                })
              : f
                ? s.jsx(wt, { size: 16, className: 'text-green-600' })
                : s.jsx(tn, { size: 16, className: 'text-slate-400' }),
          }),
        ],
      }),
      f &&
        f.name !== '無' &&
        s.jsxs('p', {
          className: 'mt-1 flex items-center gap-1 text-xs text-green-600',
          children: [
            s.jsx(wt, { size: 12 }),
            '已選擇「',
            f.name,
            '」',
            f.property_count ? ` (${f.property_count} 個物件)` : '',
          ],
        }),
      f &&
        f.name === '無' &&
        s.jsx('p', {
          className: 'mt-1 flex items-center gap-1 text-xs text-slate-500',
          children: '🏠 此物件為透天/店面，不歸入社區牆',
        }),
      !f &&
        l &&
        w.valid &&
        s.jsxs('p', {
          className: 'mt-1 text-xs text-amber-600',
          children: ['⚠️ 將建立新社區「', l.trim(), '」，請確認名稱正確（系統會比對相似名稱）'],
        }),
      !f &&
        l &&
        !w.valid &&
        l.length >= 2 &&
        s.jsxs('p', {
          className: 'mt-1 text-xs text-amber-600',
          children: ['⚠️ ', w.reason || '建議填寫正式社區名稱', '（如：遠雄之星8期、惠文新象）'],
        }),
      i &&
        s.jsxs('div', {
          className:
            'absolute z-dropdown mt-1 max-h-80 w-full overflow-hidden overflow-y-auto rounded-xl border border-slate-200 bg-white shadow-lg',
          children: [
            s.jsxs('button', {
              onClick: k,
              className:
                'flex w-full items-center gap-3 border-b border-slate-100 bg-slate-50/50 px-4 py-3 text-left hover:bg-slate-50',
              children: [
                s.jsx('div', {
                  className:
                    'flex size-8 shrink-0 items-center justify-center rounded-lg bg-slate-200',
                  children: s.jsx(Qe, {
                    size: 16,
                    className: 'text-slate-500',
                  }),
                }),
                s.jsxs('div', {
                  children: [
                    s.jsx('span', {
                      className: 'font-medium text-slate-600',
                      children: '無社區',
                    }),
                    s.jsx('span', {
                      className: 'ml-2 text-xs text-slate-400',
                      children: '（透天、店面、獨棟）',
                    }),
                  ],
                }),
              ],
            }),
            d.map((j) =>
              s.jsxs(
                'button',
                {
                  onClick: () => N(j),
                  className:
                    'flex w-full items-start gap-3 border-b border-slate-100 px-4 py-3 text-left last:border-0 hover:bg-slate-50',
                  children: [
                    s.jsx('div', {
                      className:
                        'flex size-8 shrink-0 items-center justify-center rounded-lg bg-blue-100',
                      children: s.jsx(mr, {
                        size: 16,
                        className: 'text-blue-600',
                      }),
                    }),
                    s.jsxs('div', {
                      className: 'min-w-0 flex-1',
                      children: [
                        s.jsxs('div', {
                          className: 'flex items-center gap-2',
                          children: [
                            s.jsx('span', {
                              className: 'truncate font-medium text-slate-800',
                              children: j.name,
                            }),
                            j.is_verified &&
                              s.jsx('span', {
                                className:
                                  'rounded bg-green-100 px-1.5 py-0.5 text-[10px] text-green-700',
                                children: '已驗證',
                              }),
                          ],
                        }),
                        j.address &&
                          s.jsx('p', {
                            className: 'truncate text-xs text-slate-500',
                            children: j.address,
                          }),
                        j.property_count
                          ? s.jsxs('p', {
                              className: 'text-xs text-slate-400',
                              children: [j.property_count, ' 個物件'],
                            })
                          : null,
                      ],
                    }),
                  ],
                },
                j.id
              )
            ),
            G &&
              s.jsxs('button', {
                onClick: T,
                className:
                  'flex w-full items-center gap-3 border-t border-amber-100 bg-amber-50/50 px-4 py-3 text-left hover:bg-amber-50',
                children: [
                  s.jsx('div', {
                    className:
                      'flex size-8 shrink-0 items-center justify-center rounded-lg bg-amber-500',
                    children: s.jsx(fr, { size: 16, className: 'text-white' }),
                  }),
                  s.jsxs('div', {
                    children: [
                      s.jsx('span', {
                        className: 'font-medium text-amber-700',
                        children: '建立新社區：',
                      }),
                      s.jsx('span', {
                        className: 'ml-1 text-amber-600',
                        children: l.trim(),
                      }),
                      s.jsx('p', {
                        className: 'mt-0.5 text-xs text-amber-600',
                        children: '⚠️ 請確認找不到才建立',
                      }),
                    ],
                  }),
                ],
              }),
            d.length === 0 &&
              !G &&
              l.length >= 2 &&
              !u &&
              s.jsxs('div', {
                className: 'px-4 py-6 text-center',
                children: [
                  s.jsx('div', {
                    className:
                      'mx-auto mb-3 flex size-12 items-center justify-center rounded-full bg-slate-100',
                    children: s.jsx(tn, {
                      size: 20,
                      className: 'text-slate-400',
                    }),
                  }),
                  s.jsx('p', {
                    className: 'text-sm font-medium text-slate-600',
                    children: '未找到相似社區',
                  }),
                  s.jsx('p', {
                    className: 'mt-1 text-xs text-slate-400',
                    children: '請確認名稱後選擇「建立新社區」',
                  }),
                ],
              }),
            u &&
              d.length === 0 &&
              s.jsx('div', {
                className: 'space-y-3 p-4',
                children: [1, 2, 3].map((j) =>
                  s.jsxs(
                    'div',
                    {
                      className: 'flex animate-pulse items-center gap-3',
                      children: [
                        s.jsx('div', {
                          className: 'size-8 rounded-lg bg-slate-200',
                        }),
                        s.jsxs('div', {
                          className: 'flex-1 space-y-2',
                          children: [
                            s.jsx('div', {
                              className: 'h-4 w-3/4 rounded bg-slate-200',
                            }),
                            s.jsx('div', {
                              className: 'h-3 w-1/2 rounded bg-slate-100',
                            }),
                          ],
                        }),
                      ],
                    },
                    j
                  )
                ),
              }),
          ],
        }),
    ],
  });
}
const nN = [
    '白癡',
    '智障',
    '廢物',
    '垃圾',
    '去死',
    '滾蛋',
    '保證賺',
    '穩賺不賠',
    '免費送',
    '立即致富',
    '色情',
    '賭博',
    '毒品',
  ],
  aN = [
    '加LINE',
    '加賴',
    '私訊領',
    '限時優惠',
    '最後機會',
    '點擊連結',
    'bit.ly',
    'tinyurl',
    '折扣碼',
    '代購',
    '代辦',
    '保證過件',
  ],
  iN = [
    '透天',
    '店面',
    '華廈',
    '公寓',
    '套房',
    '大樓',
    '出租',
    '出售',
    '急售',
    '降價',
    '特價',
    '便宜',
    '超值',
    '搶手',
    '稀有',
    '唯一',
    'A棟',
    'B棟',
    'C棟',
    'A區',
    'B區',
    'C區',
  ],
  ii = (e) => e.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'),
  oN = new RegExp(
    nN.map((e) => ii(e.replace(/[^\u4e00-\u9fa5a-zA-Z0-9]/g, '').toLowerCase())).join('|'),
    'i'
  ),
  lN = aN
    .map((e) =>
      e
        .split('')
        .map((t) => ii(t))
        .join('[^\\u4e00-\\u9fa5a-zA-Z0-9]{0,2}')
    )
    .join('|'),
  cN = new RegExp(lN, 'i');
new RegExp(`^(${iN.map(ii).join('|')})$`, 'i');
function dN(e) {
  const t = [];
  if (!e) return { passed: !0, issues: [] };
  const n = e
    .replace(/[^\u4e00-\u9fa5a-zA-Z0-9]/g, '')
    .toLowerCase()
    .match(oN);
  n && t.push({ type: 'sensitive', word: n[0], message: '包含不當用語' });
  const a = e.match(cN);
  return (
    a && t.push({ type: 'ad', word: a[0], message: '疑似廣告內容' }),
    { passed: t.length === 0, issues: t }
  );
}
const Tt = {
    advantage: { minLength: 2 },
    disadvantage: { minLength: 10 },
    communityName: { minLength: 2 },
    title: { minLength: 1 },
    price: { minLength: 1 },
    address: { minLength: 5 },
    images: { minCount: 1, maxSizeMB: 10 },
  },
  uN = ['image/jpeg', 'image/jpg', 'image/png', 'image/webp', 'image/heic', 'image/heif'],
  mN = Tt.images.maxSizeMB * 1024 * 1024;
function hN(e) {
  if (!uN.includes(e.type))
    return {
      valid: !1,
      file: e,
      error: `不支援的檔案格式：${e.type || '未知'}。請使用 JPG、PNG 或 WebP`,
    };
  if (e.size > mN) {
    const t = (e.size / 1024 / 1024).toFixed(1);
    return {
      valid: !1,
      file: e,
      error: `檔案過大：${t}MB（上限 ${Tt.images.maxSizeMB}MB）`,
    };
  }
  return { valid: !0, file: e };
}
function fN(e) {
  const t = e.map(hN),
    r = t.filter((a) => a.valid).map((a) => a.file),
    n = t.filter((a) => !a.valid);
  return { validFiles: r, invalidFiles: n, allValid: n.length === 0 };
}
function pN(e, t) {
  return h.useMemo(() => {
    var re, ae, R, ee, $, J;
    const n = [],
      a = e.highlights || [],
      i = a.length,
      o = {
        advMin: i >= 3 ? 2 : 5,
        adv2Optional: i >= 5,
        disMin: i >= 3 ? 5 : 10,
      },
      l = e.title.length >= Tt.title.minLength,
      c = l ? '' : '請輸入物件標題';
    !l && e.title.length > 0 && n.push({ field: 'title', message: c });
    const d = e.price.length >= Tt.price.minLength && /^\d+$/.test(e.price),
      m = e.price ? (d ? '' : '價格必須為數字') : '請輸入價格';
    !d && e.price.length > 0 && n.push({ field: 'price', message: m });
    const u = e.address.length >= Tt.address.minLength,
      x = e.address.length === 0 ? '請輸入地址' : u ? '' : `地址至少 ${Tt.address.minLength} 字`;
    !u && e.address.length > 0 && n.push({ field: 'address', message: x });
    const f = e.communityName === '無' || e.communityName.length >= Tt.communityName.minLength,
      g = f ? '' : '請選擇或輸入社區名稱';
    !f && e.communityName.length > 0 && n.push({ field: 'communityName', message: g });
    const b = e.advantage1.length,
      y = b >= o.advMin,
      p = y ? '' : `還需 ${o.advMin - b} 字`;
    !y && b > 0 && n.push({ field: 'advantage1', message: `優點1${p}` });
    const E = e.advantage2.length,
      S = o.adv2Optional || E >= o.advMin,
      N = S ? '' : `還需 ${o.advMin - E} 字`;
    !S && E > 0 && n.push({ field: 'advantage2', message: `優點2${N}` });
    const k = e.disadvantage.length,
      T = k >= o.disMin,
      C = T ? '' : `還需 ${o.disMin - k} 字`;
    !T && k > 0 && n.push({ field: 'disadvantage', message: `公道話${C}` });
    const w = i >= 3,
      G = w ? '' : '請至少選擇 3 個重點膠囊';
    !w && i > 0 && n.push({ field: 'highlights', message: G });
    const j = t >= Tt.images.minCount,
      _ = j ? '' : '請至少上傳 1 張照片';
    j || n.push({ field: 'images', message: _ });
    const D = [
        { name: '標題', value: e.title },
        { name: '地址', value: e.address },
        { name: '社區', value: e.communityName },
        { name: '優點1', value: e.advantage1 },
        { name: '優點2', value: e.advantage2 },
        { name: '公道話', value: e.disadvantage },
        ...a.map((Y, oe) => ({ name: `標籤${oe + 1}`, value: Y })),
      ],
      V = [];
    let se = !1;
    const I = D.map((Y) => {
        const oe = dN(Y.value);
        return (
          oe.passed ||
            oe.issues.forEach((U) => {
              (V.push(`${Y.name}: ${U.message}`), U.type === 'sensitive' && (se = !0));
            }),
          { name: Y.name, result: oe }
        );
      }),
      A = l && d && u && f,
      z = y && S && T && w,
      O = A && z && j && !se;
    return {
      title: { valid: l, message: c },
      price: { valid: d, message: m },
      address: { valid: u, message: x },
      communityName: { valid: f, message: g },
      advantage1: {
        valid: y,
        message: p,
        charCount: b,
        contentWarning:
          (ae = (re = I.find((Y) => Y.name === '優點1')) == null ? void 0 : re.result.issues[0]) ==
          null
            ? void 0
            : ae.message,
      },
      advantage2: {
        valid: S,
        message: N,
        charCount: E,
        contentWarning:
          (ee = (R = I.find((Y) => Y.name === '優點2')) == null ? void 0 : R.result.issues[0]) ==
          null
            ? void 0
            : ee.message,
      },
      disadvantage: {
        valid: T,
        message: C,
        charCount: k,
        contentWarning:
          (J = ($ = I.find((Y) => Y.name === '公道話')) == null ? void 0 : $.result.issues[0]) ==
          null
            ? void 0
            : J.message,
      },
      highlights: {
        valid: w,
        message: G,
        warnings: I.filter((Y) => Y.name.startsWith('標籤'))
          .map((Y) => {
            var oe;
            return (oe = Y.result.issues[0]) == null ? void 0 : oe.message;
          })
          .filter(Boolean),
      },
      images: { valid: j, message: _, count: t },
      adv1Valid: y,
      adv2Valid: S,
      disValid: T,
      communityValid: f,
      highlightsValid: w,
      basicValid: A,
      twoGoodOneFairValid: z,
      allValid: O,
      canSubmit: O,
      contentCheck: { hasIssues: V.length > 0, blockSubmit: se, warnings: V },
      errors: n,
    };
  }, [e, t]);
}
const Sd = h.createContext(void 0),
  xN = ({ children: e }) => {
    const [t, r] = h.useState(!1),
      [n, a] = h.useState(null),
      [i, o] = h.useState([]),
      [l, c] = h.useState(),
      [d, m] = h.useState(null),
      [u, x] = h.useState(!1),
      f = h.useRef(null),
      [g, b] = h.useState({
        title: '',
        price: '',
        address: '',
        communityName: '',
        size: '',
        age: '',
        floorCurrent: '',
        floorTotal: '',
        rooms: '3',
        halls: '2',
        bathrooms: '2',
        type: '電梯大樓',
        description: '',
        advantage1: '',
        advantage2: '',
        disadvantage: '',
        highlights: [],
        images: [],
        sourceExternalId: '',
      }),
      y = pN(
        {
          title: g.title,
          price: g.price,
          address: g.address,
          communityName: g.communityName,
          advantage1: g.advantage1,
          advantage2: g.advantage2,
          disadvantage: g.disadvantage,
          highlights: g.highlights || [],
        },
        i.length
      ),
      N = {
        form: g,
        setForm: b,
        validation: y,
        loading: t,
        setLoading: r,
        uploadProgress: n,
        selectedCommunityId: l,
        setSelectedCommunityId: c,
        fileInputRef: f,
        handleFileSelect: (k) => {
          if (k.target.files && k.target.files.length > 0) {
            const T = Array.from(k.target.files),
              { validFiles: C, invalidFiles: w, allValid: G } = fN(T);
            if (
              (G ||
                w.forEach(({ file: j, error: _ }) => {
                  W.warning(`${j.name} 無法上傳`, _ || '檔案格式或大小不符合要求');
                }),
              C.length > 0)
            ) {
              o((_) => [..._, ...C]);
              const j = C.map((_) => URL.createObjectURL(_));
              b((_) => ({ ..._, images: [..._.images, ...j] }));
            }
          }
        },
        removeImage: (k) => {
          (b((T) => ({ ...T, images: T.images.filter((C, w) => w !== k) })),
            o((T) => T.filter((C, w) => w !== k)));
        },
        handleSubmit: async () => {
          if (!y.basicValid) {
            W.error('請完成必填欄位', '標題、價格、地址與社區名稱為必填');
            return;
          }
          if (!y.twoGoodOneFairValid) {
            W.error(
              '兩好一公道字數不足',
              `優點至少各 ${Tt.advantage.minLength} 字，公道話至少 ${Tt.disadvantage.minLength} 字`
            );
            return;
          }
          if (!y.images.valid) {
            W.error('請上傳照片', '至少需要一張物件照片');
            return;
          }
          (r(!0), a({ current: 0, total: i.length }));
          try {
            const k = await pn.uploadImages(i, {
              concurrency: 3,
              onProgress: (C, w) => a({ current: C, total: w }),
            });
            if (
              (k.allSuccess ||
                W.warning('部分圖片上傳失敗', '部分照片未能上傳，但我們將繼續處理其他照片'),
              k.urls.length === 0)
            )
              throw new Error('所有圖片上傳失敗，請檢查網路連線後重試');
            const T = await pn.createPropertyWithForm(g, k.urls, l);
            (m({
              public_id: T.public_id,
              community_id: T.community_id,
              community_name: T.community_name || g.communityName,
              is_new_community: !l && T.community_id !== null,
            }),
              x(!0),
              W.success('🎉 刊登成功！', `物件編號：${T.public_id}`));
          } catch (k) {
            (console.error('Publish error:', k),
              W.error('刊登失敗', (k == null ? void 0 : k.message) || '發生未知錯誤'));
          } finally {
            (r(!1), a(null));
          }
        },
        uploadResult: d,
        showConfirmation: u,
      };
    return s.jsx(Sd.Provider, { value: N, children: e });
  },
  or = () => {
    const e = h.useContext(Sd);
    if (e === void 0) throw new Error('useUploadForm must be used within an UploadFormProvider');
    return e;
  },
  Ot =
    'w-full p-3 rounded-xl bg-slate-50 border border-slate-200 focus:ring-2 focus:ring-[#003366] focus:border-transparent outline-none text-sm transition-all',
  gN = () => {
    const { form: e, setForm: t, validation: r, setSelectedCommunityId: n } = or(),
      a = (o) => {
        t((l) => ({ ...l, [o.target.name]: o.target.value }));
      },
      i = (o, l) => {
        (t((c) => ({ ...c, communityName: o })), n(l));
      };
    return s.jsxs('section', {
      className: 'rounded-2xl border border-slate-100 bg-white p-6 shadow-sm',
      children: [
        s.jsxs('h2', {
          className: 'mb-5 flex items-center gap-2 text-lg font-bold text-[#003366]',
          children: [s.jsx(Qe, { size: 20, className: 'text-[#00A8E8]' }), ' 基本資料'],
        }),
        s.jsxs('div', {
          className: 'space-y-4',
          children: [
            s.jsxs('div', {
              children: [
                s.jsx('label', {
                  htmlFor: 'upload-title',
                  className:
                    'mb-1.5 block text-xs font-semibold text-slate-500 uppercase tracking-wider',
                  children: '物件標題 *',
                }),
                s.jsx('input', {
                  id: 'upload-title',
                  name: 'title',
                  value: e.title,
                  onChange: a,
                  className: `${Ot} font-bold ${!r.title.valid && e.title.length > 0 ? 'border-red-300 bg-red-50' : ''}`,
                  placeholder: '例如：信義區101景觀全新裝潢大三房',
                }),
              ],
            }),
            s.jsxs('div', {
              className: 'grid grid-cols-2 gap-4',
              children: [
                s.jsxs('div', {
                  children: [
                    s.jsx('label', {
                      htmlFor: 'upload-price',
                      className:
                        'mb-1.5 block text-xs font-semibold text-slate-500 uppercase tracking-wider',
                      children: '價格 (萬) *',
                    }),
                    s.jsx('input', {
                      id: 'upload-price',
                      name: 'price',
                      type: 'number',
                      value: e.price,
                      onChange: a,
                      className: `${Ot} ${!r.price.valid && e.price.length > 0 ? 'border-red-300 bg-red-50' : ''}`,
                      placeholder: '0',
                    }),
                  ],
                }),
                s.jsxs('div', {
                  children: [
                    s.jsx('label', {
                      htmlFor: 'upload-address',
                      className:
                        'mb-1.5 block text-xs font-semibold text-slate-500 uppercase tracking-wider',
                      children: '地址 *',
                    }),
                    s.jsx('input', {
                      id: 'upload-address',
                      name: 'address',
                      value: e.address,
                      onChange: a,
                      className: `${Ot} ${!r.address.valid && e.address.length > 0 ? 'border-red-300 bg-red-50' : ''}`,
                      placeholder: '台北市信義區...',
                    }),
                  ],
                }),
              ],
            }),
            s.jsxs('div', {
              children: [
                s.jsxs('span', {
                  className:
                    'mb-1.5 block text-xs font-semibold text-slate-500 uppercase tracking-wider',
                  children: [
                    '社區名稱 * ',
                    s.jsx('span', {
                      className: 'text-slate-400 font-normal',
                      children: '(透天/店面請選「無社區」)',
                    }),
                  ],
                }),
                s.jsx(kd, {
                  value: e.communityName,
                  address: e.address,
                  onChange: i,
                  required: !0,
                }),
                !r.communityValid &&
                  e.communityName.length > 0 &&
                  s.jsx('p', {
                    className: 'mt-1.5 text-[11px] text-red-500 font-medium',
                    children: '請輸入完整社區名稱（至少2字）',
                  }),
              ],
            }),
            s.jsxs('div', {
              className: 'grid grid-cols-4 gap-4',
              children: [
                s.jsxs('div', {
                  children: [
                    s.jsx('label', {
                      htmlFor: 'upload-size',
                      className:
                        'mb-1.5 block text-xs font-semibold text-slate-500 uppercase tracking-wider',
                      children: '坪數',
                    }),
                    s.jsx('input', {
                      id: 'upload-size',
                      name: 'size',
                      type: 'number',
                      value: e.size,
                      onChange: a,
                      className: Ot,
                      placeholder: '0',
                    }),
                  ],
                }),
                s.jsxs('div', {
                  children: [
                    s.jsx('label', {
                      htmlFor: 'upload-age',
                      className:
                        'mb-1.5 block text-xs font-semibold text-slate-500 uppercase tracking-wider',
                      children: '屋齡',
                    }),
                    s.jsx('input', {
                      id: 'upload-age',
                      name: 'age',
                      type: 'number',
                      value: e.age,
                      onChange: a,
                      className: Ot,
                      placeholder: '0',
                    }),
                  ],
                }),
                s.jsxs('div', {
                  className: 'col-span-2',
                  children: [
                    s.jsx('label', {
                      htmlFor: 'upload-type',
                      className:
                        'mb-1.5 block text-xs font-semibold text-slate-500 uppercase tracking-wider',
                      children: '類型',
                    }),
                    s.jsxs('select', {
                      id: 'upload-type',
                      name: 'type',
                      value: e.type,
                      onChange: a,
                      className: Ot,
                      children: [
                        s.jsx('option', { children: '電梯大樓' }),
                        s.jsx('option', { children: '公寓' }),
                        s.jsx('option', { children: '透天' }),
                        s.jsx('option', { children: '套房' }),
                      ],
                    }),
                  ],
                }),
              ],
            }),
            s.jsxs('div', {
              className: 'grid grid-cols-3 gap-4',
              children: [
                s.jsxs('div', {
                  children: [
                    s.jsx('label', {
                      htmlFor: 'upload-rooms',
                      className:
                        'mb-1.5 block text-xs font-semibold text-slate-500 uppercase tracking-wider',
                      children: '房',
                    }),
                    s.jsx('input', {
                      id: 'upload-rooms',
                      name: 'rooms',
                      type: 'number',
                      value: e.rooms,
                      onChange: a,
                      className: Ot,
                    }),
                  ],
                }),
                s.jsxs('div', {
                  children: [
                    s.jsx('label', {
                      htmlFor: 'upload-halls',
                      className:
                        'mb-1.5 block text-xs font-semibold text-slate-500 uppercase tracking-wider',
                      children: '廳',
                    }),
                    s.jsx('input', {
                      id: 'upload-halls',
                      name: 'halls',
                      type: 'number',
                      value: e.halls,
                      onChange: a,
                      className: Ot,
                    }),
                  ],
                }),
                s.jsxs('div', {
                  children: [
                    s.jsx('label', {
                      htmlFor: 'upload-bathrooms',
                      className:
                        'mb-1.5 block text-xs font-semibold text-slate-500 uppercase tracking-wider',
                      children: '衛',
                    }),
                    s.jsx('input', {
                      id: 'upload-bathrooms',
                      name: 'bathrooms',
                      type: 'number',
                      value: e.bathrooms,
                      onChange: a,
                      className: Ot,
                    }),
                  ],
                }),
              ],
            }),
          ],
        }),
      ],
    });
  },
  bN = [
    { name: '交通', tags: ['近捷運', '近公車', '近高鐵'] },
    { name: '屋況', tags: ['全新裝潢', '採光佳', '高樓層', '邊間', '景觀戶'] },
    { name: '設施', tags: ['有車位', '有電梯', '有管理', '有中庭'] },
    { name: '生活', tags: ['近學校', '近公園', '近市場', '安靜'] },
    { name: '交易', tags: ['急售', '可議價', '稀有釋出'] },
  ],
  Qr = 5,
  rl = 3,
  yN = 3,
  nl = 5,
  vN = ({ value: e, onChange: t, required: r = !1 }) => {
    const [n, a] = h.useState(['', '', '']),
      i = h.useCallback(
        (x) => {
          e.includes(x) ? t(e.filter((f) => f !== x)) : e.length < Qr && t([...e, x]);
        },
        [e, t]
      ),
      o = h.useCallback(
        (x, f) => {
          const g = f.slice(0, nl),
            b = [...n];
          ((b[x] = g), a(b));
        },
        [n]
      ),
      l = h.useCallback(
        (x) => {
          const f = (n[x] || '').trim();
          if (!f || e.includes(f) || e.length >= Qr) return;
          t([...e, f]);
          const g = [...n];
          ((g[x] = ''), a(g));
        },
        [n, e, t]
      ),
      c = h.useCallback(
        (x) => {
          t(e.filter((f) => f !== x));
        },
        [e, t]
      ),
      d = e.length,
      m = d >= rl,
      u = d >= Qr;
    return s.jsxs('div', {
      className: 'space-y-4',
      children: [
        s.jsxs('div', {
          className: 'flex items-center justify-between',
          children: [
            s.jsxs('span', {
              className: 'text-xs font-medium text-slate-600',
              children: [
                '物件亮點 ',
                r && '*',
                ' ',
                s.jsx('span', {
                  className: 'text-slate-400',
                  children: '（選 3-5 個，每個 5 字內）',
                }),
              ],
            }),
            s.jsxs('span', {
              className: `text-xs font-medium ${m ? 'text-green-600' : 'text-slate-400'}`,
              children: ['已選 ', d, '/', Qr, ' ', m && '✓'],
            }),
          ],
        }),
        s.jsxs('div', {
          className: 'space-y-3 rounded-xl border border-slate-200 bg-slate-50 p-4',
          children: [
            bN.map((x) =>
              s.jsxs(
                'div',
                {
                  children: [
                    s.jsx('span', {
                      className: 'mb-1.5 block text-xs font-medium text-slate-500',
                      children: x.name,
                    }),
                    s.jsx('div', {
                      className: 'flex flex-wrap gap-2',
                      children: x.tags.map((f) => {
                        const g = e.includes(f),
                          b = !g && u;
                        return s.jsxs(
                          'button',
                          {
                            type: 'button',
                            onClick: () => i(f),
                            disabled: b,
                            className: `flex items-center gap-1 rounded-full px-3 py-1.5 text-sm font-medium transition-all ${g ? 'bg-[#003366] text-white shadow-sm' : b ? 'cursor-not-allowed bg-slate-200 text-slate-400' : 'bg-white text-slate-600 shadow-sm hover:bg-blue-50 hover:text-[#003366]'}`,
                            children: [g && s.jsx(wt, { size: 14 }), f],
                          },
                          f
                        );
                      }),
                    }),
                  ],
                },
                x.name
              )
            ),
            s.jsxs('div', {
              children: [
                s.jsxs('span', {
                  className: 'mb-1.5 block text-xs font-medium text-slate-500',
                  children: ['自訂（選填，最多 ', yN, ' 個）'],
                }),
                s.jsx('div', {
                  className: 'flex flex-wrap gap-2',
                  children: n.map((x, f) =>
                    s.jsxs(
                      'div',
                      {
                        className: 'flex items-center gap-1',
                        children: [
                          s.jsx('input', {
                            type: 'text',
                            value: x,
                            onChange: (g) => o(f, g.target.value),
                            onKeyDown: (g) => {
                              g.key === 'Enter' && (g.preventDefault(), l(f));
                            },
                            placeholder: '自訂...',
                            maxLength: nl,
                            disabled: u,
                            className:
                              'w-20 rounded-lg border border-slate-200 bg-white px-2 py-1.5 text-sm text-slate-700 placeholder:text-slate-300 focus:border-[#003366] focus:outline-none focus:ring-1 focus:ring-[#003366] disabled:cursor-not-allowed disabled:bg-slate-100',
                          }),
                          x.trim() &&
                            !u &&
                            s.jsx('button', {
                              type: 'button',
                              onClick: () => l(f),
                              className:
                                'rounded-full bg-[#003366] p-1 text-white transition hover:bg-[#004488]',
                              children: s.jsx(fr, { size: 14 }),
                            }),
                        ],
                      },
                      f
                    )
                  ),
                }),
              ],
            }),
          ],
        }),
        e.length > 0 &&
          s.jsxs('div', {
            className: 'flex flex-wrap items-center gap-2',
            children: [
              s.jsx('span', {
                className: 'text-xs text-slate-500',
                children: '已選：',
              }),
              e.map((x) =>
                s.jsxs(
                  'span',
                  {
                    className:
                      'flex items-center gap-1 rounded-full bg-blue-100 px-2.5 py-1 text-sm font-medium text-[#003366]',
                    children: [
                      x,
                      s.jsx('button', {
                        type: 'button',
                        onClick: () => c(x),
                        className:
                          'rounded-full p-0.5 text-blue-400 transition hover:bg-blue-200 hover:text-blue-600',
                        children: s.jsx(is, { size: 12 }),
                      }),
                    ],
                  },
                  x
                )
              ),
            ],
          }),
        r &&
          !m &&
          e.length > 0 &&
          s.jsxs('p', {
            className: 'text-xs text-amber-600',
            children: ['請至少選擇 ', rl, ' 個亮點'],
          }),
      ],
    });
  },
  jN = () => {
    const { form: e, setForm: t, validation: r } = or(),
      n = (a) => {
        t((i) => ({ ...i, highlights: a }));
      };
    return s.jsxs('section', {
      className: 'rounded-2xl border border-slate-100 bg-white p-6 shadow-sm',
      children: [
        s.jsxs('h2', {
          className: 'mb-5 flex items-center gap-2 text-lg font-bold text-[#003366]',
          children: [s.jsx(Nn, { size: 20, className: 'text-blue-500' }), ' 物件特色'],
        }),
        s.jsxs('div', {
          className: 'rounded-xl bg-blue-50/30 p-5 border border-blue-100/50',
          children: [
            s.jsx('label', {
              htmlFor: 'highlight-picker',
              className: 'mb-4 flex items-center gap-2 text-sm font-bold text-blue-800',
              children: '重點膠囊 (至少 3 個)',
            }),
            s.jsx('input', {
              id: 'highlight-picker',
              className: 'sr-only',
              'aria-hidden': 'true',
              tabIndex: -1,
              readOnly: !0,
            }),
            s.jsx(vN, { value: e.highlights || [], onChange: n }),
            !r.highlights.valid &&
              s.jsxs('p', {
                className: 'mt-3 text-xs text-red-500 flex items-center gap-1.5 font-medium',
                children: [s.jsx(ss, { size: 14 }), ' ', r.highlights.message],
              }),
            r.highlights.warnings.length > 0 &&
              s.jsx('div', {
                className: 'mt-3 space-y-1',
                children: r.highlights.warnings.map((a, i) =>
                  s.jsxs(
                    'p',
                    {
                      className: 'text-xs text-amber-600 flex items-center gap-1.5',
                      children: [s.jsx(ss, { size: 14 }), ' ', a],
                    },
                    i
                  )
                ),
              }),
          ],
        }),
      ],
    });
  },
  Kn =
    'w-full p-3 rounded-xl bg-slate-50 border border-slate-200 focus:ring-2 focus:ring-[#003366] focus:border-transparent outline-none text-sm transition-all',
  wN = () => {
    const { form: e, setForm: t, validation: r } = or(),
      n = (a) => {
        t((i) => ({ ...i, [a.target.name]: a.target.value }));
      };
    return s.jsxs('section', {
      className: 'rounded-2xl border border-slate-100 bg-white p-6 shadow-sm',
      children: [
        s.jsxs('div', {
          className: 'mb-5 flex items-center gap-2',
          children: [
            s.jsx(rn, { className: 'text-orange-500', size: 22 }),
            s.jsxs('div', {
              children: [
                s.jsx('h2', {
                  className: 'text-lg font-bold text-[#003366]',
                  children: '兩好一公道',
                }),
                s.jsx('p', {
                  className: 'text-xs text-slate-500',
                  children: '誠實揭露，建立買賣信任',
                }),
              ],
            }),
          ],
        }),
        s.jsxs('div', {
          className: 'space-y-5',
          children: [
            s.jsxs('div', {
              children: [
                s.jsxs('label', {
                  htmlFor: 'upload-advantage1',
                  className:
                    'mb-1.5 flex items-center gap-1.5 text-xs font-semibold text-green-700 uppercase tracking-wider',
                  children: [s.jsx(ea, { size: 14 }), ' 優點 1'],
                }),
                s.jsx('input', {
                  id: 'upload-advantage1',
                  name: 'advantage1',
                  value: e.advantage1,
                  onChange: n,
                  className: `${Kn} ${r.advantage1.valid ? 'border-green-200 bg-green-50/30' : ''} ${r.advantage1.contentWarning ? 'border-red-300' : ''}`,
                  placeholder: '例如：格局方正，採光極佳',
                }),
                s.jsxs('div', {
                  className: 'mt-1.5 flex items-center justify-between px-1',
                  children: [
                    s.jsxs('span', {
                      className: `text-[11px] font-medium ${r.advantage1.valid ? 'text-green-600' : 'text-slate-400'}`,
                      children: [
                        e.advantage1.length,
                        ' 字 ',
                        r.advantage1.valid ? '✓' : `(需 ${r.advantage1.message})`,
                      ],
                    }),
                    r.advantage1.contentWarning &&
                      s.jsxs('span', {
                        className: 'flex items-center gap-1 text-[11px] text-red-500 font-medium',
                        children: [s.jsx(ss, { size: 12 }), ' ', r.advantage1.contentWarning],
                      }),
                  ],
                }),
              ],
            }),
            s.jsxs('div', {
              children: [
                s.jsxs('label', {
                  htmlFor: 'upload-advantage2',
                  className:
                    'mb-1.5 flex items-center gap-1.5 text-xs font-semibold text-green-700 uppercase tracking-wider',
                  children: [s.jsx(ea, { size: 14 }), ' 優點 2'],
                }),
                s.jsx('input', {
                  id: 'upload-advantage2',
                  name: 'advantage2',
                  value: e.advantage2,
                  onChange: n,
                  className: `${Kn} ${r.advantage2.valid ? 'border-green-200 bg-green-50/30' : ''} ${r.advantage2.contentWarning ? 'border-red-300' : ''}`,
                  placeholder: '例如：近捷運站，生活機能好',
                }),
                s.jsxs('div', {
                  className: 'mt-1.5 flex items-center justify-between px-1',
                  children: [
                    s.jsxs('span', {
                      className: `text-[11px] font-medium ${r.advantage2.valid ? 'text-green-600' : 'text-slate-400'}`,
                      children: [
                        e.advantage2.length,
                        ' 字 ',
                        r.advantage2.valid ? '✓' : `(需 ${r.advantage2.message})`,
                      ],
                    }),
                    r.advantage2.contentWarning &&
                      s.jsxs('span', {
                        className: 'flex items-center gap-1 text-[11px] text-red-500 font-medium',
                        children: [s.jsx(ss, { size: 12 }), ' ', r.advantage2.contentWarning],
                      }),
                  ],
                }),
              ],
            }),
            s.jsxs('div', {
              children: [
                s.jsxs('label', {
                  htmlFor: 'upload-disadvantage',
                  className:
                    'mb-1.5 flex items-center gap-1.5 text-xs font-semibold text-orange-700 uppercase tracking-wider',
                  children: [s.jsx(du, { size: 14 }), ' 誠實公道話'],
                }),
                s.jsx('input', {
                  id: 'upload-disadvantage',
                  name: 'disadvantage',
                  value: e.disadvantage,
                  onChange: n,
                  className: `${Kn} ${r.disadvantage.valid ? 'border-orange-200 bg-orange-50/30' : ''} ${r.disadvantage.contentWarning ? 'border-red-300' : ''}`,
                  placeholder: '例如：臨路有車流聲，建議加裝氣密窗',
                }),
                s.jsxs('div', {
                  className: 'mt-1.5 flex items-center justify-between px-1',
                  children: [
                    s.jsxs('span', {
                      className: `text-[11px] font-medium ${r.disadvantage.valid ? 'text-orange-600' : 'text-slate-400'}`,
                      children: [
                        e.disadvantage.length,
                        ' 字 ',
                        r.disadvantage.valid ? '✓' : `(需 ${r.disadvantage.message})`,
                      ],
                    }),
                    r.disadvantage.contentWarning &&
                      s.jsxs('span', {
                        className: 'flex items-center gap-1 text-[11px] text-red-500 font-medium',
                        children: [s.jsx(ss, { size: 12 }), ' ', r.disadvantage.contentWarning],
                      }),
                  ],
                }),
              ],
            }),
          ],
        }),
        r.contentCheck.hasIssues &&
          s.jsxs('div', {
            className: `mt-5 flex items-start gap-3 rounded-xl p-4 ${r.contentCheck.blockSubmit ? 'border border-red-200 bg-red-50' : 'border border-yellow-200 bg-yellow-50'}`,
            children: [
              s.jsx(ss, {
                className: r.contentCheck.blockSubmit ? 'text-red-500' : 'text-yellow-600',
                size: 20,
              }),
              s.jsxs('div', {
                children: [
                  s.jsx('p', {
                    className: `text-sm font-bold ${r.contentCheck.blockSubmit ? 'text-red-700' : 'text-yellow-700'}`,
                    children: r.contentCheck.blockSubmit ? '內容不符合發布規範' : '內容需要注意',
                  }),
                  s.jsx('ul', {
                    className: 'mt-1.5 space-y-1 text-xs text-slate-600',
                    children: r.contentCheck.warnings.map((a, i) =>
                      s.jsxs(
                        'li',
                        {
                          className: 'flex items-center gap-1.5',
                          children: ['• ', a],
                        },
                        i
                      )
                    ),
                  }),
                ],
              }),
            ],
          }),
      ],
    });
  },
  NN =
    'w-full p-3 rounded-xl bg-slate-50 border border-slate-200 focus:ring-2 focus:ring-[#003366] focus:border-transparent outline-none text-sm transition-all',
  _N = () => {
    const { form: e, setForm: t, fileInputRef: r, handleFileSelect: n, removeImage: a } = or(),
      i = (o) => {
        t((l) => ({ ...l, [o.target.name]: o.target.value }));
      };
    return s.jsxs('section', {
      className: 'rounded-2xl border border-slate-100 bg-white p-6 shadow-sm',
      children: [
        s.jsxs('h2', {
          className: 'mb-5 flex items-center gap-2 text-lg font-bold text-[#003366]',
          children: [s.jsx(Nn, { size: 20, className: 'text-yellow-500' }), ' 文案與照片'],
        }),
        s.jsxs('div', {
          className: 'space-y-5',
          children: [
            s.jsxs('div', {
              children: [
                s.jsx('label', {
                  htmlFor: 'upload-description',
                  className:
                    'mb-1.5 block text-xs font-semibold text-slate-500 uppercase tracking-wider',
                  children: '物件描述',
                }),
                s.jsx('textarea', {
                  id: 'upload-description',
                  name: 'description',
                  value: e.description,
                  onChange: i,
                  rows: 4,
                  className: `${NN} resize-none`,
                  placeholder: '詳細介紹這個物件的特色、生活機能、交通便利性...',
                }),
              ],
            }),
            s.jsxs('div', {
              children: [
                s.jsxs('span', {
                  className:
                    'mb-3 block text-xs font-semibold text-slate-500 uppercase tracking-wider',
                  children: [
                    '物件照片 * ',
                    s.jsx('span', {
                      className: 'text-slate-400 font-normal',
                      children: '(至少 1 張)',
                    }),
                  ],
                }),
                s.jsxs('div', {
                  className: 'grid grid-cols-4 gap-4',
                  children: [
                    e.images.map((o, l) =>
                      s.jsxs(
                        'div',
                        {
                          className:
                            'group relative aspect-square overflow-hidden rounded-xl border border-slate-200 shadow-sm',
                          children: [
                            s.jsx('img', {
                              src: o,
                              alt: '',
                              className:
                                'size-full object-cover transition-transform duration-300 group-hover:scale-110',
                            }),
                            s.jsx('div', {
                              className:
                                'absolute inset-0 bg-black/20 opacity-0 transition-opacity group-hover:opacity-100',
                            }),
                            s.jsx('button', {
                              onClick: () => a(l),
                              className:
                                'absolute right-1.5 top-1.5 rounded-full bg-red-500 p-1.5 text-white shadow-lg transition-transform hover:scale-110',
                              children: s.jsx(is, { size: 14 }),
                            }),
                            l === 0 &&
                              s.jsx('span', {
                                className:
                                  'absolute bottom-1.5 left-1.5 rounded-md bg-[#003366]/90 px-2 py-1 text-[10px] font-bold text-white backdrop-blur-sm',
                                children: '封面',
                              }),
                          ],
                        },
                        l
                      )
                    ),
                    s.jsxs('button', {
                      onClick: () => {
                        var o;
                        return (o = r.current) == null ? void 0 : o.click();
                      },
                      className:
                        'flex aspect-square flex-col items-center justify-center rounded-xl border-2 border-dashed border-slate-200 bg-slate-50 text-slate-400 transition-all hover:border-[#00A8E8] hover:bg-blue-50 hover:text-[#00A8E8]',
                      children: [
                        s.jsx(wl, { size: 28 }),
                        s.jsx('span', {
                          className: 'mt-2 text-xs font-bold',
                          children: '上傳照片',
                        }),
                      ],
                    }),
                    s.jsx('input', {
                      type: 'file',
                      multiple: !0,
                      ref: r,
                      onChange: n,
                      className: 'hidden',
                      accept: 'image/*',
                    }),
                  ],
                }),
              ],
            }),
          ],
        }),
      ],
    });
  },
  kN = () => {
    const { form: e, selectedCommunityId: t } = or(),
      r = h.useMemo(
        () =>
          _d({
            advantage1: e.advantage1,
            advantage2: e.advantage2,
            features: e.highlights,
            size: parseFloat(e.size) || 0,
            rooms: parseInt(e.rooms) || 0,
            halls: parseInt(e.halls) || 0,
            floorCurrent: e.floorCurrent,
            floorTotal: parseInt(e.floorTotal) || 0,
          }),
        [e]
      );
    return !e.title && !e.price && e.images.length === 0
      ? null
      : s.jsxs('section', {
          className: 'rounded-2xl border border-slate-200 bg-slate-50/50 p-5',
          children: [
            s.jsxs('h3', {
              className:
                'mb-4 flex items-center gap-2 text-sm font-bold text-slate-500 uppercase tracking-wider',
              children: [s.jsx(tr, { size: 16, className: 'text-slate-400' }), ' 即時預覽'],
            }),
            s.jsxs('div', {
              className:
                'overflow-hidden rounded-2xl border border-slate-200 bg-white shadow-md transition-all hover:shadow-lg',
              children: [
                e.images.length > 0 &&
                  s.jsx('div', {
                    className: 'aspect-video overflow-hidden',
                    children: s.jsx('img', {
                      src: e.images[0],
                      alt: '',
                      className: 'size-full object-cover',
                    }),
                  }),
                s.jsxs('div', {
                  className: 'p-5',
                  children: [
                    s.jsx('h4', {
                      className: 'text-lg font-bold text-slate-900 leading-tight',
                      children: e.title || '物件標題',
                    }),
                    s.jsxs('p', {
                      className: 'mt-1.5 text-sm text-slate-500 flex items-center gap-1',
                      children: [s.jsx(tr, { size: 14 }), ' ', e.address || '地址'],
                    }),
                    s.jsxs('div', {
                      className: 'mt-3 flex items-baseline gap-1.5',
                      children: [
                        s.jsx('span', {
                          className: 'text-2xl font-black text-[#003366]',
                          children: e.price || '0',
                        }),
                        s.jsx('span', {
                          className: 'text-sm font-bold text-slate-500',
                          children: '萬',
                        }),
                      ],
                    }),
                    s.jsxs('div', {
                      className: 'mt-4 flex flex-wrap gap-2',
                      children: [
                        r.map((n, a) =>
                          s.jsx(
                            'span',
                            {
                              className:
                                'rounded-full bg-blue-50 px-3 py-1 text-xs font-bold text-[#003366] border border-blue-100',
                              children: n,
                            },
                            a
                          )
                        ),
                        r.length === 0 &&
                          s.jsx('span', {
                            className: 'text-xs text-slate-400 italic',
                            children: '尚未生成標籤',
                          }),
                      ],
                    }),
                    e.communityName &&
                      s.jsx('div', {
                        className: 'mt-4 border-t border-slate-100 pt-3 text-xs text-slate-500',
                        children: s.jsxs('span', {
                          className: 'flex items-center gap-1.5',
                          children: [
                            '🏘️ 社區牆：',
                            s.jsx('span', {
                              className: t ? 'font-bold text-green-600' : 'font-bold text-blue-600',
                              children: e.communityName,
                            }),
                            t
                              ? s.jsx('span', {
                                  className: 'text-green-600 bg-green-50 px-1.5 py-0.5 rounded',
                                  children: '已連結現有社區',
                                })
                              : s.jsx('span', {
                                  className: 'text-blue-600 bg-blue-50 px-1.5 py-0.5 rounded',
                                  children: '將自動建立新社區',
                                }),
                          ],
                        }),
                      }),
                  ],
                }),
              ],
            }),
          ],
        });
  },
  SN = () => {
    const e = yn(),
      {
        loading: t,
        setLoading: r,
        uploadProgress: n,
        setForm: a,
        validation: i,
        handleSubmit: o,
        uploadResult: l,
        showConfirmation: c,
      } = or(),
      [d, m] = h.useState(null);
    h.useEffect(() => {
      de.auth.getUser().then(({ data: x }) => {
        m(x.user);
      });
    }, []);
    const u = () => {
      prompt('請貼上 591 網址') &&
        (r(!0),
        setTimeout(() => {
          (a((f) => ({
            ...f,
            title: '【急售】信義區捷運景觀豪邸',
            price: '2880',
            address: '台北市信義區忠孝東路',
            size: '45.2',
            sourceExternalId: '591-MOCK-ID',
          })),
            r(!1));
        }, 1e3));
    };
    return c && l
      ? s.jsx('div', {
          className: 'min-h-screen bg-slate-50 px-4 py-12',
          children: s.jsxs('div', {
            className: 'mx-auto max-w-md overflow-hidden rounded-3xl bg-white shadow-2xl',
            children: [
              s.jsxs('div', {
                className: 'bg-green-500 py-10 text-center text-white',
                children: [
                  s.jsx('div', {
                    className:
                      'mx-auto mb-4 flex size-20 items-center justify-center rounded-full bg-white/20 backdrop-blur-sm',
                    children: s.jsx(wt, { size: 40, strokeWidth: 3 }),
                  }),
                  s.jsx('h1', {
                    className: 'text-2xl font-black',
                    children: '上傳成功！',
                  }),
                  s.jsx('p', {
                    className: 'mt-1 opacity-90',
                    children: '您的物件已正式發佈',
                  }),
                ],
              }),
              s.jsxs('div', {
                className: 'p-8',
                children: [
                  s.jsxs('div', {
                    className: 'mb-8 space-y-4',
                    children: [
                      s.jsxs('div', {
                        className: 'flex items-center gap-4 rounded-2xl bg-slate-50 p-4',
                        children: [
                          s.jsx('div', {
                            className:
                              'flex size-12 items-center justify-center rounded-xl bg-blue-100 text-blue-600',
                            children: s.jsx(Qe, { size: 24 }),
                          }),
                          s.jsxs('div', {
                            children: [
                              s.jsx('p', {
                                className: 'text-xs font-bold text-slate-400 uppercase',
                                children: '物件編號',
                              }),
                              s.jsx('p', {
                                className: 'font-mono font-bold text-slate-700',
                                children: l.public_id,
                              }),
                            ],
                          }),
                        ],
                      }),
                      l.community_name &&
                        s.jsxs('div', {
                          className: 'flex items-center gap-4 rounded-2xl bg-slate-50 p-4',
                          children: [
                            s.jsx('div', {
                              className:
                                'flex size-12 items-center justify-center rounded-xl bg-orange-100 text-orange-600',
                              children: s.jsx(mr, { size: 24 }),
                            }),
                            s.jsxs('div', {
                              children: [
                                s.jsx('p', {
                                  className: 'text-xs font-bold text-slate-400 uppercase',
                                  children: '社區牆',
                                }),
                                s.jsx('p', {
                                  className: 'font-bold text-slate-700',
                                  children: l.community_name,
                                }),
                                l.is_new_community &&
                                  s.jsx('span', {
                                    className:
                                      'mt-0.5 inline-block rounded bg-orange-500 px-1.5 py-0.5 text-[10px] font-bold text-white',
                                    children: '新建立',
                                  }),
                              ],
                            }),
                          ],
                        }),
                    ],
                  }),
                  s.jsxs('div', {
                    className: 'grid grid-cols-1 gap-3',
                    children: [
                      s.jsx(We, {
                        to: `/p/${l.public_id}`,
                        className:
                          'flex items-center justify-center gap-2 rounded-xl bg-[#003366] py-4 font-bold text-white transition-all hover:bg-[#002244] active:scale-[0.98]',
                        children: '查看物件詳情',
                      }),
                      l.community_id &&
                        s.jsx(We, {
                          to: `/community/${l.community_id}`,
                          className:
                            'flex items-center justify-center gap-2 rounded-xl border-2 border-[#003366] py-4 font-bold text-[#003366] transition-all hover:bg-blue-50 active:scale-[0.98]',
                          children: '前往社區牆',
                        }),
                      s.jsx('button', {
                        onClick: () => window.location.reload(),
                        className: 'mt-2 text-sm font-bold text-slate-400 hover:text-slate-600',
                        children: '繼續上傳下一個',
                      }),
                    ],
                  }),
                ],
              }),
            ],
          }),
        })
      : s.jsxs('div', {
          className: 'min-h-screen bg-slate-50 pb-20',
          children: [
            s.jsx('header', {
              className: 'sticky top-0 z-30 border-b border-slate-200 bg-white/80 backdrop-blur-md',
              children: s.jsxs('div', {
                className: 'mx-auto flex max-w-5xl items-center justify-between px-4 py-4',
                children: [
                  s.jsxs('div', {
                    className: 'flex items-center gap-4',
                    children: [
                      s.jsx('button', {
                        onClick: () => e(-1),
                        className:
                          'rounded-full p-2 text-slate-400 hover:bg-slate-100 hover:text-slate-600',
                        children: s.jsx(Ma, { size: 20 }),
                      }),
                      s.jsx('h1', {
                        className: 'text-xl font-black text-[#003366]',
                        children: '刊登物件',
                      }),
                    ],
                  }),
                  s.jsxs('div', {
                    className: 'flex items-center gap-3',
                    children: [
                      s.jsxs('button', {
                        onClick: u,
                        className:
                          'hidden items-center gap-2 rounded-full bg-orange-50 px-4 py-2 text-sm font-bold text-orange-600 transition-all hover:bg-orange-100 sm:flex',
                        children: [s.jsx(uu, { size: 16 }), ' 591 搬家'],
                      }),
                      !d &&
                        s.jsx(We, {
                          to: '/auth',
                          className: 'text-sm font-bold text-blue-600 hover:underline',
                          children: '登入以同步',
                        }),
                    ],
                  }),
                ],
              }),
            }),
            s.jsx('main', {
              className: 'mx-auto mt-8 max-w-5xl px-4',
              children: s.jsxs('div', {
                className: 'grid grid-cols-1 gap-8 lg:grid-cols-12',
                children: [
                  s.jsxs('div', {
                    className: 'space-y-8 lg:col-span-7',
                    children: [s.jsx(gN, {}), s.jsx(jN, {}), s.jsx(wN, {}), s.jsx(_N, {})],
                  }),
                  s.jsx('div', {
                    className: 'lg:col-span-5',
                    children: s.jsxs('div', {
                      className: 'sticky top-24 space-y-6',
                      children: [
                        s.jsx(kN, {}),
                        s.jsxs('div', {
                          className: 'rounded-2xl bg-white p-6 shadow-sm border border-slate-100',
                          children: [
                            s.jsxs('div', {
                              className: 'mb-4 flex items-center justify-between',
                              children: [
                                s.jsx('h3', {
                                  className:
                                    'text-sm font-bold text-slate-500 uppercase tracking-wider',
                                  children: '發佈確認',
                                }),
                                s.jsx('span', {
                                  className: `text-xs font-bold ${i.canSubmit ? 'text-green-500' : 'text-red-400'}`,
                                  children: i.canSubmit ? '✓ 資料已齊全' : '⚠ 尚有必填欄位',
                                }),
                              ],
                            }),
                            s.jsx('button', {
                              onClick: o,
                              disabled: !i.canSubmit || t,
                              className: `group relative w-full overflow-hidden rounded-xl py-4 font-black text-white transition-all active:scale-[0.98] ${i.canSubmit && !t ? 'bg-gradient-to-r from-[#003366] to-[#00A8E8] shadow-lg shadow-blue-200 hover:translate-y-[-2px] hover:shadow-xl' : 'cursor-not-allowed bg-slate-300'}`,
                              children: t
                                ? s.jsxs('div', {
                                    className: 'flex items-center justify-center gap-3',
                                    children: [
                                      s.jsx(pr, {
                                        className: 'animate-spin',
                                        size: 20,
                                      }),
                                      s.jsx('span', {
                                        children: n
                                          ? `上傳中 ${Math.round((n.current / n.total) * 100)}%`
                                          : '處理中...',
                                      }),
                                    ],
                                  })
                                : s.jsxs('div', {
                                    className: 'flex items-center justify-center gap-2',
                                    children: [
                                      s.jsx(mu, { size: 20 }),
                                      s.jsx('span', {
                                        children: '立即發佈物件',
                                      }),
                                    ],
                                  }),
                            }),
                            s.jsxs('p', {
                              className:
                                'mt-4 text-center text-[11px] leading-relaxed text-slate-400',
                              children: [
                                '點擊發佈即代表您同意 ',
                                s.jsx(We, {
                                  to: '/terms',
                                  className: 'underline',
                                  children: '服務條款',
                                }),
                                ' 與 ',
                                s.jsx(We, {
                                  to: '/privacy',
                                  className: 'underline',
                                  children: '隱私權政策',
                                }),
                                '，並保證所提供之資訊真實無誤。',
                              ],
                            }),
                          ],
                        }),
                      ],
                    }),
                  }),
                ],
              }),
            }),
          ],
        });
  },
  EN = () => s.jsx(xN, { children: s.jsx(SN, {}) }),
  TN = () => {
    const { publicId: e } = Er(),
      [t] = Tr(),
      r = yn(),
      [n, a] = h.useState(!0),
      [i, o] = h.useState(!1),
      [l, c] = h.useState(null),
      [d, m] = h.useState(null),
      [u, x] = h.useState(''),
      [f, g] = h.useState(),
      [b, y] = h.useState(!1),
      p = t.get('fix') === 'community';
    h.useEffect(() => {
      (async () => {
        if (e)
          try {
            const { data: k, error: T } = await de
              .from('properties')
              .select('id, public_id, title, address, community_id, community_name')
              .eq('public_id', e)
              .single();
            if (T) throw T;
            (c(k), x(k.community_name || ''), g(k.community_id || void 0));
          } catch (k) {
            m('無法載入物件資料：' + k.message);
          } finally {
            a(!1);
          }
      })();
    }, [e]);
    const E = (N, k) => {
        (x(N),
          g(k),
          y(
            N !== (l == null ? void 0 : l.community_name) ||
              k !== (l == null ? void 0 : l.community_id)
          ));
      },
      S = async () => {
        if (!(!l || !b)) {
          o(!0);
          try {
            const { error: N } = await de
              .from('properties')
              .update({ community_id: f || null, community_name: u || null })
              .eq('id', l.id);
            if (N) throw N;
            r(`/property/${e}`, { state: { message: '社區歸屬已更新！' } });
          } catch (N) {
            m('儲存失敗：' + N.message);
          } finally {
            o(!1);
          }
        }
      };
    return n
      ? s.jsx('div', {
          className: 'flex min-h-screen items-center justify-center bg-[#f8fafc]',
          children: s.jsx(pr, {
            className: 'animate-spin text-[#003366]',
            size: 40,
          }),
        })
      : d || !l
        ? s.jsx('div', {
            className: 'flex min-h-screen items-center justify-center bg-[#f8fafc]',
            children: s.jsxs('div', {
              className: 'text-center',
              children: [
                s.jsx(ss, { size: 48, className: 'mx-auto mb-4 text-red-500' }),
                s.jsx('p', {
                  className: 'text-red-600',
                  children: d || '找不到物件',
                }),
                s.jsx('button', {
                  onClick: () => r(-1),
                  className: 'mt-4 text-blue-600 underline',
                  children: '返回',
                }),
              ],
            }),
          })
        : s.jsxs('div', {
            className: 'min-h-screen bg-[#f8fafc] font-sans text-slate-800',
            children: [
              s.jsxs('nav', {
                className:
                  'sticky top-0 z-overlay flex h-16 items-center border-b border-slate-100 bg-white/90 px-4 shadow-sm backdrop-blur-md',
                children: [
                  s.jsx('button', {
                    onClick: () => r(-1),
                    className: 'mr-3 rounded-full p-2 transition-colors hover:bg-slate-100',
                    children: s.jsx(Ma, {
                      size: 20,
                      className: 'text-slate-600',
                    }),
                  }),
                  s.jsxs('div', {
                    className: 'flex items-center gap-2 text-xl font-extrabold text-[#003366]',
                    children: [
                      s.jsx('div', {
                        className:
                          'flex size-8 items-center justify-center rounded-lg bg-gradient-to-br from-[#003366] to-[#00A8E8] text-white',
                        children: s.jsx(Qe, { size: 18 }),
                      }),
                      p ? '修正社區歸屬' : '編輯物件',
                    ],
                  }),
                ],
              }),
              s.jsxs('main', {
                className: 'mx-auto max-w-lg p-6 py-8',
                children: [
                  s.jsxs('section', {
                    className: 'mb-6 rounded-2xl border border-slate-100 bg-white p-5 shadow-sm',
                    children: [
                      s.jsx('h2', {
                        className: 'mb-2 font-bold text-slate-800',
                        children: l.title,
                      }),
                      s.jsx('p', {
                        className: 'text-sm text-slate-500',
                        children: l.address,
                      }),
                      s.jsxs('p', {
                        className: 'mt-1 text-xs text-slate-400',
                        children: ['物件編號：', l.public_id],
                      }),
                    ],
                  }),
                  s.jsxs('section', {
                    className: 'mb-6 rounded-2xl border border-slate-100 bg-white p-5 shadow-sm',
                    children: [
                      s.jsxs('div', {
                        className: 'mb-4 flex items-center gap-2',
                        children: [
                          s.jsx(mr, { className: 'text-blue-600', size: 20 }),
                          s.jsx('h3', {
                            className: 'font-bold text-slate-800',
                            children: '社區歸屬',
                          }),
                        ],
                      }),
                      s.jsxs('div', {
                        className: 'mb-4 rounded-xl bg-slate-50 p-3',
                        children: [
                          s.jsx('p', {
                            className: 'mb-1 text-xs text-slate-500',
                            children: '目前歸屬',
                          }),
                          s.jsx('p', {
                            className: 'font-medium text-slate-700',
                            children: l.community_name || '（無社區）',
                          }),
                        ],
                      }),
                      s.jsxs('div', {
                        children: [
                          s.jsx('span', {
                            id: 'edit-community-label',
                            className: 'mb-2 block text-xs font-medium text-slate-600',
                            children: '重新選擇社區',
                          }),
                          s.jsx(kd, {
                            value: u,
                            address: l.address,
                            onChange: E,
                            required: !0,
                          }),
                        ],
                      }),
                      b &&
                        s.jsx('div', {
                          className: 'mt-4 rounded-xl border border-amber-200 bg-amber-50 p-3',
                          children: s.jsxs('p', {
                            className: 'flex items-center gap-2 text-sm text-amber-700',
                            children: [
                              s.jsx(ss, { size: 16 }),
                              '社區歸屬將變更為：',
                              s.jsx('span', {
                                className: 'font-medium',
                                children: u || '無',
                              }),
                            ],
                          }),
                        }),
                    ],
                  }),
                  s.jsx('button', {
                    onClick: S,
                    disabled: !b || i,
                    className: `
            flex w-full items-center justify-center gap-2 rounded-xl py-4 text-lg font-bold transition-all
            ${b && !i ? 'bg-gradient-to-r from-[#003366] to-[#00A8E8] text-white shadow-lg hover:scale-[1.01]' : 'cursor-not-allowed bg-slate-200 text-slate-400'}
          `,
                    children: i
                      ? s.jsxs(s.Fragment, {
                          children: [
                            s.jsx(pr, { className: 'animate-spin', size: 20 }),
                            '儲存中...',
                          ],
                        })
                      : s.jsxs(s.Fragment, {
                          children: [s.jsx(hu, { size: 20 }), b ? '確認修正' : '無變更'],
                        }),
                  }),
                  s.jsx('button', {
                    onClick: () => r(-1),
                    className:
                      'mt-3 w-full rounded-xl bg-slate-100 py-3 font-medium text-slate-600 transition hover:bg-slate-200',
                    children: '取消',
                  }),
                ],
              }),
            ],
          });
  },
  IN = new Gu({
    defaultOptions: { queries: { staleTime: 1e3 * 60 * 5, retry: 1 } },
  });
function CN() {
  const [e, t] = h.useState(null),
    r = gl();
  return (
    h.useEffect(() => {
      Ul().then(t);
    }, []),
    h.useEffect(() => {
      e && Ga('page_view', r.pathname);
    }, [r, e]),
    e
      ? s.jsx(Hu, {
          client: IN,
          children: s.jsx(Fm, {
            children: s.jsxs(G1, {
              children: [
                s.jsx(Cm, {
                  position: 'top-right',
                  theme: 'light',
                  richColors: !0,
                  closeButton: !0,
                  toastOptions: { duration: 3200 },
                }),
                s.jsxs(
                  Pd,
                  {
                    children: [
                      s.jsx(ot, {
                        path: '/',
                        element: s.jsx(dt, {
                          children: s.jsx(gy, { config: e }),
                        }),
                      }),
                      s.jsx(ot, {
                        path: '/feed/:userId',
                        element: s.jsx(dt, { children: s.jsx(Av, {}) }),
                      }),
                      s.jsx(ot, { path: '/uag', element: s.jsx(Fw, {}) }),
                      s.jsx(ot, {
                        path: '/community/:id/wall',
                        element: s.jsx(dt, { children: s.jsx(E1, {}) }),
                      }),
                      s.jsx(ot, {
                        path: '/community/suggested',
                        element: s.jsx(dt, { children: s.jsx(T1, {}) }),
                      }),
                      s.jsx(ot, {
                        path: '/property/upload',
                        element: s.jsx(dt, { children: s.jsx(EN, {}) }),
                      }),
                      s.jsx(ot, {
                        path: '/property/:publicId/edit',
                        element: s.jsx(dt, { children: s.jsx(TN, {}) }),
                      }),
                      s.jsx(ot, {
                        path: '/property/:id',
                        element: s.jsx(dt, { children: s.jsx(sN, {}) }),
                      }),
                      s.jsx(ot, {
                        path: '/p/:id',
                        element: s.jsx(dt, { children: s.jsx(D1, {}) }),
                      }),
                      s.jsx(ot, {
                        path: '/maihouses/trust/room',
                        element: s.jsx(dt, { children: s.jsx(Qo, {}) }),
                      }),
                      s.jsx(ot, {
                        path: '/assure',
                        element: s.jsx(dt, { children: s.jsx(Qo, {}) }),
                      }),
                      s.jsx(ot, {
                        path: '/chat',
                        element: s.jsx(dt, { children: s.jsx(U1, {}) }),
                      }),
                      s.jsx(ot, {
                        path: '/r/:id',
                        element: s.jsx(dt, { children: s.jsx(Zw, {}) }),
                      }),
                    ],
                  },
                  r.pathname
                ),
                !1,
                e.devtools === '1' && s.jsx(rf, { config: e }),
                s.jsx(H1, {}),
              ],
            }),
          }),
        })
      : s.jsx('div', {
          className: 'p-6 text-sm text-[var(--text-secondary)]',
          children: '載入中…',
        })
  );
}
const al = document.getElementById('root');
if (al) {
  const e = window.location.pathname.startsWith('/maihouses') ? '/maihouses' : '/';
  ta.createRoot(al).render(
    s.jsx(F.StrictMode, {
      children: s.jsx(zd, {
        basename: e,
        future: { v7_startTransition: !0, v7_relativeSplatPath: !0 },
        children: s.jsx(CN, {}),
      }),
    })
  );
}
export { Ul as g };
//# sourceMappingURL=index-By1D1jHu.js.map
