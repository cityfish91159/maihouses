{"version":3,"file":"index-C0hmlZcP.js","sources":["../../src/services/mock/fixtures.ts","../../src/services/mock/index.ts"],"sourcesContent":["import type { PropertyCard, ReviewSnippet, CommunityPreview } from '../../types'\n\nlet seed = 97\nconst rnd = () => ((seed = ((seed * 9301 + 49297) % 233280) / 233280))\n\nconst COMM = ['惠宇上晴', '單元二新苑', '水湳青庭', '七期晶華', '北屯新苑', '西屯國際']\nconst LOC = ['台中西屯', '台中北屯', '台中南屯', '台中西區', '台中北區', '台中南區']\nconst HL = ['雙車位', '採光佳', '邊間', '屋況佳', '近公園', '24H管理', '格局方正']\nconst AU = ['住戶A', '住戶B', '住戶C', '準住戶D', '住戶E']\nconst TX = ['管理嚴謹', '機能方便', '中庭維護佳', '車位好停', '生活圈便利']\n\nconst hash32 = (s: string) => {\n  let h = 2166136261 >>> 0\n  for (let i = 0; i < s.length; i++) {\n    h ^= s.codePointAt(i) ?? 0\n    h = (h * 16777619) >>> 0\n  }\n  return h\n}\n\nexport const reseed = (k: number) => {\n  seed = (k % 233279) + 1\n}\n\nexport const makeReview = (i: number): ReviewSnippet => ({\n  id: `r${i}`,\n  authorMask: AU[i % AU.length] ?? '',\n  content: TX[Math.floor(rnd() * TX.length)] ?? '',\n  ts: new Date(Date.now() - i * 36e5).toISOString()\n})\n\nexport function makeProperty(i: number): PropertyCard {\n  const cname = COMM[i % COMM.length] ?? ''\n  const highlights = [HL[Math.floor(rnd() * HL.length)] ?? '', HL[Math.floor(rnd() * HL.length)] ?? ''].filter(Boolean)\n  return {\n    id: `p${i}`,\n    title: `${cname} 景觀${(i % 3) + 2}房`,\n    price: 1500 + Math.floor(rnd() * 2000),\n    communityId: `c${i % COMM.length}`,\n    communityName: cname,\n    cover: `https://picsum.photos/seed/mai-${i}/800/450`,\n    highlights,\n    reviewsTop2: [makeReview(i * 2), makeReview(i * 2 + 1)]\n  }\n}\n\nexport function makeCommunity(i: number): CommunityPreview {\n  return {\n    id: `c${i}`,\n    name: COMM[i % COMM.length] ?? '',\n    cover: `https://picsum.photos/seed/comm-${i}/600/300`,\n    score: 4 + Math.floor(rnd() * 10) / 10,\n    reviewCount: 10 + Math.floor(rnd() * 90),\n    location: LOC[i % LOC.length] ?? ''\n  }\n}\n\nexport const makeProperties = (n = 24) => Array.from({ length: n }, (_, i) => makeProperty(i + 1))\nexport const makeCommunities = (n = 6) => Array.from({ length: n }, (_, i) => makeCommunity(i))\n\nexport const makePropertiesDeterministic = (key: string, n = 24) => {\n  reseed(hash32(key))\n  return makeProperties(n)\n}\n\n// ====== 固定社區評價（社區牆六則） ======\n// 社區：惠宇上晴（c0）\n// 來源：MVP 靜態頁面 community_wall_MVP_green_tags.html\n// 只保留必要欄位（未加 rating / tags，可日後擴充型別）\nexport const COMMUNITY_REVIEWS: Record<string, ReviewSnippet[]> = {\n  c0: [\n    {\n      id: 'c0r1',\n      authorMask: 'J***',\n      content: '公設維護得乾淨，假日草皮有人整理。之前反映停車動線，管委會一週內就公告改善。',\n      ts: new Date(Date.now() - 2 * 3_600_000).toISOString()\n    },\n    {\n      id: 'c0r2',\n      authorMask: 'W***',\n      content: '住起來整體舒服，但面向上路的低樓層在上下班尖峰車聲明顯，喜靜的買家可考慮中高樓層。',\n      ts: new Date(Date.now() - 4 * 3_600_000).toISOString()\n    },\n    {\n      id: 'c0r3',\n      authorMask: 'L***',\n      content: '頂樓排水設計不錯，颱風天也沒有積水問題。不過垃圾車時間稍晚，家裡偶爾會有下水道味。',\n      ts: new Date(Date.now() - 6 * 3_600_000).toISOString()\n    },\n    // 另外三則（原頁面隱藏）自擬內容，提供更完整測試資料\n    {\n      id: 'c0r4',\n      authorMask: 'H***',\n      content: '晚間公共照明足夠，走廊不陰暗。建議之後能更新健身房幾台老舊器材。',\n      ts: new Date(Date.now() - 8 * 3_600_000).toISOString()\n    },\n    {\n      id: 'c0r5',\n      authorMask: 'A***',\n      content: '垃圾分類與回收管理還不錯，管理員態度親切。有時收包裹要稍等，但整體效率可以接受。',\n      ts: new Date(Date.now() - 10 * 3_600_000).toISOString()\n    },\n    {\n      id: 'c0r6',\n      authorMask: 'K***',\n      content: '車道轉彎半徑偏小，新手第一次會緊張；不過停車場指示標示清楚，熟悉後就順手。',\n      ts: new Date(Date.now() - 12 * 3_600_000).toISOString()\n    }\n  ]\n}\n","import { getConfig } from '../../app/config'\nimport { makePropertiesDeterministic, makeProperties, makeReview, makeCommunities, COMMUNITY_REVIEWS } from './fixtures'\nimport type { ApiResponse, Paginated, PropertyCard, AiAskRes } from '../../types'\n\nconst idempotent = new Map<string, ApiResponse<AiAskRes>>()\nconst delay = (ms: number) => new Promise((r) => setTimeout(r, ms))\nconst maybeFail = (rate: number) => {\n  if (rate > 0 && Math.random() < rate) throw new Error('Mock 網路失敗')\n}\n\nfunction header(options: RequestInit, key: string) {\n  const h = options.headers\n  if (!h) return\n  if (h instanceof Headers) return h.get(key) || undefined\n  if (Array.isArray(h)) return h.find(([k]) => k.toLowerCase() === key.toLowerCase())?.[1]\n  const o = h\n  return o[key] ?? o[key.toLowerCase()]\n}\n\nexport async function mockHandler<T = unknown>(endpoint: string, options: RequestInit): Promise<ApiResponse<T>> {\n  const cfg = await getConfig()\n  await delay(cfg.latency ?? 0)\n  maybeFail(cfg.error ?? 0)\n\n  if (endpoint === '/api/v1/uag/events') return { ok: true, data: null as any }\n  \n  if (/^\\/api\\/v1\\/meta$/.test(endpoint))\n    return { ok: true, data: { backendVersion: '1.0.7', apiVersion: 'v1', maintenance: false } as any }\n\n  if (endpoint.startsWith('/api/v1/properties?')) {\n    const sp = new URLSearchParams(endpoint.split('?')[1] || '')\n    const page = +sp.get('page')! || 1\n    const pageSize = +sp.get('pageSize')! || 8\n    const keyword = sp.get('q') || ''\n    const key = `${cfg.mockSeed ?? ''}|${keyword}|${page}`\n    \n    let items = makePropertiesDeterministic(key, 24)\n    if (keyword) items = items.filter((p) => p.title.includes(keyword) || p.communityName.includes(keyword))\n    \n    const data: Paginated<PropertyCard> = {\n      items: items.slice((page - 1) * pageSize, page * pageSize),\n      page,\n      pageSize,\n      total: items.length\n    }\n    return { ok: true, data: data as any }\n  }\n\n  if (/^\\/api\\/v1\\/properties\\/[^/?]+$/.test(endpoint)) {\n    const id = endpoint.split('/').pop()!\n    const p = makeProperties(24).find((x) => x.id === id)\n    return p ? { ok: true, data: p as any } : { ok: false, error: { code: 'NOT_FOUND', message: '物件不存在' } }\n  }\n\n  if (/^\\/api\\/v1\\/communities\\/.+\\/reviews\\?/.test(endpoint)) {\n    // 解析 communityId\n    const m = /^\\/api\\/v1\\/communities\\/([^/?]+)\\/reviews\\?/.exec(endpoint)!\n    const communityId = m?.[1] ?? ''\n    const sp = new URLSearchParams(endpoint.split('?')[1] || '')\n    const limit = +sp.get('limit')! || 2\n    const offset = +sp.get('offset')! || 0\n\n    const fixed = COMMUNITY_REVIEWS[communityId]\n    if (fixed && fixed.length > 0) {\n      const sliced = fixed.slice(offset, offset + limit)\n      return { ok: true, data: sliced as any }\n    }\n\n    // fallback：舊隨機生成\n    const reviews = Array.from({ length: limit }, (_, i) => makeReview(i + offset))\n    return { ok: true, data: reviews as any }\n  }\n\n  if (/^\\/api\\/v1\\/communities\\/preview$/.test(endpoint)) {\n    return { ok: true, data: makeCommunities(6) as any }\n  }\n\n  // AI 助理已接 OpenAI API，不使用 mock\n  if (endpoint === '/api/v1/ai/ask') {\n    return { ok: false, error: { code: 'USE_REAL_API', message: 'AI 助理使用真實 OpenAI API' } }\n  }\n\n  return { ok: false, error: { code: 'NOT_FOUND', message: '端點不存在' } }\n}\n"],"names":["seed","rnd","COMM","LOC","HL","AU","TX","hash32","s","h","i","reseed","k","makeReview","makeProperty","cname","highlights","makeCommunity","makeProperties","n","_","makeCommunities","makePropertiesDeterministic","key","COMMUNITY_REVIEWS","delay","ms","r","maybeFail","rate","mockHandler","endpoint","options","cfg","getConfig","sp","page","pageSize","keyword","items","p","id","x","m","communityId","limit","offset","fixed"],"mappings":"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"}