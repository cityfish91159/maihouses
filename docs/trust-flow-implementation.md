# å®‰å¿ƒç•™ç—•å·¥å–®

## æ‘˜è¦ï¼ˆæŒ‰æ–½å·¥é †åºï¼‰

### Phase 1ï¼šè³‡æ–™åº«
| # | ä»»å‹™ | ç‹€æ…‹ |
|---|------|------|
| DB-1 | è³‡æ–™åº«åŠ  trust_enabled æ¬„ä½ | âœ… |
| DB-2 | è³‡æ–™åº«åŠ æ¡ˆä»¶ç‹€æ…‹æ¬„ä½ | â–¡ |
| DB-3 | è³‡æ–™åº«åŠ  token æ¬„ä½ | â–¡ |
| DB-4 | è³‡æ–™åº«åŠ  buyer æ¬„ä½ | â–¡ |

### Phase 2ï¼šæ ¸å¿ƒå¾Œç«¯ API
| # | ä»»å‹™ | ç‹€æ…‹ |
|---|------|------|
| BE-1 | ä¸Šå‚³ API å­˜ trust_enabled | â–¡ |
| BE-2 | è£œé–‹å®‰å¿ƒæœå‹™ API | â–¡ |
| BE-7 | æŸ¥è©¢é€šçŸ¥ç›®æ¨™ | â–¡ |
| BE-8 | æ¨æ’­å¤±æ•—è™•ç† | â–¡ |
| BE-5 | é€²åº¦æ›´æ–°æ¨æ’­ | â–¡ |
| BE-9 | æ¡ˆä»¶é—œé–‰é€šçŸ¥ | â–¡ |
| BE-3 | LINE æŸ¥è©¢äº¤æ˜“ API | â–¡ |
| BE-4 | LINE webhook è™•ç†ã€Œæˆ‘çš„äº¤æ˜“ã€ | â–¡ |
| BE-6 | æ¶ˆè²»è€…æ¡ˆä»¶åˆ—è¡¨ API | â–¡ |
| BE-10 | å–šé†’ä¼‘çœ  API | â–¡ |

### Phase 3ï¼šå‰ç«¯
| # | ä»»å‹™ | ç‹€æ…‹ |
|---|------|------|
| FE-1 | ä¸Šå‚³é åŠ å®‰å¿ƒæœå‹™é–‹é—œ | â–¡ |
| FE-2 | è©³æƒ…é åŠ å®‰å¿ƒå¾½ç«  | â–¡ |
| FE-3 | Trust Room åŠ è¨»å†Šå¼•å° | â–¡ |
| FE-5 | Trust Room ç‹€æ…‹ Banner | â–¡ |
| FE-4 | Feed é åŠ äº¤æ˜“åˆ—è¡¨ | â–¡ |
| FE-6 | UAG ä¼‘çœ æ¡ˆä»¶ UI | â–¡ |

### Phase 4ï¼šç”Ÿå‘½é€±æœŸ
| # | ä»»å‹™ | ç‹€æ…‹ |
|---|------|------|
| LC-1 | æˆäº¤æ™‚é—œé–‰å…¶ä»–æ¡ˆä»¶ | â–¡ |
| LC-2 | ç‰©ä»¶ä¸‹æ¶æ™‚é—œé–‰æ¡ˆä»¶ | â–¡ |
| LC-3 | æ¯æ—¥ä¼‘çœ æª¢æŸ¥ | â–¡ |
| LC-4 | ä¼‘çœ éæœŸè‡ªå‹•é—œé–‰ | â–¡ |

---

## å•†æ¥­æ¨¡å¼

**æ ¸å¿ƒæ¦‚å¿µ**ï¼šå®‰å¿ƒç•™ç—•æ˜¯ã€Œæˆ¿ä»²èˆ‡æ¶ˆè²»è€…ä¹‹é–“çš„äº¤æ˜“è¿½è¹¤ã€ï¼Œä¸æ˜¯ç‰©ä»¶å±¬æ€§ã€‚

```
ä¸€å€‹ç‰©ä»¶ï¼ˆMH-100001ï¼‰
â”œâ”€â”€ æ¶ˆè²»è€… A é ç´„ â†’ æ¡ˆä»¶ A â†’ ç¨ç«‹ M1â†’M6 é€²åº¦
â”œâ”€â”€ æ¶ˆè²»è€… B é ç´„ â†’ æ¡ˆä»¶ B â†’ ç¨ç«‹ M1â†’M6 é€²åº¦
â”œâ”€â”€ æ¶ˆè²»è€… C é ç´„ â†’ æ¡ˆä»¶ C â†’ ç¨ç«‹ M1â†’M6 é€²åº¦
â”‚   ...ï¼ˆå¯èƒ½ 100 å€‹æ½›åœ¨è²·æ–¹ï¼‰
â””â”€â”€ æœ€çµ‚ 1 å€‹æˆäº¤ï¼ˆM5ï¼‰â†’ åªæœ‰é€™å€‹æ¡ˆä»¶æ”¶è²»
```

**æ”¶è²»é»**ï¼šM5 æˆäº¤æ™‚æ‰æ”¶è²»ï¼Œå…¶ä»–éšæ®µå…è²»

---

## å•é¡Œèˆ‡è§£æ±º

| å•é¡Œ | è§£æ±ºæ–¹æ¡ˆ |
|------|----------|
| ç‰©ä»¶æœ‰å¤šäººè©¢å•ï¼Œä½†åªæœ‰ 1 å€‹æœƒæˆäº¤ï¼Œå…¶ä»– 99 å€‹æ¡ˆä»¶æ€éº¼è¾¦ï¼Ÿ | æ¡ˆä»¶ç”Ÿå‘½é€±æœŸç®¡ç†ï¼š30 å¤©ç„¡äº’å‹• â†’ ä¼‘çœ ï¼Œå† 60 å¤© â†’ è‡ªå‹•é—œé–‰ |
| æ¶ˆè²»è€…æ²’è¨»å†Šæ€éº¼è¿½è¹¤äº¤æ˜“ï¼Ÿ | Token é€£çµ + LINE ç¶å®šï¼Œè¼¸å…¥ã€Œæˆ‘çš„äº¤æ˜“ã€æŸ¥è©¢æ‰€æœ‰æ¡ˆä»¶ |
| æ¶ˆè²»è€…ä¸çŸ¥é“é€²åº¦æœ‰æ›´æ–°ï¼Ÿ | å„ªå…ˆ push é€šçŸ¥ï¼Œfallback LINE æ¨æ’­ |
| ç‰©ä»¶æˆäº¤äº†ï¼Œå…¶ä»–æ¡ˆä»¶æ€éº¼è™•ç†ï¼Ÿ | è‡ªå‹•é—œé–‰ä¸¦é€šçŸ¥ã€Œç‰©ä»¶å·²ç”±ä»–äººæˆäº¤ã€ |
| ç‰©ä»¶ä¸‹æ¶äº†ï¼Œæ¡ˆä»¶æ€éº¼è¾¦ï¼Ÿ | è‡ªå‹•é—œé–‰ä¸¦é€šçŸ¥ã€Œç‰©ä»¶å·²ä¸‹æ¶ã€ |
| æˆ¿ä»²æ€éº¼çŸ¥é“å“ªäº›æ¡ˆä»¶è©²è·Ÿé€²ï¼Ÿ | UAG å¾Œå°åˆ†é¡é¡¯ç¤ºï¼šé€²è¡Œä¸­ / ä¼‘çœ  / æˆäº¤ |

---

## DB-1 | è³‡æ–™åº«åŠ  trust_enabled æ¬„ä½ âœ…

**ç‚ºä»€éº¼**
ç‰©ä»¶è¦èƒ½æ¨™è¨˜ã€Œæœ‰æ²’æœ‰é–‹å®‰å¿ƒç•™ç—•ã€ï¼Œè©³æƒ…é æ‰çŸ¥é“è¦ä¸è¦é¡¯ç¤ºå¾½ç« ï¼Œä¸Šå‚³é æ‰æœ‰æ±è¥¿å¯ä»¥å­˜ã€‚

**åšä»€éº¼**
```sql
ALTER TABLE properties ADD COLUMN trust_enabled BOOLEAN DEFAULT false;
```

**æ”¹å“ªè£¡**
`supabase/migrations/20260122_add_trust_enabled.sql`

**é©—è­‰**
```sql
SELECT trust_enabled FROM properties LIMIT 1;
-- æœ‰å›å‚³ false å°±æ˜¯æˆåŠŸ
```

**æ–½ä½œç´€éŒ„** (2026-01-21)
- Migration æª”æ¡ˆå·²å­˜åœ¨ï¼š`20260122_add_trust_enabled.sql`
- æ–°å¢ TypeScript é¡å‹ï¼š`src/types/supabase-schema.ts` PropertyRow.trust_enabled
- RLS æª¢æŸ¥ï¼šç¾æœ‰ UPDATE æ”¿ç­– (`auth.uid() = agent_id`) å·²è¶³å¤ ä¿è­·
- `npm run gate` é€šé

---

## DB-2 |è³‡æ–™åº«åŠ æ¡ˆä»¶ç‹€æ…‹æ¬„ä½

**ç‚ºä»€éº¼**
æ¡ˆä»¶è¦èƒ½ä¼‘çœ ã€é—œé–‰ï¼Œä¸èƒ½æ°¸é ã€Œé€²è¡Œä¸­ã€ã€‚100 å€‹æ¡ˆä»¶åªæœ‰ 1 å€‹æˆäº¤ï¼Œå¦å¤– 99 å€‹è¦èƒ½è‡ªå‹•è™•ç†æ‰ã€‚

**åšä»€éº¼**
```sql
-- åŠ ç‹€æ…‹æ¬„ä½
ALTER TABLE trust_cases ADD COLUMN status VARCHAR(30) DEFAULT 'active';
-- active, dormant, completed, closed_sold_to_other, closed_property_unlisted, closed_inactive

-- åŠ ä¼‘çœ æ™‚é–“
ALTER TABLE trust_cases ADD COLUMN dormant_at TIMESTAMPTZ;

-- åŠ é—œé–‰æ™‚é–“å’ŒåŸå› 
ALTER TABLE trust_cases ADD COLUMN closed_at TIMESTAMPTZ;
ALTER TABLE trust_cases ADD COLUMN closed_reason TEXT;
```

**æ”¹å“ªè£¡**
`supabase/migrations/20260122_add_case_status.sql`

**é©—è­‰**
```sql
SELECT status, dormant_at, closed_at FROM trust_cases LIMIT 1;
-- æœ‰æ¬„ä½å°±æ˜¯æˆåŠŸ
```

---

## DB-3 |è³‡æ–™åº«åŠ  token æ¬„ä½

**ç‚ºä»€éº¼**
æ¶ˆè²»è€…è¦èƒ½ç”¨ Token é€£çµé€²å…¥ Trust Roomï¼Œä¸ç”¨ç™»å…¥ä¹Ÿèƒ½çœ‹é€²åº¦ã€‚Token è¦æœ‰éæœŸæ™‚é–“ã€‚

**åšä»€éº¼**
```sql
ALTER TABLE trust_cases ADD COLUMN token UUID DEFAULT gen_random_uuid();
ALTER TABLE trust_cases ADD COLUMN token_expires_at TIMESTAMPTZ DEFAULT NOW() + INTERVAL '90 days';

CREATE UNIQUE INDEX idx_trust_cases_token ON trust_cases(token);
```

**æ”¹å“ªè£¡**
`supabase/migrations/20260122_add_case_token.sql`

**é©—è­‰**
```sql
SELECT token, token_expires_at FROM trust_cases LIMIT 1;
-- æœ‰ UUID å’ŒéæœŸæ™‚é–“å°±æ˜¯æˆåŠŸ
```

---

## DB-4 |è³‡æ–™åº«åŠ  buyer æ¬„ä½

**ç‚ºä»€éº¼**
æ¡ˆä»¶è¦è¨˜éŒ„ã€Œè²·æ–¹æ˜¯èª°ã€ï¼Œå¯èƒ½æ˜¯å·²è¨»å†Šç”¨æˆ¶ï¼ˆuser_idï¼‰æˆ–æœªè¨»å†Šç”¨æˆ¶ï¼ˆline_idï¼‰ã€‚é€™æ¨£æ‰çŸ¥é“è¦é€šçŸ¥èª°ã€‚

**åšä»€éº¼**
```sql
ALTER TABLE trust_cases ADD COLUMN buyer_user_id UUID REFERENCES auth.users(id);
ALTER TABLE trust_cases ADD COLUMN buyer_line_id TEXT;

CREATE INDEX idx_trust_cases_buyer_user ON trust_cases(buyer_user_id);
CREATE INDEX idx_trust_cases_buyer_line ON trust_cases(buyer_line_id);
```

**æ”¹å“ªè£¡**
`supabase/migrations/20260122_add_case_buyer.sql`

**é©—è­‰**
```sql
SELECT buyer_user_id, buyer_line_id FROM trust_cases LIMIT 1;
-- æœ‰æ¬„ä½å°±æ˜¯æˆåŠŸ
```

---

## FE-1 |ä¸Šå‚³é åŠ å®‰å¿ƒæœå‹™é–‹é—œ

**ç‚ºä»€éº¼**
æˆ¿ä»²ä¸Šå‚³ç‰©ä»¶æ™‚è¦èƒ½é¸ã€Œé–‹ä¸é–‹å®‰å¿ƒç•™ç—•ã€ã€‚ç¾åœ¨ä¸Šå‚³é æ²’é€™å€‹é¸é …ï¼Œæˆ¿ä»²æƒ³é–‹ä¹Ÿé–‹ä¸äº†ã€‚

**åšä»€éº¼**
åœ¨ä¸Šå‚³è¡¨å–®åŠ ä¸€å€‹ Toggleï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ›¡ï¸ å®‰å¿ƒç•™ç—•æœå‹™                     â”‚
â”‚                                     â”‚
â”‚ [Toggle] é–‹å•Ÿå®‰å¿ƒç•™ç—•               â”‚
â”‚                                     â”‚
â”‚ ç‚ºæ¶ˆè²»è€…æä¾›å…­éšæ®µäº¤æ˜“è¿½è¹¤          â”‚
â”‚ ğŸ’¡ åƒ…åœ¨æˆäº¤æ™‚æ”¶å–æœå‹™è²»             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ”¹å“ªè£¡**
- `src/pages/PropertyUploadPage.tsx`ï¼ˆåŠ  UIï¼‰
- `src/components/upload/UploadContext.tsx`ï¼ˆåŠ  stateï¼‰

**é©—è­‰**
ä¸Šå‚³é æœ‰ Toggleï¼Œå¯ä»¥é–‹é—œï¼Œé€å‡ºæ™‚ console èƒ½çœ‹åˆ° trust_enabled å€¼

---

## FE-2 |è©³æƒ…é åŠ å®‰å¿ƒå¾½ç« 

**ç‚ºä»€éº¼**
æ¶ˆè²»è€…çœ‹ç‰©ä»¶æ™‚è¦çŸ¥é“ã€Œé€™ç‰©ä»¶æœ‰æ²’æœ‰å®‰å¿ƒç•™ç—•ã€ã€‚ç¾åœ¨è©³æƒ…é çœ‹ä¸å‡ºä¾†ï¼Œæˆ¿ä»²é–‹äº†æœå‹™æ¶ˆè²»è€…ä¹Ÿä¸çŸ¥é“ã€‚

**åšä»€éº¼**
trust_enabled=true æ™‚é¡¯ç¤ºå¾½ç« ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ›¡ï¸ å®‰å¿ƒç•™ç—•                         â”‚
â”‚                                     â”‚
â”‚ æœ¬ç‰©ä»¶æ”¯æ´å®‰å¿ƒäº¤æ˜“ç•™ç—•æœå‹™          â”‚
â”‚ âœ“ å…­éšæ®µäº¤æ˜“è¿½è¹¤                    â”‚
â”‚ âœ“ æ¯æ­¥é©Ÿæ•¸ä½ç•™ç—•                    â”‚
â”‚ âœ“ é›™æ–¹ç¢ºèªæ©Ÿåˆ¶                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ”¹å“ªè£¡**
- æ–°å¢ `src/components/TrustBadge.tsx`
- ä¿®æ”¹ `src/pages/PropertyDetailPage.tsx`ï¼ˆå¼•å…¥ä¸¦æ”¾åœ¨å´é‚Šæ¬„ï¼‰

**é©—è­‰**
- trust_enabled=true çš„ç‰©ä»¶ï¼šé¡¯ç¤ºå¾½ç« 
- trust_enabled=false çš„ç‰©ä»¶ï¼šä¸é¡¯ç¤º

---

## FE-3 |Trust Room åŠ è¨»å†Šå¼•å°

**ç‚ºä»€éº¼**
æ¶ˆè²»è€…ç”¨ Token é€£çµé€² Trust Room çœ‹å®Œé€²åº¦å°±èµ°äº†ï¼Œæ²’æœ‰ä»»ä½•æ±è¥¿å¼•å°ä»–è¨»å†Šã€‚å¹³å°æµå¤±æ½›åœ¨æœƒå“¡ã€‚

**åšä»€éº¼**
æœªç™»å…¥æ™‚åœ¨é é¢åº•éƒ¨é¡¯ç¤ºï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ’¡ è¨»å†Šé‚æˆ¿å­æœƒå“¡                   â”‚
â”‚                                     â”‚
â”‚ âœ“ åœ¨å€‹äººé é¢ç®¡ç†æ‰€æœ‰äº¤æ˜“            â”‚
â”‚ âœ“ å³æ™‚æ¥æ”¶é€²åº¦æ›´æ–°é€šçŸ¥              â”‚
â”‚ âœ“ æ°¸ä¹…ä¿å­˜äº¤æ˜“ç´€éŒ„                  â”‚
â”‚                                     â”‚
â”‚ [ç«‹å³è¨»å†Š]  [ç¨å¾Œå†èªª]              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ”¹å“ªè£¡**
`src/pages/TrustRoom.tsx`

**é©—è­‰**
- æœªç™»å…¥ï¼šçœ‹å¾—åˆ°å¼•å°å€å¡Š
- å·²ç™»å…¥ï¼šçœ‹ä¸åˆ°

---

## FE-4 |Feed é åŠ äº¤æ˜“åˆ—è¡¨

**ç‚ºä»€éº¼**
å·²è¨»å†Šçš„æ¶ˆè²»è€…ç™»å…¥å¾Œï¼Œæ²’åœ°æ–¹çœ‹ã€Œæˆ‘æœ‰å¹¾ç­†äº¤æ˜“åœ¨é€²è¡Œã€ã€‚æ¯æ¬¡éƒ½è¦ç¿»æ‰¾æˆ¿ä»²ç™¼çš„é€£çµï¼Œå¾ˆéº»ç…©ã€‚

**åšä»€éº¼**
åœ¨ Feed é åŠ ã€Œæˆ‘çš„äº¤æ˜“ã€å€å¡Šï¼Œåˆ—å‡ºæ‰€æœ‰é€²è¡Œä¸­çš„æ¡ˆä»¶ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“‹ æˆ‘çš„äº¤æ˜“ (2)                     â”‚
â”‚                                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ  ä¿¡ç¾©å€ä¸‰æˆ¿                    â”‚ â”‚
â”‚ â”‚ æˆ¿ä»²ï¼šç‹å°æ˜                    â”‚ â”‚
â”‚ â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ M3 å‡ºåƒ¹              â”‚ â”‚
â”‚ â”‚ [æŸ¥çœ‹è©³æƒ…]                      â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ  å¤§å®‰å€å…©æˆ¿                    â”‚ â”‚
â”‚ â”‚ æˆ¿ä»²ï¼šæå°è¯                    â”‚ â”‚
â”‚ â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘ M2 å¸¶çœ‹              â”‚ â”‚
â”‚ â”‚ [æŸ¥çœ‹è©³æƒ…]                      â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ”¹å“ªè£¡**
- æ–°å¢ `src/components/Feed/TxList.tsx`ï¼ˆåˆ—è¡¨çµ„ä»¶ï¼‰
- æ–°å¢ `src/components/Feed/TxCard.tsx`ï¼ˆå¡ç‰‡çµ„ä»¶ï¼‰
- ä¿®æ”¹ Feed é é¢å¼•å…¥

**é©—è­‰**
ç™»å…¥å¾Œ Feed é çœ‹å¾—åˆ°äº¤æ˜“åˆ—è¡¨ï¼Œé»ã€ŒæŸ¥çœ‹è©³æƒ…ã€èƒ½é€² Trust Room

---

## FE-5 |Trust Room ç‹€æ…‹ Banner

**ç‚ºä»€éº¼**
æ¡ˆä»¶æœ‰ 6 ç¨®ç‹€æ…‹ï¼ˆactiveã€dormantã€completedã€closed_*ï¼‰ï¼ŒTrust Room è¦é¡¯ç¤ºå°æ‡‰çš„ Banner è®“æ¶ˆè²»è€…çŸ¥é“ç‹€æ³ã€‚

**åšä»€éº¼**
æ ¹æ“šæ¡ˆä»¶ç‹€æ…‹é¡¯ç¤ºä¸åŒ Bannerï¼š

**activeï¼ˆé€²è¡Œä¸­ï¼‰**ï¼šä¸é¡¯ç¤º Bannerï¼Œæ­£å¸¸é¡¯ç¤ºé€²åº¦

**dormantï¼ˆä¼‘çœ ï¼‰**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ’¤ æ­¤äº¤æ˜“å·²ä¼‘çœ             â”‚
â”‚ 30 å¤©ç„¡äº’å‹•                â”‚
â”‚ [è¯ç¹«æˆ¿ä»²ç¹¼çºŒ]             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
èƒŒæ™¯è‰²ï¼š#FEF3C7ï¼ˆé»ƒï¼‰
```

**completedï¼ˆæˆäº¤ï¼‰**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ‰ æ­å–œï¼äº¤æ˜“å·²å®Œæˆ        â”‚
â”‚ æ„Ÿè¬ä½¿ç”¨å®‰å¿ƒç•™ç—•           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
èƒŒæ™¯è‰²ï¼š#D1FAE5ï¼ˆç¶ ï¼‰
```

**closed_sold_to_otherï¼ˆä»–äººæˆäº¤ï¼‰**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¤ç‰©ä»¶å·²ç”±å…¶ä»–è²·æ–¹æˆäº¤     â”‚
â”‚ æ„Ÿè¬æ‚¨çš„é—œæ³¨               â”‚
â”‚ [ç€è¦½å…¶ä»–ç‰©ä»¶]             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
èƒŒæ™¯è‰²ï¼š#F3F4F6ï¼ˆç°ï¼‰
```

**closed_property_unlistedï¼ˆç‰©ä»¶ä¸‹æ¶ï¼‰**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¤ç‰©ä»¶å·²ä¸‹æ¶               â”‚
â”‚ æ¡ˆä»¶å·²é—œé–‰                 â”‚
â”‚ [ç€è¦½å…¶ä»–ç‰©ä»¶]             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
èƒŒæ™¯è‰²ï¼š#F3F4F6ï¼ˆç°ï¼‰
```

**closed_inactiveï¼ˆéæœŸé—œé–‰ï¼‰**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¤æ¡ˆä»¶å› é•·æœŸç„¡äº’å‹•å·²é—œé–‰   â”‚
â”‚ [ç€è¦½å…¶ä»–ç‰©ä»¶]             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
èƒŒæ™¯è‰²ï¼š#F3F4F6ï¼ˆç°ï¼‰
```

**æ”¹å“ªè£¡**
`src/pages/TrustRoom.tsx`

**é©—è­‰**
ä¸åŒç‹€æ…‹çš„æ¡ˆä»¶é€²å…¥ Trust Roomï¼Œçœ‹åˆ°å°æ‡‰çš„ Banner

---

## FE-6 |UAG ä¼‘çœ æ¡ˆä»¶ UI

**ç‚ºä»€éº¼**
æˆ¿ä»²è¦èƒ½çœ‹åˆ°å“ªäº›æ¡ˆä»¶ä¼‘çœ äº†ï¼Œä¸¦ä¸”èƒ½ã€Œå–šé†’ã€å®ƒå€‘ã€‚ç¾åœ¨ä¼‘çœ æ¡ˆä»¶è·Ÿé€²è¡Œä¸­æ¡ˆä»¶æ··åœ¨ä¸€èµ·çœ‹ä¸å‡ºä¾†ã€‚

**åšä»€éº¼**
ä¼‘çœ æ¡ˆä»¶å¡ç‰‡åŠ ä¸Šæ¨™è¨˜å’Œå–šé†’æŒ‰éˆ•ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ’¤ ä¿¡ç¾©å€ãƒ»é™³â—‹â—‹           â”‚
â”‚ â–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ M1 æ¥æ´½        â”‚
â”‚ ä¼‘çœ  15 å¤©                 â”‚
â”‚ [å–šé†’æ¡ˆä»¶]                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
èƒŒæ™¯è‰²ï¼šæ·¡é»ƒè‰²
```

æˆ¿ä»²è¦–è§’å¢åŠ ç¯©é¸å’Œåˆ†é¡ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“‹ æˆ‘çš„æ¡ˆä»¶ (15)   [ç¯©é¸â–¼]â”‚
â”‚ é€²è¡Œä¸­:8 | ä¼‘çœ :5 | æˆäº¤:2â”‚
â”‚                            â”‚
â”‚ ğŸ’¤ ä¼‘çœ æ¡ˆä»¶ (5)    [å±•é–‹â–¼]â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ”¹å“ªè£¡**
`src/pages/UAG/components/TrustFlow/CaseSelector.tsx`

**é©—è­‰**
- ä¼‘çœ æ¡ˆä»¶æœ‰ ğŸ’¤ æ¨™è¨˜å’Œæ·¡é»ƒè‰²èƒŒæ™¯
- æœ‰ã€Œå–šé†’æ¡ˆä»¶ã€æŒ‰éˆ•
- èƒ½ç¯©é¸æ¡ˆä»¶ç‹€æ…‹

---

## BE-1 |ä¸Šå‚³ API å­˜ trust_enabled

**ç‚ºä»€éº¼**
FE-1 å‰ç«¯åŠ äº†é–‹é—œï¼Œå¾Œç«¯è¦èƒ½æ¥æ”¶ä¸¦å­˜é€²è³‡æ–™åº«ã€‚

**åšä»€éº¼**
åœ¨ create API æ¥æ”¶ trust_enabled åƒæ•¸ï¼Œå­˜å…¥ properties è¡¨ã€‚

**æ”¹å“ªè£¡**
`api/property/create.ts`

**é©—è­‰**
ä¸Šå‚³ç‰©ä»¶æ™‚é–‹å•Ÿ Toggleï¼ŒæŸ¥è³‡æ–™åº« trust_enabled=true

---

## BE-2 |è£œé–‹å®‰å¿ƒæœå‹™ API

**ç‚ºä»€éº¼**
å·²ä¸Šå‚³ä½†æ²’é–‹å®‰å¿ƒæœå‹™çš„ç‰©ä»¶ï¼Œæˆ¿ä»²è¦èƒ½ã€Œè£œé–‹ã€ã€‚ä½†é–‹äº†ä¸èƒ½é—œï¼ˆä¸ç„¶æˆ¿ä»²éƒ½é—œæ‰å°±ä¸ç”¨ä»˜éŒ¢ï¼‰ã€‚

**åšä»€éº¼**
```
POST /api/property/enable-trust
Body: { propertyId: "xxx" }

åªå…è¨± false â†’ true
ä¸å…è¨± true â†’ falseï¼ˆå›å‚³éŒ¯èª¤ï¼‰
```

**æ”¹å“ªè£¡**
æ–°å¢ `api/property/enable-trust.ts`

**é©—è­‰**
- trust_enabled=false çš„ç‰©ä»¶ï¼šå‘¼å«å¾Œè®Š true
- trust_enabled=true çš„ç‰©ä»¶ï¼šå‘¼å«å›å‚³éŒ¯èª¤

---

## BE-3 |LINE æŸ¥è©¢äº¤æ˜“ API

**ç‚ºä»€éº¼**
LINE webhook æ”¶åˆ°ã€Œæˆ‘çš„äº¤æ˜“ã€é—œéµå­—æ™‚ï¼Œè¦èƒ½æŸ¥å‡ºé€™å€‹ LINE ç”¨æˆ¶æœ‰å“ªäº›æ¡ˆä»¶ã€‚

**åšä»€éº¼**
```
GET /api/trust/my-cases?lineUserId=Uxxxxxxx

å›å‚³ï¼š
{
  cases: [
    { id, caseName, propertyTitle, agentName, currentStep, status }
  ]
}
```

**æ”¹å“ªè£¡**
æ–°å¢ `api/trust/my-cases.ts`

**é©—è­‰**
ç”¨æœ‰æ¡ˆä»¶çš„ LINE User ID å‘¼å«ï¼Œå›å‚³æ­£ç¢ºæ¡ˆä»¶åˆ—è¡¨

---

## BE-4 |LINE webhook è™•ç†ã€Œæˆ‘çš„äº¤æ˜“ã€

**ç‚ºä»€éº¼**
æ¶ˆè²»è€…åœ¨ LINE è¼¸å…¥ã€Œæˆ‘çš„äº¤æ˜“ã€ï¼Œè¦èƒ½æŸ¥åˆ°è‡ªå·±æ‰€æœ‰é€²è¡Œä¸­çš„æ¡ˆä»¶ã€‚ç¾åœ¨åªæœƒå›ã€Œä½ çš„ LINE User IDã€ã€‚

**åšä»€éº¼**
æ”¶åˆ°ã€Œæˆ‘çš„äº¤æ˜“ã€æ™‚ï¼Œå‘¼å« BE-3 APIï¼Œçµ„æˆå›è¦†è¨Šæ¯ï¼š
```
ğŸ“‹ æ‚¨ç›®å‰æœ‰ 2 ç­†é€²è¡Œä¸­çš„äº¤æ˜“ï¼š

1ï¸âƒ£ ä¿¡ç¾©å€ä¸‰æˆ¿
   æˆ¿ä»²ï¼šç‹å°æ˜
   é€²åº¦ï¼šM3 å‡ºåƒ¹
   [æŸ¥çœ‹è©³æƒ…] â† Trust Room é€£çµ

2ï¸âƒ£ å¤§å®‰å€å…©æˆ¿
   æˆ¿ä»²ï¼šæå°è¯
   é€²åº¦ï¼šM2 å¸¶çœ‹
   [æŸ¥çœ‹è©³æƒ…]
```

**æ”¹å“ªè£¡**
`api/line/webhook.ts`ï¼ˆåœ¨ message äº‹ä»¶åŠ åˆ¤æ–·ï¼‰

**é©—è­‰**
LINE è¼¸å…¥ã€Œæˆ‘çš„äº¤æ˜“ã€ï¼Œå›å‚³æ­£ç¢ºæ ¼å¼

---

## BE-5 |é€²åº¦æ›´æ–°æ¨æ’­

**ç‚ºä»€éº¼**
æˆ¿ä»²æ¨é€²æ­¥é©Ÿæ™‚ï¼Œæ¶ˆè²»è€…è¦æ”¶åˆ° LINE é€šçŸ¥ã€‚ä¸ç„¶æ¶ˆè²»è€…ä¸çŸ¥é“é€²åº¦æœ‰è®ŠåŒ–ã€‚

**åšä»€éº¼**
æ­¥é©Ÿæ¨é€²æ™‚ç™¼é€ LINE æ¨æ’­ï¼š
```
ğŸ  ä¿¡ç¾©å€ä¸‰æˆ¿
æ‚¨çš„äº¤æ˜“é€²åº¦å·²æ›´æ–°ï¼

M2 å¸¶çœ‹ â†’ M3 å‡ºåƒ¹

[æŸ¥çœ‹è©³æƒ…]
```

**æ”¹å“ªè£¡**
- æ–°å¢ `api/trust/notify.ts`ï¼ˆæ¨æ’­å‡½æ•¸ï¼‰
- ä¿®æ”¹ `api/trust/advance-step.ts`ï¼ˆæ¨é€²æ­¥é©Ÿæ™‚å‘¼å«ï¼‰

**é©—è­‰**
æ¨é€²æ­¥é©Ÿå¾Œï¼Œæ¶ˆè²»è€… LINE æ”¶åˆ°é€šçŸ¥

---

## BE-6 |æ¶ˆè²»è€…æ¡ˆä»¶åˆ—è¡¨ API

**ç‚ºä»€éº¼**
FE-4 å‰ç«¯è¦é¡¯ç¤ºäº¤æ˜“åˆ—è¡¨ï¼Œéœ€è¦ API æŸ¥è©¢ã€Œé€™å€‹ç”¨æˆ¶æœ‰å“ªäº›æ¡ˆä»¶ã€ã€‚

**åšä»€éº¼**
```
GET /api/trust/consumer-cases?userId=xxx

å›å‚³ï¼š
{
  cases: [
    { id, caseName, propertyTitle, agentName, currentStep, status, trustRoomUrl }
  ]
}
```

**æ”¹å“ªè£¡**
æ–°å¢ `api/trust/consumer-cases.ts`

**é©—è­‰**
ç”¨æœ‰æ¡ˆä»¶çš„ç”¨æˆ¶ ID å‘¼å«ï¼Œå›å‚³æ­£ç¢ºæ¡ˆä»¶åˆ—è¡¨

---

## BE-7 |æŸ¥è©¢é€šçŸ¥ç›®æ¨™

**ç‚ºä»€éº¼**
ç™¼é€šçŸ¥æ™‚è¦çŸ¥é“ã€Œé€šçŸ¥èª°ã€ã€‚æ¶ˆè²»è€…å¯èƒ½æ˜¯å·²è¨»å†Šç”¨æˆ¶ï¼ˆç”¨ pushï¼‰æˆ–æœªè¨»å†Šç”¨æˆ¶ï¼ˆç”¨ LINEï¼‰ã€‚è¦æœ‰å„ªå…ˆé †åºã€‚

**åšä»€éº¼**
```typescript
// å„ªå…ˆé †åºï¼šuser_id > line_id
async function getNotifyTarget(caseId: string) {
  const trustCase = await getTrustCase(caseId);

  if (trustCase.buyer_user_id) {
    return { type: 'push', userId: trustCase.buyer_user_id };
  }

  if (trustCase.buyer_line_id) {
    return { type: 'line', lineId: trustCase.buyer_line_id };
  }

  return null; // ç„¡æ³•é€šçŸ¥
}
```

**æ”¹å“ªè£¡**
`api/trust/notify.ts`

**é©—è­‰**
- æœ‰ buyer_user_id çš„æ¡ˆä»¶ï¼šå›å‚³ push é¡å‹
- åªæœ‰ buyer_line_id çš„æ¡ˆä»¶ï¼šå›å‚³ line é¡å‹
- éƒ½æ²’æœ‰çš„æ¡ˆä»¶ï¼šå›å‚³ null

---

## BE-8 |æ¨æ’­å¤±æ•—è™•ç†

**ç‚ºä»€éº¼**
LINE å¯èƒ½é™æµã€ç”¨æˆ¶å¯èƒ½å°é–ã€‚æ¨æ’­å¤±æ•—ä¸èƒ½å°±é€™æ¨£ç®—äº†ï¼Œè¦é‡è©¦ï¼Œé‚„è¦æœ‰é™ç´šæ©Ÿåˆ¶ã€‚

**åšä»€éº¼**
```typescript
async function sendNotification(target, message) {
  try {
    if (target.type === 'push') {
      await sendPush(target.userId, message);
    } else {
      await sendLine(target.lineId, message);
    }
  } catch (error) {
    // é‡è©¦ä¸€æ¬¡
    await delay(1000);
    try {
      await retry();
    } catch {
      // è¨˜éŒ„å¤±æ•—
      await logNotificationFailure(target, message);

      // é™ç´šï¼špush å¤±æ•—å˜—è©¦ LINE
      if (target.type === 'push' && target.lineId) {
        await sendLine(target.lineId, message);
      }
    }
  }
}
```

**æ”¹å“ªè£¡**
`api/trust/notify.ts`

**é©—è­‰**
- æ•…æ„è®“æ¨æ’­å¤±æ•—ï¼Œç¢ºèªæœ‰é‡è©¦
- ç¢ºèªæœ‰è¨˜éŒ„å¤±æ•—æ—¥èªŒ
- push å¤±æ•—æ™‚æœ‰å˜—è©¦ LINE

---

## BE-9 |æ¡ˆä»¶é—œé–‰é€šçŸ¥

**ç‚ºä»€éº¼**
æ¡ˆä»¶è¢«é—œé–‰æ™‚æ¶ˆè²»è€…è¦çŸ¥é“ã€‚ä¸åŒé—œé–‰åŸå› è¦æœ‰ä¸åŒæ–‡æ¡ˆã€‚

**åšä»€éº¼**
| é—œé–‰åŸå›  | LINE é€šçŸ¥æ–‡æ¡ˆ |
|----------|---------------|
| closed_sold_to_other | ã€Œæ­¤ç‰©ä»¶å·²ç”±å…¶ä»–è²·æ–¹æˆäº¤ï¼Œæ„Ÿè¬æ‚¨çš„é—œæ³¨ã€‚[ç€è¦½å…¶ä»–ç‰©ä»¶]ã€ |
| closed_property_unlisted | ã€Œæ­¤ç‰©ä»¶å·²ä¸‹æ¶ï¼Œæ¡ˆä»¶å·²é—œé–‰ã€‚[ç€è¦½å…¶ä»–ç‰©ä»¶]ã€ |
| closed_inactive | ã€Œæ¡ˆä»¶å› é•·æœŸç„¡äº’å‹•å·²è‡ªå‹•é—œé–‰ã€‚å¦‚éœ€å”åŠ©è«‹è¯ç¹«å®¢æœã€‚ã€ |

**æ”¹å“ªè£¡**
`api/trust/close.ts`ï¼ˆæˆ–æ•´åˆåˆ° LC-1ã€LC-2ã€LC-4ï¼‰

**é©—è­‰**
æ¡ˆä»¶è¢«é—œé–‰æ™‚ï¼Œæ¶ˆè²»è€… LINE æ”¶åˆ°å°æ‡‰æ–‡æ¡ˆçš„é€šçŸ¥

---

## BE-10 |å–šé†’ä¼‘çœ  API

**ç‚ºä»€éº¼**
ä¼‘çœ çš„æ¡ˆä»¶è¦èƒ½ã€Œå–šé†’ã€å›åˆ° active ç‹€æ…‹ã€‚æˆ¿ä»²æˆ–æ¶ˆè²»è€…éƒ½å¯èƒ½è§¸ç™¼ã€‚

**åšä»€éº¼**
```typescript
// POST /api/trust/wake
async function wake(caseId: string) {
  const trustCase = await getTrustCase(caseId);

  if (trustCase.status !== 'dormant') {
    throw new Error('åªæœ‰ä¼‘çœ æ¡ˆä»¶å¯ä»¥å–šé†’');
  }

  await supabase
    .from('trust_cases')
    .update({
      status: 'active',
      dormant_at: null,
      updated_at: new Date()
    })
    .eq('id', caseId);

  // é€šçŸ¥å°æ–¹
  await sendNotification(
    getNotifyTarget(caseId),
    'æ‚¨çš„äº¤æ˜“å·²æ¢å¾©é€²è¡Œä¸­'
  );
}
```

**æ”¹å“ªè£¡**
æ–°å¢ `api/trust/wake.ts`

**é©—è­‰**
- ä¼‘çœ æ¡ˆä»¶å‘¼å«å¾Œç‹€æ…‹è®Š active
- éä¼‘çœ æ¡ˆä»¶å‘¼å«å›å‚³éŒ¯èª¤
- é›™æ–¹æ”¶åˆ°é€šçŸ¥

---

## LC-1 |æˆäº¤æ™‚é—œé–‰å…¶ä»–æ¡ˆä»¶

**ç‚ºä»€éº¼**
ä¸€å€‹ç‰©ä»¶æœ‰ 100 å€‹æ¡ˆä»¶ï¼Œå…¶ä¸­ 1 å€‹æˆäº¤äº†ï¼Œå¦å¤– 99 å€‹è¦è‡ªå‹•é—œé–‰ï¼ˆæ¨™è¨˜ç‚ºã€Œç‰©ä»¶å·²ç”±ä»–äººæˆäº¤ã€ï¼‰ã€‚

**åšä»€éº¼**
æ¡ˆä»¶é”åˆ° M5ï¼ˆæˆäº¤ï¼‰æ™‚ï¼š
```sql
UPDATE trust_cases
SET status = 'closed_sold_to_other',
    closed_at = NOW(),
    closed_reason = 'ç‰©ä»¶å·²ç”±å…¶ä»–è²·æ–¹æˆäº¤'
WHERE property_id = $property_id
  AND id != $completed_case_id
  AND status IN ('active', 'dormant');
```

**æ”¹å“ªè£¡**
`api/trust/complete.ts`ï¼ˆæˆ–ä¿®æ”¹ç¾æœ‰çš„æ­¥é©Ÿæ¨é€² APIï¼‰

**é©—è­‰**
æ¡ˆä»¶ A æˆäº¤å¾Œï¼ŒåŒç‰©ä»¶çš„æ¡ˆä»¶ Bã€C ç‹€æ…‹è®Šæˆ closed_sold_to_other

---

## LC-2 |ç‰©ä»¶ä¸‹æ¶æ™‚é—œé–‰æ¡ˆä»¶

**ç‚ºä»€éº¼**
æˆ¿ä»²æŠŠç‰©ä»¶ä¸‹æ¶äº†ï¼Œæ‰€æœ‰ç›¸é—œæ¡ˆä»¶è¦é—œé–‰ï¼ˆæ¨™è¨˜ç‚ºã€Œç‰©ä»¶å·²ä¸‹æ¶ã€ï¼‰ã€‚

**åšä»€éº¼**
ç‰©ä»¶ä¸‹æ¶æ™‚ï¼š
```sql
UPDATE trust_cases
SET status = 'closed_property_unlisted',
    closed_at = NOW(),
    closed_reason = 'ç‰©ä»¶å·²ä¸‹æ¶'
WHERE property_id = $property_id
  AND status IN ('active', 'dormant');
```

**æ”¹å“ªè£¡**
`api/property/unlist.ts`ï¼ˆæˆ–ä¿®æ”¹ç¾æœ‰çš„ä¸‹æ¶ APIï¼‰

**é©—è­‰**
ç‰©ä»¶ä¸‹æ¶å¾Œï¼Œæ‰€æœ‰ç›¸é—œæ¡ˆä»¶ç‹€æ…‹è®Šæˆ closed_property_unlisted

---

## LC-3 |æ¯æ—¥ä¼‘çœ æª¢æŸ¥

**ç‚ºä»€éº¼**
æ¡ˆä»¶ 30 å¤©æ²’æœ‰ä»»ä½•äº’å‹•ï¼ˆæ²’æ¨é€²æ­¥é©Ÿã€æ²’ç¢ºèªï¼‰ï¼Œè¦æ¨™è¨˜ç‚ºã€Œä¼‘çœ ã€ã€‚

**åšä»€éº¼**
æ¯æ—¥ Cron Jobï¼š
```sql
UPDATE trust_cases
SET status = 'dormant',
    dormant_at = NOW()
WHERE status = 'active'
  AND updated_at < NOW() - INTERVAL '30 days';
```

**æ”¹å“ªè£¡**
æ–°å¢ `api/cron/trust-dormant.ts`
Vercel cron è¨­å®šæ¯æ—¥ 03:00 åŸ·è¡Œ

**é©—è­‰**
30 å¤©æ²’å‹•çš„æ¡ˆä»¶ï¼Œéš”å¤©ç‹€æ…‹è®Šæˆ dormant

---

## LC-4 |ä¼‘çœ éæœŸè‡ªå‹•é—œé–‰

**ç‚ºä»€éº¼**
ä¼‘çœ ç‹€æ…‹æŒçºŒ 60 å¤©é‚„æ˜¯æ²’äº’å‹•ï¼Œè¦è‡ªå‹•é—œé–‰ï¼ˆæ¨™è¨˜ç‚ºã€ŒéæœŸé—œé–‰ã€ï¼‰ã€‚

**åšä»€éº¼**
æ¯æ—¥ Cron Jobï¼š
```sql
UPDATE trust_cases
SET status = 'closed_inactive',
    closed_at = NOW(),
    closed_reason = 'è¶…é 90 å¤©ç„¡äº’å‹•ï¼Œæ¡ˆä»¶å·²è‡ªå‹•é—œé–‰'
WHERE status = 'dormant'
  AND dormant_at < NOW() - INTERVAL '60 days';
```

**æ”¹å“ªè£¡**
æ–°å¢ `api/cron/trust-expire.ts`
Vercel cron è¨­å®šæ¯æ—¥ 03:30 åŸ·è¡Œ

**é©—è­‰**
ä¼‘çœ è¶…é 60 å¤©çš„æ¡ˆä»¶ï¼Œéš”å¤©ç‹€æ…‹è®Šæˆ closed_inactive

---

## é™„éŒ„ï¼šå…­éšæ®µèªªæ˜

| éšæ®µ | åç¨± | èªªæ˜ | æ”¶è²» |
|------|------|------|------|
| M1 | æ¥æ´½ | é¦–æ¬¡è¯ç¹« | âŒ |
| M2 | å¸¶çœ‹ | å¯¦åœ°çœ‹å±‹ | âŒ |
| M3 | å‡ºåƒ¹ | è²·æ–¹å‡ºåƒ¹ | âŒ |
| M4 | æ–¡æ—‹ | åƒ¹æ ¼å”å•† | âŒ |
| M5 | æˆäº¤ | ç°½ç´„å®Œæˆ | âœ… æ”¶è²» |
| M6 | äº¤å±‹ | é»äº¤å®Œæˆ | âŒ |

---

## é™„éŒ„ï¼šæ¡ˆä»¶ç‹€æ…‹èªªæ˜

| ç‹€æ…‹ | èªªæ˜ | è§¸ç™¼æ¢ä»¶ |
|------|------|----------|
| active | é€²è¡Œä¸­ | å»ºç«‹æ¡ˆä»¶æ™‚ |
| dormant | ä¼‘çœ  | 30 å¤©ç„¡äº’å‹• |
| completed | æˆäº¤ | M5 å®Œæˆ |
| closed_sold_to_other | ä»–äººæˆäº¤ | åŒç‰©ä»¶å…¶ä»–æ¡ˆä»¶ M5 |
| closed_property_unlisted | ç‰©ä»¶ä¸‹æ¶ | æˆ¿ä»²ä¸‹æ¶ç‰©ä»¶ |
| closed_inactive | éæœŸé—œé–‰ | ä¼‘çœ è¶…é 60 å¤© |
