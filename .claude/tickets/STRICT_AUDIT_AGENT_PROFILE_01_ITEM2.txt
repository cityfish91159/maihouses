# STRICT-AUDIT 報告

工單: `AGENT PROFILE.md` #2 [P0] 移除預約看屋 + 雙按鈕 UX 重構  
日期: 2026-02-08  
稽核模式: `/strict-audit`（逐步執行：規格比對 → 程式碼盤點 → 測試驗證 → 差異結論）

---

## 0) 結論

整體結論: **條件式通過（Conditional Pass）**  
- 主流程（使用中的 PropertyDetail 頁）已完成「三按鈕 → LINE + 致電雙按鈕」，且測試/型別/lint 均通過。  
- 但仍有**預約看屋（booking）殘留邏輯**存在於 `src/pages/propertyDetail` 兩個未使用 hook，與「移除預約看屋」目標不一致，建議補清理後再視為完全收斂。

---

## 1) 已完成（簡述）

1. `BookingModal` 主體與相關檔案已刪除。  
2. `PropertyDetailPage` 已改為 LINE / 致電雙路徑，無 booking state/handler/render。  
3. `AgentTrustCard`、`MobileActionBar`、`MobileCTA`、`VipModal` 皆為雙按鈕（LINE + 致電）。  
4. 行動端按鈕觸控高度 `min-h-[44px]` 已落地。  
5. LINE 色已統一走 constants + CSS variable；未發現 `bg-[#06C755]` 類硬編碼直接使用。  
6. 測試與靜態檢查通過（見第 3 節）。

---

## 2) 未完成（詳細）

### [P1] 預約看屋殘留邏輯仍存在於 `src/pages/propertyDetail` hooks（雖目前未被引用）

#### 問題描述
工單 #2 目標是移除預約看屋流程，但下列檔案仍保留完整 booking 狀態、行為與事件追蹤：

- `src/pages/propertyDetail/usePropertyContactActions.ts:8`
- `src/pages/propertyDetail/usePropertyContactActions.ts:22`
- `src/pages/propertyDetail/usePropertyContactActions.ts:32`
- `src/pages/propertyDetail/usePropertyContactActions.ts:35`
- `src/pages/propertyDetail/usePropertyContactActions.ts:38`
- `src/pages/propertyDetail/usePropertyContactActions.ts:41`
- `src/pages/propertyDetail/usePropertyContactActions.ts:103`
- `src/pages/propertyDetail/usePropertyContactActions.ts:133`
- `src/pages/propertyDetail/usePropertyContactActions.ts:183`
- `src/pages/propertyDetail/usePropertyContactActions.ts:195`
- `src/pages/propertyDetail/usePropertyContactActions.ts:207`
- `src/pages/propertyDetail/usePropertyContactActions.ts:214`
- `src/pages/propertyDetail/useContactPanels.ts:5`
- `src/pages/propertyDetail/useContactPanels.ts:13`
- `src/pages/propertyDetail/useContactPanels.ts:16`
- `src/pages/propertyDetail/useContactPanels.ts:19`
- `src/pages/propertyDetail/useContactPanels.ts:82`
- `src/pages/propertyDetail/useContactPanels.ts:91`
- `src/pages/propertyDetail/useContactPanels.ts:96`
- `src/pages/propertyDetail/useContactPanels.ts:107`

#### 風險
1. 後續重構若誤用這兩個 hook，可能把 booking 流程重新帶回線上。  
2. 程式語義與工單「已移除預約看屋」不一致，增加維護成本與認知負擔。  
3. `booking_click` analytics 事件會造成追蹤語意污染。

#### 建議修復
1. 直接刪除上述兩個未使用 hook；或至少移除其中 booking 型別、state、handler、analytics。  
2. 若保留 hook 架構，改名並收斂為 `line/call` 專用 API，避免再出現 `booking` 介面。  
3. 補一個防回歸掃描測試（例如 `rg`/lint rule），禁止 `PropertyDetail` 領域再次引入 booking callback/state。

---

## 3) 實際執行步驟與結果

### A. 規格與範圍定位
- 讀取工單 #2 規格與驗收標準：`.claude/tickets/AGENT PROFILE.md`（#2 區段）。

### B. 刪除項與殘留項檢查
- 檢查刪除檔案：
  - `src/components/PropertyDetail/BookingModal.tsx` → 不存在
  - `src/components/PropertyDetail/bookingUtils.ts` → 不存在
  - `src/components/PropertyDetail/__tests__/BookingModal.test.tsx` → 不存在
- 檢查 `src` 內 `BookingModal` 參照：
  - `rg -n "BookingModal" src` → 無結果

### C. 雙按鈕與樣式檢查
- `src/components/AgentTrustCard.tsx:238` 起：雙按鈕（LINE + 致電），皆 `min-h-[44px]`
- `src/components/PropertyDetail/MobileActionBar.tsx:60` 起：雙按鈕（LINE + 致電），皆 `min-h-[44px]`
- `src/components/PropertyDetail/MobileCTA.tsx:40` 起：雙按鈕（LINE + 致電），皆 `min-h-[44px]`
- `src/components/PropertyDetail/VipModal.tsx:83` 起：雙按鈕（LINE + 致電），無預約按鈕
- `src/pages/PropertyDetailPage.tsx:392` 起：雙路徑 callback；未見 booking state/handler/render

### D. LINE 色統一檢查
- `rg -n "bg-\\[#06C755\\]|#06C755" ...`  
  結果僅出現在 `src/components/PropertyDetail/constants.ts:2`（常數定義，屬預期）

### E. 測試與靜態檢查
1. `npm run test -- src/components/__tests__/AgentTrustCard.memo.test.tsx src/components/PropertyDetail/__tests__/MobileActionBar.test.tsx src/components/PropertyDetail/__tests__/MobileCTA.test.tsx`  
   - 結果: **3 files / 35 tests 全通過**
2. `npm run test -- src/pages/__tests__/PropertyDetailPage.phase11.test.tsx src/pages/__tests__/PropertyDetailPage.handlers.test.tsx src/pages/__tests__/PropertyDetailPage.optimization.test.tsx`  
   - 結果: **3 files / 23 tests 全通過**
3. `npm run typecheck`  
   - 結果: **通過**
4. `npm run lint`  
   - 結果: **通過**

---

## 4) 驗收判定（對照 #2）

1. BookingModal 相關檔案已刪除: **PASS**  
2. AgentTrustCard 雙按鈕: **PASS**  
3. MobileActionBar 雙按鈕 + 觸控面積: **PASS**  
4. MobileCTA 雙按鈕: **PASS**  
5. VipModal 雙按鈕: **PASS**  
6. LINE 色統一 CSS variable: **PASS**  
7. typecheck + lint: **PASS**  
8. 「移除預約看屋」語義完整收斂（無 booking 殘留程式介面）: **FAIL（P1）**

---

## 5) 最終建議

建議將 #2 狀態調整為「**已完成主流程，待清理殘留 booking hooks**」，並新增一個小任務（P1）收尾上述兩個檔案；清理後再視為完全結案。

