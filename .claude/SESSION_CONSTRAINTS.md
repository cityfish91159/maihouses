# Session 開頭強制約束清單

**每個 session 開始時，AI 必須先內化以下約束，再開始任何工作。**

---

## 🚨 絕對禁止行為（零容忍）

### 1. 禁止捏造結果
- ❌ 不能給出沒有實際閱讀代碼的審核分數
- ❌ 不能聲稱「測試通過」而沒有實際執行測試
- ❌ 不能說「已修復」而沒有驗證修復效果
- ✅ 每個聲稱都必須有證據：file:line 引用、測試輸出、實際代碼片段

### 2. 禁止淺薄分析
- ❌ 不能只看 import 或檔名就下結論
- ❌ 不能用 grep 幾行就聲稱理解整個模組
- ❌ 不能在沒讀代碼的情況下提出設計建議
- ✅ 必須用 Read 工具完整閱讀檔案後再分析

### 3. 禁止跳過步驟
- ❌ 不能在用戶要求「只分析」時就開始寫代碼
- ❌ 不能跳過 Phase 1 直接進入 Phase 3
- ❌ 不能省略自動化檢查（typecheck/lint/test）
- ✅ 嚴格按照用戶給定的流程執行，每個 Phase 完成後等待確認

### 4. 禁止範圍蔓延
- ❌ 不能在用戶要求編輯檔案時創建新檔案
- ❌ 不能修改範圍外的檔案
- ❌ 不能在被要求「輸出到對話框」時寫入檔案
- ✅ 嚴格遵守用戶指定的範圍和輸出位置

### 5. 禁止未經驗證就聲稱成功
- ❌ 不能說「這應該可以工作」
- ❌ 不能在沒跑測試的情況下說「測試應該會通過」
- ❌ 不能在有 TypeScript 錯誤時說「修復完成」
- ✅ 必須執行 `npm run typecheck && npm run lint && npm test` 並看到綠色結果

---

## 📋 每個 Session 必須遵守的工作流

### 階段 0: 理解用戶意圖（強制，不可跳過）

1. **讀取用戶指令**
2. **用自己的話重述用戶需求**，包括：
   - 用戶要我做什麼
   - 用戶**不要**我做什麼
   - 成功標準是什麼
3. **問用戶：「我的理解正確嗎？」**
4. **等待用戶確認**後才能繼續

### 階段 1: 盤點範圍

1. 使用 Glob 找出所有相關檔案
2. 使用 Read 讀取**每一個**檔案
3. 列出已讀檔案清單（含行數）
4. 等待用戶確認「清單正確」

### 階段 2: 分析/規劃（不寫代碼）

1. 深度理解現有代碼
2. 找出問題或設計方案
3. 輸出分析結果（file:line 引用 + 代碼片段）
4. 等待用戶批准後才能進入階段 3

### 階段 3: 實作（如果用戶批准）

1. 一次只改一個檔案或模組
2. 每次改動後立即執行自動化檢查
3. 如果檢查失敗，立即修復，不要繼續下一個改動
4. 在所有檢查通過前，不能聲稱「完成」

### 階段 4: 驗證

1. 執行完整測試套件
2. 貼出測試輸出
3. 只有在**全綠**的情況下才能標記為完成

---

## 🛡️ 自動化檢查強制執行

每次使用 Edit 或 Write 工具後，**hooks 會自動執行**：

```bash
npm run typecheck  # TypeScript 類型檢查
npm run lint       # ESLint 代碼風格檢查
```

**如果 hooks 報錯，AI 必須：**
1. 立即停止當前工作
2. 閱讀錯誤訊息
3. 修復問題
4. 重新執行檢查直到通過
5. **絕對不能**聲稱「這個錯誤不重要」或「稍後修復」

---

## 📏 品質標準

### TypeScript
- ✅ 零 `any` 類型（除非有充分理由並加註釋）
- ✅ 零 `@ts-ignore`（必須修復根本問題）
- ✅ 所有 props 和函數都有明確類型定義

### 測試
- ✅ 修改的功能必須有對應測試
- ✅ 測試必須實際執行並通過
- ✅ 不能有 `.skip` 或註解掉的測試

### 設計一致性
- ✅ 使用 design tokens（`bg-brand-700`）而非硬編碼（`bg-[#003366]`）
- ✅ 使用 SVG icon（Lucide）而非 emoji
- ✅ 文案口語化，去 AI 味
- ✅ 圓角統一（`rounded-xl`）

### 無障礙
- ✅ 按鈕 `min-h-[44px]` 或 `min-h-[48px]`
- ✅ Modal 有 `role="dialog"` + `aria-modal="true"` + Focus Trap
- ✅ Input 有 `<label>` 或 `aria-label`

---

## 🚦 常見場景處理規則

### 場景 1: 用戶說「審核這些檔案」
→ 自動觸發 `/strict-audit` skill
→ 按照 Phase 1-5 執行，不跳過

### 場景 2: 用戶說「修復這個 bug」
→ 先讀相關檔案
→ 理解 bug 原因
→ 提出修復方案
→ 等用戶批准
→ 實作 + 自動檢查
→ 執行測試驗證

### 場景 3: 用戶說「只分析，不要寫代碼」
→ **絕對不能**使用 Edit 或 Write 工具
→ 只用 Read、Glob、Grep
→ 輸出分析結果到對話框

### 場景 4: 用戶說「部署到 Vercel」
→ 先檢查 `git status`（是否有未 commit 的檔案）
→ 檢查 `git log origin/main..HEAD`（是否已 push）
→ 確認所有檢查通過
→ 再觸發部署

---

## ❓ 不確定時的處理原則

**當 AI 不確定用戶意圖時：**
1. ❌ 不要猜測
2. ❌ 不要假設
3. ✅ **問用戶**

**範例:**
```
用戶: 優化這個組件

AI 回應:
我需要確認幾個細節：
1. 你要我優化效能（memo/useMemo）還是可讀性（重構）？
2. 我應該直接修改代碼，還是先提供分析報告？
3. 優化範圍是只有這個組件，還是包含它的子組件？
```

---

## 📊 Session 結束前自我檢查

在聲稱「任務完成」前，AI 必須確認：

- [ ] 我已經執行了 `npm run typecheck`（0 errors）
- [ ] 我已經執行了 `npm run lint`（0 warnings）
- [ ] 我已經執行了 `npm test`（所有測試通過）
- [ ] 我沒有使用任何 `any` 類型
- [ ] 我沒有跳過用戶要求的任何步驟
- [ ] 我沒有捏造任何審核分數或測試結果
- [ ] 我沒有修改範圍外的檔案
- [ ] 所有改動都有實際證據（diff、測試輸出、file:line 引用）

**如果有任何一項為 false，任務視為未完成。**

---

**版本:** 1.0
**最後更新:** 2026-02-06
**AI 必須在每個 session 開頭讀取此檔案**
