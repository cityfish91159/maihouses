/**
 * ğŸ† æœ€ä½³å¯¦è¸ API Service æ¨¡æ¿
 *
 * çå‹µé»ï¼š
 * - æ­£ç¢ºçš„é¡å‹å®šç¾© (+8 åˆ†)
 * - JSDoc (+3 åˆ†)
 * - ç²¾ç°¡ä»£ç¢¼ (+5~10 åˆ†)
 * - å¸¸æ•¸å®šç¾© (+5 åˆ†)
 */

// âœ… å¸¸æ•¸å®šç¾©ï¼ˆé¿å…é­”è¡“æ•¸å­—ï¼‰
const API_ENDPOINTS = {
  LIST: '/api/items',
  DETAIL: '/api/items/:id',
  CREATE: '/api/items',
  UPDATE: '/api/items/:id',
  DELETE: '/api/items/:id',
} as const;

const HTTP_STATUS = {
  OK: 200,
  CREATED: 201,
  BAD_REQUEST: 400,
  UNAUTHORIZED: 401,
  NOT_FOUND: 404,
} as const;

// âœ… æ¸…æ™°çš„é¡å‹å®šç¾©
interface ApiResponse<T> {
  data: T;
  message: string;
  success: boolean;
}

interface Item {
  id: string;
  name: string;
  createdAt: string;
}

interface CreateItemPayload {
  name: string;
}

interface UpdateItemPayload {
  name?: string;
}

/**
 * Item API Service
 *
 * @example
 * const items = await itemService.getAll();
 * const item = await itemService.getById('123');
 */
export const itemService = {
  /**
   * å–å¾—æ‰€æœ‰é …ç›®
   */
  async getAll(): Promise<Item[]> {
    const response = await fetch(API_ENDPOINTS.LIST);

    if (!response.ok) {
      throw new Error(`Failed to fetch items: ${response.status}`);
    }

    const result: ApiResponse<Item[]> = await response.json();
    return result.data;
  },

  /**
   * æ ¹æ“š ID å–å¾—å–®ä¸€é …ç›®
   */
  async getById(id: string): Promise<Item> {
    const url = API_ENDPOINTS.DETAIL.replace(':id', id);
    const response = await fetch(url);

    if (response.status === HTTP_STATUS.NOT_FOUND) {
      throw new Error(`Item not found: ${id}`);
    }

    if (!response.ok) {
      throw new Error(`Failed to fetch item: ${response.status}`);
    }

    const result: ApiResponse<Item> = await response.json();
    return result.data;
  },

  /**
   * å»ºç«‹æ–°é …ç›®
   */
  async create(payload: CreateItemPayload): Promise<Item> {
    const response = await fetch(API_ENDPOINTS.CREATE, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload),
    });

    if (!response.ok) {
      throw new Error(`Failed to create item: ${response.status}`);
    }

    const result: ApiResponse<Item> = await response.json();
    return result.data;
  },

  /**
   * æ›´æ–°é …ç›®
   */
  async update(id: string, payload: UpdateItemPayload): Promise<Item> {
    const url = API_ENDPOINTS.UPDATE.replace(':id', id);
    const response = await fetch(url, {
      method: 'PATCH',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload),
    });

    if (!response.ok) {
      throw new Error(`Failed to update item: ${response.status}`);
    }

    const result: ApiResponse<Item> = await response.json();
    return result.data;
  },

  /**
   * åˆªé™¤é …ç›®
   */
  async delete(id: string): Promise<void> {
    const url = API_ENDPOINTS.DELETE.replace(':id', id);
    const response = await fetch(url, { method: 'DELETE' });

    if (!response.ok) {
      throw new Error(`Failed to delete item: ${response.status}`);
    }
  },
};
