/**
 * ğŸ† æœ€ä½³å¯¦è¸ React Context æ¨¡æ¿
 *
 * çå‹µé»ï¼š
 * - æ­£ç¢ºçš„é¡å‹å®šç¾© (+8 åˆ†)
 * - useCallback/useMemo (+5 åˆ†)
 * - early return (+3 åˆ†)
 * - JSDoc (+3 åˆ†)
 */

import {
  createContext,
  useContext,
  useCallback,
  useMemo,
  useState,
  type ReactNode,
} from 'react';

// âœ… æ¸…æ™°çš„é¡å‹å®šç¾©
interface ContextState {
  value: string;
  count: number;
}

interface ContextActions {
  setValue: (value: string) => void;
  increment: () => void;
  reset: () => void;
}

interface ContextValue extends ContextState, ContextActions {}

interface ProviderProps {
  children: ReactNode;
  initialValue?: string;
}

// âœ… é è¨­å€¼
const defaultState: ContextState = {
  value: '',
  count: 0,
};

// âœ… Context å»ºç«‹
const MyContext = createContext<ContextValue | null>(null);

/**
 * MyProvider - Context Provider
 *
 * @example
 * <MyProvider initialValue="hello">
 *   <App />
 * </MyProvider>
 */
export function MyProvider({ children, initialValue = '' }: ProviderProps) {
  const [state, setState] = useState<ContextState>({
    ...defaultState,
    value: initialValue,
  });

  // âœ… useCallback å„ªåŒ–
  const setValue = useCallback((value: string) => {
    setState((prev) => ({ ...prev, value }));
  }, []);

  const increment = useCallback(() => {
    setState((prev) => ({ ...prev, count: prev.count + 1 }));
  }, []);

  const reset = useCallback(() => {
    setState({ ...defaultState, value: initialValue });
  }, [initialValue]);

  // âœ… useMemo å„ªåŒ– context value
  const contextValue = useMemo<ContextValue>(
    () => ({
      ...state,
      setValue,
      increment,
      reset,
    }),
    [state, setValue, increment, reset]
  );

  return (
    <MyContext.Provider value={contextValue}>
      {children}
    </MyContext.Provider>
  );
}

/**
 * useMyContext - è‡ªå®šç¾© Hook å–å¾— Context
 *
 * @throws Error å¦‚æœåœ¨ Provider å¤–ä½¿ç”¨
 */
export function useMyContext(): ContextValue {
  const context = useContext(MyContext);

  // âœ… Early return + éŒ¯èª¤è™•ç†
  if (!context) {
    throw new Error('useMyContext must be used within MyProvider');
  }

  return context;
}
