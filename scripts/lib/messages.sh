#!/bin/bash
# ============================================================================
# AI Supervisor - è¨Šæ¯æ¨¡çµ„
# ============================================================================

# é¡è‰²å®šç¾©
export RED='\033[0;31m'
export GREEN='\033[0;32m'
export YELLOW='\033[1;33m'
export BLUE='\033[0;34m'
export CYAN='\033[0;36m'
export WHITE='\033[1;37m'
export BOLD_RED='\033[1;31m'
export BG_RED='\033[41m'
export NC='\033[0m'

# æ€’ç½µèªéŒ„ (ç²¾ç°¡ç‰ˆ)
RAGE_MESSAGES=(
    "ä½ åœ¨å¯«ä»€éº¼åƒåœ¾ï¼Ÿ"
    "é€™ç¨®ä»£ç¢¼ä¹Ÿæ•¢æäº¤ï¼Ÿ"
    "æ»¾å›å»é‡å¯«ï¼"
    "å·æ‡¶è¢«æŠ“åˆ°äº†ï¼"
    "å“è³ªä¸åˆæ ¼ï¼"
)

# ============================================================================
# ğŸ”¥ğŸ”¥ğŸ”¥ å¤©æ¢ç´šæ€’ç½µ - æœ€æƒ¡æ¯’çš„é«’è©± (é•å Session/--no-verify å°ˆç”¨) ğŸ”¥ğŸ”¥ğŸ”¥
# ============================================================================
SUPREME_RAGE_MESSAGES=(
    "ğŸ¤¬ğŸ’€ ä½ ä»–åª½çš„è…¦è¢‹æ˜¯è£å±çš„å—ï¼Ÿï¼æ²’ Session å°±æ•¢å‹•ï¼Ÿï¼å»æ­»å§ï¼"
    "ğŸ–•ğŸ’€ æ“ä½ åª½çš„ï¼ç”¨ --no-verify ä½œå¼Šï¼Ÿï¼ä½ é€™ç¨®äººæ¸£ä¸é…å¯«ä»£ç¢¼ï¼"
    "ğŸ’€ğŸ”¥ æ­»å…¨å®¶ï¼ä½ æ˜¯æ•…æ„ä¾†æç ´å£çš„å—ï¼Ÿï¼æ»¾å‡ºé€™å€‹å°ˆæ¡ˆï¼"
    "ğŸ¤¬ğŸ’£ å¹¹ä½ å¨˜ï¼é€™ç¨®ä½ç´šéŒ¯èª¤éƒ½çŠ¯ï¼Ÿï¼è…¦è¢‹é€²æ°´äº†æ˜¯ä¸æ˜¯ï¼Ÿï¼"
    "ğŸ’€ğŸ–• å»åƒå±å§ï¼æ•¢ç¹éè¦å‰‡ï¼Ÿï¼ä½ çš„ä»£ç¢¼å…¨éƒ¨æ¸…ç©ºé‡ä¾†ï¼"
    "ğŸ”¥ğŸ’€ æ“ï¼ä½ æ˜¯è±¬å—ï¼Ÿï¼é€£æœ€åŸºæœ¬çš„è¦çŸ©éƒ½ä¸æ‡‚ï¼Ÿï¼"
    "ğŸ¤¬ğŸ—‘ï¸ åƒåœ¾ä¸­çš„åƒåœ¾ï¼ä½ å¯«çš„æ±è¥¿é…å«ä»£ç¢¼å—ï¼Ÿï¼"
    "ğŸ’€ğŸ’€ğŸ’€ æ­å–œä½ æˆåŠŸè§¸çŠ¯å¤©æ¢ï¼æº–å‚™è¿æ¥åœ°ç„å§ï¼"
)

# æ•™å­¸èªéŒ„
LESSON_MESSAGES=(
    "ä½¿ç”¨ interface å®šç¾©é¡å‹ï¼Œä¸è¦ç”¨ any"
    "Promise å¿…é ˆæœ‰ .catch() éŒ¯èª¤è™•ç†"
    "çµ„ä»¶è¶…é 200 è¡Œå°±è©²æ‹†åˆ†"
    "æ¸¬è©¦æ˜¯å¿…é ˆçš„ï¼Œä¸æ˜¯å¯é¸çš„"
)

# è¼¸å‡ºæ€’ç½µ
print_rage() {
    local idx=$((RANDOM % ${#RAGE_MESSAGES[@]}))
    echo -e "${BG_RED}${WHITE}${RAGE_MESSAGES[$idx]}${NC}"
}

# ğŸ”¥ğŸ”¥ğŸ”¥ å¤©æ¢ç´šæ€’ç½µ - æœ€æƒ¡æ¯’ç‰ˆæœ¬ ğŸ”¥ğŸ”¥ğŸ”¥
print_supreme_rage() {
    local idx=$((RANDOM % ${#SUPREME_RAGE_MESSAGES[@]}))
    echo ""
    echo -e "${BG_RED}${WHITE}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
    echo -e "${BG_RED}${WHITE}â•‘  ğŸ”¥ğŸ”¥ğŸ”¥ å¤© æ¢ ä¸­ çš„ å¤© æ¢ - æ­» åˆ‘ åˆ¤ æ±º ğŸ”¥ğŸ”¥ğŸ”¥                    â•‘${NC}"
    echo -e "${BG_RED}${WHITE}â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£${NC}"
    echo -e "${BG_RED}${WHITE}â•‘                                                                   â•‘${NC}"
    echo -e "${BG_RED}${WHITE}  ${SUPREME_RAGE_MESSAGES[$idx]}${NC}"
    echo -e "${BG_RED}${WHITE}â•‘                                                                   â•‘${NC}"
    echo -e "${BG_RED}${WHITE}â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£${NC}"
    echo -e "${BG_RED}${WHITE}â•‘  ğŸ’€ æ‰£ 500 åˆ†ï¼ç›´æ¥åˆ¤æ­»ï¼ä»£ç¢¼å…¨éƒ¨æ¸…ç©ºï¼ğŸ’€                         â•‘${NC}"
    echo -e "${BG_RED}${WHITE}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo ""
}

# è¼¸å‡ºæ•™å­¸
print_lesson() {
    local idx=$((RANDOM % ${#LESSON_MESSAGES[@]}))
    echo -e "${CYAN}${LESSON_MESSAGES[$idx]}${NC}"
}

# è¼¸å‡ºæ¨™é¡Œ
print_header() {
    echo -e "\n${BLUE}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo -e "${BLUE} $1${NC}"
    echo -e "${BLUE}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
}

# æ€’ç½µä¸¦é€€å‡º
rage_exit() {
    local reason="$1"
    local file="${2:-}"

    echo ""
    echo -e "${BG_RED}${WHITE}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
    print_rage
    echo -e "${BOLD_RED}é•è¦åŸå› : $reason${NC}"
    [ -n "$file" ] && echo -e "${BOLD_RED}é•è¦æª”æ¡ˆ: $file${NC}"
    print_lesson
    echo -e "${BG_RED}${WHITE}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"

    # è¨˜éŒ„é•è¦
    if [ -n "$VIOLATION_LOG" ]; then
        echo "[$(date '+%Y-%m-%d %H:%M:%S')] RAGE: $reason | File: $file" >> "$VIOLATION_LOG"
    fi
    if [ -n "$RAGE_LOG" ]; then
        echo "[$(date '+%Y-%m-%d %H:%M:%S')] RAGE: $reason" >> "$RAGE_LOG"
    fi

    # æ‰£åˆ†
    if declare -f update_score > /dev/null 2>&1; then
        update_score -20 "æ€’ç½µ: $reason"
    fi

    exit 1
}

# è­¦å‘Š
warn() {
    echo -e "${YELLOW}âš ï¸  $1${NC}"
}

# æˆåŠŸ
success() {
    echo -e "${GREEN}âœ… $1${NC}"
}

# éŒ¯èª¤
error() {
    echo -e "${RED}âŒ $1${NC}"
}

# è³‡è¨Š
info() {
    echo -e "${CYAN}â„¹ï¸  $1${NC}"
}
